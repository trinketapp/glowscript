/*This is a combined, compressed file.  Look at https://github.com/BruceSherwood/glowscript for source code and copyright information.*/!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var s=t||window.event,a=h.call(arguments,1),r=0,f=0,d=0,c=0,m=0,g=0;if(t=e.event.fix(s),t.type="mousewheel","detail"in s&&(d=s.detail*-1),"wheelDelta"in s&&(d=s.wheelDelta),"wheelDeltaY"in s&&(d=s.wheelDeltaY),"wheelDeltaX"in s&&(f=s.wheelDeltaX*-1),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(f=d*-1,d=0),r=0===d?f:d,"deltaY"in s&&(d=s.deltaY*-1,r=d),"deltaX"in s&&(f=s.deltaX,0===d&&(r=f*-1)),0!==d||0!==f){if(1===s.deltaMode){var w=e.data(this,"mousewheel-line-height");r*=w,d*=w,f*=w}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");r*=v,d*=v,f*=v}if(c=Math.max(Math.abs(d),Math.abs(f)),(!l||c<l)&&(l=c,n(s,c)&&(l/=40)),n(s,c)&&(r/=40,f/=40,d/=40),r=Math[r>=1?"floor":"ceil"](r/l),f=Math[f>=1?"floor":"ceil"](f/l),d=Math[d>=1?"floor":"ceil"](d/l),u.settings.normalizeOffset&&this.getBoundingClientRect){var p=this.getBoundingClientRect();m=t.clientX-p.left,g=t.clientY-p.top}return t.deltaX=f,t.deltaY=d,t.deltaFactor=l,t.offsetX=m,t.offsetY=g,t.deltaMode=0,a.unshift(t,r,f,d),o&&clearTimeout(o),o=setTimeout(i,200),(e.event.dispatch||e.event.handle).apply(this,a)}}function i(){l=null}function n(e,t){return u.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120===0}var o,l,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice;if(e.event.fixHooks)for(var r=s.length;r;)e.event.fixHooks[s[--r]]=e.event.mouseHooks;var u=e.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var i=a.length;i;)this.addEventListener(a[--i],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",u.getLineHeight(this)),e.data(this,"mousewheel-page-height",u.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=a.length;i;)this.removeEventListener(a[--i],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t)["offsetParent"in e.fn?"offsetParent":"parent"]();return i.length||(i=e("body")),parseInt(i.css("fontSize"),10)},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})});
!function(t){t.color={},t.color.make=function(i,e,n,o){var a={};return a.r=i||0,a.g=e||0,a.b=n||0,a.a=null!=o?o:1,a.add=function(t,i){for(var e=0;e<t.length;++e)a[t.charAt(e)]+=i;return a.normalize()},a.scale=function(t,i){for(var e=0;e<t.length;++e)a[t.charAt(e)]*=i;return a.normalize()},a.toString=function(){return a.a>=1?"rgb("+[a.r,a.g,a.b].join(",")+")":"rgba("+[a.r,a.g,a.b,a.a].join(",")+")"},a.normalize=function(){function t(t,i,e){return i<t?t:i>e?e:i}return a.r=t(0,parseInt(a.r),255),a.g=t(0,parseInt(a.g),255),a.b=t(0,parseInt(a.b),255),a.a=t(0,a.a,1),a},a.clone=function(){return t.color.make(a.r,a.b,a.g,a.a)},a.normalize()},t.color.extract=function(i,e){var n;do{if(n=i.css(e).toLowerCase(),""!=n&&"transparent"!=n)break;i=i.parent()}while(!t.nodeName(i.get(0),"body"));return"rgba(0, 0, 0, 0)"==n&&(n="transparent"),t.color.parse(n)},t.color.parse=function(e){var n,o=t.color.make;if(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))return o(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10));if(n=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(e))return o(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseFloat(n[4]));if(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))return o(2.55*parseFloat(n[1]),2.55*parseFloat(n[2]),2.55*parseFloat(n[3]));if(n=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(e))return o(2.55*parseFloat(n[1]),2.55*parseFloat(n[2]),2.55*parseFloat(n[3]),parseFloat(n[4]));if(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))return o(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16));if(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))return o(parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16));var a=t.trim(e).toLowerCase();return"transparent"==a?o(255,255,255,0):(n=i[a]||[0,0,0],o(n[0],n[1],n[2]))};var i={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(t){function e(e,o,a,r){function l(t,i){i=[kt].concat(i);for(var e=0;e<t.length;++e)t[e].apply(this,i)}function s(){for(var i=0;i<r.length;++i){var e=r[i];e.init(kt),e.options&&t.extend(!0,rt,e.options)}}function c(i){var e;for(t.extend(!0,rt,i),null==rt.xaxis.color&&(rt.xaxis.color=rt.grid.color),null==rt.yaxis.color&&(rt.yaxis.color=rt.grid.color),null==rt.xaxis.tickColor&&(rt.xaxis.tickColor=rt.grid.tickColor),null==rt.yaxis.tickColor&&(rt.yaxis.tickColor=rt.grid.tickColor),null==rt.grid.borderColor&&(rt.grid.borderColor=rt.grid.color),null==rt.grid.tickColor&&(rt.grid.tickColor=t.color.parse(rt.grid.color).scale("a",.22).toString()),e=0;e<Math.max(1,rt.xaxes.length);++e)rt.xaxes[e]=t.extend(!0,{},rt.xaxis,rt.xaxes[e]);for(e=0;e<Math.max(1,rt.yaxes.length);++e)rt.yaxes[e]=t.extend(!0,{},rt.yaxis,rt.yaxes[e]);for(rt.xaxis.noTicks&&null==rt.xaxis.ticks&&(rt.xaxis.ticks=rt.xaxis.noTicks),rt.yaxis.noTicks&&null==rt.yaxis.ticks&&(rt.yaxis.ticks=rt.yaxis.noTicks),rt.x2axis&&(rt.xaxes[1]=t.extend(!0,{},rt.xaxis,rt.x2axis),rt.xaxes[1].position="top"),rt.y2axis&&(rt.yaxes[1]=t.extend(!0,{},rt.yaxis,rt.y2axis),rt.yaxes[1].position="right"),rt.grid.coloredAreas&&(rt.grid.markings=rt.grid.coloredAreas),rt.grid.coloredAreasColor&&(rt.grid.markingsColor=rt.grid.coloredAreasColor),rt.lines&&t.extend(!0,rt.series.lines,rt.lines),rt.points&&t.extend(!0,rt.series.points,rt.points),rt.bars&&t.extend(!0,rt.series.bars,rt.bars),null!=rt.shadowSize&&(rt.series.shadowSize=rt.shadowSize),e=0;e<rt.xaxes.length;++e)x(ht,e+1).options=rt.xaxes[e];for(e=0;e<rt.yaxes.length;++e)x(dt,e+1).options=rt.yaxes[e];for(var n in bt)rt.hooks[n]&&rt.hooks[n].length&&(bt[n]=bt[n].concat(rt.hooks[n]));l(bt.processOptions,[rt])}function u(t){at=f(t),g(),v()}function f(i){for(var e=[],n=0;n<i.length;++n){var o=t.extend(!0,{},rt.series);null!=i[n].data?(o.data=i[n].data,delete i[n].data,t.extend(!0,o,i[n]),i[n].data=o.data):o.data=i[n],e.push(o)}return e}function h(t,i){var e=t[i+"axis"];return"object"==typeof e&&(e=e.n),"number"!=typeof e&&(e=1),e}function d(){return t.grep(ht.concat(dt),function(t){return t})}function m(t){var i,e,n={};for(i=0;i<ht.length;++i)e=ht[i],e&&e.used&&(n["x"+e.n]=e.c2p(t.left));for(i=0;i<dt.length;++i)e=dt[i],e&&e.used&&(n["y"+e.n]=e.c2p(t.top));return void 0!==n.x1&&(n.x=n.x1),void 0!==n.y1&&(n.y=n.y1),n}function p(t){var i,e,n,o={};for(i=0;i<ht.length;++i)if(e=ht[i],e&&e.used&&(n="x"+e.n,null==t[n]&&1==e.n&&(n="x"),null!=t[n])){o.left=e.p2c(t[n]);break}for(i=0;i<dt.length;++i)if(e=dt[i],e&&e.used&&(n="y"+e.n,null==t[n]&&1==e.n&&(n="y"),null!=t[n])){o.top=e.p2c(t[n]);break}return o}function x(i,e){return i[e-1]||(i[e-1]={n:e,direction:i==ht?"x":"y",options:t.extend(!0,{},i==ht?rt.xaxis:rt.yaxis)}),i[e-1]}function g(){var i,e=at.length,n=[],o=[];for(i=0;i<at.length;++i){var a=at[i].color;null!=a&&(--e,"number"==typeof a?o.push(a):n.push(t.color.parse(at[i].color)))}for(i=0;i<o.length;++i)e=Math.max(e,o[i]+1);var r=[],l=0;for(i=0;r.length<e;){var s;s=rt.colors.length==i?t.color.make(100,100,100):t.color.parse(rt.colors[i]);var c=l%2==1?-1:1;s.scale("rgb",1+c*Math.ceil(l/2)*.2),r.push(s),++i,i>=rt.colors.length&&(i=0,++l)}var u,f=0;for(i=0;i<at.length;++i){if(u=at[i],null==u.color?(u.color=r[f].toString(),++f):"number"==typeof u.color&&(u.color=r[u.color].toString()),null==u.lines.show){var d,m=!0;for(d in u)if(u[d]&&u[d].show){m=!1;break}m&&(u.lines.show=!0)}u.xaxis=x(ht,h(u,"x")),u.yaxis=x(dt,h(u,"y"))}}function v(){function i(t,i,e){i<t.datamin&&i!=-x&&(t.datamin=i),e>t.datamax&&e!=x&&(t.datamax=e)}var e,n,o,a,r,s,c,u,f,h,m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,x=Number.MAX_VALUE;for(t.each(d(),function(t,i){i.datamin=m,i.datamax=p,i.used=!1}),e=0;e<at.length;++e)r=at[e],r.datapoints={points:[]},l(bt.processRawData,[r,r.data,r.datapoints]);for(e=0;e<at.length;++e){r=at[e];var g=r.data,v=r.datapoints.format;if(v||(v=[],v.push({x:!0,number:!0,required:!0}),v.push({y:!0,number:!0,required:!0}),(r.bars.show||r.lines.show&&r.lines.fill)&&(v.push({y:!0,number:!0,required:!1,defaultValue:0}),r.bars.horizontal&&(delete v[v.length-1].y,v[v.length-1].x=!0)),r.datapoints.format=v),null==r.datapoints.pointsize)for(r.datapoints.pointsize=v.length,c=r.datapoints.pointsize,s=r.datapoints.points,insertSteps=r.lines.show&&r.lines.steps,r.xaxis.used=r.yaxis.used=!0,n=o=0;n<g.length;++n,o+=c){h=g[n];var b=null==h;if(!b)for(a=0;a<c;++a)u=h[a],f=v[a],f&&(f.number&&null!=u&&(u=+u,isNaN(u)?u=null:u==1/0?u=x:u==-(1/0)&&(u=-x)),null==u&&(f.required&&(b=!0),null!=f.defaultValue&&(u=f.defaultValue))),s[o+a]=u;if(b)for(a=0;a<c;++a)u=s[o+a],null!=u&&(f=v[a],f.x&&i(r.xaxis,u,u),f.y&&i(r.yaxis,u,u)),s[o+a]=null;else if(insertSteps&&o>0&&null!=s[o-c]&&s[o-c]!=s[o]&&s[o-c+1]!=s[o+1]){for(a=0;a<c;++a)s[o+c+a]=s[o+a];s[o+1]=s[o-c+1],o+=c}}}for(e=0;e<at.length;++e)r=at[e],l(bt.processDatapoints,[r,r.datapoints]);for(e=0;e<at.length;++e){r=at[e],s=r.datapoints.points,c=r.datapoints.pointsize;var k=m,y=m,T=p,w=p;for(n=0;n<s.length;n+=c)if(null!=s[n])for(a=0;a<c;++a)u=s[n+a],f=v[a],f&&u!=x&&u!=-x&&(f.x&&(u<k&&(k=u),u>T&&(T=u)),f.y&&(u<y&&(y=u),u>w&&(w=u)));if(r.bars.show){var M="left"==r.bars.align?0:-r.bars.barWidth/2;r.bars.horizontal?(y+=M,w+=M+r.bars.barWidth):(k+=M,T+=M+r.bars.barWidth)}i(r.xaxis,k,T),i(r.yaxis,y,w)}t.each(d(),function(t,i){i.datamin==m&&(i.datamin=null),i.datamax==p&&(i.datamax=null)})}function b(i,n){var o=document.createElement("canvas");return o.className=n,o.width=pt,o.height=xt,i||t(o).css({position:"absolute",left:0,top:0}),t(o).appendTo(e),o.getContext||(o=window.G_vmlCanvasManager.initElement(o)),o.getContext("2d").save(),o}function k(){if(pt=e.width(),xt=e.height(),pt<=0||xt<=0)throw"Invalid dimensions for plot, width = "+pt+", height = "+xt}function y(t){t.width!=pt&&(t.width=pt),t.height!=xt&&(t.height=xt);var i=t.getContext("2d");i.restore(),i.save()}function T(){var i,n=e.children("canvas.base"),o=e.children("canvas.overlay");0==n.length||0==o?(e.html(""),e.css({padding:0}),"static"==e.css("position")&&e.css("position","relative"),k(),lt=b(!0,"base"),st=b(!1,"overlay"),i=!1):(lt=n.get(0),st=o.get(0),i=!0),ut=lt.getContext("2d"),ft=st.getContext("2d"),ct=t([st,lt]),i&&(e.data("plot").shutdown(),kt.resize(),ft.clearRect(0,0,pt,xt),ct.unbind(),e.children().not([lt,st]).remove()),e.data("plot",kt)}function w(){rt.grid.hoverable&&(ct.mousemove(G),ct.mouseleave(_)),rt.grid.clickable&&ct.click(J),l(bt.bindEvents,[ct])}function M(){Tt&&clearTimeout(Tt),ct.unbind("mousemove",G),ct.unbind("mouseleave",_),ct.unbind("click",J),l(bt.shutdown,[ct])}function C(t){function i(t){return t}var e,n,o=t.options.transform||i,a=t.options.inverseTransform;"x"==t.direction?(e=t.scale=gt/Math.abs(o(t.max)-o(t.min)),n=Math.min(o(t.max),o(t.min))):(e=t.scale=vt/Math.abs(o(t.max)-o(t.min)),e=-e,n=Math.max(o(t.max),o(t.min))),o==i?t.p2c=function(t){return(t-n)*e}:t.p2c=function(t){return(o(t)-n)*e},a?t.c2p=function(t){return a(n+t/e)}:t.c2p=function(t){return n+t/e}}function S(i){function n(n,o){return t('<div style="position:absolute;top:-10000px;'+o+'font-size:smaller"><div class="'+i.direction+"Axis "+i.direction+i.n+'Axis">'+n.join("")+"</div></div>").appendTo(e)}var o,a,r,l=i.options,s=i.ticks||[],c=[],u=l.labelWidth,f=l.labelHeight;if("x"==i.direction){if(null==u&&(u=Math.floor(pt/(s.length>0?s.length:1))),null==f){for(c=[],o=0;o<s.length;++o)a=s[o].label,a&&c.push('<div class="tickLabel" style="float:left;width:'+u+'px">'+a+"</div>");c.length>0&&(c.push('<div style="clear:left"></div>'),r=n(c,"width:10000px;"),f=r.height(),r.remove())}}else if(null==u||null==f){for(o=0;o<s.length;++o)a=s[o].label,a&&c.push('<div class="tickLabel">'+a+"</div>");c.length>0&&(r=n(c,""),null==u&&(u=r.children().width()),null==f&&(f=r.find("div.tickLabel").height()),r.remove())}null==u&&(u=0),null==f&&(f=0),i.labelWidth=u,i.labelHeight=f}function z(i){var e=i.labelWidth,n=i.labelHeight,o=i.options.position,a=i.options.tickLength,r=rt.grid.axisMargin,l=rt.grid.labelMargin,s="x"==i.direction?ht:dt,c=t.grep(s,function(t){return t&&t.options.position==o&&t.reserveSpace});t.inArray(i,c)==c.length-1&&(r=0),null==a&&(a="full");var u=t.grep(s,function(t){return t&&t.reserveSpace}),f=0==t.inArray(i,u);f||"full"!=a||(a=5),isNaN(+a)||(l+=+a),"x"==i.direction?(n+=l,"bottom"==o?(mt.bottom+=n+r,i.box={top:xt-mt.bottom,height:n}):(i.box={top:mt.top+r,height:n},mt.top+=n+r)):(e+=l,"left"==o?(i.box={left:mt.left+r,width:e},mt.left+=e+r):(mt.right+=e+r,i.box={left:pt-mt.right,width:e})),i.position=o,i.tickLength=a,i.box.padding=l,i.innermost=f}function W(t){"x"==t.direction?(t.box.left=mt.left,t.box.width=gt):(t.box.top=mt.top,t.box.height=vt)}function A(){var i,e=d();if(t.each(e,function(t,i){i.show=i.options.show,null==i.show&&(i.show=i.used),i.reserveSpace=i.show||i.options.reserveSpace,F(i)}),allocatedAxes=t.grep(e,function(t){return t.reserveSpace}),mt.left=mt.right=mt.top=mt.bottom=0,rt.grid.show){for(t.each(allocatedAxes,function(t,i){I(i),U(i),N(i,i.ticks),S(i)}),i=allocatedAxes.length-1;i>=0;--i)z(allocatedAxes[i]);var n=rt.grid.minBorderMargin;if(null==n)for(n=0,i=0;i<at.length;++i)n=Math.max(n,at[i].points.radius+at[i].points.lineWidth/2);for(var o in mt)mt[o]+=rt.grid.borderWidth,mt[o]=Math.max(n,mt[o])}gt=pt-mt.left-mt.right,vt=xt-mt.bottom-mt.top,t.each(e,function(t,i){C(i)}),rt.grid.show&&(t.each(allocatedAxes,function(t,i){W(i)}),O()),B()}function F(t){var i=t.options,e=+(null!=i.min?i.min:t.datamin),n=+(null!=i.max?i.max:t.datamax),o=n-e;if(0==o){var a=0==n?1:.01;null==i.min&&(e-=a),null!=i.max&&null==i.min||(n+=a)}else{var r=i.autoscaleMargin;null!=r&&(null==i.min&&(e-=o*r,e<0&&null!=t.datamin&&t.datamin>=0&&(e=0)),null==i.max&&(n+=o*r,n>0&&null!=t.datamax&&t.datamax<=0&&(n=0)))}t.min=e,t.max=n}function I(i){var e,o=i.options;e="number"==typeof o.ticks&&o.ticks>0?o.ticks:.3*Math.sqrt("x"==i.direction?pt:xt);var a,r,l,s,c,u,f,h=(i.max-i.min)/e;if("time"==o.mode){var d={second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,year:525949.2*60*1e3},m=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"],[3,"month"],[6,"month"],[1,"year"]],p=0;null!=o.minTickSize&&(p="number"==typeof o.tickSize?o.tickSize:o.minTickSize[0]*d[o.minTickSize[1]]);for(var c=0;c<m.length-1&&!(h<(m[c][0]*d[m[c][1]]+m[c+1][0]*d[m[c+1][1]])/2&&m[c][0]*d[m[c][1]]>=p);++c);a=m[c][0],l=m[c][1],"year"==l&&(u=Math.pow(10,Math.floor(Math.log(h/d.year)/Math.LN10)),f=h/d.year/u,a=f<1.5?1:f<3?2:f<7.5?5:10,a*=u),i.tickSize=o.tickSize||[a,l],r=function(t){var i=[],e=t.tickSize[0],o=t.tickSize[1],a=new Date(t.min),r=e*d[o];"second"==o&&a.setUTCSeconds(n(a.getUTCSeconds(),e)),"minute"==o&&a.setUTCMinutes(n(a.getUTCMinutes(),e)),"hour"==o&&a.setUTCHours(n(a.getUTCHours(),e)),"month"==o&&a.setUTCMonth(n(a.getUTCMonth(),e)),"year"==o&&a.setUTCFullYear(n(a.getUTCFullYear(),e)),a.setUTCMilliseconds(0),r>=d.minute&&a.setUTCSeconds(0),r>=d.hour&&a.setUTCMinutes(0),r>=d.day&&a.setUTCHours(0),r>=4*d.day&&a.setUTCDate(1),r>=d.year&&a.setUTCMonth(0);var l,s=0,c=Number.NaN;do if(l=c,c=a.getTime(),i.push(c),"month"==o)if(e<1){a.setUTCDate(1);var u=a.getTime();a.setUTCMonth(a.getUTCMonth()+1);var f=a.getTime();a.setTime(c+s*d.hour+(f-u)*e),s=a.getUTCHours(),a.setUTCHours(0)}else a.setUTCMonth(a.getUTCMonth()+e);else"year"==o?a.setUTCFullYear(a.getUTCFullYear()+e):a.setTime(c+r);while(c<t.max&&c!=l);return i},s=function(i,e){var n=new Date(i);if(null!=o.timeformat)return t.plot.formatDate(n,o.timeformat,o.monthNames);var a=e.tickSize[0]*d[e.tickSize[1]],r=e.max-e.min,l=o.twelveHourClock?" %p":"";return a<d.minute?fmt="%h:%M:%S"+l:a<d.day?r<2*d.day?fmt="%h:%M"+l:fmt="%b %d %h:%M"+l:a<d.month?fmt="%b %d":a<d.year?r<d.year?fmt="%b":fmt="%b %y":fmt="%y",t.plot.formatDate(n,fmt,o.monthNames)}}else{var x=o.tickDecimals,g=-Math.floor(Math.log(h)/Math.LN10);null!=x&&g>x&&(g=x),u=Math.pow(10,-g),f=h/u,f<1.5?a=1:f<3?(a=2,f>2.25&&(null==x||g+1<=x)&&(a=2.5,++g)):a=f<7.5?5:10,a*=u,null!=o.minTickSize&&a<o.minTickSize&&(a=o.minTickSize),i.tickDecimals=Math.max(0,null!=x?x:g),i.tickSize=o.tickSize||a,r=function(t){var i,e=[],o=n(t.min,t.tickSize),a=0,r=Number.NaN;do i=r,r=o+a*t.tickSize,e.push(r),++a;while(r<t.max&&r!=i);return e},s=function(t,i){return t.toFixed(i.tickDecimals)}}if(null!=o.alignTicksWithAxis){var v=("x"==i.direction?ht:dt)[o.alignTicksWithAxis-1];if(v&&v.used&&v!=i){var b=r(i);if(b.length>0&&(null==o.min&&(i.min=Math.min(i.min,b[0])),null==o.max&&b.length>1&&(i.max=Math.max(i.max,b[b.length-1]))),r=function(t){var i,e,n=[];for(e=0;e<v.ticks.length;++e)i=(v.ticks[e].v-v.min)/(v.max-v.min),i=t.min+i*(t.max-t.min),n.push(i);return n},"time"!=i.mode&&null==o.tickDecimals){var k=Math.max(0,-Math.floor(Math.log(h)/Math.LN10)+1),y=r(i);y.length>1&&/\..*0$/.test((y[1]-y[0]).toFixed(k))||(i.tickDecimals=k)}}}i.tickGenerator=r,t.isFunction(o.tickFormatter)?i.tickFormatter=function(t,i){return""+o.tickFormatter(t,i)}:i.tickFormatter=s}function U(i){var e=i.options.ticks,n=[];null==e||"number"==typeof e&&e>0?n=i.tickGenerator(i):e&&(n=t.isFunction(e)?e({min:i.min,max:i.max}):e);var o,a;for(i.ticks=[],o=0;o<n.length;++o){var r=null,l=n[o];"object"==typeof l?(a=+l[0],l.length>1&&(r=l[1])):a=+l,null==r&&(r=i.tickFormatter(a,i)),isNaN(a)||i.ticks.push({v:a,label:r})}}function N(t,i){t.options.autoscaleMargin&&i.length>0&&(null==t.options.min&&(t.min=Math.min(t.min,i[0].v)),null==t.options.max&&i.length>1&&(t.max=Math.max(t.max,i[i.length-1].v)))}function D(){ut.clearRect(0,0,pt,xt);var t=rt.grid;t.show&&t.backgroundColor&&P(),t.show&&!t.aboveData&&H();for(var i=0;i<at.length;++i)l(bt.drawSeries,[ut,at[i]]),Y(at[i]);l(bt.draw,[ut]),t.show&&t.aboveData&&H()}function L(t,e){var n,o,a,r,l=d();for(i=0;i<l.length;++i)if(n=l[i],n.direction==e&&(r=e+n.n+"axis",t[r]||1!=n.n||(r=e+"axis"),t[r])){o=t[r].from,a=t[r].to;break}if(t[r]||(n="x"==e?ht[0]:dt[0],o=t[e+"1"],a=t[e+"2"]),null!=o&&null!=a&&o>a){var s=o;o=a,a=s}return{from:o,to:a,axis:n}}function P(){ut.save(),ut.translate(mt.left,mt.top),ut.fillStyle=ot(rt.grid.backgroundColor,vt,0,"rgba(255, 255, 255, 0)"),ut.fillRect(0,0,gt,vt),ut.restore()}function H(){var i;ut.save(),ut.translate(mt.left,mt.top);var e=rt.grid.markings;if(e){if(t.isFunction(e)){var n=kt.getAxes();n.xmin=n.xaxis.min,n.xmax=n.xaxis.max,n.ymin=n.yaxis.min,n.ymax=n.yaxis.max,e=e(n)}for(i=0;i<e.length;++i){var o=e[i],a=L(o,"x"),r=L(o,"y");null==a.from&&(a.from=a.axis.min),null==a.to&&(a.to=a.axis.max),null==r.from&&(r.from=r.axis.min),null==r.to&&(r.to=r.axis.max),a.to<a.axis.min||a.from>a.axis.max||r.to<r.axis.min||r.from>r.axis.max||(a.from=Math.max(a.from,a.axis.min),a.to=Math.min(a.to,a.axis.max),r.from=Math.max(r.from,r.axis.min),r.to=Math.min(r.to,r.axis.max),a.from==a.to&&r.from==r.to||(a.from=a.axis.p2c(a.from),a.to=a.axis.p2c(a.to),r.from=r.axis.p2c(r.from),r.to=r.axis.p2c(r.to),a.from==a.to||r.from==r.to?(ut.beginPath(),ut.strokeStyle=o.color||rt.grid.markingsColor,ut.lineWidth=o.lineWidth||rt.grid.markingsLineWidth,ut.moveTo(a.from,r.from),ut.lineTo(a.to,r.to),ut.stroke()):(ut.fillStyle=o.color||rt.grid.markingsColor,ut.fillRect(a.from,r.to,a.to-a.from,r.from-r.to))))}}for(var n=d(),l=rt.grid.borderWidth,s=0;s<n.length;++s){var c,u,f,h,m=n[s],p=m.box,x=m.tickLength;if(m.show&&0!=m.ticks.length){for(ut.strokeStyle=m.options.tickColor||t.color.parse(m.options.color).scale("a",.22).toString(),ut.lineWidth=1,"x"==m.direction?(c=0,u="full"==x?"top"==m.position?0:vt:p.top-mt.top+("top"==m.position?p.height:0)):(u=0,c="full"==x?"left"==m.position?0:gt:p.left-mt.left+("left"==m.position?p.width:0)),m.innermost||(ut.beginPath(),f=h=0,"x"==m.direction?f=gt:h=vt,1==ut.lineWidth&&(c=Math.floor(c)+.5,u=Math.floor(u)+.5),ut.moveTo(c,u),ut.lineTo(c+f,u+h),ut.stroke()),ut.beginPath(),i=0;i<m.ticks.length;++i){var g=m.ticks[i].v;f=h=0,g<m.min||g>m.max||"full"==x&&l>0&&(g==m.min||g==m.max)||("x"==m.direction?(c=m.p2c(g),h="full"==x?-vt:x,"top"==m.position&&(h=-h)):(u=m.p2c(g),f="full"==x?-gt:x,"left"==m.position&&(f=-f)),1==ut.lineWidth&&("x"==m.direction?c=Math.floor(c)+.5:u=Math.floor(u)+.5),ut.moveTo(c,u),ut.lineTo(c+f,u+h))}ut.stroke()}}l&&(ut.lineWidth=l,ut.strokeStyle=rt.grid.borderColor,ut.strokeRect(-l/2,-l/2,gt+l,vt+l)),ut.restore()}function O(){e.find(".tickLabels").remove();for(var t=['<div class="tickLabels" style="font-size:smaller">'],i=d(),n=0;n<i.length;++n){var o=i[n],a=o.box;if(o.show){t.push('<div class="'+o.direction+"Axis "+o.direction+o.n+'Axis" style="color:'+o.options.color+'">');for(var r=0;r<o.ticks.length;++r){var l=o.ticks[r];if(!(!l.label||l.v<o.min||l.v>o.max)){var s,c={};"x"==o.direction?(s="center",c.left=Math.round(mt.left+o.p2c(l.v)-o.labelWidth/2),"bottom"==o.position?c.top=a.top+a.padding:c.bottom=xt-(a.top+a.height-a.padding)):(c.top=Math.round(mt.top+o.p2c(l.v)-o.labelHeight/2),"left"==o.position?(c.right=pt-(a.left+a.width-a.padding),s="right"):(c.left=a.left+a.padding,s="left")),c.width=o.labelWidth;var u=["position:absolute","text-align:"+s];for(var f in c)u.push(f+":"+c[f]+"px");t.push('<div class="tickLabel" style="'+u.join(";")+'">'+l.label+"</div>")}}t.push("</div>")}}t.push("</div>"),e.append(t.join(""))}function Y(t){t.lines.show&&j(t),t.bars.show&&V(t),t.points.show&&R(t)}function j(t){function i(t,i,e,n,o){var a=t.points,r=t.pointsize,l=null,s=null;ut.beginPath();for(var c=r;c<a.length;c+=r){var u=a[c-r],f=a[c-r+1],h=a[c],d=a[c+1];if(null!=u&&null!=h){if(f<=d&&f<o.min){if(d<o.min)continue;u=(o.min-f)/(d-f)*(h-u)+u,f=o.min}else if(d<=f&&d<o.min){if(f<o.min)continue;h=(o.min-f)/(d-f)*(h-u)+u,d=o.min}if(f>=d&&f>o.max){if(d>o.max)continue;u=(o.max-f)/(d-f)*(h-u)+u,f=o.max}else if(d>=f&&d>o.max){if(f>o.max)continue;h=(o.max-f)/(d-f)*(h-u)+u,d=o.max}if(u<=h&&u<n.min){if(h<n.min)continue;f=(n.min-u)/(h-u)*(d-f)+f,u=n.min}else if(h<=u&&h<n.min){if(u<n.min)continue;d=(n.min-u)/(h-u)*(d-f)+f,h=n.min}if(u>=h&&u>n.max){if(h>n.max)continue;f=(n.max-u)/(h-u)*(d-f)+f,u=n.max}else if(h>=u&&h>n.max){if(u>n.max)continue;d=(n.max-u)/(h-u)*(d-f)+f,h=n.max}u==l&&f==s||ut.moveTo(n.p2c(u)+i,o.p2c(f)+e),l=h,s=d,ut.lineTo(n.p2c(h)+i,o.p2c(d)+e)}}ut.stroke()}function e(t,i,e){for(var n=t.points,o=t.pointsize,a=Math.min(Math.max(0,e.min),e.max),r=0,l=!1,s=1,c=0,u=0;;){if(o>0&&r>n.length+o)break;r+=o;var f=n[r-o],h=n[r-o+s],d=n[r],m=n[r+s];if(l){if(o>0&&null!=f&&null==d){u=r,o=-o,s=2;continue}if(o<0&&r==c+o){ut.fill(),l=!1,o=-o,s=1,r=c=u+o;continue}}if(null!=f&&null!=d){if(f<=d&&f<i.min){if(d<i.min)continue;h=(i.min-f)/(d-f)*(m-h)+h,f=i.min}else if(d<=f&&d<i.min){if(f<i.min)continue;m=(i.min-f)/(d-f)*(m-h)+h,d=i.min}if(f>=d&&f>i.max){if(d>i.max)continue;h=(i.max-f)/(d-f)*(m-h)+h,f=i.max}else if(d>=f&&d>i.max){if(f>i.max)continue;m=(i.max-f)/(d-f)*(m-h)+h,d=i.max}if(l||(ut.beginPath(),ut.moveTo(i.p2c(f),e.p2c(a)),l=!0),h>=e.max&&m>=e.max)ut.lineTo(i.p2c(f),e.p2c(e.max)),ut.lineTo(i.p2c(d),e.p2c(e.max));else if(h<=e.min&&m<=e.min)ut.lineTo(i.p2c(f),e.p2c(e.min)),ut.lineTo(i.p2c(d),e.p2c(e.min));else{var p=f,x=d;h<=m&&h<e.min&&m>=e.min?(f=(e.min-h)/(m-h)*(d-f)+f,h=e.min):m<=h&&m<e.min&&h>=e.min&&(d=(e.min-h)/(m-h)*(d-f)+f,m=e.min),h>=m&&h>e.max&&m<=e.max?(f=(e.max-h)/(m-h)*(d-f)+f,h=e.max):m>=h&&m>e.max&&h<=e.max&&(d=(e.max-h)/(m-h)*(d-f)+f,m=e.max),f!=p&&ut.lineTo(i.p2c(p),e.p2c(h)),ut.lineTo(i.p2c(f),e.p2c(h)),ut.lineTo(i.p2c(d),e.p2c(m)),d!=x&&(ut.lineTo(i.p2c(d),e.p2c(m)),ut.lineTo(i.p2c(x),e.p2c(m)))}}}}ut.save(),ut.translate(mt.left,mt.top),ut.lineJoin="round";var n=t.lines.lineWidth,o=t.shadowSize;if(n>0&&o>0){ut.lineWidth=o,ut.strokeStyle="rgba(0,0,0,0.1)";var a=Math.PI/18;i(t.datapoints,Math.sin(a)*(n/2+o/2),Math.cos(a)*(n/2+o/2),t.xaxis,t.yaxis),ut.lineWidth=o/2,i(t.datapoints,Math.sin(a)*(n/2+o/4),Math.cos(a)*(n/2+o/4),t.xaxis,t.yaxis)}ut.lineWidth=n,ut.strokeStyle=t.color;var r=X(t.lines,t.color,0,vt);r&&(ut.fillStyle=r,e(t.datapoints,t.xaxis,t.yaxis)),n>0&&i(t.datapoints,0,0,t.xaxis,t.yaxis),ut.restore()}function R(t){function i(t,i,e,n,o,a,r,l){for(var s=t.points,c=t.pointsize,u=0;u<s.length;u+=c){var f=s[u],h=s[u+1];null==f||f<a.min||f>a.max||h<r.min||h>r.max||(ut.beginPath(),f=a.p2c(f),h=r.p2c(h)+n,"circle"==l?ut.arc(f,h,i,0,o?Math.PI:2*Math.PI,!1):l(ut,f,h,i,o),ut.closePath(),e&&(ut.fillStyle=e,ut.fill()),ut.stroke())}}ut.save(),ut.translate(mt.left,mt.top);var e=t.points.lineWidth,n=t.shadowSize,o=t.points.radius,a=t.points.symbol;if(e>0&&n>0){var r=n/2;ut.lineWidth=r,ut.strokeStyle="rgba(0,0,0,0.1)",i(t.datapoints,o,null,r+r/2,!0,t.xaxis,t.yaxis,a),ut.strokeStyle="rgba(0,0,0,0.2)",i(t.datapoints,o,null,r/2,!0,t.xaxis,t.yaxis,a)}ut.lineWidth=e,ut.strokeStyle=t.color,i(t.datapoints,o,X(t.points,t.color),0,!1,t.xaxis,t.yaxis,a),ut.restore()}function E(t,i,e,n,o,a,r,l,s,c,u,f){var h,d,m,p,x,g,v,b,k;u?(b=g=v=!0,x=!1,h=e,d=t,p=i+n,m=i+o,d<h&&(k=d,d=h,h=k,x=!0,g=!1)):(x=g=v=!0,b=!1,h=t+n,d=t+o,m=e,p=i,p<m&&(k=p,p=m,m=k,b=!0,v=!1)),d<l.min||h>l.max||p<s.min||m>s.max||(h<l.min&&(h=l.min,x=!1),d>l.max&&(d=l.max,g=!1),m<s.min&&(m=s.min,b=!1),p>s.max&&(p=s.max,v=!1),h=l.p2c(h),m=s.p2c(m),d=l.p2c(d),p=s.p2c(p),r&&(c.beginPath(),c.moveTo(h,m),c.lineTo(h,p),c.lineTo(d,p),c.lineTo(d,m),c.fillStyle=r(m,p),c.fill()),f>0&&(x||g||v||b)&&(c.beginPath(),c.moveTo(h,m+a),x?c.lineTo(h,p+a):c.moveTo(h,p+a),v?c.lineTo(d,p+a):c.moveTo(d,p+a),g?c.lineTo(d,m+a):c.moveTo(d,m+a),b?c.lineTo(h,m+a):c.moveTo(h,m+a),c.stroke()))}function V(t){function i(i,e,n,o,a,r,l){for(var s=i.points,c=i.pointsize,u=0;u<s.length;u+=c)null!=s[u]&&E(s[u],s[u+1],s[u+2],e,n,o,a,r,l,ut,t.bars.horizontal,t.bars.lineWidth)}ut.save(),ut.translate(mt.left,mt.top),ut.lineWidth=t.bars.lineWidth,ut.strokeStyle=t.color;var e="left"==t.bars.align?0:-t.bars.barWidth/2,n=t.bars.fill?function(i,e){return X(t.bars,t.color,i,e)}:null;i(t.datapoints,e,e+t.bars.barWidth,0,n,t.xaxis,t.yaxis),ut.restore()}function X(i,e,n,o){var a=i.fill;if(!a)return null;if(i.fillColor)return ot(i.fillColor,n,o,e);var r=t.color.parse(e);return r.a="number"==typeof a?a:.4,r.normalize(),r.toString()}function B(){if(e.find(".legend").remove(),rt.legend.show){for(var i,n,o=[],a=!1,r=rt.legend.labelFormatter,l=0;l<at.length;++l)i=at[l],n=i.label,n&&(l%rt.legend.noColumns==0&&(a&&o.push("</tr>"),o.push("<tr>"),a=!0),r&&(n=r(n,i)),o.push('<td class="legendColorBox"><div style="border:1px solid '+rt.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+i.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+n+"</td>"));if(a&&o.push("</tr>"),0!=o.length){var s='<table style="font-size:smaller;color:'+rt.grid.color+'">'+o.join("")+"</table>";if(null!=rt.legend.container)t(rt.legend.container).html(s);else{var c="",u=rt.legend.position,f=rt.legend.margin;null==f[0]&&(f=[f,f]),"n"==u.charAt(0)?c+="top:"+(f[1]+mt.top)+"px;":"s"==u.charAt(0)&&(c+="bottom:"+(f[1]+mt.bottom)+"px;"),"e"==u.charAt(1)?c+="right:"+(f[0]+mt.right)+"px;":"w"==u.charAt(1)&&(c+="left:"+(f[0]+mt.left)+"px;");var h=t('<div class="legend">'+s.replace('style="','style="position:absolute;'+c+";")+"</div>").appendTo(e);if(0!=rt.legend.backgroundOpacity){var d=rt.legend.backgroundColor;null==d&&(d=rt.grid.backgroundColor,d=d&&"string"==typeof d?t.color.parse(d):t.color.extract(h,"background-color"),d.a=1,d=d.toString());var m=h.children();t('<div style="position:absolute;width:'+m.width()+"px;height:"+m.height()+"px;"+c+"background-color:"+d+';"> </div>').prependTo(h).css("opacity",rt.legend.backgroundOpacity)}}}}}function q(t,i,e){var n,o,a=rt.grid.mouseActiveRadius,r=a*a+1,l=null;for(n=at.length-1;n>=0;--n)if(e(at[n])){var s=at[n],c=s.xaxis,u=s.yaxis,f=s.datapoints.points,h=s.datapoints.pointsize,d=c.c2p(t),m=u.c2p(i),p=a/c.scale,x=a/u.scale;if(c.options.inverseTransform&&(p=Number.MAX_VALUE),u.options.inverseTransform&&(x=Number.MAX_VALUE),s.lines.show||s.points.show)for(o=0;o<f.length;o+=h){var g=f[o],v=f[o+1];if(null!=g&&!(g-d>p||g-d<-p||v-m>x||v-m<-x)){var b=Math.abs(c.p2c(g)-t),k=Math.abs(u.p2c(v)-i),y=b*b+k*k;y<r&&(r=y,l=[n,o/h])}}if(s.bars.show&&!l){var T="left"==s.bars.align?0:-s.bars.barWidth/2,w=T+s.bars.barWidth;for(o=0;o<f.length;o+=h){var g=f[o],v=f[o+1],M=f[o+2];null!=g&&(at[n].bars.horizontal?d<=Math.max(M,g)&&d>=Math.min(M,g)&&m>=v+T&&m<=v+w:d>=g+T&&d<=g+w&&m>=Math.min(M,v)&&m<=Math.max(M,v))&&(l=[n,o/h])}}}return l?(n=l[0],o=l[1],h=at[n].datapoints.pointsize,{datapoint:at[n].datapoints.points.slice(o*h,(o+1)*h),dataIndex:o,series:at[n],seriesIndex:n}):null}function G(t){rt.grid.hoverable&&Q("plothover",t,function(t){return 0!=t.hoverable})}function _(t){rt.grid.hoverable&&Q("plothover",t,function(t){return!1})}function J(t){Q("plotclick",t,function(t){return 0!=t.clickable})}function Q(t,i,n){var o=ct.offset(),a=i.pageX-o.left-mt.left,r=i.pageY-o.top-mt.top,l=m({left:a,top:r});l.pageX=i.pageX,l.pageY=i.pageY;var s=q(a,r,n);if(s&&(s.pageX=parseInt(s.series.xaxis.p2c(s.datapoint[0])+o.left+mt.left),s.pageY=parseInt(s.series.yaxis.p2c(s.datapoint[1])+o.top+mt.top)),rt.grid.autoHighlight){for(var c=0;c<yt.length;++c){var u=yt[c];u.auto!=t||s&&u.series==s.series&&u.point[0]==s.datapoint[0]&&u.point[1]==s.datapoint[1]||tt(u.series,u.point)}s&&Z(s.series,s.datapoint,t)}e.trigger(t,[l,s])}function $(){Tt||(Tt=setTimeout(K,30))}function K(){Tt=null,ft.save(),ft.clearRect(0,0,pt,xt),ft.translate(mt.left,mt.top);var t,i;for(t=0;t<yt.length;++t)i=yt[t],i.series.bars.show?nt(i.series,i.point):et(i.series,i.point);ft.restore(),l(bt.drawOverlay,[ft])}function Z(t,i,e){if("number"==typeof t&&(t=at[t]),"number"==typeof i){var n=t.datapoints.pointsize;i=t.datapoints.points.slice(n*i,n*(i+1))}var o=it(t,i);o==-1?(yt.push({series:t,point:i,auto:e}),$()):e||(yt[o].auto=!1)}function tt(t,i){null==t&&null==i&&(yt=[],$()),"number"==typeof t&&(t=at[t]),"number"==typeof i&&(i=t.data[i]);var e=it(t,i);e!=-1&&(yt.splice(e,1),$())}function it(t,i){for(var e=0;e<yt.length;++e){var n=yt[e];if(n.series==t&&n.point[0]==i[0]&&n.point[1]==i[1])return e}return-1}function et(i,e){var n=e[0],o=e[1],a=i.xaxis,r=i.yaxis;if(!(n<a.min||n>a.max||o<r.min||o>r.max)){var l=i.points.radius+i.points.lineWidth/2;ft.lineWidth=l,ft.strokeStyle=t.color.parse(i.color).scale("a",.5).toString();var s=1.5*l,n=a.p2c(n),o=r.p2c(o);ft.beginPath(),"circle"==i.points.symbol?ft.arc(n,o,s,0,2*Math.PI,!1):i.points.symbol(ft,n,o,s,!1),ft.closePath(),ft.stroke()}}function nt(i,e){ft.lineWidth=i.bars.lineWidth,ft.strokeStyle=t.color.parse(i.color).scale("a",.5).toString();var n=t.color.parse(i.color).scale("a",.5).toString(),o="left"==i.bars.align?0:-i.bars.barWidth/2;E(e[0],e[1],e[2]||0,o,o+i.bars.barWidth,0,function(){return n},i.xaxis,i.yaxis,ft,i.bars.horizontal,i.bars.lineWidth)}function ot(i,e,n,o){if("string"==typeof i)return i;for(var a=ut.createLinearGradient(0,n,0,e),r=0,l=i.colors.length;r<l;++r){var s=i.colors[r];if("string"!=typeof s){var c=t.color.parse(o);null!=s.brightness&&(c=c.scale("rgb",s.brightness)),null!=s.opacity&&(c.a*=s.opacity),s=c.toString()}a.addColorStop(r/(l-1),s)}return a}var at=[],rt={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85},xaxis:{show:null,position:"bottom",mode:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null,monthNames:null,timeformat:null,twelveHourClock:!1},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1},shadowSize:3},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},hooks:{}},lt=null,st=null,ct=null,ut=null,ft=null,ht=[],dt=[],mt={left:0,right:0,top:0,bottom:0},pt=0,xt=0,gt=0,vt=0,bt={processOptions:[],processRawData:[],processDatapoints:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},kt=this;kt.setData=u,kt.setupGrid=A,kt.draw=D,kt.getPlaceholder=function(){return e},kt.getCanvas=function(){return lt},kt.getPlotOffset=function(){return mt},kt.width=function(){return gt},kt.height=function(){return vt},kt.offset=function(){var t=ct.offset();return t.left+=mt.left,t.top+=mt.top,t},kt.getData=function(){return at},kt.getAxes=function(){var i={};return t.each(ht.concat(dt),function(t,e){e&&(i[e.direction+(1!=e.n?e.n:"")+"axis"]=e)}),i},kt.getXAxes=function(){return ht},kt.getYAxes=function(){return dt},kt.c2p=m,kt.p2c=p,kt.getOptions=function(){return rt},kt.highlight=Z,kt.unhighlight=tt,kt.triggerRedrawOverlay=$,
kt.pointOffset=function(t){return{left:parseInt(ht[h(t,"x")-1].p2c(+t.x)+mt.left),top:parseInt(dt[h(t,"y")-1].p2c(+t.y)+mt.top)}},kt.shutdown=M,kt.resize=function(){k(),y(lt),y(st)},kt.hooks=bt,s(kt),c(a),T(),u(o),A(),D(),w();var yt=[],Tt=null}function n(t,i){return i*Math.floor(t/i)}t.plot=function(i,n,o){var a=new e(t(i),n,o,t.plot.plugins);return a},t.plot.version="0.7",t.plot.plugins=[],t.plot.formatDate=function(t,i,e){var n=function(t){return t=""+t,1==t.length?"0"+t:t},o=[],a=!1,r=!1,l=t.getUTCHours(),s=l<12;null==e&&(e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),i.search(/%p|%P/)!=-1&&(l>12?l-=12:0==l&&(l=12));for(var c=0;c<i.length;++c){var u=i.charAt(c);if(a){switch(u){case"h":u=""+l;break;case"H":u=n(l);break;case"M":u=n(t.getUTCMinutes());break;case"S":u=n(t.getUTCSeconds());break;case"d":u=""+t.getUTCDate();break;case"m":u=""+(t.getUTCMonth()+1);break;case"y":u=""+t.getUTCFullYear();break;case"b":u=""+e[t.getUTCMonth()];break;case"p":u=s?"am":"pm";break;case"P":u=s?"AM":"PM";break;case"0":u="",r=!0}u&&r&&(u=n(u),r=!1),o.push(u),r||(a=!1)}else"%"==u?a=!0:o.push(u)}return o.join("")}}(jQuery);
!function(t){function e(t){return Math.log(t)/Math.LN10}function o(t,o){if(void 0===o&&(o=3),0===t)return 0;if(o<=0)throw new Error("Significant figures must be greater than zero.");o=Math.floor(o+.5);var i=t>=0?"":"-";t=Math.abs(t);var r=Math.floor(e(t))+1;if(r>o)return t=t.toPrecision(o),i+t.replace("+","");if(r<0){var n=t*pow(10,abs(r)+1);return r-=1,i+n.toFixed(o-1)+"e"+r}return i+t.toFixed(o-r)}function i(t){function e(e){r.locked||r.x!=-1&&(r.x=-1,t.triggerRedrawOverlay())}function i(e){if(!r.locked){if(t.getSelection&&t.getSelection())return void(r.x=-1);var o=t.offset();r.x=Math.max(0,Math.min(e.pageX-o.left,t.width())),r.y=Math.max(0,Math.min(e.pageY-o.top,t.height())),t.triggerRedrawOverlay()}}var r={x:-1,y:-1,locked:!1};t.setCrosshair=function(e){if(e){var o=t.p2c(e);r.x=Math.max(0,Math.min(o.left,t.width())),r.y=Math.max(0,Math.min(o.top,t.height()))}else r.x=-1;t.triggerRedrawOverlay()},t.clearCrosshair=t.setCrosshair,t.lockCrosshair=function(e){e&&t.setCrosshair(e),r.locked=!0},t.unlockCrosshair=function(){r.locked=!1},t.hooks.bindEvents.push(function(t,o){t.getOptions().crosshair.mode&&(o.mouseout(e),o.mousemove(i))}),t.hooks.drawOverlay.push(function(t,e){var i=t.getOptions().crosshair;if(i.mode){var n=t.getPlotOffset();if(e.save(),e.translate(n.left,n.top),r.x!=-1){var a=t.c2p({left:r.x,top:r.y});text=o(a.x,3)+","+o(a.y,3);var s=13;e.fillStyle=i.color,e.font=s+"px Verdana";var h=e.measureText(text).width,l=0,f=0;r.y<s+3?(h+=14,f=s,r.x<=t.width()-(h+5)&&(l+=14)):f=-5,r.x>t.width()-(h+5)?(e.textAlign="right",l+=-3):(e.textAlign="left",l+=3),e.fillText(text,r.x+l,r.y+f),e.strokeStyle=i.color,e.lineWidth=i.lineWidth,e.lineJoin="round",e.beginPath(),i.mode.indexOf("x")!=-1&&(e.moveTo(r.x,0),e.lineTo(r.x,t.height())),i.mode.indexOf("y")!=-1&&(e.moveTo(0,r.y),e.lineTo(t.width(),r.y)),e.stroke()}e.restore()}}),t.hooks.shutdown.push(function(t,o){o.unbind("mouseout",e),o.unbind("mousemove",i)})}var r={crosshair:{mode:null,color:"rgba(0, 0, 0, 0.5)",lineWidth:1}};t.plot.plugins.push({init:i,options:r,name:"crosshair_GS",version:"1.0"})}(jQuery);
!function(t){function i(){return!!document.createElement("canvas").getContext}function e(){if(!i())return!1;var t=document.createElement("canvas"),e=t.getContext("2d");return"function"==typeof e.fillText}function s(){var t=document.createElement("div");return"undefined"!=typeof t.style.MozTransition||"undefined"!=typeof t.style.OTransition||"undefined"!=typeof t.style.webkitTransition||"undefined"!=typeof t.style.transition}function o(t,i,e,s,o){this.axisName=t,this.position=i,this.padding=e,this.plot=s,this.opts=o,this.width=0,this.height=0}function a(t,i,e,s,a){o.prototype.constructor.call(this,t,i,e,s,a)}function l(t,i,e,s,a){o.prototype.constructor.call(this,t,i,e,s,a),this.elem=null}function h(t,i,e,s,o){l.prototype.constructor.call(this,t,i,e,s,o)}function n(t,i,e,s,o){h.prototype.constructor.call(this,t,i,e,s,o),this.requiresResize=!1}function r(i){i.hooks.processOptions.push(function(i,o){if(o.axisLabels.show){var r=!1,p={},d=2;i.hooks.draw.push(function(i,o){var f=!1;r?(r=!1,t.each(i.getAxes(),function(t,e){var s=e.options||i.getOptions()[t];s&&s.axisLabel&&e.show&&p[t].draw(e.box)})):(t.each(i.getAxes(),function(t,o){var r=o.options||i.getOptions()[t];if(t in p&&(o.labelHeight=o.labelHeight-p[t].height,o.labelWidth=o.labelWidth-p[t].width,r.labelHeight=o.labelHeight,r.labelWidth=o.labelWidth,p[t].cleanup(),delete p[t]),r&&r.axisLabel&&o.show){f=!0;var c=null;if(r.axisLabelUseHtml||"Microsoft Internet Explorer"!=navigator.appName)c=r.axisLabelUseHtml||!s()&&!e()&&!r.axisLabelUseCanvas?l:r.axisLabelUseCanvas||!s()?a:h;else{var b=navigator.userAgent,x=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=x.exec(b)&&(rv=parseFloat(RegExp.$1)),c=rv>=9&&!r.axisLabelUseCanvas&&!r.axisLabelUseHtml?h:r.axisLabelUseCanvas||r.axisLabelUseHtml?r.axisLabelUseCanvas?a:l:n}var g=void 0===r.axisLabelPadding?d:r.axisLabelPadding;p[t]=new c(t,o.position,g,i,r),p[t].calculateSize(),r.labelHeight=o.labelHeight+p[t].height,r.labelWidth=o.labelWidth+p[t].width}}),f&&(r=!0,i.setupGrid(),i.draw()))})}})}var p={axisLabels:{show:!0}};o.prototype.cleanup=function(){},a.prototype=new o,a.prototype.constructor=a,a.prototype.calculateSize=function(){this.opts.axisLabelFontSizePixels||(this.opts.axisLabelFontSizePixels=14),this.opts.axisLabelFontFamily||(this.opts.axisLabelFontFamily="sans-serif");this.opts.axisLabelFontSizePixels+this.padding,this.opts.axisLabelFontSizePixels+this.padding;"left"==this.position||"right"==this.position?(this.width=this.opts.axisLabelFontSizePixels+this.padding,this.height=0):(this.width=0,this.height=this.opts.axisLabelFontSizePixels+this.padding)},a.prototype.draw=function(t){this.opts.axisLabelColour||(this.opts.axisLabelColour="black");var i=this.plot.getCanvas().getContext("2d");i.save(),i.font=this.opts.axisLabelFontSizePixels+"px "+this.opts.axisLabelFontFamily,i.fillStyle=this.opts.axisLabelColour;var e,s,o=i.measureText(this.opts.axisLabel).width,a=this.opts.axisLabelFontSizePixels,l=0;"top"==this.position?(e=t.left+t.width/2-o/2,s=t.top+.72*a):"bottom"==this.position?(e=t.left+t.width/2-o/2,s=t.top+t.height-.72*a):"left"==this.position?(e=t.left+.72*a,s=t.height/2+t.top+o/2,l=-Math.PI/2):"right"==this.position&&(e=t.left+t.width-.72*a,s=t.height/2+t.top-o/2,l=Math.PI/2),i.translate(e,s),i.rotate(l),i.fillText(this.opts.axisLabel,0,0),i.restore()},l.prototype=new o,l.prototype.constructor=l,l.prototype.calculateSize=function(){var i=t('<div class="axisLabels" style="position:absolute;">'+this.opts.axisLabel+"</div>");this.plot.getPlaceholder().append(i),this.labelWidth=i.outerWidth(!0),this.labelHeight=i.outerHeight(!0),i.remove(),this.width=this.height=0,"left"==this.position||"right"==this.position?this.width=this.labelWidth+this.padding:this.height=this.labelHeight+this.padding},l.prototype.cleanup=function(){this.elem&&this.elem.remove()},l.prototype.draw=function(i){this.plot.getPlaceholder().find("#"+this.axisName+"Label").remove(),this.elem=t('<div id="'+this.axisName+'Label" " class="axisLabels" style="position:absolute;">'+this.opts.axisLabel+"</div>"),this.plot.getPlaceholder().append(this.elem),"top"==this.position?(this.elem.css("left",i.left+i.width/2-this.labelWidth/2+"px"),this.elem.css("top",i.top+"px")):"bottom"==this.position?(this.elem.css("left",i.left+i.width/2-this.labelWidth/2+"px"),this.elem.css("top",i.top+i.height-this.labelHeight+"px")):"left"==this.position?(this.elem.css("top",i.top+i.height/2-this.labelHeight/2+"px"),this.elem.css("left",i.left+"px")):"right"==this.position&&(this.elem.css("top",i.top+i.height/2-this.labelHeight/2+"px"),this.elem.css("left",i.left+i.width-this.labelWidth+"px"))},h.prototype=new l,h.prototype.constructor=h,h.prototype.calculateSize=function(){l.prototype.calculateSize.call(this),this.width=this.height=0,"left"==this.position||"right"==this.position?this.width=this.labelHeight+this.padding:this.height=this.labelHeight+this.padding},h.prototype.transforms=function(t,i,e){var s={"-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":""};if(0!=i||0!=e){var o=" translate("+i+"px, "+e+"px)";s["-moz-transform"]+=o,s["-webkit-transform"]+=o,s["-o-transform"]+=o,s["-ms-transform"]+=o}if(0!=t){var a=" rotate("+t+"deg)";s["-moz-transform"]+=a,s["-webkit-transform"]+=a,s["-o-transform"]+=a,s["-ms-transform"]+=a}var l="top: 0; left: 0; ";for(var h in s)s[h]&&(l+=h+":"+s[h]+";");return l+=";"},h.prototype.calculateOffsets=function(t){var i={x:0,y:0,degrees:0};return"bottom"==this.position?(i.x=t.left+t.width/2-this.labelWidth/2,i.y=t.top+t.height-this.labelHeight):"top"==this.position?(i.x=t.left+t.width/2-this.labelWidth/2,i.y=t.top):"left"==this.position?(i.degrees=-90,i.x=t.left-this.labelWidth/2+this.labelHeight/2,i.y=t.height/2+t.top):"right"==this.position&&(i.degrees=90,i.x=t.left+t.width-this.labelWidth/2-this.labelHeight/2,i.y=t.height/2+t.top),i.x=Math.round(i.x),i.y=Math.round(i.y),i},h.prototype.draw=function(i){this.plot.getPlaceholder().find("."+this.axisName+"Label").remove();var e=this.calculateOffsets(i);this.elem=t('<div class="axisLabels '+this.axisName+'Label" style="position:absolute; '+this.transforms(e.degrees,e.x,e.y)+'">'+this.opts.axisLabel+"</div>"),this.plot.getPlaceholder().append(this.elem)},n.prototype=new h,n.prototype.constructor=n,n.prototype.transforms=function(t,i,e){var s="";if(0!=t){for(var o=t/90;o<0;)o+=4;s+=" filter: progid:DXImageTransform.Microsoft.BasicImage(rotation="+o+"); ",this.requiresResize="right"==this.position}return 0!=i&&(s+="left: "+i+"px; "),0!=e&&(s+="top: "+e+"px; "),s},n.prototype.calculateOffsets=function(t){var i=h.prototype.calculateOffsets.call(this,t);return"top"==this.position?i.y=t.top+1:"left"==this.position?(i.x=t.left,i.y=t.height/2+t.top-this.labelWidth/2):"right"==this.position&&(i.x=t.left+t.width-this.labelHeight,i.y=t.height/2+t.top-this.labelWidth/2),i},n.prototype.draw=function(t){h.prototype.draw.call(this,t),this.requiresResize&&(this.elem=this.plot.getPlaceholder().find("."+this.axisName+"Label"),this.elem.css("width",this.labelWidth),this.elem.css("height",this.labelHeight))},t.plot.plugins.push({init:r,options:p,name:"axisLabels",version:"2.0"})}(jQuery);
function assert(t,n){if(!t)throw new Error(n||"Assert Failed")}function orient2d(t,n,e){var i=(t.x-e.x)*(n.y-e.y),o=(t.y-e.y)*(n.x-e.x),r=i-o;return r>-1e-12&&r<EPSILON?Orientation.COLLINEAR:r>0?Orientation.CCW:Orientation.CW}function inScanArea(t,n,e,i){var o=(t.x-n.x)*(i.y-n.y)-(i.x-n.x)*(t.y-n.y);if(o>=-1e-12)return!1;var r=(t.x-e.x)*(i.y-e.y)-(i.x-e.x)*(t.y-e.y);return!(r<=EPSILON)}function isAngleObtuse(t,n,e){var i=n.x-t.x,o=n.y-t.y,r=e.x-t.x,s=e.y-t.y;return i*r+o*s<0}function triangulate(t){t.initTriangulation(),t.createAdvancingFront(),sweepPoints(t),finalizationPolygon(t)}function sweepPoints(t){var n,e=t.pointCount();for(n=1;n<e;++n)for(var i=t.getPoint(n),o=pointEvent(t,i),r=i._p2t_edge_list,s=0;r&&s<r.length;++s)edgeEventByEdge(t,r[s],o)}function finalizationPolygon(t){for(var n=t.front().head().next.triangle,e=t.front().head().next.point;!n.getConstrainedEdgeCW(e);)n=n.neighborCCW(e);t.meshClean(n)}function pointEvent(t,n){var e=t.locateNode(n),i=newFrontTriangle(t,n,e);return n.x<=e.point.x+EPSILON&&fill(t,e),fillAdvancingFront(t,i),i}function edgeEventByEdge(t,n,e){t.edge_event.constrained_edge=n,t.edge_event.right=n.p.x>n.q.x,isEdgeSideOfTriangle(e.triangle,n.p,n.q)||(fillEdgeEvent(t,n,e),edgeEventByPoints(t,n.p,n.q,e.triangle,n.q))}function edgeEventByPoints(t,n,e,i,o){if(!isEdgeSideOfTriangle(i,n,e)){var r=i.pointCCW(o),s=orient2d(e,r,n);if(s===Orientation.COLLINEAR)throw new PointError("poly2tri EdgeEvent: Collinear not supported!",[e,r,n]);var a=i.pointCW(o),p=orient2d(e,a,n);if(p===Orientation.COLLINEAR)throw new PointError("poly2tri EdgeEvent: Collinear not supported!",[e,a,n]);s===p?(i=s===Orientation.CW?i.neighborCCW(o):i.neighborCW(o),edgeEventByPoints(t,n,e,i,o)):flipEdgeEvent(t,n,e,i,o)}}function isEdgeSideOfTriangle(t,n,e){var i=t.edgeIndex(n,e);if(i!==-1){t.markConstrainedEdgeByIndex(i);var o=t.getNeighbor(i);return o&&o.markConstrainedEdgeByPoints(n,e),!0}return!1}function newFrontTriangle(t,n,e){var i=new Triangle(n,e.point,e.next.point);i.markNeighbor(e.triangle),t.addToMap(i);var o=new Node(n);return o.next=e.next,o.prev=e,e.next.prev=o,e.next=o,legalize(t,i)||t.mapTriangleToNodes(i),o}function fill(t,n){var e=new Triangle(n.prev.point,n.point,n.next.point);e.markNeighbor(n.prev.triangle),e.markNeighbor(n.triangle),t.addToMap(e),n.prev.next=n.next,n.next.prev=n.prev,legalize(t,e)||t.mapTriangleToNodes(e)}function fillAdvancingFront(t,n){for(var e=n.next;e.next&&!isAngleObtuse(e.point,e.next.point,e.prev.point);)fill(t,e),e=e.next;for(e=n.prev;e.prev&&!isAngleObtuse(e.point,e.next.point,e.prev.point);)fill(t,e),e=e.prev;n.next&&n.next.next&&isBasinAngleRight(n)&&fillBasin(t,n)}function isBasinAngleRight(t){var n=t.point.x-t.next.next.point.x,e=t.point.y-t.next.next.point.y;return assert(e>=0,"unordered y"),n>=0||Math.abs(n)<e}function legalize(t,n){for(var e=0;e<3;++e)if(!n.delaunay_edge[e]){var i=n.getNeighbor(e);if(i){var o=n.getPoint(e),r=i.oppositePoint(n,o),s=i.index(r);if(i.constrained_edge[s]||i.delaunay_edge[s]){n.constrained_edge[e]=i.constrained_edge[s];continue}var a=inCircle(o,n.pointCCW(o),n.pointCW(o),r);if(a){n.delaunay_edge[e]=!0,i.delaunay_edge[s]=!0,rotateTrianglePair(n,o,i,r);var p=!legalize(t,n);return p&&t.mapTriangleToNodes(n),p=!legalize(t,i),p&&t.mapTriangleToNodes(i),n.delaunay_edge[e]=!1,i.delaunay_edge[s]=!1,!0}}}return!1}function inCircle(t,n,e,i){var o=t.x-i.x,r=t.y-i.y,s=n.x-i.x,a=n.y-i.y,p=o*a,l=s*r,g=p-l;if(g<=0)return!1;var d=e.x-i.x,h=e.y-i.y,u=d*r,f=o*h,c=u-f;if(c<=0)return!1;var _=s*h,y=d*a,v=o*o+r*r,x=s*s+a*a,C=d*d+h*h,E=v*(_-y)+x*c+C*g;return E>0}function rotateTrianglePair(t,n,e,i){var o,r,s,a;o=t.neighborCCW(n),r=t.neighborCW(n),s=e.neighborCCW(i),a=e.neighborCW(i);var p,l,g,d;p=t.getConstrainedEdgeCCW(n),l=t.getConstrainedEdgeCW(n),g=e.getConstrainedEdgeCCW(i),d=e.getConstrainedEdgeCW(i);var h,u,f,c;h=t.getDelaunayEdgeCCW(n),u=t.getDelaunayEdgeCW(n),f=e.getDelaunayEdgeCCW(i),c=e.getDelaunayEdgeCW(i),t.legalize(n,i),e.legalize(i,n),e.setDelaunayEdgeCCW(n,h),t.setDelaunayEdgeCW(n,u),t.setDelaunayEdgeCCW(i,f),e.setDelaunayEdgeCW(i,c),e.setConstrainedEdgeCCW(n,p),t.setConstrainedEdgeCW(n,l),t.setConstrainedEdgeCCW(i,g),e.setConstrainedEdgeCW(i,d),t.clearNeighbors(),e.clearNeighbors(),o&&e.markNeighbor(o),r&&t.markNeighbor(r),s&&t.markNeighbor(s),a&&e.markNeighbor(a),t.markNeighbor(e)}function fillBasin(t,n){for(orient2d(n.point,n.next.point,n.next.next.point)===Orientation.CCW?t.basin.left_node=n.next.next:t.basin.left_node=n.next,t.basin.bottom_node=t.basin.left_node;t.basin.bottom_node.next&&t.basin.bottom_node.point.y>=t.basin.bottom_node.next.point.y;)t.basin.bottom_node=t.basin.bottom_node.next;if(t.basin.bottom_node!==t.basin.left_node){for(t.basin.right_node=t.basin.bottom_node;t.basin.right_node.next&&t.basin.right_node.point.y<t.basin.right_node.next.point.y;)t.basin.right_node=t.basin.right_node.next;t.basin.right_node!==t.basin.bottom_node&&(t.basin.width=t.basin.right_node.point.x-t.basin.left_node.point.x,t.basin.left_highest=t.basin.left_node.point.y>t.basin.right_node.point.y,fillBasinReq(t,t.basin.bottom_node))}}function fillBasinReq(t,n){if(!isShallow(t,n)){fill(t,n);var e;if(n.prev!==t.basin.left_node||n.next!==t.basin.right_node){if(n.prev===t.basin.left_node){if(e=orient2d(n.point,n.next.point,n.next.next.point),e===Orientation.CW)return;n=n.next}else if(n.next===t.basin.right_node){if(e=orient2d(n.point,n.prev.point,n.prev.prev.point),e===Orientation.CCW)return;n=n.prev}else n=n.prev.point.y<n.next.point.y?n.prev:n.next;fillBasinReq(t,n)}}}function isShallow(t,n){var e;return e=t.basin.left_highest?t.basin.left_node.point.y-n.point.y:t.basin.right_node.point.y-n.point.y,t.basin.width>e}function fillEdgeEvent(t,n,e){t.edge_event.right?fillRightAboveEdgeEvent(t,n,e):fillLeftAboveEdgeEvent(t,n,e)}function fillRightAboveEdgeEvent(t,n,e){for(;e.next.point.x<n.p.x;)orient2d(n.q,e.next.point,n.p)===Orientation.CCW?fillRightBelowEdgeEvent(t,n,e):e=e.next}function fillRightBelowEdgeEvent(t,n,e){e.point.x<n.p.x&&(orient2d(e.point,e.next.point,e.next.next.point)===Orientation.CCW?fillRightConcaveEdgeEvent(t,n,e):(fillRightConvexEdgeEvent(t,n,e),fillRightBelowEdgeEvent(t,n,e)))}function fillRightConcaveEdgeEvent(t,n,e){fill(t,e.next),e.next.point!==n.p&&orient2d(n.q,e.next.point,n.p)===Orientation.CCW&&orient2d(e.point,e.next.point,e.next.next.point)===Orientation.CCW&&fillRightConcaveEdgeEvent(t,n,e)}function fillRightConvexEdgeEvent(t,n,e){orient2d(e.next.point,e.next.next.point,e.next.next.next.point)===Orientation.CCW?fillRightConcaveEdgeEvent(t,n,e.next):orient2d(n.q,e.next.next.point,n.p)===Orientation.CCW&&fillRightConvexEdgeEvent(t,n,e.next)}function fillLeftAboveEdgeEvent(t,n,e){for(;e.prev.point.x>n.p.x;)orient2d(n.q,e.prev.point,n.p)===Orientation.CW?fillLeftBelowEdgeEvent(t,n,e):e=e.prev}function fillLeftBelowEdgeEvent(t,n,e){e.point.x>n.p.x&&(orient2d(e.point,e.prev.point,e.prev.prev.point)===Orientation.CW?fillLeftConcaveEdgeEvent(t,n,e):(fillLeftConvexEdgeEvent(t,n,e),fillLeftBelowEdgeEvent(t,n,e)))}function fillLeftConvexEdgeEvent(t,n,e){orient2d(e.prev.point,e.prev.prev.point,e.prev.prev.prev.point)===Orientation.CW?fillLeftConcaveEdgeEvent(t,n,e.prev):orient2d(n.q,e.prev.prev.point,n.p)===Orientation.CW&&fillLeftConvexEdgeEvent(t,n,e.prev)}function fillLeftConcaveEdgeEvent(t,n,e){fill(t,e.prev),e.prev.point!==n.p&&orient2d(n.q,e.prev.point,n.p)===Orientation.CW&&orient2d(e.point,e.prev.point,e.prev.prev.point)===Orientation.CW&&fillLeftConcaveEdgeEvent(t,n,e)}function flipEdgeEvent(t,n,e,i,o){var r=i.neighborAcross(o);assert(r,"FLIP failed due to missing triangle!");var s=r.oppositePoint(i,o);if(i.getConstrainedEdgeAcross(o)){var a=i.index(o);throw new PointError("poly2tri Intersecting Constraints",[o,s,i.getPoint((a+1)%3),i.getPoint((a+2)%3)])}if(inScanArea(o,i.pointCCW(o),i.pointCW(o),s))if(rotateTrianglePair(i,o,r,s),t.mapTriangleToNodes(i),t.mapTriangleToNodes(r),o===e&&s===n)e===t.edge_event.constrained_edge.q&&n===t.edge_event.constrained_edge.p&&(i.markConstrainedEdgeByPoints(n,e),r.markConstrainedEdgeByPoints(n,e),legalize(t,i),legalize(t,r));else{var p=orient2d(e,s,n);i=nextFlipTriangle(t,p,i,r,o,s),flipEdgeEvent(t,n,e,i,o)}else{var l=nextFlipPoint(n,e,r,s);flipScanEdgeEvent(t,n,e,i,r,l),edgeEventByPoints(t,n,e,i,o)}}function nextFlipTriangle(t,n,e,i,o,r){var s;return n===Orientation.CCW?(s=i.edgeIndex(o,r),i.delaunay_edge[s]=!0,legalize(t,i),i.clearDelaunayEdges(),e):(s=e.edgeIndex(o,r),e.delaunay_edge[s]=!0,legalize(t,e),e.clearDelaunayEdges(),i)}function nextFlipPoint(t,n,e,i){var o=orient2d(n,i,t);if(o===Orientation.CW)return e.pointCCW(i);if(o===Orientation.CCW)return e.pointCW(i);throw new PointError("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[n,i,t])}function flipScanEdgeEvent(t,n,e,i,o,r){var s=o.neighborAcross(r);assert(s,"FLIP failed due to missing triangle");var a=s.oppositePoint(o,r);if(inScanArea(e,i.pointCCW(e),i.pointCW(e),a))flipEdgeEvent(t,e,a,s,a);else{var p=nextFlipPoint(n,e,s,a);flipScanEdgeEvent(t,n,e,i,s,p)}}var Node=function(t,n){this.point=t,this.triangle=n||null,this.next=null,this.prev=null,this.value=t.x},AdvancingFront=function(t,n){this.head_=t,this.tail_=n,this.search_node_=t};AdvancingFront.prototype.head=function(){return this.head_},AdvancingFront.prototype.setHead=function(t){this.head_=t},AdvancingFront.prototype.tail=function(){return this.tail_},AdvancingFront.prototype.setTail=function(t){this.tail_=t},AdvancingFront.prototype.search=function(){return this.search_node_},AdvancingFront.prototype.setSearch=function(t){this.search_node_=t},AdvancingFront.prototype.findSearchNode=function(){return this.search_node_},AdvancingFront.prototype.locateNode=function(t){var n=this.search_node_;if(t<n.value){for(;n=n.prev;)if(t>=n.value)return this.search_node_=n,n}else for(;n=n.next;)if(t<n.value)return this.search_node_=n.prev,n.prev;return null},AdvancingFront.prototype.locatePoint=function(t){var n=t.x,e=this.findSearchNode(n),i=e.point.x;if(n===i){if(t!==e.point)if(t===e.prev.point)e=e.prev;else{if(t!==e.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");e=e.next}}else if(n<i)for(;(e=e.prev)&&t!==e.point;);else for(;(e=e.next)&&t!==e.point;);return e&&(this.search_node_=e),e};var Point=function(t,n){this.x=+t||0,this.y=+n||0,this._p2t_edge_list=null};Point.prototype.toJSON=function(){return{x:this.x,y:this.y}},Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.set_zero=function(){return this.x=0,this.y=0,this},Point.prototype.set=function(t,n){return this.x=+t||0,this.y=+n||0,this},Point.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},Point.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},Point.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},Point.prototype.mul=function(t){return this.x*=t,this.y*=t,this},Point.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Point.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,t},Point.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},Point.negate=function(t){return new Point((-t.x),(-t.y))},Point.add=function(t,n){return new Point(t.x+n.x,t.y+n.y)},Point.sub=function(t,n){return new Point(t.x-n.x,t.y-n.y)},Point.mul=function(t,n){return new Point(t*n.x,t*n.y)},Point.cross=function(t,n){return"number"==typeof t?"number"==typeof n?t*n:new Point(-t*n.y,t*n.x):"number"==typeof n?new Point(n*t.y,-n*t.x):t.x*n.y-t.y*n.x},Point.compare=function(t,n){return t.y===n.y?t.x-n.x:t.y-n.y},Point.toString=function(t){var n=t.toString();return"[object Object]"===n?toStringBase(t):n},Point.equals=function(t,n){return t.x===n.x&&t.y===n.y},Point.dot=function(t,n){return t.x*n.x+t.y*n.y};var PointError=function(t,n){this.name="PointError",this.points=n=n||[],this.message=t||"Invalid Points!"};PointError.prototype=new Error,PointError.prototype.constructor=PointError;var EPSILON=1e-12,Orientation={CW:1,CCW:-1,COLLINEAR:0},kAlpha=.3,Edge=function(t,n){if(this.p=t,this.q=n,t.y>n.y)this.q=t,this.p=n;else if(t.y===n.y)if(t.x>n.x)this.q=t,this.p=n;else if(t.x===n.x)throw new PointError("poly2tri Invalid Edge constructor: repeated points!",[t]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},Basin=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};Basin.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var EdgeEvent=function(){this.constrained_edge=null,this.right=!1},SweepContext=function(t,n){n=n||{},this.triangles_=[],this.map_=[],this.points_=n.cloneArrays?t.slice(0):t,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new Basin,this.edge_event=new EdgeEvent,this.initEdges(this.points_)};SweepContext.prototype.addHole=function(t){this.initEdges(t);var n,e=t.length;for(n=0;n<e;n++)this.points_.push(t[n]);return this},SweepContext.prototype.AddHole=SweepContext.prototype.addHole,SweepContext.prototype.addHoles=function(t){var n,e=t.length;for(n=0;n<e;n++)this.initEdges(t[n]);return this.points_=this.points_.concat.apply(this.points_,t),this},SweepContext.prototype.addPoint=function(t){return this.points_.push(t),this},SweepContext.prototype.AddPoint=SweepContext.prototype.addPoint,SweepContext.prototype.addPoints=function(t){return this.points_=this.points_.concat(t),this},SweepContext.prototype.triangulate=function(){return triangulate(this),this},SweepContext.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},SweepContext.prototype.getTriangles=function(){return this.triangles_},SweepContext.prototype.GetTriangles=SweepContext.prototype.getTriangles,SweepContext.prototype.front=function(){return this.front_},SweepContext.prototype.pointCount=function(){return this.points_.length},SweepContext.prototype.head=function(){return this.head_},SweepContext.prototype.setHead=function(t){this.head_=t},SweepContext.prototype.tail=function(){return this.tail_},SweepContext.prototype.setTail=function(t){this.tail_=t},SweepContext.prototype.getMap=function(){return this.map_},SweepContext.prototype.initTriangulation=function(){var t,n=this.points_[0].x,e=this.points_[0].x,i=this.points_[0].y,o=this.points_[0].y,r=this.points_.length;for(t=1;t<r;t++){var s=this.points_[t];s.x>n&&(n=s.x),s.x<e&&(e=s.x),s.y>i&&(i=s.y),s.y<o&&(o=s.y)}this.pmin_=new Point(e,o),this.pmax_=new Point(n,i);var a=kAlpha*(n-e),p=kAlpha*(i-o);this.head_=new Point(n+a,o-p),this.tail_=new Point(e-a,o-p),this.points_.sort(Point.compare)},SweepContext.prototype.initEdges=function(t){var n,e=t.length;for(n=0;n<e;++n)this.edge_list.push(new Edge(t[n],t[(n+1)%e]))},SweepContext.prototype.getPoint=function(t){return this.points_[t]},SweepContext.prototype.addToMap=function(t){this.map_.push(t)},SweepContext.prototype.locateNode=function(t){return this.front_.locateNode(t.x)},SweepContext.prototype.createAdvancingFront=function(){var t,n,e,i=new Triangle(this.points_[0],this.tail_,this.head_);this.map_.push(i),t=new Node(i.getPoint(1),i),n=new Node(i.getPoint(0),i),e=new Node(i.getPoint(2)),this.front_=new AdvancingFront(t,e),t.next=n,n.next=e,n.prev=t,e.prev=n},SweepContext.prototype.removeNode=function(t){},SweepContext.prototype.mapTriangleToNodes=function(t){for(var n=0;n<3;++n)if(!t.getNeighbor(n)){var e=this.front_.locatePoint(t.pointCW(t.getPoint(n)));e&&(e.triangle=t)}},SweepContext.prototype.removeFromMap=function(t){var n,e=this.map_,i=e.length;for(n=0;n<i;n++)if(e[n]===t){e.splice(n,1);break}},SweepContext.prototype.meshClean=function(t){for(var n,e,i=[t];n=i.pop();)if(!n.isInterior())for(n.setInterior(!0),this.triangles_.push(n),e=0;e<3;e++)n.constrained_edge[e]||i.push(n.getNeighbor(e))};var Triangle=function(t,n,e){this.points_=[t,n,e],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]};Triangle.prototype.getPoint=function(t){return this.points_[t]},Triangle.prototype.GetPoint=Triangle.prototype.getPoint,Triangle.prototype.getPoints=function(){return this.points_},Triangle.prototype.getNeighbor=function(t){return this.neighbors_[t]},Triangle.prototype.containsPoint=function(t){var n=this.points_;return t===n[0]||t===n[1]||t===n[2]},Triangle.prototype.containsEdge=function(t){return this.containsPoint(t.p)&&this.containsPoint(t.q)},Triangle.prototype.containsPoints=function(t,n){return this.containsPoint(t)&&this.containsPoint(n)},Triangle.prototype.isInterior=function(){return this.interior_},Triangle.prototype.setInterior=function(t){return this.interior_=t,this},Triangle.prototype.markNeighborPointers=function(t,n,e){var i=this.points_;if(t===i[2]&&n===i[1]||t===i[1]&&n===i[2])this.neighbors_[0]=e;else if(t===i[0]&&n===i[2]||t===i[2]&&n===i[0])this.neighbors_[1]=e;else{if(!(t===i[0]&&n===i[1]||t===i[1]&&n===i[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=e}},Triangle.prototype.markNeighbor=function(t){var n=this.points_;t.containsPoints(n[1],n[2])?(this.neighbors_[0]=t,t.markNeighborPointers(n[1],n[2],this)):t.containsPoints(n[0],n[2])?(this.neighbors_[1]=t,t.markNeighborPointers(n[0],n[2],this)):t.containsPoints(n[0],n[1])&&(this.neighbors_[2]=t,t.markNeighborPointers(n[0],n[1],this))},Triangle.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},Triangle.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},Triangle.prototype.pointCW=function(t){var n=this.points_;return t===n[0]?n[2]:t===n[1]?n[0]:t===n[2]?n[1]:null},Triangle.prototype.pointCCW=function(t){var n=this.points_;return t===n[0]?n[1]:t===n[1]?n[2]:t===n[2]?n[0]:null},Triangle.prototype.neighborCW=function(t){return t===this.points_[0]?this.neighbors_[1]:t===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},Triangle.prototype.neighborCCW=function(t){return t===this.points_[0]?this.neighbors_[2]:t===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},Triangle.prototype.getConstrainedEdgeCW=function(t){return t===this.points_[0]?this.constrained_edge[1]:t===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},Triangle.prototype.getConstrainedEdgeCCW=function(t){return t===this.points_[0]?this.constrained_edge[2]:t===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},Triangle.prototype.getConstrainedEdgeAcross=function(t){return t===this.points_[0]?this.constrained_edge[0]:t===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},Triangle.prototype.setConstrainedEdgeCW=function(t,n){t===this.points_[0]?this.constrained_edge[1]=n:t===this.points_[1]?this.constrained_edge[2]=n:this.constrained_edge[0]=n},Triangle.prototype.setConstrainedEdgeCCW=function(t,n){t===this.points_[0]?this.constrained_edge[2]=n:t===this.points_[1]?this.constrained_edge[0]=n:this.constrained_edge[1]=n},Triangle.prototype.getDelaunayEdgeCW=function(t){return t===this.points_[0]?this.delaunay_edge[1]:t===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},Triangle.prototype.getDelaunayEdgeCCW=function(t){return t===this.points_[0]?this.delaunay_edge[2]:t===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},Triangle.prototype.setDelaunayEdgeCW=function(t,n){t===this.points_[0]?this.delaunay_edge[1]=n:t===this.points_[1]?this.delaunay_edge[2]=n:this.delaunay_edge[0]=n},Triangle.prototype.setDelaunayEdgeCCW=function(t,n){t===this.points_[0]?this.delaunay_edge[2]=n:t===this.points_[1]?this.delaunay_edge[0]=n:this.delaunay_edge[1]=n},Triangle.prototype.neighborAcross=function(t){return t===this.points_[0]?this.neighbors_[0]:t===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},Triangle.prototype.oppositePoint=function(t,n){var e=t.pointCW(n);return this.pointCW(e)},Triangle.prototype.legalize=function(t,n){var e=this.points_;if(t===e[0])e[1]=e[0],e[0]=e[2],e[2]=n;else if(t===e[1])e[2]=e[1],e[1]=e[0],e[0]=n;else{if(t!==e[2])throw new Error("poly2tri Invalid Triangle.legalize() call");e[0]=e[2],e[2]=e[1],e[1]=n}},Triangle.prototype.index=function(t){var n=this.points_;if(t===n[0])return 0;if(t===n[1])return 1;if(t===n[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},Triangle.prototype.edgeIndex=function(t,n){var e=this.points_;if(t===e[0]){if(n===e[1])return 2;if(n===e[2])return 1}else if(t===e[1]){if(n===e[2])return 0;if(n===e[0])return 2}else if(t===e[2]){if(n===e[0])return 1;if(n===e[1])return 0}return-1},Triangle.prototype.markConstrainedEdgeByIndex=function(t){this.constrained_edge[t]=!0},Triangle.prototype.markConstrainedEdgeByEdge=function(t){this.markConstrainedEdgeByPoints(t.p,t.q)},Triangle.prototype.markConstrainedEdgeByPoints=function(t,n){var e=this.points_;n===e[0]&&t===e[1]||n===e[1]&&t===e[0]?this.constrained_edge[2]=!0:n===e[0]&&t===e[2]||n===e[2]&&t===e[0]?this.constrained_edge[1]=!0:(n===e[1]&&t===e[2]||n===e[2]&&t===e[1])&&(this.constrained_edge[0]=!0)};
function Tree(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Data(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new Tree,this.dtree=new Tree}function tinf_build_bits_base(e,t,a,r){var n,s;for(n=0;n<a;++n)e[n]=0;for(n=0;n<30-a;++n)e[n+a]=n/a|0;for(s=r,n=0;n<30;++n)t[n]=s,s+=1<<e[n]}function tinf_build_fixed_trees(e,t){var a;for(a=0;a<7;++a)e.table[a]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,a=0;a<24;++a)e.trans[a]=256+a;for(a=0;a<144;++a)e.trans[24+a]=a;for(a=0;a<8;++a)e.trans[168+a]=280+a;for(a=0;a<112;++a)e.trans[176+a]=144+a;for(a=0;a<5;++a)t.table[a]=0;for(t.table[5]=32,a=0;a<32;++a)t.trans[a]=a}function tinf_build_tree(e,t,a,r){var n,s;for(n=0;n<16;++n)e.table[n]=0;for(n=0;n<r;++n)e.table[t[a+n]]++;for(e.table[0]=0,s=0,n=0;n<16;++n)offs[n]=s,s+=e.table[n];for(n=0;n<r;++n)t[a+n]&&(e.trans[offs[t[a+n]]++]=n)}function tinf_getbit(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function tinf_read_bits(e,t,a){if(!t)return a;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,r+a}function tinf_decode_symbol(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var a=0,r=0,n=0,s=e.tag;do r=2*r+(1&s),s>>>=1,++n,a+=t.table[n],r-=t.table[n];while(r>=0);return e.tag=s,e.bitcount-=n,t.trans[a+r]}function tinf_decode_trees(e,t,a){var r,n,s,i,o,l;for(r=tinf_read_bits(e,5,257),n=tinf_read_bits(e,5,1),s=tinf_read_bits(e,4,4),i=0;i<19;++i)lengths[i]=0;for(i=0;i<s;++i){var u=tinf_read_bits(e,3,0);lengths[clcidx[i]]=u}for(tinf_build_tree(code_tree,lengths,0,19),o=0;o<r+n;){var p=tinf_decode_symbol(e,code_tree);switch(p){case 16:var f=lengths[o-1];for(l=tinf_read_bits(e,2,3);l;--l)lengths[o++]=f;break;case 17:for(l=tinf_read_bits(e,3,3);l;--l)lengths[o++]=0;break;case 18:for(l=tinf_read_bits(e,7,11);l;--l)lengths[o++]=0;break;default:lengths[o++]=p}}tinf_build_tree(t,lengths,0,r),tinf_build_tree(a,lengths,r,n)}function tinf_inflate_block_data(e,t,a){for(;;){var r=tinf_decode_symbol(e,t);if(256===r)return TINF_OK;if(r<256)e.dest[e.destLen++]=r;else{var n,s,i,o;for(r-=257,n=tinf_read_bits(e,length_bits[r],length_base[r]),s=tinf_decode_symbol(e,a),i=e.destLen-tinf_read_bits(e,dist_bits[s],dist_base[s]),o=i;o<i+n;++o)e.dest[e.destLen++]=e.dest[o]}}}function tinf_inflate_uncompressed_block(e){for(var t,a,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if(t=e.source[e.sourceIndex+1],t=256*t+e.source[e.sourceIndex],a=e.source[e.sourceIndex+3],a=256*a+e.source[e.sourceIndex+2],t!==(65535&~a))return TINF_DATA_ERROR;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,TINF_OK}function tinf_uncompress(e,t){var a,r,n,s=new Data(e,t);do{switch(a=tinf_getbit(s),r=tinf_read_bits(s,2,0)){case 0:n=tinf_inflate_uncompressed_block(s);break;case 1:n=tinf_inflate_block_data(s,sltree,sdtree);break;case 2:tinf_decode_trees(s,s.ltree,s.dtree),n=tinf_inflate_block_data(s,s.ltree,s.dtree);break;default:n=TINF_DATA_ERROR}if(n!==TINF_OK)throw new Error("Data error")}while(!a);return s.destLen<s.dest.length?"function"==typeof s.dest.slice?s.dest.slice(0,s.destLen):s.dest.subarray(0,s.destLen):s.dest}function line(e,t,a,r,n){e.beginPath(),e.moveTo(t,a),e.lineTo(r,n),e.stroke()}function DefaultEncoding(e){this.font=e}function CmapEncoding(e){this.cmap=e}function CffEncoding(e,t){this.encoding=e,this.charset=t}function GlyphNames(e){var t;switch(e.version){case 1:this.names=opentype_standardNames.slice();break;case 2:for(this.names=new Array(e.numberOfGlyphs),t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<opentype_standardNames.length?this.names[t]=opentype_standardNames[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-opentype_standardNames.length];break;case 2.5:for(this.names=new Array(e.numberOfGlyphs),t=0;t<e.numberOfGlyphs;t++)this.names[t]=opentype_standardNames[t+e.glyphNameIndex[t]];break;case 3:this.names=[]}}function addGlyphNames(e){for(var t,a=e.tables.cmap.glyphIndexMap,r=Object.keys(a),n=0;n<r.length;n+=1){var s=r[n],i=a[s];t=e.glyphs.get(i),t.addUnicode(parseInt(s))}for(n=0;n<e.glyphs.length;n+=1)t=e.glyphs.get(n),e.cffEncoding?t.name=e.cffEncoding.charset[n]:t.name=e.glyphNames.glyphIndexToName(n)}function Font(e){e=e||{},e.empty||(util.checkArgument(e.familyName,"When creating a new Font object, familyName is required."),util.checkArgument(e.styleName,"When creating a new Font object, styleName is required."),util.checkArgument(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),util.checkArgument(e.ascender,"When creating a new Font object, ascender is required."),util.checkArgument(e.descender,"When creating a new Font object, descender is required."),util.checkArgument(e.descender<0,"Descender should be negative (e.g. -512)."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||e.familyName+e.styleName},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender),this.supported=!0,this.glyphs=new GlyphSet(this,e.glyphs||[]),this.encoding=new DefaultEncoding(this),this.tables={}}function getPathDefinition(e,t){var a=t||{commands:[]};return{configurable:!0,get:function(){return"function"==typeof a&&(a=a()),a},set:function(e){a=e}}}function Glyph(e){this.bindConstructorValues(e)}function GlyphSet(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var a=0;a<t.length;a++)this.glyphs[a]=t[a];this.length=t&&t.length||0}function glyphLoader(e,t){return new Glyph({index:t,font:e})}function ttfGlyphLoader(e,t,a,r,n,s){return function(){var i=new Glyph({index:t,font:e});return i.path=function(){a(i,r,n);var t=s(e.glyphs,i);return t.unitsPerEm=e.unitsPerEm,t},i}}function cffGlyphLoader(e,t,a,r){return function(){var n=new Glyph({index:t,font:e});return n.path=function(){var t=a(e,n,r);return t.unitsPerEm=e.unitsPerEm,t},n}}function loadFromFile(e,t){var a=require("fs");a.readFile(e,function(e,a){return e?t(e.message):void t(null,util.nodeBufferToArrayBuffer(a))})}function loadFromUrl(e,t){var a=new XMLHttpRequest;a.open("get",e,!0),a.responseType="arraybuffer",a.onload=function(){return 200!==a.status?t("Font could not be loaded: "+a.statusText):t(null,a.response)},a.send()}function parseOpenTypeTableEntries(e,t){for(var a=[],r=12,n=0;n<t;n+=1){var s=getTag(e,r),i=getULong(e,r+4),o=getULong(e,r+8),l=getULong(e,r+12);a.push({tag:s,checksum:i,offset:o,length:l,compression:!1}),r+=16}return a}function parseWOFFTableEntries(e,t){for(var a=[],r=44,n=0;n<t;n+=1){var s,i=getTag(e,r),o=getULong(e,r+4),l=getULong(e,r+8),u=getULong(e,r+12);s=l<u&&"WOFF",a.push({tag:i,offset:o,compression:s,compressedLength:l,originalLength:u}),r+=20}return a}function uncompressTable(e,t){if("WOFF"===t.compression){var a=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),r=new Uint8Array(t.originalLength);if(inflate(a,r),r.byteLength!==t.originalLength)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");var n=new DataView(r.buffer,0);return{data:n,offset:0}}return{data:e,offset:t.offset}}function parseBuffer(e){var t,a,r,n=new Font({empty:!0}),s=new DataView(e,0),i=[],o=getTag(s,0);if(o===String.fromCharCode(0,1,0,0))n.outlinesFormat="truetype",r=getUShort(s,4),i=parseOpenTypeTableEntries(s,r);else if("OTTO"===o)n.outlinesFormat="cff",r=getUShort(s,4),i=parseOpenTypeTableEntries(s,r);else{if("wOFF"!==o)throw new Error("Unsupported OpenType signature "+o);var l=getTag(s,4);if(l===String.fromCharCode(0,1,0,0))n.outlinesFormat="truetype";else{if("OTTO"!==l)throw new Error("Unsupported OpenType flavor "+o);n.outlinesFormat="cff"}r=getUShort(s,12),i=parseWOFFTableEntries(s,r)}for(var u,p,f,c,h,d,m,g,y=0;y<r;y+=1){var v,b=i[y];switch(b.tag){case"cmap":v=uncompressTable(s,b),n.tables.cmap=parseCmapTable(v.data,v.offset),n.encoding=new CmapEncoding(n.tables.cmap);break;case"fvar":p=b;break;case"head":v=uncompressTable(s,b),n.tables.head=parseHeadTable(v.data,v.offset),n.unitsPerEm=n.tables.head.unitsPerEm,t=n.tables.head.indexToLocFormat;break;case"hhea":v=uncompressTable(s,b),n.tables.hhea=parseHheaTable(v.data,v.offset),n.ascender=n.tables.hhea.ascender,n.descender=n.tables.hhea.descender,n.numberOfHMetrics=n.tables.hhea.numberOfHMetrics;break;case"hmtx":h=b;break;case"ltag":v=uncompressTable(s,b),a=ltag.parse(v.data,v.offset);break;case"maxp":v=uncompressTable(s,b),n.tables.maxp=parseMaxpTable(v.data,v.offset),n.numGlyphs=n.tables.maxp.numGlyphs;break;case"name":g=b;break;case"OS/2":v=uncompressTable(s,b),n.tables.os2=parseOS2Table(v.data,v.offset);break;case"post":v=uncompressTable(s,b),n.tables.post=parsePostTable(v.data,v.offset),n.glyphNames=new GlyphNames(n.tables.post);break;case"glyf":f=b;break;case"loca":m=b;break;case"CFF ":u=b;break;case"kern":d=b;break;case"GPOS":c=b}}var S=uncompressTable(s,g);if(n.tables.name=parseNameTable(S.data,S.offset,a),n.names=n.tables.name,f&&m){var T=0===t,x=uncompressTable(s,m),O=parseLocaTable(x.data,x.offset,n.numGlyphs,T),U=uncompressTable(s,f);n.glyphs=parseGlyfTable(U.data,U.offset,O,n)}else{if(!u)throw new Error("Font doesn't contain TrueType or CFF outlines.");var C=uncompressTable(s,u);parseCFFTable(C.data,C.offset,n)}var R=uncompressTable(s,h);if(parseHmtxTable(R.data,R.offset,n.numberOfHMetrics,n.numGlyphs,n.glyphs),addGlyphNames(n),d){var E=uncompressTable(s,d);n.kerningPairs=kern.parse(E.data,E.offset)}else n.kerningPairs={};if(c){var w=uncompressTable(s,c);parseGposTable(w.data,w.offset,n)}if(p){var k=uncompressTable(s,p);n.tables.fvar=fvar.parse(k.data,k.offset,n.names)}return n}function opentype_load(e,t){var a="undefined"==typeof window,r=a?loadFromFile:loadFromUrl;r(e,function(e,a){if(e)return t(e);var r;try{r=parseBuffer(a)}catch(n){return t(n,null)}return t(null,r)})}function loadSync(e){var t=require("fs"),a=t.readFileSync(e);return parseBuffer(util.nodeBufferToArrayBuffer(a))}function Parser(e,t){this.data=e,this.offset=t,this.relativeOffset=0}function Path(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function Table(e,t,a){var r;for(r=0;r<t.length;r+=1){var n=t[r];this[n.name]=n.value}if(this.tableName=e,this.fields=t,a){var s=Object.keys(a);for(r=0;r<s.length;r+=1){var i=s[r],o=a[i];void 0!==this[i]&&(this[i]=o)}}}function equals(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a+=1)if(!equals(e[a],t[a]))return!1;return!0}return!1}function parseCFFIndex(e,t,a){var r,n,s,i=[],o=[],l=getCard16(e,t);if(0!==l){var u=getByte(e,t+2);n=t+(l+1)*u+2;var p=t+3;for(r=0;r<l+1;r+=1)i.push(getOffset(e,p,u)),p+=u;s=n+i[l]}else s=t+2;for(r=0;r<i.length-1;r+=1){var f=getBytes(e,n+i[r],n+i[r+1]);a&&(f=a(f)),o.push(f)}return{objects:o,startOffset:t,endOffset:s}}function parseFloatOperand(e){for(var t="",a=15,r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var n=e.parseByte(),s=n>>4,i=15&n;if(s===a)break;if(t+=r[s],i===a)break;t+=r[i]}return parseFloat(t)}function parseOperand(e,t){var a,r,n,s;if(28===t)return a=e.parseByte(),r=e.parseByte(),a<<8|r;if(29===t)return a=e.parseByte(),r=e.parseByte(),n=e.parseByte(),s=e.parseByte(),a<<24|r<<16|n<<8|s;if(30===t)return parseFloatOperand(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return a=e.parseByte(),256*(t-247)+a+108;if(t>=251&&t<=254)return a=e.parseByte(),256*-(t-251)-a-108;throw new Error("Invalid b0 "+t)}function entriesToObject(e){for(var t={},a=0;a<e.length;a+=1){var r,n=e[a][0],s=e[a][1];if(r=1===s.length?s[0]:s,t.hasOwnProperty(n))throw new Error("Object "+t+" already has key "+n);t[n]=r}return t}function parseCFFDict(e,t,a){t=void 0!==t?t:0;var r=new Parser(e,t),n=[],s=[];for(a=void 0!==a?a:e.length;r.relativeOffset<a;){var i=r.parseByte();i<=21?(12===i&&(i=1200+r.parseByte()),n.push([i,s]),s=[]):s.push(parseOperand(r,i))}return entriesToObject(n)}function getCFFString(e,t){return t=t<=390?cffStandardStrings[t]:e[t-391]}function interpretDict(e,t,a){for(var r={},n=0;n<t.length;n+=1){var s=t[n],i=e[s.op];void 0===i&&(i=void 0!==s.value?s.value:null),"SID"===s.type&&(i=getCFFString(a,i)),r[s.name]=i}return r}function parseCFFHeader(e,t){var a={};return a.formatMajor=getCard8(e,t),a.formatMinor=getCard8(e,t+1),a.size=getCard8(e,t+2),a.offsetSize=getCard8(e,t+3),a.startOffset=t,a.endOffset=t+4,a}function parseCFFTopDict(e,t){var a=parseCFFDict(e,0,e.byteLength);return interpretDict(a,TOP_DICT_META,t)}function parseCFFPrivateDict(e,t,a,r){var n=parseCFFDict(e,t,a);return interpretDict(n,PRIVATE_DICT_META,r)}function parseCFFCharset(e,t,a,r){var n,s,i,o=new Parser(e,t);a-=1;var l=[".notdef"],u=o.parseCard8();if(0===u)for(n=0;n<a;n+=1)s=o.parseSID(),l.push(getCFFString(r,s));else if(1===u)for(;l.length<=a;)for(s=o.parseSID(),i=o.parseCard8(),n=0;n<=i;n+=1)l.push(getCFFString(r,s)),s+=1;else{if(2!==u)throw new Error("Unknown charset format "+u);for(;l.length<=a;)for(s=o.parseSID(),i=o.parseCard16(),n=0;n<=i;n+=1)l.push(getCFFString(r,s)),s+=1}return l}function parseCFFEncoding(e,t,a){var r,n,s={},i=new Parser(e,t),o=i.parseCard8();if(0===o){var l=i.parseCard8();for(r=0;r<l;r+=1)n=i.parseCard8(),s[n]=r}else{if(1!==o)throw new Error("Unknown encoding format "+o);var u=i.parseCard8();for(n=1,r=0;r<u;r+=1)for(var p=i.parseCard8(),f=i.parseCard8(),c=p;c<=p+f;c+=1)s[c]=n,n+=1}return new CffEncoding(s,a)}function parseCFFCharstring(e,t,a){function r(e,t){m&&p.closePath(),p.moveTo(e,t),m=!0}function n(){var t;t=f.length%2!==0,t&&!h&&(d=f.shift()+e.nominalWidthX),c+=f.length>>1,f.length=0,h=!0}function s(a){for(var v,b,S,T,x,O,U,C,R,E,w,k,I=0;I<a.length;){var F=a[I];switch(I+=1,F){case 1:n();break;case 3:n();break;case 4:f.length>1&&!h&&(d=f.shift()+e.nominalWidthX,h=!0),y+=f.pop(),r(g,y);break;case 5:for(;f.length>0;)g+=f.shift(),y+=f.shift(),p.lineTo(g,y);break;case 6:for(;f.length>0&&(g+=f.shift(),p.lineTo(g,y),0!==f.length);)y+=f.shift(),p.lineTo(g,y);break;case 7:for(;f.length>0&&(y+=f.shift(),p.lineTo(g,y),0!==f.length);)g+=f.shift(),p.lineTo(g,y);break;case 8:for(;f.length>0;)i=g+f.shift(),o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),g=l+f.shift(),y=u+f.shift(),p.curveTo(i,o,l,u,g,y);break;case 10:x=f.pop()+e.subrsBias,O=e.subrs[x],O&&s(O);break;case 11:return;case 12:switch(F=a[I],I+=1,F){case 35:i=g+f.shift(),o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),U=l+f.shift(),C=u+f.shift(),R=U+f.shift(),E=C+f.shift(),w=R+f.shift(),k=E+f.shift(),g=w+f.shift(),y=k+f.shift(),f.shift(),p.curveTo(i,o,l,u,U,C),p.curveTo(R,E,w,k,g,y);break;case 34:i=g+f.shift(),o=y,l=i+f.shift(),u=o+f.shift(),U=l+f.shift(),C=u,R=U+f.shift(),E=u,w=R+f.shift(),k=y,g=w+f.shift(),p.curveTo(i,o,l,u,U,C),p.curveTo(R,E,w,k,g,y);break;case 36:i=g+f.shift(),o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),U=l+f.shift(),C=u,R=U+f.shift(),E=u,w=R+f.shift(),k=E+f.shift(),g=w+f.shift(),p.curveTo(i,o,l,u,U,C),p.curveTo(R,E,w,k,g,y);break;case 37:i=g+f.shift(),o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),U=l+f.shift(),C=u+f.shift(),R=U+f.shift(),E=C+f.shift(),w=R+f.shift(),k=E+f.shift(),Math.abs(w-g)>Math.abs(k-y)?g=w+f.shift():y=k+f.shift(),p.curveTo(i,o,l,u,U,C),p.curveTo(R,E,w,k,g,y);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+F),f.length=0}break;case 14:f.length>0&&!h&&(d=f.shift()+e.nominalWidthX,h=!0),m&&(p.closePath(),m=!1);break;case 18:n();break;case 19:case 20:n(),I+=c+7>>3;break;case 21:f.length>2&&!h&&(d=f.shift()+e.nominalWidthX,h=!0),y+=f.pop(),g+=f.pop(),r(g,y);break;case 22:f.length>1&&!h&&(d=f.shift()+e.nominalWidthX,h=!0),g+=f.pop(),r(g,y);break;case 23:n();break;case 24:for(;f.length>2;)i=g+f.shift(),o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),g=l+f.shift(),y=u+f.shift(),p.curveTo(i,o,l,u,g,y);g+=f.shift(),y+=f.shift(),p.lineTo(g,y);break;case 25:for(;f.length>6;)g+=f.shift(),y+=f.shift(),p.lineTo(g,y);i=g+f.shift(),o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),g=l+f.shift(),y=u+f.shift(),p.curveTo(i,o,l,u,g,y);break;case 26:for(f.length%2&&(g+=f.shift());f.length>0;)i=g,o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),g=l,y=u+f.shift(),p.curveTo(i,o,l,u,g,y);break;case 27:for(f.length%2&&(y+=f.shift());f.length>0;)i=g+f.shift(),o=y,l=i+f.shift(),u=o+f.shift(),g=l+f.shift(),y=u,p.curveTo(i,o,l,u,g,y);break;case 28:v=a[I],b=a[I+1],f.push((v<<24|b<<16)>>16),I+=2;break;case 29:x=f.pop()+e.gsubrsBias,O=e.gsubrs[x],O&&s(O);break;case 30:for(;f.length>0&&(i=g,o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),g=l+f.shift(),y=u+(1===f.length?f.shift():0),p.curveTo(i,o,l,u,g,y),0!==f.length);)i=g+f.shift(),o=y,l=i+f.shift(),u=o+f.shift(),y=u+f.shift(),g=l+(1===f.length?f.shift():0),p.curveTo(i,o,l,u,g,y);break;case 31:for(;f.length>0&&(i=g+f.shift(),o=y,l=i+f.shift(),u=o+f.shift(),y=u+f.shift(),g=l+(1===f.length?f.shift():0),p.curveTo(i,o,l,u,g,y),0!==f.length);)i=g,o=y+f.shift(),l=i+f.shift(),u=o+f.shift(),g=l+f.shift(),y=u+(1===f.length?f.shift():0),p.curveTo(i,o,l,u,g,y);break;default:F<32?console.log("Glyph "+t.index+": unknown operator "+F):F<247?f.push(F-139):F<251?(v=a[I],I+=1,f.push(256*(F-247)+v+108)):F<255?(v=a[I],I+=1,f.push(256*-(F-251)-v-108)):(v=a[I],b=a[I+1],S=a[I+2],T=a[I+3],I+=4,f.push((v<<24|b<<16|S<<8|T)/65536))}}}var i,o,l,u,p=new Path,f=[],c=0,h=!1,d=e.defaultWidthX,m=!1,g=0,y=0;return s(a),t.advanceWidth=d,p}function calcCFFSubroutineBias(e){var t;return t=e.length<1240?107:e.length<33900?1131:32768}function parseCFFTable(e,t,a){a.tables.cff={};var r=parseCFFHeader(e,t),n=parseCFFIndex(e,r.endOffset,bytesToString),s=parseCFFIndex(e,n.endOffset),i=parseCFFIndex(e,s.endOffset,bytesToString),o=parseCFFIndex(e,i.endOffset);a.gsubrs=o.objects,a.gsubrsBias=calcCFFSubroutineBias(a.gsubrs);var l=new DataView(new Uint8Array(s.objects[0]).buffer),u=parseCFFTopDict(l,i.objects);a.tables.cff.topDict=u;var p=t+u["private"][1],f=parseCFFPrivateDict(e,p,u["private"][0],i.objects);if(a.defaultWidthX=f.defaultWidthX,a.nominalWidthX=f.nominalWidthX,0!==f.subrs){var c=p+f.subrs,h=parseCFFIndex(e,c);a.subrs=h.objects,a.subrsBias=calcCFFSubroutineBias(a.subrs)}else a.subrs=[],a.subrsBias=0;var d=parseCFFIndex(e,t+u.charStrings);a.nGlyphs=d.objects.length;var m=parseCFFCharset(e,t+u.charset,a.nGlyphs,i.objects);0===u.encoding?a.cffEncoding=new CffEncoding(cffStandardEncoding,m):1===u.encoding?a.cffEncoding=new CffEncoding(cffExpertEncoding,m):a.cffEncoding=parseCFFEncoding(e,t+u.encoding,m),a.encoding=a.encoding||a.cffEncoding,a.glyphs=new GlyphSet(a);for(var g=0;g<a.nGlyphs;g+=1){var y=d.objects[g];a.glyphs.push(g,cffGlyphLoader(a,g,parseCFFCharstring,y))}}function encodeString(e,t){var a,r=cffStandardStrings.indexOf(e);return r>=0&&(a=r),r=t.indexOf(e),r>=0?a=r+cffStandardStrings.length:(a=cffStandardStrings.length+t.length,t.push(e)),a}function makeHeader(){return new table.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(e){var t=new table.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var a=0;a<e.length;a+=1)t.names.push({name:"name_"+a,type:"NAME",value:e[a]});return t}function makeDict(e,t,a){for(var r={},n=0;n<e.length;n+=1){var s=e[n],i=t[s.name];void 0===i||equals(i,s.value)||("SID"===s.type&&(i=encodeString(i,a)),r[s.op]={name:s.name,type:s.type,value:i})}return r}function makeTopDict(e,t){var a=new table.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=makeDict(TOP_DICT_META,e,t),a}function makeTopDictIndex(e){var t=new table.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function makeStringIndex(e){var t=new table.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var a=0;a<e.length;a+=1)t.strings.push({name:"string_"+a,type:"STRING",value:e[a]});return t}function makeGlobalSubrIndex(){return new table.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(e,t){for(var a=new table.Record("Charsets",[{name:"format",type:"Card8",value:0}]),r=0;r<e.length;r+=1){var n=e[r],s=encodeString(n,t);a.fields.push({name:"glyph_"+r,type:"SID",value:s})}return a}function glyphToOps(e){var t=[],a=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var r=0,n=0,s=0;s<a.commands.length;s+=1){var i,o,l=a.commands[s];if("Q"===l.type){var u=1/3,p=2/3;l={type:"C",x:l.x,y:l.y,x1:u*r+p*l.x1,y1:u*n+p*l.y1,x2:u*l.x+p*l.x1,y2:u*l.y+p*l.y1}}if("M"===l.type)i=Math.round(l.x-r),o=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:i}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rmoveto",type:"OP",value:21}),r=Math.round(l.x),n=Math.round(l.y);else if("L"===l.type)i=Math.round(l.x-r),o=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:i}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rlineto",type:"OP",value:5}),r=Math.round(l.x),n=Math.round(l.y);else if("C"===l.type){var f=Math.round(l.x1-r),c=Math.round(l.y1-n),h=Math.round(l.x2-l.x1),d=Math.round(l.y2-l.y1);i=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),t.push({name:"dx1",type:"NUMBER",value:f}),t.push({name:"dy1",type:"NUMBER",value:c}),t.push({name:"dx2",type:"NUMBER",value:h}),t.push({name:"dy2",type:"NUMBER",value:d}),t.push({name:"dx",type:"NUMBER",value:i}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rrcurveto",type:"OP",value:8}),r=Math.round(l.x),n=Math.round(l.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}function makeCharStringsIndex(e){for(var t=new table.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),a=0;a<e.length;a+=1){var r=e.get(a),n=glyphToOps(r);t.charStrings.push({name:r.name,type:"CHARSTRING",value:n})}return t}function makePrivateDict(e,t){var a=new table.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return a.dict=makeDict(PRIVATE_DICT_META,e,t),a}function makeCFFTable(e,t){for(var a,r=new table.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),n=1/t.unitsPerEm,s={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[n,0,0,n,0,0],charset:999,encoding:0,charStrings:999,"private":[0,999]},i={},o=[],l=1;l<e.length;l+=1)a=e.get(l),o.push(a.name);var u=[];r.header=makeHeader(),r.nameIndex=makeNameIndex([t.postScriptName]);var p=makeTopDict(s,u);r.topDictIndex=makeTopDictIndex(p),r.globalSubrIndex=makeGlobalSubrIndex(),r.charsets=makeCharsets(o,u),r.charStringsIndex=makeCharStringsIndex(e),r.privateDict=makePrivateDict(i,u),r.stringIndex=makeStringIndex(u);var f=r.header.sizeOf()+r.nameIndex.sizeOf()+r.topDictIndex.sizeOf()+r.stringIndex.sizeOf()+r.globalSubrIndex.sizeOf();return s.charset=f,s.encoding=0,s.charStrings=s.charset+r.charsets.sizeOf(),s["private"][1]=s.charStrings+r.charStringsIndex.sizeOf(),p=makeTopDict(s,u),r.topDictIndex=makeTopDictIndex(p),r}function parseCmapTable(e,t){var a,r={};r.version=getUShort(e,t),assert(0===r.version,"cmap table version should be 0."),r.numTables=getUShort(e,t+2);var n=-1;for(a=0;a<r.numTables;a+=1){var s=getUShort(e,t+4+8*a),i=getUShort(e,t+4+8*a+2);if(3===s&&(1===i||0===i)){n=getULong(e,t+4+8*a+4);break}}if(n===-1)return null;var o=new Parser(e,t+n);r.format=o.parseUShort(),assert(4===r.format,"Only format 4 cmap tables are supported."),r.length=o.parseUShort(),r.language=o.parseUShort();var l;r.segCount=l=o.parseUShort()>>1,o.skip("uShort",3),r.glyphIndexMap={};var u=new Parser(e,t+n+14),p=new Parser(e,t+n+16+2*l),f=new Parser(e,t+n+16+4*l),c=new Parser(e,t+n+16+6*l),h=t+n+16+8*l;for(a=0;a<l-1;a+=1)for(var d,m=u.parseUShort(),g=p.parseUShort(),y=f.parseShort(),v=c.parseUShort(),b=g;b<=m;b+=1)0!==v?(h=c.offset+c.relativeOffset-2,h+=v,h+=2*(b-g),d=getUShort(e,h),0!==d&&(d=d+y&65535)):d=b+y&65535,r.glyphIndexMap[b]=d;return r}function addSegment(e,t,a){e.segments.push({end:t,start:t,delta:-(t-a),offset:0})}function addTerminatorSegment(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(e){var t,a=new table.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);for(a.segments=[],t=0;t<e.length;t+=1){for(var r=e.get(t),n=0;n<r.unicodes.length;n+=1)addSegment(a,r.unicodes[n],t);a.segments=a.segments.sort(function(e,t){return e.start-t.start})}addTerminatorSegment(a);var s;s=a.segments.length,a.segCountX2=2*s,a.searchRange=2*Math.pow(2,Math.floor(Math.log(s)/Math.log(2))),a.entrySelector=Math.log(a.searchRange/2)/Math.log(2),a.rangeShift=a.segCountX2-a.searchRange;var i=[],o=[],l=[],u=[],p=[];for(t=0;t<s;t+=1){var f=a.segments[t];i=i.concat({name:"end_"+t,type:"USHORT",value:f.end}),o=o.concat({name:"start_"+t,type:"USHORT",value:f.start}),l=l.concat({name:"idDelta_"+t,type:"SHORT",value:f.delta}),u=u.concat({name:"idRangeOffset_"+t,type:"USHORT",value:f.offset}),void 0!==f.glyphId&&(p=p.concat({name:"glyph_"+t,type:"USHORT",value:f.glyphId}))}return a.fields=a.fields.concat(i),a.fields.push({name:"reservedPad",type:"USHORT",value:0}),a.fields=a.fields.concat(o),a.fields=a.fields.concat(l),a.fields=a.fields.concat(u),a.fields=a.fields.concat(p),a.length=14+2*i.length+2+2*o.length+2*l.length+2*u.length+2*p.length,a}function addName(e,t){var a=JSON.stringify(e),r=256;for(var n in t){var s=parseInt(n);if(s&&!(s<256)){if(JSON.stringify(t[n])===a)return s;r<=s&&(r=s+1)}}return t[r]=e,r}function makeFvarAxis(e,t,a){var r=addName(t.name,a);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:r}]}function parseFvarAxis(e,t,a){var r={},n=new Parser(e,t);return r.tag=n.parseTag(),r.minValue=n.parseFixed(),r.defaultValue=n.parseFixed(),r.maxValue=n.parseFixed(),n.skip("uShort",1),r.name=a[n.parseUShort()]||{},r}function makeFvarInstance(e,t,a,r){for(var n=addName(t.name,r),s=[{name:"nameID_"+e,type:"USHORT",value:n},{name:"flags_"+e,type:"USHORT",value:0}],i=0;i<a.length;++i){var o=a[i].tag;s.push({name:"axis_"+e+" "+o,type:"FIXED",value:t.coordinates[o]<<16})}return s}function parseFvarInstance(e,t,a,r){var n={},s=new Parser(e,t);n.name=r[s.parseUShort()]||{},s.skip("uShort",1),n.coordinates={};for(var i=0;i<a.length;++i)n.coordinates[a[i].tag]=s.parseFixed();return n}function makeFvarTable(e,t){var a=new table.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);a.offsetToData=a.sizeOf();for(var r=0;r<e.axes.length;r++)a.fields=a.fields.concat(makeFvarAxis(r,e.axes[r],t));for(var n=0;n<e.instances.length;n++)a.fields=a.fields.concat(makeFvarInstance(n,e.instances[n],e.axes,t));return a}function parseFvarTable(e,t,a){var r=new Parser(e,t),n=r.parseULong();assert(65536===n,"Unsupported fvar table version.");var s=r.parseOffset16();r.skip("uShort",1);for(var i=r.parseUShort(),o=r.parseUShort(),l=r.parseUShort(),u=r.parseUShort(),p=[],f=0;f<i;f++)p.push(parseFvarAxis(e,t+s+f*o,a));for(var c=[],h=t+s+i*o,d=0;d<l;d++)c.push(parseFvarInstance(e,h+d*u,p,a));return{axes:p,instances:c}}function parseGlyphCoordinate(e,t,a,r,n){var s;return(t&r)>0?(s=e.parseByte(),0===(t&n)&&(s=-s),s=a+s):s=(t&n)>0?a:a+e.parseShort(),s}function parseGlyph(e,t,a){var r=new Parser(t,a);e.numberOfContours=r.parseShort(),e.xMin=r.parseShort(),e.yMin=r.parseShort(),e.xMax=r.parseShort(),e.yMax=r.parseShort();var n,s;if(e.numberOfContours>0){var i,o=e.endPointIndices=[];for(i=0;i<e.numberOfContours;i+=1)o.push(r.parseUShort());for(e.instructionLength=r.parseUShort(),e.instructions=[],i=0;i<e.instructionLength;i+=1)e.instructions.push(r.parseByte());var l=o[o.length-1]+1;for(n=[],i=0;i<l;i+=1)if(s=r.parseByte(),n.push(s),(8&s)>0)for(var u=r.parseByte(),p=0;p<u;p+=1)n.push(s),i+=1;if(assert(n.length===l,"Bad flags."),o.length>0){var f,c=[];if(l>0){for(i=0;i<l;i+=1)s=n[i],f={},f.onCurve=!!(1&s),f.lastPointOfContour=o.indexOf(i)>=0,c.push(f);var h=0;for(i=0;i<l;i+=1)s=n[i],f=c[i],f.x=parseGlyphCoordinate(r,s,h,2,16),h=f.x;var d=0;for(i=0;i<l;i+=1)s=n[i],f=c[i],f.y=parseGlyphCoordinate(r,s,d,4,32),d=f.y}e.points=c}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var m=!0;m;){n=r.parseUShort();var g={glyphIndex:r.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&n)>0?(g.dx=r.parseShort(),g.dy=r.parseShort()):(g.dx=r.parseChar(),g.dy=r.parseChar()),(8&n)>0?g.xScale=g.yScale=r.parseF2Dot14():(64&n)>0?(g.xScale=r.parseF2Dot14(),g.yScale=r.parseF2Dot14()):(128&n)>0&&(g.xScale=r.parseF2Dot14(),g.scale01=r.parseF2Dot14(),g.scale10=r.parseF2Dot14(),g.yScale=r.parseF2Dot14()),e.components.push(g),m=!!(32&n)}}}function transformPoints(e,t){for(var a=[],r=0;r<e.length;r+=1){var n=e[r],s={x:t.xScale*n.x+t.scale01*n.y+t.dx,y:t.scale10*n.x+t.yScale*n.y+t.dy,onCurve:n.onCurve,lastPointOfContour:n.lastPointOfContour};a.push(s)}return a}function getContours(e){for(var t=[],a=[],r=0;r<e.length;r+=1){var n=e[r];a.push(n),n.lastPointOfContour&&(t.push(a),a=[])}return assert(0===a.length,"There are still points left in the current contour."),t}function getPath(e){var t=new Path;if(!e)return t;for(var a=getContours(e),r=0;r<a.length;r+=1){var n,s,i=a[r],o=i[0],l=i[i.length-1];o.onCurve?(n=null,s=!0):(o=l.onCurve?l:{x:(o.x+l.x)/2,y:(o.y+l.y)/2},n=o,s=!1),t.moveTo(o.x,o.y);for(var u=s?1:0;u<i.length;u+=1){var p=i[u],f=0===u?o:i[u-1];if(f.onCurve&&p.onCurve)t.lineTo(p.x,p.y);else if(f.onCurve&&!p.onCurve)n=p;else if(f.onCurve||p.onCurve){if(f.onCurve||!p.onCurve)throw new Error("Invalid state.");t.quadraticCurveTo(n.x,n.y,p.x,p.y),n=null}else{var c={x:(f.x+p.x)/2,y:(f.y+p.y)/2};t.quadraticCurveTo(f.x,f.y,c.x,c.y),n=p}}o!==l&&(n?t.quadraticCurveTo(n.x,n.y,o.x,o.y):t.lineTo(o.x,o.y))}return t.closePath(),t}function buildPath(e,t){if(t.isComposite)for(var a=0;a<t.components.length;a+=1){var r=t.components[a],n=e.get(r.glyphIndex);if(n.getPath(),n.points){var s=transformPoints(n.points,r);t.points=t.points.concat(s)}}return getPath(t.points)}function parseGlyfTable(e,t,a,r){var n,s=new GlyphSet(r);for(n=0;n<a.length-1;n+=1){var i=a[n],o=a[n+1];i!==o?s.push(n,ttfGlyphLoader(r,n,parseGlyph,e,t+i,buildPath)):s.push(n,glyphLoader(r,n))}return s}function parseTaggedListTable(e,t){for(var a=new Parser(e,t),r=a.parseUShort(),n=[],s=0;s<r;s++)n[a.parseTag()]={offset:a.parseUShort()};return n}function parseCoverageTable(e,t){var a=new Parser(e,t),r=a.parseUShort(),n=a.parseUShort();if(1===r)return a.parseUShortList(n);if(2===r){for(var s=[];n--;)for(var i=a.parseUShort(),o=a.parseUShort(),l=a.parseUShort(),u=i;u<=o;u++)s[l++]=u;
return s}}function parseClassDefTable(e,t){var a=new Parser(e,t),r=a.parseUShort();if(1===r){var n=a.parseUShort(),s=a.parseUShort(),i=a.parseUShortList(s);return function(e){return i[e-n]||0}}if(2===r){for(var o=a.parseUShort(),l=[],u=[],p=[],f=0;f<o;f++)l[f]=a.parseUShort(),u[f]=a.parseUShort(),p[f]=a.parseUShort();return function(e){for(var t=0,a=l.length-1;t<a;){var r=t+a+1>>1;e<l[r]?a=r-1:t=r}return l[t]<=e&&e<=u[t]?p[t]||0:0}}}function parsePairPosSubTable(e,t){var a,r,n=new Parser(e,t),s=n.parseUShort(),i=n.parseUShort(),o=parseCoverageTable(e,t+i),l=n.parseUShort(),u=n.parseUShort();if(4===l&&0===u){var p={};if(1===s){for(var f=n.parseUShort(),c=[],h=n.parseOffset16List(f),d=0;d<f;d++){var m=h[d],g=p[m];if(!g){g={},n.relativeOffset=m;for(var y=n.parseUShort();y--;){var v=n.parseUShort();l&&(a=n.parseShort()),u&&(r=n.parseShort()),g[v]=a}}c[o[d]]=g}return function(e,t){var a=c[e];if(a)return a[t]}}if(2===s){for(var b=n.parseUShort(),S=n.parseUShort(),T=n.parseUShort(),x=n.parseUShort(),O=parseClassDefTable(e,t+b),U=parseClassDefTable(e,t+S),C=[],R=0;R<T;R++)for(var E=C[R]=[],w=0;w<x;w++)l&&(a=n.parseShort()),u&&(r=n.parseShort()),E[w]=a;var k={};for(R=0;R<o.length;R++)k[o[R]]=1;return function(e,t){if(k[e]){var a=O(e),r=U(t),n=C[a];return n?n[r]:void 0}}}}}function parseLookupTable(e,t){var a=new Parser(e,t),r=a.parseUShort(),n=a.parseUShort(),s=16&n,i=a.parseUShort(),o=a.parseOffset16List(i),l={lookupType:r,lookupFlag:n,markFilteringSet:s?a.parseUShort():-1};if(2===r){for(var u=[],p=0;p<i;p++)u.push(parsePairPosSubTable(e,t+o[p]));l.getKerningValue=function(e,t){for(var a=u.length;a--;){var r=u[a](e,t);if(void 0!==r)return r}return 0}}return l}function parseGposTable(e,t,a){var r=new Parser(e,t),n=r.parseFixed();assert(1===n,"Unsupported GPOS table version."),parseTaggedListTable(e,t+r.parseUShort()),parseTaggedListTable(e,t+r.parseUShort());var s=r.parseUShort();r.relativeOffset=s;for(var i=r.parseUShort(),o=r.parseOffset16List(i),l=t+s,u=0;u<i;u++){var p=parseLookupTable(e,l+o[u]);2!==p.lookupType||a.getGposKerningValue||(a.getGposKerningValue=p.getKerningValue)}}function parseHeadTable(e,t){var a={},r=new Parser(e,t);return a.version=r.parseVersion(),a.fontRevision=Math.round(1e3*r.parseFixed())/1e3,a.checkSumAdjustment=r.parseULong(),a.magicNumber=r.parseULong(),assert(1594834165===a.magicNumber,"Font header has wrong magic number."),a.flags=r.parseUShort(),a.unitsPerEm=r.parseUShort(),a.created=r.parseLongDateTime(),a.modified=r.parseLongDateTime(),a.xMin=r.parseShort(),a.yMin=r.parseShort(),a.xMax=r.parseShort(),a.yMax=r.parseShort(),a.macStyle=r.parseUShort(),a.lowestRecPPEM=r.parseUShort(),a.fontDirectionHint=r.parseShort(),a.indexToLocFormat=r.parseShort(),a.glyphDataFormat=r.parseShort(),a}function makeHeadTable(e){return new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:0},{name:"modified",type:"LONGDATETIME",value:0},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}function parseHheaTable(e,t){var a={},r=new Parser(e,t);return a.version=r.parseVersion(),a.ascender=r.parseShort(),a.descender=r.parseShort(),a.lineGap=r.parseShort(),a.advanceWidthMax=r.parseUShort(),a.minLeftSideBearing=r.parseShort(),a.minRightSideBearing=r.parseShort(),a.xMaxExtent=r.parseShort(),a.caretSlopeRise=r.parseShort(),a.caretSlopeRun=r.parseShort(),a.caretOffset=r.parseShort(),r.relativeOffset+=8,a.metricDataFormat=r.parseShort(),a.numberOfHMetrics=r.parseUShort(),a}function makeHheaTable(e){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}function parseHmtxTable(e,t,a,r,n){for(var s,i,o=new Parser(e,t),l=0;l<r;l+=1){l<a&&(s=o.parseUShort(),i=o.parseShort());var u=n.get(l);u.advanceWidth=s,u.leftSideBearing=i}}function makeHmtxTable(e){for(var t=new table.Table("hmtx",[]),a=0;a<e.length;a+=1){var r=e.get(a),n=r.advanceWidth||0,s=r.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+a,type:"USHORT",value:n}),t.fields.push({name:"leftSideBearing_"+a,type:"SHORT",value:s})}return t}function parseKernTable(e,t){var a={},r=new Parser(e,t),n=r.parseUShort();assert(0===n,"Unsupported kern table version."),r.skip("uShort",1);var s=r.parseUShort();assert(0===s,"Unsupported kern sub-table version."),r.skip("uShort",2);var i=r.parseUShort();r.skip("uShort",3);for(var o=0;o<i;o+=1){var l=r.parseUShort(),u=r.parseUShort(),p=r.parseShort();a[l+","+u]=p}return a}function parseLocaTable(e,t,a,r){for(var n=new Parser(e,t),s=r?n.parseUShort:n.parseULong,i=[],o=0;o<a+1;o+=1){var l=s.call(n);r&&(l*=2),i.push(l)}return i}function makeLtagTable(e){for(var t=new table.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),a="",r=12+4*e.length,n=0;n<e.length;++n){var s=a.indexOf(e[n]);s<0&&(s=a.length,a+=e[n]),t.fields.push({name:"offset "+n,type:"USHORT",value:r+s}),t.fields.push({name:"length "+n,type:"USHORT",value:e[n].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:a}),t}function parseLtagTable(e,t){var a=new Parser(e,t),r=a.parseULong();assert(1===r,"Unsupported ltag table version."),a.skip("uLong",1);for(var n=a.parseULong(),s=[],i=0;i<n;i++){for(var o="",l=t+a.parseUShort(),u=a.parseUShort(),p=l;p<l+u;++p)o+=String.fromCharCode(e.getInt8(p));s.push(o)}return s}function parseMaxpTable(e,t){var a={},r=new Parser(e,t);return a.version=r.parseVersion(),a.numGlyphs=r.parseUShort(),1===a.version&&(a.maxPoints=r.parseUShort(),a.maxContours=r.parseUShort(),a.maxCompositePoints=r.parseUShort(),a.maxCompositeContours=r.parseUShort(),a.maxZones=r.parseUShort(),a.maxTwilightPoints=r.parseUShort(),a.maxStorage=r.parseUShort(),a.maxFunctionDefs=r.parseUShort(),a.maxInstructionDefs=r.parseUShort(),a.maxStackElements=r.parseUShort(),a.maxSizeOfInstructions=r.parseUShort(),a.maxComponentElements=r.parseUShort(),a.maxComponentDepth=r.parseUShort()),a}function makeMaxpTable(e){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}function getLanguageCode(e,t,a){switch(e){case 0:if(65535===t)return"und";if(a)return a[t];break;case 1:return macLanguages[t];case 3:return windowsLanguages[t]}}function getEncoding(e,t,a){switch(e){case 0:return utf16;case 1:return macLanguageEncodings[a]||macScriptEncodings[t];case 3:if(1===t||10===t)return utf16}}function parseNameTable(e,t,a){for(var r={},n=new Parser(e,t),s=n.parseUShort(),i=n.parseUShort(),o=n.offset+n.parseUShort(),l=0;l<i;l++){var u=n.parseUShort(),p=n.parseUShort(),f=n.parseUShort(),c=n.parseUShort(),h=nameTableNames[c]||c,d=n.parseUShort(),m=n.parseUShort(),g=getLanguageCode(u,f,a),y=getEncoding(u,p,f);if(void 0!==y&&void 0!==g){var v;if(v=y===utf16?opentype_decode.UTF16(e,o+m,d):opentype_decode.MACSTRING(e,o+m,d,y)){var b=r[h];void 0===b&&(b=r[h]={}),b[g]=v}}}var S=0;return 1===s&&(S=n.parseUShort()),r}function reverseDict(e){var t={};for(var a in e)t[e[a]]=parseInt(a);return t}function makeNameRecord(e,t,a,r,n,s){return new table.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:a},{name:"nameID",type:"USHORT",value:r},{name:"length",type:"USHORT",value:n},{name:"offset",type:"USHORT",value:s}])}function findSubArray(e,t){var a=e.length,r=t.length-a+1;e:for(var n=0;n<r;n++)for(;n<r;n++){for(var s=0;s<a;s++)if(t[n+s]!==e[s])continue e;return n}return-1}function addStringToPool(e,t){var a=findSubArray(e,t);if(a<0){a=t.length;for(var r=0,n=e.length;r<n;++r)t.push(e[r])}return a}function makeNameTable(e,t){var a,r=[],n={},s=reverseDict(nameTableNames);for(var i in e){var o=s[i];void 0===o&&(o=i),a=parseInt(o),n[a]=e[i],r.push(a)}for(var l=reverseDict(macLanguages),u=reverseDict(windowsLanguages),p=[],f=[],c=0;c<r.length;c++){a=r[c];var h=n[a];for(var d in h){var m=h[d],g=1,y=l[d],v=macLanguageToScript[y],b=getEncoding(g,v,y),S=encode.MACSTRING(m,b);void 0===S&&(g=0,y=t.indexOf(d),y<0&&(y=t.length,t.push(d)),v=4,S=encode.UTF16(m));var T=addStringToPool(S,f);p.push(makeNameRecord(g,v,y,a,S.length,T));var x=u[d];if(void 0!==x){var O=encode.UTF16(m),U=addStringToPool(O,f);p.push(makeNameRecord(3,1,x,a,O.length,U))}}}p.sort(function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID});for(var C=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:p.length},{name:"stringOffset",type:"USHORT",value:6+12*p.length}]),R=0;R<p.length;R++)C.fields.push({name:"record_"+R,type:"RECORD",value:p[R]});return C.fields.push({name:"strings",type:"LITERAL",value:f}),C}function getUnicodeRange(e){for(var t=0;t<unicodeRanges.length;t+=1){var a=unicodeRanges[t];if(e>=a.begin&&e<a.end)return t}return-1}function parseOS2Table(e,t){var a=new Parser(e,t);os2.version=a.parseUShort(),os2.xAvgCharWidth=a.parseShort(),os2.usWeightClass=a.parseUShort(),os2.usWidthClass=a.parseUShort(),os2.fsType=a.parseUShort(),os2.ySubscriptXSize=a.parseShort(),os2.ySubscriptYSize=a.parseShort(),os2.ySubscriptXOffset=a.parseShort(),os2.ySubscriptYOffset=a.parseShort(),os2.ySuperscriptXSize=a.parseShort(),os2.ySuperscriptYSize=a.parseShort(),os2.ySuperscriptXOffset=a.parseShort(),os2.ySuperscriptYOffset=a.parseShort(),os2.yStrikeoutSize=a.parseShort(),os2.yStrikeoutPosition=a.parseShort(),os2.sFamilyClass=a.parseShort(),os2.panose=[];for(var r=0;r<10;r++)os2.panose[r]=a.parseByte();return os2.ulUnicodeRange1=a.parseULong(),os2.ulUnicodeRange2=a.parseULong(),os2.ulUnicodeRange3=a.parseULong(),os2.ulUnicodeRange4=a.parseULong(),os2.achVendID=String.fromCharCode(a.parseByte(),a.parseByte(),a.parseByte(),a.parseByte()),os2.fsSelection=a.parseUShort(),os2.usFirstCharIndex=a.parseUShort(),os2.usLastCharIndex=a.parseUShort(),os2.sTypoAscender=a.parseShort(),os2.sTypoDescender=a.parseShort(),os2.sTypoLineGap=a.parseShort(),os2.usWinAscent=a.parseUShort(),os2.usWinDescent=a.parseUShort(),os2.version>=1&&(os2.ulCodePageRange1=a.parseULong(),os2.ulCodePageRange2=a.parseULong()),os2.version>=2&&(os2.sxHeight=a.parseShort(),os2.sCapHeight=a.parseShort(),os2.usDefaultChar=a.parseUShort(),os2.usBreakChar=a.parseUShort(),os2.usMaxContent=a.parseUShort()),os2}function makeOS2Table(e){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}function parsePostTable(e,t){var a,r={},n=new Parser(e,t);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=standardNames.slice();break;case 2:for(r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs),a=0;a<r.numberOfGlyphs;a++)r.glyphNameIndex[a]=n.parseUShort();for(r.names=[],a=0;a<r.numberOfGlyphs;a++)if(r.glyphNameIndex[a]>=standardNames.length){var s=n.parseChar();r.names.push(n.parseString(s))}break;case 2.5:for(r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs),a=0;a<r.numberOfGlyphs;a++)r.offset[a]=n.parseChar()}return r}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}function log2(e){return Math.log(e)/Math.log(2)|0}function computeCheckSum(e){for(;e.length%4!==0;)e.push(0);for(var t=0,a=0;a<e.length;a+=4)t+=(e[a]<<24)+(e[a+1]<<16)+(e[a+2]<<8)+e[a+3];return t%=Math.pow(2,32)}function makeTableRecord(e,t,a,r){return new table.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==a?a:0},{name:"length",type:"ULONG",value:void 0!==r?r:0}])}function makeSfntTable(e){var t=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var a=Math.pow(2,log2(t.numTables));t.searchRange=16*a,t.entrySelector=log2(a),t.rangeShift=16*t.numTables-t.searchRange;for(var r=[],n=[],s=t.sizeOf()+makeTableRecord().sizeOf()*t.numTables;s%4!==0;)s+=1,n.push({name:"padding",type:"BYTE",value:0});for(var i=0;i<e.length;i+=1){var o=e[i];assert(4===o.tableName.length,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),u=makeTableRecord(o.tableName,computeCheckSum(o.encode()),s,l);for(r.push({name:u.tag+" Table Record",type:"RECORD",value:u}),n.push({name:o.tableName+" table",type:"RECORD",value:o}),s+=l,assert(!isNaN(s),"Something went wrong calculating the offset.");s%4!==0;)s+=1,n.push({name:"padding",type:"BYTE",value:0})}return r.sort(function(e,t){return e.value.tag>t.value.tag?1:-1}),t.fields=t.fields.concat(r),t.fields=t.fields.concat(n),t}function metricsForChar(e,t,a){for(var r=0;r<t.length;r+=1){var n=e.charToGlyphIndex(t[r]);if(n>0){var s=e.glyphs.get(n);return s.getMetrics()}}return a}function average(e){for(var t=0,a=0;a<e.length;a+=1)t+=e[a];return t/e.length}function fontToSfntTable(e){for(var t,a=[],r=[],n=[],s=[],i=[],o=[],l=[],u=0,p=0,f=0,c=0,h=0,d=0;d<e.glyphs.length;d+=1){var m=e.glyphs.get(d),g=0|m.unicode;if("undefined"==typeof m.advanceWidth)throw new Error("Glyph "+m.name+" ("+d+"): advanceWidth is required.");(t>g||null===t)&&(t=g),u<g&&(u=g);var y=os2.getUnicodeRange(g);if(y<32)p|=1<<y;else if(y<64)f|=1<<y-32;else if(y<96)c|=1<<y-64;else{if(!(y<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");h|=1<<y-96}if(".notdef"!==m.name){var v=m.getMetrics();a.push(v.xMin),r.push(v.yMin),n.push(v.xMax),s.push(v.yMax),o.push(v.leftSideBearing),l.push(v.rightSideBearing),i.push(m.advanceWidth)}}var b={xMin:Math.min.apply(null,a),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,n),yMax:Math.max.apply(null,s),advanceWidthMax:Math.max.apply(null,i),advanceWidthAvg:average(i),minLeftSideBearing:Math.min.apply(null,o),maxLeftSideBearing:Math.max.apply(null,o),minRightSideBearing:Math.min.apply(null,l)};b.ascender=e.ascender,b.descender=e.descender;var S=head.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:b.xMin,yMin:b.yMin,xMax:b.xMax,yMax:b.yMax,lowestRecPPEM:3}),T=hhea.make({ascender:b.ascender,descender:b.descender,advanceWidthMax:b.advanceWidthMax,minLeftSideBearing:b.minLeftSideBearing,minRightSideBearing:b.minRightSideBearing,xMaxExtent:b.maxLeftSideBearing+(b.xMax-b.xMin),numberOfHMetrics:e.glyphs.length}),x=maxp.make(e.glyphs.length),O=os2.make({xAvgCharWidth:Math.round(b.advanceWidthAvg),usWeightClass:500,usWidthClass:5,usFirstCharIndex:t,usLastCharIndex:u,ulUnicodeRange1:p,ulUnicodeRange2:f,ulUnicodeRange3:c,ulUnicodeRange4:h,fsSelection:64,sTypoAscender:b.ascender,sTypoDescender:b.descender,sTypoLineGap:0,usWinAscent:b.yMax,usWinDescent:Math.abs(b.yMin),ulCodePageRange1:1,sxHeight:metricsForChar(e,"xyvw",{yMax:Math.round(b.ascender/2)}).yMax,sCapHeight:metricsForChar(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",b).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0}),U=hmtx.make(e.glyphs),C=cmap.make(e.glyphs),R=e.getEnglishName("fontFamily"),E=e.getEnglishName("fontSubfamily"),w=R+" "+E,k=e.getEnglishName("postScriptName");k||(k=R.replace(/\s/g,"")+"-"+E);var I={};for(var F in e.names)I[F]=e.names[F];I.uniqueID||(I.uniqueID={en:e.getEnglishName("manufacturer")+":"+w}),I.postScriptName||(I.postScriptName={en:k}),I.preferredFamily||(I.preferredFamily=e.names.fontFamily),I.preferredSubfamily||(I.preferredSubfamily=e.names.fontSubfamily);var M=[],N=makeNameTable(I,M),A=M.length>0?ltag.make(M):void 0,D=post.make(),P=cff.make(e.glyphs,{version:e.getEnglishName("version"),fullName:w,familyName:R,weightName:E,postScriptName:k,unitsPerEm:e.unitsPerEm,fontBBox:[0,b.yMin,b.ascender,b.advanceWidthMax]}),L=[S,T,x,O,N,C,D,P,U];A&&L.push(A);var B=makeSfntTable(L),H=B.encode(),G=computeCheckSum(H),_=B.fields,z=!1;for(d=0;d<_.length;d+=1)if("head table"===_[d].name){_[d].value.checkSumAdjustment=2981146554-G,z=!0;break}if(!z)throw new Error("Could not find head table with checkSum to adjust.");return B}function constant(e){return function(){return e}}var TINF_OK=0,TINF_DATA_ERROR=-3,sltree=new Tree,sdtree=new Tree,length_bits=new Uint8Array(30),length_base=new Uint16Array(30),dist_bits=new Uint8Array(30),dist_base=new Uint16Array(30),clcidx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),code_tree=new Tree,lengths=new Uint8Array(320);assert=function(e,t){if(!e)throw new Error(t)};var offs=new Uint16Array(16);tinf_build_fixed_trees(sltree,sdtree),tinf_build_bits_base(length_bits,length_base,4,3),tinf_build_bits_base(dist_bits,dist_base,2,1),length_bits[28]=0,length_base[28]=258;var cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];DefaultEncoding.prototype.charToGlyphIndex=function(e){var t=e.charCodeAt(0),a=this.font.glyphs;if(!a)return null;for(var r=0;r<a.length;r+=1)for(var n=a.get(r),s=0;s<n.unicodes.length;s+=1)if(n.unicodes[s]===t)return r},CmapEncoding.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.charCodeAt(0)]||0},CffEncoding.prototype.charToGlyphIndex=function(e){var t=e.charCodeAt(0),a=this.encoding[t];return this.charset.indexOf(a)},GlyphNames.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},GlyphNames.prototype.glyphIndexToName=function(e){return this.names[e]},opentype_cffStandardStrings=cffStandardStrings,opentype_cffStandardEncoding=cffStandardEncoding,opentype_cffExpertEncoding=cffExpertEncoding,opentype_standardNames=standardNames,opentype_DefaultEncoding=DefaultEncoding,opentype_CmapEncoding=CmapEncoding,opentype_CffEncoding=CffEncoding,opentype_GlyphNames=GlyphNames,opentype_addGlyphNames=addGlyphNames,Font.prototype.hasChar=function(e){
return null!==this.encoding.charToGlyphIndex(e)},Font.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},Font.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),a=this.glyphs.get(t);return a||(a=this.glyphs.get(0)),a},Font.prototype.stringToGlyphs=function(e){for(var t=[],a=0;a<e.length;a+=1){var r=e[a];t.push(this.charToGlyph(r))}return t},Font.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},Font.prototype.nameToGlyph=function(e){var t=this.nametoGlyphIndex(e),a=this.glyphs.get(t);return a||(a=this.glyphs.get(0)),a},Font.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},Font.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var a=this.getGposKerningValue;return a?a(e,t):this.kerningPairs[e+","+t]||0},Font.prototype.forEachGlyph=function(e,t,a,r,n,s){t=void 0!==t?t:0,a=void 0!==a?a:0,r=void 0!==r?r:72,n=n||{};for(var i=void 0===n.kerning||n.kerning,o=1/this.unitsPerEm*r,l=this.stringToGlyphs(e),u=0;u<l.length;u+=1){var p=l[u];if(s(p,t,a,r,n),p.advanceWidth&&(t+=p.advanceWidth*o),i&&u<l.length-1){var f=this.getKerningValue(p,l[u+1]);t+=f*o}}},Font.prototype.getPath=function(e,t,a,r,n){var s=new Path;return this.forEachGlyph(e,t,a,r,n,function(e,t,a,r){var n=e.getPath(t,a,r);s.extend(n)}),s},Font.prototype.getPaths=function(e,t,a,r,n){var s=[];return this.forEachGlyph(e,t,a,r,n,function(e,t,a,r){var n=e.getPath(t,a,r);s.push(n)}),s},Font.prototype.draw=function(e,t,a,r,n,s){this.getPath(t,a,r,n,s).draw(e)},Font.prototype.drawPoints=function(e,t,a,r,n,s){this.forEachGlyph(t,a,r,n,s,function(t,a,r,n){t.drawPoints(e,a,r,n)})},Font.prototype.drawMetrics=function(e,t,a,r,n,s){this.forEachGlyph(t,a,r,n,s,function(t,a,r,n){t.drawMetrics(e,a,r,n)})},Font.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},Font.prototype.validate=function(){function e(e,t){e||a.push(t)}function t(t){var a=r.getEnglishName(t);e(a&&a.trim().length>0,"No English "+t+" specified.")}var a=[],r=this;t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),e(this.unitsPerEm>0,"No unitsPerEm specified.")},Font.prototype.toTables=function(){return sfnt.fontToTable(this)},Font.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Font.prototype.toArrayBuffer=function(){for(var e=this.toTables(),t=e.encode(),a=new ArrayBuffer(t.length),r=new Uint8Array(a),n=0;n<t.length;n++)r[n]=t[n];return a},Font.prototype.download=function(){var e=this.getEnglishName("fontFamily"),t=this.getEnglishName("fontSubfamily"),a=e.replace(/\s/g,"")+"-"+t+".otf",r=this.toArrayBuffer();if(util.isBrowser())window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,r.byteLength,function(e){e.root.getFile(a,{create:!0},function(e){e.createWriter(function(t){var a=new DataView(r),n=new Blob([a],{type:"font/opentype"});t.write(n),t.addEventListener("writeend",function(){location.href=e.toURL()},!1)})})},function(e){throw e});else{var n=require("fs"),s=util.arrayBufferToNodeBuffer(r);n.writeFileSync(a,s)}},Glyph.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],e.xMin&&(this.xMin=e.xMin),e.yMin&&(this.yMin=e.yMin),e.xMax&&(this.xMax=e.xMax),e.yMax&&(this.yMax=e.yMax),e.advanceWidth&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",getPathDefinition(this,e.path))},Glyph.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},Glyph.prototype.getPath=function(e,t,a,r){e=void 0!==e?e:0,t=void 0!==t?t:0,r=void 0!==r?r:{xScale:1,yScale:1},a=void 0!==a?a:72;for(var n=1/this.path.unitsPerEm*a,s=r.xScale*n,i=r.yScale*n,o=new Path,l=this.path.commands,u=0;u<l.length;u+=1){var p=l[u];"M"===p.type?o.moveTo(e+p.x*s,t+-p.y*i):"L"===p.type?o.lineTo(e+p.x*s,t+-p.y*i):"Q"===p.type?o.quadraticCurveTo(e+p.x1*s,t+-p.y1*i,e+p.x*s,t+-p.y*i):"C"===p.type?o.curveTo(e+p.x1*s,t+-p.y1*i,e+p.x2*s,t+-p.y2*i,e+p.x*s,t+-p.y*i):"Z"===p.type&&o.closePath()}return o},Glyph.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],a=0;a<this.points.length;a+=1){var r=this.points[a];t.push(r),r.lastPointOfContour&&(e.push(t),t=[])}return assert(0===t.length,"There are still points left in the current contour."),e},Glyph.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],a=[],r=0;r<e.length;r+=1){var n=e[r];"Z"!==n.type&&(t.push(n.x),a.push(n.y)),"Q"!==n.type&&"C"!==n.type||(t.push(n.x1),a.push(n.y1)),"C"===n.type&&(t.push(n.x2),a.push(n.y2))}var s={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,a),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,a),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s},Glyph.prototype.draw=function(e,t,a,r,n){this.getPath(t,a,r,n).draw(e)},Glyph.prototype.drawPoints=function(e,t,a,r){function n(t,a,r,n){var s=2*Math.PI;e.beginPath();for(var i=0;i<t.length;i+=1)e.moveTo(a+t[i].x*n,r+t[i].y*n),e.arc(a+t[i].x*n,r+t[i].y*n,2,0,s,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,a=void 0!==a?a:0,r=void 0!==r?r:24;for(var s=1/this.path.unitsPerEm*r,i=[],o=[],l=this.path,u=0;u<l.commands.length;u+=1){var p=l.commands[u];void 0!==p.x&&i.push({x:p.x,y:-p.y}),void 0!==p.x1&&o.push({x:p.x1,y:-p.y1}),void 0!==p.x2&&o.push({x:p.x2,y:-p.y2})}e.fillStyle="blue",n(i,t,a,s),e.fillStyle="red",n(o,t,a,s)},Glyph.prototype.drawMetrics=function(e,t,a,r){var n;t=void 0!==t?t:0,a=void 0!==a?a:0,r=void 0!==r?r:24,n=1/this.path.unitsPerEm*r,e.lineWidth=1,e.strokeStyle="black",draw.line(e,t,-1e4,t,1e4),draw.line(e,-1e4,a,1e4,a);var s=this.xMin||0,i=this.yMin||0,o=this.xMax||0,l=this.yMax||0,u=this.advanceWidth||0;e.strokeStyle="blue",draw.line(e,t+s*n,-1e4,t+s*n,1e4),draw.line(e,t+o*n,-1e4,t+o*n,1e4),draw.line(e,-1e4,a+-i*n,1e4,a+-i*n),draw.line(e,-1e4,a+-l*n,1e4,a+-l*n),e.strokeStyle="green",draw.line(e,t+u*n,-1e4,t+u*n,1e4)},GlyphSet.prototype.get=function(e){return"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]()),this.glyphs[e]},GlyphSet.prototype.push=function(e,t){this.glyphs[e]=t,this.length++},getByte=function(e,t){return e.getUint8(t)},getCard8=getByte,getUShort=function(e,t){return e.getUint16(t,!1)},getCard16=getUShort,getShort=function(e,t){return e.getInt16(t,!1)},getULong=function(e,t){return e.getUint32(t,!1)},getFixed=function(e,t){var a=e.getInt16(t,!1),r=e.getUint16(t+2,!1);return a+r/65535},getTag=function(e,t){for(var a="",r=t;r<t+4;r+=1)a+=String.fromCharCode(e.getInt8(r));return a},getOffset=function(e,t,a){for(var r=0,n=0;n<a;n+=1)r<<=8,r+=e.getUint8(t+n);return r},getBytes=function(e,t,a){for(var r=[],n=t;n<a;n+=1)r.push(e.getUint8(n));return r},bytesToString=function(e){for(var t="",a=0;a<e.length;a+=1)t+=String.fromCharCode(e[a]);return t};var typeOffsets={"byte":1,uShort:2,"short":2,uLong:4,fixed:4,longDateTime:8,tag:4};Parser.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},Parser.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},Parser.prototype.parseCard8=Parser.prototype.parseByte,Parser.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},Parser.prototype.parseCard16=Parser.prototype.parseUShort,Parser.prototype.parseSID=Parser.prototype.parseUShort,Parser.prototype.parseOffset16=Parser.prototype.parseUShort,Parser.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},Parser.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},Parser.prototype.parseULong=function(){var e=getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},Parser.prototype.parseFixed=function(){var e=getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(e){for(var t=new Array(e),a=this.data,r=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=getUShort(a,r),r+=2;return this.relativeOffset+=2*e,t},Parser.prototype.parseString=function(e){var t=this.data,a=this.offset+this.relativeOffset,r="";this.relativeOffset+=e;for(var n=0;n<e;n++)r+=String.fromCharCode(t.getUint8(a+n));return r},Parser.prototype.parseTag=function(){return this.parseString(4)},Parser.prototype.parseLongDateTime=function(){var e=getULong(this.data,this.offset+this.relativeOffset+4);return this.relativeOffset+=8,e},Parser.prototype.parseFixed=function(){var e=getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e/65536},Parser.prototype.parseVersion=function(){var e=getUShort(this.data,this.offset+this.relativeOffset),t=getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,e+t/4096/10},Parser.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=typeOffsets[e]*t},Path.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},Path.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(e,t,a,r,n,s){this.commands.push({type:"C",x1:e,y1:t,x2:a,y2:r,x:n,y:s})},Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(e,t,a,r){this.commands.push({type:"Q",x1:e,y1:t,x:a,y:r})},Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})},Path.prototype.extend=function(e){e.commands&&(e=e.commands),Array.prototype.push.apply(this.commands,e)},Path.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var a=this.commands[t];"M"===a.type?e.moveTo(a.x,a.y):"L"===a.type?e.lineTo(a.x,a.y):"C"===a.type?e.bezierCurveTo(a.x1,a.y1,a.x2,a.y2,a.x,a.y):"Q"===a.type?e.quadraticCurveTo(a.x1,a.y1,a.x,a.y):"Z"===a.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},Path.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function a(){for(var e="",a=0;a<arguments.length;a+=1){var r=arguments[a];r>=0&&a>0&&(e+=" "),e+=t(r)}return e}e=void 0!==e?e:2;for(var r="",n=0;n<this.commands.length;n+=1){var s=this.commands[n];"M"===s.type?r+="M"+a(s.x,s.y):"L"===s.type?r+="L"+a(s.x,s.y):"C"===s.type?r+="C"+a(s.x1,s.y1,s.x2,s.y2,s.x,s.y):"Q"===s.type?r+="Q"+a(s.x1,s.y1,s.x,s.y):"Z"===s.type&&(r+="Z")}return r},Path.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&"black"!==this.fill&&(t+=null===this.fill?' fill="none"':' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},Table.prototype.encode=function(){return encode.TABLE(this)},Table.prototype.sizeOf=function(){return sizeOf.TABLE(this)};var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}],PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}],nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],macLanguages={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},macLanguageToScript={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},windowsLanguages={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"},utf16="utf-16",macScriptEncodings={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},macLanguageEncodings={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"},unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}],os2={},LIMIT16=32768,LIMIT32=2147483648,opentype_decode={},encode={},sizeOf={};encode.BYTE=function(e){return assert(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},sizeOf.BYTE=constant(1),encode.CHAR=function(e){return[e.charCodeAt(0)]},sizeOf.CHAR=constant(1),encode.CHARARRAY=function(e){for(var t=[],a=0;a<e.length;a+=1)t.push(e.charCodeAt(a));return t},sizeOf.CHARARRAY=function(e){return e.length},encode.USHORT=function(e){return[e>>8&255,255&e]},sizeOf.USHORT=constant(2),encode.SHORT=function(e){return e>=LIMIT16&&(e=-(2*LIMIT16-e)),[e>>8&255,255&e]},sizeOf.SHORT=constant(2),encode.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},sizeOf.UINT24=constant(3),encode.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},sizeOf.ULONG=constant(4),encode.LONG=function(e){return e>=LIMIT32&&(e=-(2*LIMIT32-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},sizeOf.LONG=constant(4),encode.FIXED=encode.ULONG,sizeOf.FIXED=sizeOf.ULONG,encode.FWORD=encode.SHORT,sizeOf.FWORD=sizeOf.SHORT,encode.UFWORD=encode.USHORT,sizeOf.UFWORD=sizeOf.USHORT,encode.LONGDATETIME=function(){return[0,0,0,0,0,0,0,0]},sizeOf.LONGDATETIME=constant(8),encode.TAG=function(e){return assert(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},sizeOf.TAG=constant(4),encode.Card8=encode.BYTE,sizeOf.Card8=sizeOf.BYTE,encode.Card16=encode.USHORT,sizeOf.Card16=sizeOf.USHORT,encode.OffSize=encode.BYTE,sizeOf.OffSize=sizeOf.BYTE,encode.SID=encode.USHORT,sizeOf.SID=sizeOf.USHORT,encode.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?(e-=108,[(e>>8)+247,255&e]):e>=-1131&&e<=-108?(e=-e-108,[(e>>8)+251,255&e]):e>=-32768&&e<=32767?encode.NUMBER16(e):encode.NUMBER32(e)},sizeOf.NUMBER=function(e){return encode.NUMBER(e).length},encode.NUMBER16=function(e){return[28,e>>8&255,255&e]},sizeOf.NUMBER16=constant(3),encode.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},sizeOf.NUMBER32=constant(5),encode.REAL=function(e){var t=e.toString(),a=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(a){var r=parseFloat("1e"+((a[2]?+a[2]:0)+a[1].length));t=(Math.round(e*r)/r).toString()}var n,s,i="";for(n=0,s=t.length;n<s;n+=1){var o=t[n];i+="e"===o?"-"===t[++n]?"c":"b":"."===o?"a":"-"===o?"e":o}i+=1&i.length?"f":"ff";var l=[30];for(n=0,s=i.length;n<s;n+=2)l.push(parseInt(i.substr(n,2),16));return l},sizeOf.REAL=function(e){return encode.REAL(e).length},encode.NAME=encode.CHARARRAY,sizeOf.NAME=sizeOf.CHARARRAY,encode.STRING=encode.CHARARRAY,sizeOf.STRING=sizeOf.CHARARRAY,opentype_decode.UTF16=function(e,t,a){for(var r=[],n=a/2,s=0;s<n;s++,t+=2)r[s]=e.getUint16(t);return String.fromCharCode.apply(null,r)},encode.UTF16=function(e){for(var t=[],a=0;a<e.length;a+=1){var r=e.charCodeAt(a);t.push(r>>8&255),t.push(255&r)}return t},sizeOf.UTF16=function(e){return 2*e.length};var eightBitMacEncodings={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};opentype_decode.MACSTRING=function(e,t,a,r){var n=eightBitMacEncodings[r];if(void 0!==n){for(var s="",i=0;i<a;i++){var o=e.getUint8(t+i);s+=o<=127?String.fromCharCode(o):n[127&o]}return s}};var macEncodingTableCache="function"==typeof WeakMap&&new WeakMap,macEncodingCacheKeys,getMacEncodingTable=function(e){if(!macEncodingCacheKeys){macEncodingCacheKeys={};for(var t in eightBitMacEncodings)macEncodingCacheKeys[t]=new String(t)}var a=macEncodingCacheKeys[e];if(void 0!==a){if(macEncodingTableCache){var r=macEncodingTableCache.get(a);if(void 0!==r)return r}var n=eightBitMacEncodings[e];if(void 0!==n){for(var s={},i=0;i<n.length;i++)s[n.charCodeAt(i)]=i+128;return macEncodingTableCache&&macEncodingTableCache.set(a,s),s}}};encode.MACSTRING=function(e,t){var a=getMacEncodingTable(t);if(void 0!==a){for(var r=[],n=0;n<e.length;n++){var s=e.charCodeAt(n);if(s>=128&&(s=a[s],void 0===s))return;r.push(s)}return r}},sizeOf.MACSTRING=function(e,t){var a=encode.MACSTRING(e,t);return void 0!==a?a.length:0},encode.INDEX=function(e){var t,a=1,r=[a],n=[],s=0;for(t=0;t<e.length;t+=1){var i=encode.OBJECT(e[t]);Array.prototype.push.apply(n,i),s+=i.length,a+=i.length,r.push(a)}if(0===n.length)return[0,0];var o=[],l=1+Math.floor(Math.log(s)/Math.log(2))/8|0,u=[void 0,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][l];for(t=0;t<r.length;t+=1){var p=u(r[t]);Array.prototype.push.apply(o,p)}return Array.prototype.concat(encode.Card16(e.length),encode.OffSize(l),o,n)},sizeOf.INDEX=function(e){return encode.INDEX(e).length},encode.DICT=function(e){for(var t=[],a=Object.keys(e),r=a.length,n=0;n<r;n+=1){var s=parseInt(a[n],0),i=e[s];t=t.concat(encode.OPERAND(i.value,i.type)),t=t.concat(encode.OPERATOR(s))}return t},sizeOf.DICT=function(e){return encode.DICT(e).length},encode.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},encode.OPERAND=function(e,t){var a=[];if(Array.isArray(t))for(var r=0;r<t.length;r+=1)assert(e.length===t.length,"Not enough arguments given for type"+t),a=a.concat(encode.OPERAND(e[r],t[r]));else if("SID"===t)a=a.concat(encode.NUMBER(e));else if("offset"===t)a=a.concat(encode.NUMBER32(e));else if("number"===t)a=a.concat(encode.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);a=a.concat(encode.REAL(e))}return a},encode.OP=encode.BYTE,sizeOf.OP=sizeOf.BYTE;var wmm="function"==typeof WeakMap&&new WeakMap;encode.CHARSTRING=function(e){if(wmm){var t=wmm.get(e);if(void 0!==t)return t}for(var a=[],r=e.length,n=0;n<r;n+=1){var s=e[n];a=a.concat(encode[s.type](s.value))}return wmm&&wmm.set(e,a),a},sizeOf.CHARSTRING=function(e){return encode.CHARSTRING(e).length},encode.OBJECT=function(e){var t=encode[e.type];return assert(void 0!==t,"No encoding function for type "+e.type),t(e.value)},sizeOf.OBJECT=function(e){var t=sizeOf[e.type];return assert(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},encode.TABLE=function(e){var t,a=[],r=e.fields.length,n=[],s=[];for(t=0;t<r;t+=1){var i=e.fields[t],o=encode[i.type];assert(void 0!==o,"No encoding function for field type "+i.type+" ("+i.name+")");var l=e[i.name];void 0===l&&(l=i.value);var u=o(l);"TABLE"===i.type?(s.push(a.length),a=a.concat([0,0]),n.push(u)):a=a.concat(u)}for(t=0;t<n.length;t+=1){var p=s[t],f=a.length;assert(f<65536,"Table "+e.tableName+" too big."),a[p]=f>>8,a[p+1]=255&f,a=a.concat(n[t])}return a},sizeOf.TABLE=function(e){for(var t=0,a=e.fields.length,r=0;r<a;r+=1){var n=e.fields[r],s=sizeOf[n.type];assert(void 0!==s,"No sizeOf function for field type "+n.type+" ("+n.name+")");var i=e[n.name];void 0===i&&(i=n.value),t+=s(i),"TABLE"===n.type&&(t+=2)}return t},encode.RECORD=encode.TABLE,sizeOf.RECORD=sizeOf.TABLE,encode.LITERAL=function(e){return e},sizeOf.LITERAL=function(e){return e.length},opentype_isBrowser=function(){return"undefined"!=typeof window},opentype_isNode=function(){return"undefined"==typeof window},opentype_nodeBufferToArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),r=0;r<e.length;++r)a[r]=e[r];return t},opentype_arrayBufferToNodeBuffer=function(e){for(var t=new Buffer(e.byteLength),a=new Uint8Array(e),r=0;r<t.length;++r)t[r]=a[r];return t},opentype_checkArgument=function(e,t){if(!e)throw t};
"undefined"!=typeof Float32Array?glMatrixArrayType=Float32Array:"undefined"!=typeof WebGLFloatArray?glMatrixArrayType=WebGLFloatArray:glMatrixArrayType=Array;var vec3={};vec3.create=function(t){var r=new glMatrixArrayType(3);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r},vec3.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},vec3.add=function(t,r,n){return n&&t!=n?(n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n):(t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t)},vec3.subtract=function(t,r,n){return n&&t!=n?(n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n):(t[0]-=r[0],t[1]-=r[1],t[2]-=r[2],t)},vec3.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r},vec3.scale=function(t,r,n){return n&&t!=n?(n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n):(t[0]*=r,t[1]*=r,t[2]*=r,t)},vec3.normalize=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=Math.sqrt(n*n+a*a+e*e);return u?1==u?(r[0]=n,r[1]=a,r[2]=e,r):(u=1/u,r[0]=n*u,r[1]=a*u,r[2]=e*u,r):(r[0]=0,r[1]=0,r[2]=0,r)},vec3.cross=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=r[0],i=r[1],o=r[2];return n[0]=e*o-u*i,n[1]=u*c-a*o,n[2]=a*i-e*c,n},vec3.length=function(t){var r=t[0],n=t[1],a=t[2];return Math.sqrt(r*r+n*n+a*a)},vec3.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},vec3.direction=function(t,r,n){n||(n=t);var a=t[0]-r[0],e=t[1]-r[1],u=t[2]-r[2],c=Math.sqrt(a*a+e*e+u*u);return c?(c=1/c,n[0]=a*c,n[1]=e*c,n[2]=u*c,n):(n[0]=0,n[1]=0,n[2]=0,n)},vec3.lerp=function(t,r,n,a){return a||(a=t),a[0]=t[0]+n*(r[0]-t[0]),a[1]=t[1]+n*(r[1]-t[1]),a[2]=t[2]+n*(r[2]-t[2]),a},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"};var mat3={};mat3.create=function(t){var r=new glMatrixArrayType(9);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8]),r},mat3.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,r){if(!r||t==r){var n=t[1],a=t[2],e=t[5];return t[1]=t[3],t[2]=t[6],t[3]=n,t[5]=t[7],t[6]=a,t[7]=e,t}return r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8],r},mat3.toMat4=function(t,r){return r||(r=mat4.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=0,r[4]=t[3],r[5]=t[4],r[6]=t[5],r[7]=0,r[8]=t[6],r[9]=t[7],r[10]=t[8],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"};var mat4={};mat4.create=function(t){var r=new glMatrixArrayType(16);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},mat4.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,r){if(!r||t==r){var n=t[1],a=t[2],e=t[3],u=t[6],c=t[7],i=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=n,t[6]=t[9],t[7]=t[13],t[8]=a,t[9]=u,t[11]=t[14],t[12]=e,t[13]=c,t[14]=i,t}return r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15],r},mat4.determinant=function(t){var r=t[0],n=t[1],a=t[2],e=t[3],u=t[4],c=t[5],i=t[6],o=t[7],f=t[8],v=t[9],m=t[10],s=t[11],M=t[12],l=t[13],h=t[14],y=t[15];return M*v*i*e-f*l*i*e-M*c*m*e+u*l*m*e+f*c*h*e-u*v*h*e-M*v*a*o+f*l*a*o+M*n*m*o-r*l*m*o-f*n*h*o+r*v*h*o+M*c*a*s-u*l*a*s-M*n*i*s+r*l*i*s+u*n*h*s-r*c*h*s-f*c*a*y+u*v*a*y+f*n*i*y-r*v*i*y-u*n*m*y+r*c*m*y},mat4.inverse=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=t[3],c=t[4],i=t[5],o=t[6],f=t[7],v=t[8],m=t[9],s=t[10],M=t[11],l=t[12],h=t[13],y=t[14],q=t[15],p=n*i-a*c,A=n*o-e*c,d=n*f-u*c,g=a*o-e*i,b=a*f-u*i,x=e*f-u*o,T=v*h-m*l,w=v*y-s*l,F=v*q-M*l,V=m*y-s*h,W=m*q-M*h,z=s*q-M*y,G=1/(p*z-A*W+d*V+g*F-b*w+x*T);return r[0]=(i*z-o*W+f*V)*G,r[1]=(-a*z+e*W-u*V)*G,r[2]=(h*x-y*b+q*g)*G,r[3]=(-m*x+s*b-M*g)*G,r[4]=(-c*z+o*F-f*w)*G,r[5]=(n*z-e*F+u*w)*G,r[6]=(-l*x+y*d-q*A)*G,r[7]=(v*x-s*d+M*A)*G,r[8]=(c*W-i*F+f*T)*G,r[9]=(-n*W+a*F-u*T)*G,r[10]=(l*b-h*d+q*p)*G,r[11]=(-v*b+m*d-M*p)*G,r[12]=(-c*V+i*w-o*T)*G,r[13]=(n*V-a*w+e*T)*G,r[14]=(-l*g+h*A-y*p)*G,r[15]=(v*g-m*A+s*p)*G,r},mat4.toRotationMat=function(t,r){return r||(r=mat4.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},mat4.toMat3=function(t,r){return r||(r=mat3.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r},mat4.toInverseMat3=function(t,r){var n=t[0],a=t[1],e=t[2],u=t[4],c=t[5],i=t[6],o=t[8],f=t[9],v=t[10],m=v*c-i*f,s=-v*u+i*o,M=f*u-c*o,l=n*m+a*s+e*M;if(!l)return null;var h=1/l;return r||(r=mat3.create()),r[0]=m*h,r[1]=(-v*a+e*f)*h,r[2]=(i*a-e*c)*h,r[3]=s*h,r[4]=(v*n-e*o)*h,r[5]=(-i*n+e*u)*h,r[6]=M*h,r[7]=(-f*n+a*o)*h,r[8]=(c*n-a*u)*h,r},mat4.multiply=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=t[3],i=t[4],o=t[5],f=t[6],v=t[7],m=t[8],s=t[9],M=t[10],l=t[11],h=t[12],y=t[13],q=t[14],p=t[15],A=r[0],d=r[1],g=r[2],b=r[3],x=r[4],T=r[5],w=r[6],F=r[7],V=r[8],W=r[9],z=r[10],G=r[11],I=r[12],L=r[13],k=r[14],P=r[15];return n[0]=A*a+d*i+g*m+b*h,n[1]=A*e+d*o+g*s+b*y,n[2]=A*u+d*f+g*M+b*q,n[3]=A*c+d*v+g*l+b*p,n[4]=x*a+T*i+w*m+F*h,n[5]=x*e+T*o+w*s+F*y,n[6]=x*u+T*f+w*M+F*q,n[7]=x*c+T*v+w*l+F*p,n[8]=V*a+W*i+z*m+G*h,n[9]=V*e+W*o+z*s+G*y,n[10]=V*u+W*f+z*M+G*q,n[11]=V*c+W*v+z*l+G*p,n[12]=I*a+L*i+k*m+P*h,n[13]=I*e+L*o+k*s+P*y,n[14]=I*u+L*f+k*M+P*q,n[15]=I*c+L*v+k*l+P*p,n},mat4.multiplyVec3=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2];return n[0]=t[0]*a+t[4]*e+t[8]*u+t[12],n[1]=t[1]*a+t[5]*e+t[9]*u+t[13],n[2]=t[2]*a+t[6]*e+t[10]*u+t[14],n},mat4.multiplyVec4=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2],c=r[3];return n[0]=t[0]*a+t[4]*e+t[8]*u+t[12]*c,n[1]=t[1]*a+t[5]*e+t[9]*u+t[13]*c,n[2]=t[2]*a+t[6]*e+t[10]*u+t[14]*c,n[3]=t[3]*a+t[7]*e+t[11]*u+t[15]*c,n},mat4.translate=function(t,r,n){var a=r[0],e=r[1],u=r[2];if(!n||t==n)return t[12]=t[0]*a+t[4]*e+t[8]*u+t[12],t[13]=t[1]*a+t[5]*e+t[9]*u+t[13],t[14]=t[2]*a+t[6]*e+t[10]*u+t[14],t[15]=t[3]*a+t[7]*e+t[11]*u+t[15],t;var c=t[0],i=t[1],o=t[2],f=t[3],v=t[4],m=t[5],s=t[6],M=t[7],l=t[8],h=t[9],y=t[10],q=t[11];return n[0]=c,n[1]=i,n[2]=o,n[3]=f,n[4]=v,n[5]=m,n[6]=s,n[7]=M,n[8]=l,n[9]=h,n[10]=y,n[11]=q,n[12]=c*a+v*e+l*u+t[12],n[13]=i*a+m*e+h*u+t[13],n[14]=o*a+s*e+y*u+t[14],n[15]=f*a+M*e+q*u+t[15],n},mat4.scale=function(t,r,n){var a=r[0],e=r[1],u=r[2];return n&&t!=n?(n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*e,n[5]=t[5]*e,n[6]=t[6]*e,n[7]=t[7]*e,n[8]=t[8]*u,n[9]=t[9]*u,n[10]=t[10]*u,n[11]=t[11]*u,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):(t[0]*=a,t[1]*=a,t[2]*=a,t[3]*=a,t[4]*=e,t[5]*=e,t[6]*=e,t[7]*=e,t[8]*=u,t[9]*=u,t[10]*=u,t[11]*=u,t)},mat4.rotate=function(t,r,n,a){var e=n[0],u=n[1],c=n[2],i=Math.sqrt(e*e+u*u+c*c);if(!i)return null;1!=i&&(i=1/i,e*=i,u*=i,c*=i);var o=Math.sin(r),f=Math.cos(r),v=1-f,m=t[0],s=t[1],M=t[2],l=t[3],h=t[4],y=t[5],q=t[6],p=t[7],A=t[8],d=t[9],g=t[10],b=t[11],x=e*e*v+f,T=u*e*v+c*o,w=c*e*v-u*o,F=e*u*v-c*o,V=u*u*v+f,W=c*u*v+e*o,z=e*c*v+u*o,G=u*c*v-e*o,I=c*c*v+f;return a?t!=a&&(a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]):a=t,a[0]=m*x+h*T+A*w,a[1]=s*x+y*T+d*w,a[2]=M*x+q*T+g*w,a[3]=l*x+p*T+b*w,a[4]=m*F+h*V+A*W,a[5]=s*F+y*V+d*W,a[6]=M*F+q*V+g*W,a[7]=l*F+p*V+b*W,a[8]=m*z+h*G+A*I,a[9]=s*z+y*G+d*I,a[10]=M*z+q*G+g*I,a[11]=l*z+p*G+b*I,a},mat4.rotateX=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[4],c=t[5],i=t[6],o=t[7],f=t[8],v=t[9],m=t[10],s=t[11];return n?t!=n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[4]=u*e+f*a,n[5]=c*e+v*a,n[6]=i*e+m*a,n[7]=o*e+s*a,n[8]=u*-a+f*e,n[9]=c*-a+v*e,n[10]=i*-a+m*e,n[11]=o*-a+s*e,n},mat4.rotateY=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[0],c=t[1],i=t[2],o=t[3],f=t[8],v=t[9],m=t[10],s=t[11];return n?t!=n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*e+f*-a,n[1]=c*e+v*-a,n[2]=i*e+m*-a,n[3]=o*e+s*-a,n[8]=u*a+f*e,n[9]=c*a+v*e,n[10]=i*a+m*e,n[11]=o*a+s*e,n},mat4.rotateZ=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[0],c=t[1],i=t[2],o=t[3],f=t[4],v=t[5],m=t[6],s=t[7];return n?t!=n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*e+f*a,n[1]=c*e+v*a,n[2]=i*e+m*a,n[3]=o*e+s*a,n[4]=u*-a+f*e,n[5]=c*-a+v*e,n[6]=i*-a+m*e,n[7]=o*-a+s*e,n},mat4.frustum=function(t,r,n,a,e,u,c){c||(c=mat4.create());var i=r-t,o=a-n,f=u-e;return c[0]=2*e/i,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*e/o,c[6]=0,c[7]=0,c[8]=(r+t)/i,c[9]=(a+n)/o,c[10]=-(u+e)/f,c[11]=-1,c[12]=0,c[13]=0,c[14]=-(u*e*2)/f,c[15]=0,c},mat4.perspective=function(t,r,n,a,e){var u=n*Math.tan(t*Math.PI/360),c=u*r;return mat4.frustum(-c,c,-u,u,n,a,e)},mat4.ortho=function(t,r,n,a,e,u,c){c||(c=mat4.create());var i=r-t,o=a-n,f=u-e;return c[0]=2/i,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2/o,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=-2/f,c[11]=0,c[12]=-(t+r)/i,c[13]=-(a+n)/o,c[14]=-(u+e)/f,c[15]=1,c},mat4.lookAt=function(t,r,n,a){a||(a=mat4.create());var e=t[0],u=t[1],c=t[2],i=n[0],o=n[1],f=n[2],v=r[0],m=r[1],s=r[2];if(e==v&&u==m&&c==s)return mat4.identity(a);var M,l,h,y,q,p,A,d,g,b;return M=e-r[0],l=u-r[1],h=c-r[2],b=1/Math.sqrt(M*M+l*l+h*h),M*=b,l*=b,h*=b,y=o*h-f*l,q=f*M-i*h,p=i*l-o*M,b=Math.sqrt(y*y+q*q+p*p),b?(b=1/b,y*=b,q*=b,p*=b):(y=0,q=0,p=0),A=l*p-h*q,d=h*y-M*p,g=M*q-l*y,b=Math.sqrt(A*A+d*d+g*g),b?(b=1/b,A*=b,d*=b,g*=b):(A=0,d=0,g=0),a[0]=y,a[1]=A,a[2]=M,a[3]=0,a[4]=q,a[5]=d,a[6]=l,a[7]=0,a[8]=p,a[9]=g,a[10]=h,a[11]=0,a[12]=-(y*e+q*u+p*c),a[13]=-(A*e+d*u+g*c),a[14]=-(M*e+l*u+h*c),a[15]=1,a},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4={},quat4.create=function(t){var r=new glMatrixArrayType(4);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r},quat4.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},quat4.calculateW=function(t,r){var n=t[0],a=t[1],e=t[2];return r&&t!=r?(r[0]=n,r[1]=a,r[2]=e,r[3]=-Math.sqrt(Math.abs(1-n*n-a*a-e*e)),r):(t[3]=-Math.sqrt(Math.abs(1-n*n-a*a-e*e)),t)},quat4.inverse=function(t,r){return r&&t!=r?(r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var r=t[0],n=t[1],a=t[2],e=t[3];return Math.sqrt(r*r+n*n+a*a+e*e)},quat4.normalize=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=t[3],c=Math.sqrt(n*n+a*a+e*e+u*u);return 0==c?(r[0]=0,r[1]=0,r[2]=0,r[3]=0,r):(c=1/c,r[0]=n*c,r[1]=a*c,r[2]=e*c,r[3]=u*c,r)},quat4.multiply=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=t[3],i=r[0],o=r[1],f=r[2],v=r[3];return n[0]=a*v+c*i+e*f-u*o,n[1]=e*v+c*o+u*i-a*f,n[2]=u*v+c*f+a*o-e*i,n[3]=c*v-a*i-e*o-u*f,n},quat4.multiplyVec3=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2],c=t[0],i=t[1],o=t[2],f=t[3],v=f*a+i*u-o*e,m=f*e+o*a-c*u,s=f*u+c*e-i*a,M=-c*a-i*e-o*u;return n[0]=v*f+M*-c+m*-o-s*-i,n[1]=m*f+M*-i+s*-c-v*-o,n[2]=s*f+M*-o+v*-i-m*-c,n},quat4.toMat3=function(t,r){r||(r=mat3.create());var n=t[0],a=t[1],e=t[2],u=t[3],c=n+n,i=a+a,o=e+e,f=n*c,v=n*i,m=n*o,s=a*i,M=a*o,l=e*o,h=u*c,y=u*i,q=u*o;return r[0]=1-(s+l),r[1]=v-q,r[2]=m+y,r[3]=v+q,r[4]=1-(f+l),r[5]=M-h,r[6]=m-y,r[7]=M+h,r[8]=1-(f+s),r},quat4.toMat4=function(t,r){r||(r=mat4.create());var n=t[0],a=t[1],e=t[2],u=t[3],c=n+n,i=a+a,o=e+e,f=n*c,v=n*i,m=n*o,s=a*i,M=a*o,l=e*o,h=u*c,y=u*i,q=u*o;return r[0]=1-(s+l),r[1]=v-q,r[2]=m+y,r[3]=0,r[4]=v+q,r[5]=1-(f+l),r[6]=M-h,r[7]=0,r[8]=m-y,r[9]=M+h,r[10]=1-(f+s),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},quat4.slerp=function(t,r,n,a){a||(a=t);var e=t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3];if(Math.abs(e)>=1)return a!=t&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]),a;var u=Math.acos(e),c=Math.sqrt(1-e*e);if(Math.abs(c)<.001)return a[0]=.5*t[0]+.5*r[0],a[1]=.5*t[1]+.5*r[1],a[2]=.5*t[2]+.5*r[2],a[3]=.5*t[3]+.5*r[3],a;var i=Math.sin((1-n)*u)/c,o=Math.sin(n*u)/c;return a[0]=t[0]*i+r[0]*o,a[1]=t[1]*i+r[1]*o,a[2]=t[2]*i+r[2]*o,a[3]=t[3]*i+r[3]*o,a},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};
WebGLUtils=function(){var e=function(e){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>"},t='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org" target="_blank">Click here to upgrade your browser.</a>',r='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/" target="_blank">Click here for more information.</a>',n=function(n,o){function a(t){var r=n.parentNode;r&&(r.innerHTML=e(t))}if(!window.WebGLRenderingContext)return a(t),null;var u=i(n,o);return u||a(r),u},i=function(e,t){for(var r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,i=0;i<r.length;++i){try{n=e.getContext(r[i],t)}catch(o){}if(n)break}return n};return{create3DContext:i,setupWebGL:n}}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}();
!function(){"use strict";function e(e){for(var r in e)t[r]=e[r],n[r]=e[r]}var t={version:"2.6"},r={declare:function(e,t){$.each(t,function(t,n){function c(){throw new Error("Property '"+t+"' is read-only.")}(null===n||void 0===n.value&&!n.get)&&(n={value:n}),n.name=t;var o=n.internal||"__"===t.substr(0,2);if(void 0===n.enumerable&&(n.enumerable=!o),void 0===n.type&&!n.get&&!o){var i=typeof n.value;"number"===i?n.type=r.check_number:"string"===i?n.type=r.check_string:n.value instanceof attributeVector?n.type=r.check_attributeVector:n.value instanceof attributeVectorPos?n.type=r.check_attributeVectorPos:n.value instanceof attributeVectorAxis?n.type=r.check_attributeVectorAxis:n.value instanceof attributeVectorSize?n.type=r.check_attributeVectorSize:n.value instanceof attributeVectorUp?n.type=r.check_attributeVectorUp:n.value instanceof vec&&(n.type=r.check_vec)}if(n.readonly&&n.set||n.onchanged&&n.set||void 0!==n.value&&n.get)throw new Error("Erroneous property definition '"+t+"'.");if(n.get)Object.defineProperty(e,t,{enumerable:n.enumerable,get:n.get,set:n.set||c});else if(n.type||n.onchanged){var o="__"+t,a={enumerable:n.enumerable,get:function(){return this[o]}};n.set?a.set=n.set:n.onchanged&&n.type?a.set=function(e){var t=this[o];this[o]=n.type.call(this,e,n),n.onchanged.call(this,t)}:n.onchanged?a.set=function(e){var t=this[o];this[o]=e,n.onchanged.call(this,t)}:n.type&&(a.set=function(e){this[o]=n.type.call(this,e,n)}),Object.defineProperty(e,o,{enumerable:!1,writable:!0,value:n.value}),Object.defineProperty(e,t,a)}else Object.defineProperty(e,t,{enumerable:n.enumerable,writable:!n.readonly,value:n.value})})},nullable_attributeVector:function(e,t){return null===e?null:r.check_attributeVector.call(this,e,t)},check_attributeVector:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVector(this,e.x,e.y,e.z)},check_attributeVectorPos:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVectorPos(this,e.x,e.y,e.z)},check_attributeVectorAxis:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVectorAxis(this,e.x,e.y,e.z)},check_attributeVectorSize:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVectorSize(this,e.x,e.y,e.z)},check_attributeVectorUp:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVectorUp(this,e.x,e.y,e.z)},check_vec:function(e,t){if(!e instanceof vec)throw new Error("Property '"+t.name+"' must be a vector.");return e},check_number:function(e,t){return e},check_string:function(e,t){return e}},n=window,c={glowscript:t,property:r,Export:e};e(c)}();
!function(){"use strict";function t(t,e,r){if(t.__change(),0===r.mag2)return void(void 0===t.__oldaxis&&(t.__oldaxis=e));void 0!==t.__oldaxis&&(e=t.__oldaxis,t.__oldaxis=void 0);var i=e.diff_angle(r);if(i>1e-6){var n,_;Math.abs(i-Math.PI)<1e-6?_=t.__up.multiply(-1):(n=cross(e,r),_=t.__up.rotate({angle:i,axis:n})),t.__up.__x=_.x,t.__up.__y=_.y,t.__up.__z=_.z}}function e(t,e,r){t.__change(),0===r.mag2&&void 0===t.__oldup&&(t.__oldup=e),void 0!==t.__oldup&&(e=t.__oldup,t.__oldup=void 0);var i=e.diff_angle(r);if(i>1e-6){var n,_;Math.abs(i-Math.PI)<1e-6?_=t.__axis.multiply(-1):(n=cross(e,r),_=t.__axis.rotate({angle:i,axis:n})),t.__axis.__x=_.x,t.__axis.__y=_.y,t.__axis.__z=_.z}}function r(t,e,i){if(!(this instanceof r))return void 0===e&&void 0===i?new r(t.x,t.y,t.z):new r(t,e,i);if(void 0===i||void 0===e)throw new Error("vector() requires 3 arguments: x, y, and z.");this.x=t,this.y=e,this.z=i}function i(t,e,r,i){this.__parent=t,this.__x=e,this.__y=r,this.__z=i,t&&t.__change()}function n(t,e,i,n){this.__parent=t,this.__x=e,this.__y=i,this.__z=n,t&&(t.__change(),t._pos_set=!0,t.__make_trail&&t.__update_trail(r(e,i,n)))}function _(e,r,i,n){var _;this.__parent=e,e&&(_=norm(e.__axis)),this.__x=r,this.__y=i,this.__z=n,e&&(e.__sizing&&(e.__size.__x=Math.sqrt(r*r+i*i+n*n)),window.__adjustupaxis&&t(e,_,this),e.__change())}function o(t,e,r,i){if(this.__parent=t,this.__x=e,this.__y=r,this.__z=i,t){if(t.__sizing){var n=t.__axis.norm().multiply(e);t.__axis.__x=n.x,t.__axis.__y=n.y,t.__axis.__z=n.z}t.__change()}}function s(t,r,i,n){var _;this.__parent=t,t&&(_=norm(t.__up)),this.__x=r,this.__y=i,this.__z=n,t&&(window.__adjustupaxis&&e(t,_,this),t.__change())}i.prototype=new r(0,0,0),i.prototype.constructor=i,n.prototype=new r(0,0,0),n.prototype.constructor=n,_.prototype=new r(1,0,0),_.prototype.constructor=_,o.prototype=new r(1,1,1),o.prototype.constructor=o,s.prototype=new r(0,1,0),s.prototype.constructor=s,Object.defineProperty(i.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(i.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(t){this.__x=t,this.__parent.__change()}}),Object.defineProperty(i.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(i.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(t){this.__y=t,this.__parent.__change()}}),Object.defineProperty(i.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(i.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(t){this.__z=t,this.__parent.__change()}}),Object.defineProperty(n.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(n.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(t){this.__x=t,this.__parent.__change(),this.__parent._pos_set=!0,this.__parent.__make_trail&&this.__parent.__update_trail(r(this.__x,this.__y,this.__z))}}),Object.defineProperty(n.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(n.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(t){this.__y=t,this.__parent.__change(),this.__parent._pos_set=!0,this.__parent.__make_trail&&this.__parent.__update_trail(r(this.__x,this.__y,this.__z))}}),Object.defineProperty(n.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(n.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(t){this.__z=t,this.__parent.__change(),this.__parent._pos_set=!0,this.__parent.__make_trail&&this.__parent.__update_trail(r(this.__x,this.__y,this.__z))}}),Object.defineProperty(_.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(_.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(e){var r=norm(this.__parent.__axis);this.__x=e,this.__parent.__sizing&&(this.__parent.__size.x=this.mag),t(this.__parent,r,this)}}),Object.defineProperty(_.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(_.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(e){var r=norm(this.__parent.__axis);this.__y=e,this.__parent.__sizing&&(this.__parent.__size.x=this.mag),t(this.__parent,r,this)}}),Object.defineProperty(_.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(_.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(e){var r=norm(this.__parent.__axis);this.__z=e,this.__parent.__sizing&&(this.__parent.__size.x=this.mag),t(this.__parent,r,this)}}),Object.defineProperty(o.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(o.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(t){if(this.__x=t,this.__parent.__sizing){var e=this.__parent.__axis.norm().multiply(t);this.__parent.__axis.__x=e.x,this.__parent.__axis.__y=e.y,this.__parent.__axis.__z=e.z}this.__parent.__change()}}),Object.defineProperty(o.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(o.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(t){this.__y=t,this.__parent.__change()}}),Object.defineProperty(o.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(o.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(t){this.__z=t,this.__parent.__change()}}),Object.defineProperty(s.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(s.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(t){var r=norm(this.__parent.__up);this.__x=t,e(parent,r,this)}}),Object.defineProperty(s.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(s.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(t){var r=norm(this.__parent.__up);this.__y=t,e(parent,r,this)}}),Object.defineProperty(s.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(s.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(t){var r=norm(this.__parent.__up);this.__z=t,e(parent,r,this)}}),r.prototype.toString=function(){for(var t,e,r,i,n=[this.x,this.y,this.z],_=[],o=0;o<3;o++){var t=n[o];if(0!=t)if(t=Math.abs(t)<1e-4?t.toExponential(5):t.toPrecision(6),e=t.indexOf("."),e>=0){for(i=t.indexOf("e"),i<0&&(i=t.length),r=i;;)if(r--,"0"!=t.charAt(r)){if(r==e){_.push(t.slice(0,e).concat(t.slice(i,t.length)));break}i==t.length?_.push(t.slice(0,r+1)):_.push(t.slice(0,r+1).concat(t.slice(i,t.length)));break}}else _.push(t);else _.push("0")}return"< "+_[0]+", "+_[1]+", "+_[2]+" >"},r.prototype.add=function(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)},r.prototype.sub=function(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)},r.prototype.multiply=function(t){return new r(this.x*t,this.y*t,this.z*t)},r.prototype.divide=function(t){return new r(this.x/t,this.y/t,this.z/t)},property.declare(r.prototype,{mag:{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},set:function(t){var e=this.norm().multiply(t);this.x=e.x,this.y=e.y,this.z=e.z}},mag2:{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},set:function(t){var e=this.norm().multiply(Math.sqrt(t));this.x=e.x,this.y=e.y,this.z=e.z}},hat:{get:function(){return this.norm()},set:function(t){var e=t.hat.multiply(this.mag);this.x=e.x,this.y=e.y,this.z=e.z}}}),r.prototype.norm=function(){var t=this.mag;return 0==t?new r(0,0,0):new r(this.x/t,this.y/t,this.z/t)},r.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},r.prototype.equals=function(t){return null!==t&&(this.x===t.x&&this.y===t.y&&this.z===t.z)},r.prototype.proj=function(t){var e=norm(t);return e.multiply(this.dot(e))},r.prototype.comp=function(t){return this.dot(norm(t))},r.prototype.cross=function(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},r.prototype.diff_angle=function(t){var e=this.norm().dot(t.norm());return e>1?0:e<-1?Math.PI:Math.acos(e)},r.prototype.rotate=function(t){var e,i;if(1==arguments.length?null!==t&&void 0!==t&&("number"==typeof t?e=t:(e=t.angle,i=t.axis)):2==arguments.length&&(e=arguments[0],i=arguments[1]),void 0===e)throw new Error("To rotate a vector you must specify an angle.");if(void 0===i&&(i=new r(0,0,1)),0===e)return new r(this.x,this.y,this.z);var i=i.norm(),n=i.multiply(i.dot(this)),_=i.cross(this),o=_.mag;_=_.norm();var s=_.cross(i),a=s.multiply(o*Math.cos(e)).add(_.multiply(o*Math.sin(e)));return n.add(a)},r.random=function(){return new r(-1+2*Math.random(),-1+2*Math.random(),-1+2*Math.random())},String.prototype["+"]=function(t){return this+t},Number.prototype["+"]=function(t){return this+t},Number.prototype["-"]=function(t){return this-t},Number.prototype["*"]=function(t){return t instanceof r?t.multiply(this):t*this},Number.prototype["/"]=function(t){return this/t},Number.prototype["%"]=function(t){return this%t},Number.prototype["-u"]=function(){return-this},r.prototype["+"]=r.prototype.add,r.prototype["-"]=r.prototype.sub,r.prototype["*"]=r.prototype.multiply,r.prototype["/"]=function(t){return this.divide(t)},r.prototype["-u"]=function(){return new r((-this.x),(-this.y),(-this.z))};var a={vec:r,attributeVector:i,attributeVectorPos:n,attributeVectorAxis:_,attributeVectorSize:o,attributeVectorUp:s};Export(a)}(),function(){"use strict";function t(t){return t.mag}function e(t){return t.mag2}function r(t){return t.norm()}function i(t){return t.hat}function n(t,e){return t.dot(e)}function _(t,e){return t.cross(e)}function o(t,e){return t.proj(e)}function s(t,e){return t.comp(e)}function a(t,e){return t.diff_angle(e)}function p(t){var e,r,i=arguments[0];if(2==arguments.length){var t=arguments[1];null!==t&&void 0!==t&&("number"==typeof t?e=t:(e=t.angle,r=t.axis))}else 3==arguments.length&&(e=arguments[1],r=arguments[2]);if(void 0===e)throw new Error("To rotate a vector you must specify an angle.");return void 0===r&&(r=new vec(0,0,1)),i.rotate({angle:e,axis:r})}var u={mag:t,mag2:e,norm:r,hat:i,dot:n,cross:_,proj:o,comp:s,diff_angle:a,rotate:p};Export(u)}();
!function(){"use strict";function s(){this.pos=[],this.normal=[],this.color=[],this.opacity=[],this.shininess=[],this.emissive=[],this.texpos=[],this.bumpaxis=[],this.index=[],this.model_transparent=!1}$.extend(s.prototype,{merge:function(s,p,h){var o=null,i=null,u=null,t=null,n=null,e=null,a=this.pos.length/3;if(p instanceof vertex)h<0?this.index.push(a+h):((null===o||p.__pos.x<o)&&(o=p.__pos.x),(null===i||p.__pos.x>i)&&(i=p.__pos.x),(null===u||p.__pos.y<u)&&(u=p.__pos.y),(null===t||p.__pos.y>t)&&(t=p.__pos.y),(null===n||p.__pos.z<n)&&(n=p.__pos.z),(null===e||p.__pos.z>e)&&(e=p.__pos.z),this.pos.push(p.__pos.x,p.__pos.y,p.__pos.z),this.normal.push(p.__normal.x,p.__normal.y,p.__normal.z),this.color.push(p.__color.x,p.__color.y,p.__color.z),p.__opacity<1&&(this.model_transparent=!0),this.opacity.push(p.__opacity),this.shininess.push(p.__shininess),this.emissive.push(p.__emissive),this.texpos.push(p.__texpos.x,p.__texpos.y),this.bumpaxis.push(p.__bumpaxis.x,p.__bumpaxis.y,p.__bumpaxis.z),this.index.push(a));else{for(var r=[p.__color.x,p.__color.y,p.__color.z],l=0;l<s.pos.length;l++)l%3===0?((null===o||s.pos[l]<o)&&(o=s.pos[l]),(null===i||s.pos[l]>i)&&(i=s.pos[l])):l%3===1?((null===u||s.pos[l]<u)&&(u=s.pos[l]),(null===t||s.pos[l]>t)&&(t=s.pos[l])):l%3===2&&((null===n||s.pos[l]<n)&&(n=s.pos[l]),(null===e||s.pos[l]>e)&&(e=s.pos[l])),this.pos.push(s.pos[l]);for(var l=0;l<s.normal.length;l++)this.normal.push(s.normal[l]);for(var l=0;l<s.color.length;l++)this.color.push(r[l%3]*s.color[l]);for(var l=0;l<s.opacity.length;l++){var m=p.__opacity*s.opacity[l];m<1&&(this.model_transparent=!0),this.opacity.push(m)}for(var l=0;l<s.shininess.length;l++){var x=p.__shininess*s.shininess[l];this.shininess.push(x)}for(var l=0;l<s.emissive.length;l++){var _=p.__emissive||s.emissive[l]?1:0;this.emissive.push(_)}for(var l=0;l<s.texpos.length;l++)this.texpos.push(s.texpos[l]);for(var l=0;l<s.bumpaxis.length;l++)this.bumpaxis.push(s.bumpaxis[l]);for(var l=0;l<s.index.length;l++)this.index.push(a+s.index[l])}return{__xmin:o,__ymin:u,__zmin:n,__xmax:i,__ymax:t,__zmax:e}},transformed:function(p){var h=mat3.toMat4(mat3.transpose(mat4.toInverseMat3(p))),o=new s;o.index=this.index,o.color=this.color,o.opacity=this.opacity,o.shininess=this.shininess,o.emissive=this.emissive,o.texpos=this.texpos;for(var i=0;i<this.pos.length;i+=3){var u=[this.pos[i],this.pos[i+1],this.pos[i+2]],t=[this.normal[i],this.normal[i+1],this.normal[i+2],0],n=[this.bumpaxis[i],this.bumpaxis[i+1],this.bumpaxis[i+2]];mat4.multiplyVec3(p,u),mat4.multiplyVec4(h,t),mat4.multiplyVec3(p,n),o.pos.push(u[0],u[1],u[2]),o.normal.push(t[0],t[1],t[2]),o.bumpaxis.push(n[0],n[1],n[2])}return o},adjust:function(s,p){for(var h=s.x,o=s.y,i=s.z,u=p.x,t=p.y,n=p.z,e=0;e<this.pos.length;e+=3)this.pos[e]=(this.pos[e]-h)/u,this.pos[e+1]=(this.pos[e+1]-o)/t,this.pos[e+2]=(this.pos[e+2]-i)/n,this.normal[e]*=u,this.normal[e+1]*=t,this.normal[e+2]*=n}}),$.extend(s,{makeCube:function(){var p=new s,h=.5;return p.pos.push(+h,+h,+h,+h,-h,+h,+h,-h,-h,+h,+h,-h,-h,+h,-h,-h,-h,-h,-h,-h,+h,-h,+h,+h,-h,-h,+h,-h,-h,-h,+h,-h,-h,+h,-h,+h,-h,+h,-h,-h,+h,+h,+h,+h,+h,+h,+h,-h,-h,+h,+h,-h,-h,+h,+h,-h,+h,+h,+h,+h,+h,+h,-h,+h,-h,-h,-h,-h,-h,-h,+h,-h),p.normal.push(1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1),p.color.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.opacity.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.shininess.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.emissive.push(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),p.texpos.push(0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1),p.bumpaxis.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0),p.index.push(0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23),p},makeQuad:function(){var p=new s;return p.pos.push(-1,-1,0,1,-1,0,1,1,0,-1,1,0),p.normal.push(0,0,1,0,0,1,0,0,1,0,0,1),p.color.push(1,1,1,1,1,1,1,1,1,1,1,1),p.opacity.push(1,1,1,1),p.shininess.push(1,1,1,1),p.emissive.push(0,0,0,0),p.texpos.push(0,0,1,0,1,1,0,1),p.bumpaxis.push(1,0,0,1,0,0,1,0,0,1,0,0),p.index.push(0,1,2,0,2,3),p},makeCylinder:function(p){var h,o,i=50,u=2*Math.PI/i,t=Math.sin(u),n=Math.cos(u),e=-p,a=0,r=new s;r.pos.push(0,0,0,1,0,0),r.normal.push(-1,0,0,1,0,0),r.color.push(1,1,1,1,1,1),r.opacity.push(1,1),r.shininess.push(1,1),r.emissive.push(0,0),r.texpos.push(.5,.5,.5,.5),r.bumpaxis.push(0,0,1,0,0,-1);for(var l=4*i,m=2;m<=2+4*i;m+=4)r.pos.push(0,e,a,0,e,a,1,e,a,1,e,a),r.normal.push(-1,0,0,0,e,a,1,0,0,0,e,a),r.color.push(1,1,1,1,1,1,1,1,1,1,1,1),r.opacity.push(1,1,1,1),r.shininess.push(1,1,1,1),r.emissive.push(0,0,0,0),m<2+2*i?r.texpos.push(.5*(1+a/p),.5+.5*e/p,0,(m-2)/4/(i/2),.5*(1-a/p),.5+.5*e/p,1,(m-2)/4/(i/2)):r.texpos.push(.5*(1+a/p),.5+.5*e/p,0,1-(m-2-2*i)/4/(i/2),.5*(1-a/p),.5+.5*e/p,1,1-(m-2-2*i)/4/(i/2)),r.bumpaxis.push(0,0,1,1,0,0,0,0,-1,1,0,0),m!=2+4*i&&r.index.push(0,(m-2)%l+2,(m+4-2)%l+2,m+1,(m+3-2)%l+2,(m+7-2)%l+2,m+1,(m+7-2)%l+2,(m+5-2)%l+2,1,(m+6-2)%l+2,(m+2-2)%l+2),h=e*n+a*t,o=a*n-e*t,e=h,a=o;return r},makeRing:function(p,h){for(var o,i,u=64,t=2*Math.PI/u,n=Math.sin(t),e=Math.cos(t),a=20,r=2*Math.PI/a,l=Math.sin(r),m=Math.cos(r),x=0,_=h,c=[],v=0;v<a;v++)c.push(vec(x,0,_-h)),o=x*m+_*l,i=_*m-x*l,x=o,_=i;for(var y,i,f=new s,M=0,_=p+h,d=[],b=[],v=0;v<u;v++){for(var z=vec(0,M,_),g=0;g<a;g++)d.push(c[g]),b.push(z);y=M*e+_*n,i=_*e-M*n,M=y,_=i}for(var v=0;v<u;v++)for(var g=0;g<a;g++){var I=(g+1)%a,P=(v+1)%u,k=d[v*a+g];f.pos.push(k.x,k.y,k.z),k=b[v*a+g],f.normal.push(k.x,k.y,k.z),f.color.push(1,1,1),f.opacity.push(1),f.shininess.push(1),f.emissive.push(0),f.texpos.push(g/a,v/u),k=d[v*a+I].sub(d[v*a+g]),f.bumpaxis.push(k.x,k.y,k.z),f.index.push(a*v+g,a*P+g,a*P+I,a*v+g,a*P+I,a*v+I)}return f},makeRing_compound:function(p){for(var h,o,i=p.x/2,u=(p.y/2-i,64),t=2*Math.PI/u,n=Math.sin(t),e=Math.cos(t),a=20,r=2*Math.PI/a,l=Math.sin(r),m=Math.cos(r),x=0,_=i,c=[],v=0;v<a;v++)c.push(vec(x,0,_-i)),h=x*m+_*l,o=_*m-x*l,x=h,_=o;for(var y,o,f=0,_=.5,M=[],d=[],v=0;v<u;v++){for(var b=vec(0,f*p.y,_*p.z),z=vec(0,f,_).norm(),g=b.sub(z.multiply(i)),I=0;I<a;I++){var P=c[I].x,k=c[I].z,w=vec(P,0,0).add(z.multiply(k)).add(b);M.push(w),d.push(w.sub(g).norm())}y=f*e+_*n,o=_*e-f*n,f=y,_=o}for(var C=new s,v=0;v<u;v++)for(var I=0;I<a;I++){var S=(I+1)%a,V=(v+1)%u,q=M[v*a+I];C.pos.push(q.x,q.y,q.z),q=d[v*a+I],C.normal.push(q.x,q.y,q.z),C.color.push(1,1,1),C.opacity.push(1),C.shininess.push(1),C.emissive.push(0),C.texpos.push(I/a,v/u),q=M[v*a+S].sub(M[v*a+I]),C.bumpaxis.push(q.x,q.y,q.z),C.index.push(a*v+I,a*V+I,a*V+S,a*v+I,a*V+S,a*v+S)}return C},makeSphere:function(p,h,o){var i=h,u=h,t=u,n=Math.PI/i,e=2*Math.PI/u,a=Math.sin(n),r=Math.cos(n),l=Math.sin(e),m=Math.cos(e),t=u;o&&(i=h/2,u=4,t=u+1,n=Math.PI/i,a=-Math.sin(n),r=Math.cos(n),e=Math.PI/u,l=Math.sin(e),m=Math.cos(e));var x,_,c,v,y,f,M,d,b,z,g,I,P=new s;for(x=0,c=p,y=0,g=0;g<i+1;g++){for(_=0,v=c*r+y*a,z=f=y*r-c*a,I=0;I<u+1&&(P.pos.push(x,c,y),P.normal.push(x/p,c/p,y/p),P.color.push(1,1,1),P.opacity.push(1),P.shininess.push(1),P.emissive.push(0),P.texpos.push(I/u,1-g/i),P.bumpaxis.push(y/p,0,-x/p),M=x*m+y*l,d=y*m-x*l,x=M,y=d,!(o&&I>=u));I++)b=g*t,I<u?P.index.push(b+I,b+I+t,b+I+t+1,b+I,b+I+t+1,b+I+1):P.index.push(b+I,b+I+t,b+0+t,b+I,b+0+t,b+0);if(x=0,c=v,y=z,g==i)for(y=0,I=0;I<u;I+=1)P.pos.push(0,-p,0),P.normal.push(-1,0,0),P.color.push(1,1,1),P.opacity.push(1),P.shininess.push(1),P.emissive.push(0),P.texpos.push(I/u,0),P.bumpaxis.push(y/p,0,-x/p),M=x*m+y*l,d=y*m-x*l,x=M,y=d}return P},makeCone:function(p){var h=200,o=new s;o.pos.push(0,0,0),o.normal.push(-1,0,0),o.color.push(1,1,1),o.opacity.push(1),o.shininess.push(1),o.emissive.push(0),o.texpos.push(.5,.5),o.bumpaxis.push(0,0,1);for(var i,u,t=2*Math.PI/h,n=Math.sin(t),e=Math.cos(t),a=1/(p*Math.sqrt(5)),r=0,l=-p,m=1;m<=1+3*h;m+=3)i=r*e+l*n,u=l*e-r*n,o.pos.push(0,r,l,0,r,l,1,0,0),o.normal.push(-1,0,0,a*p,2*a*r,2*a*l,a*p,2*a*(r+i)/2,2*a*(l+u)/2),o.color.push(1,1,1,1,1,1,1,1,1),o.opacity.push(1,1,1),o.shininess.push(1,1,1),o.emissive.push(0,0,0),o.texpos.push(.5*(1+l/p),.5*(1+r/p),1-(m-1)/h/3,0,1-(m-1)/h/3,1),o.bumpaxis.push(0,0,1,0,0,1,0,-l,r),m!=1+3*h&&o.index.push(0,m,m+3,m+1,m+2,m+4),r=i,l=u;return o},makePyramid:function(){var p=new s,h=1/Math.sqrt(5);return p.pos.push(0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,1,0,0,0,-.5,-.5,0,.5,-.5,1,0,0,0,-.5,.5,0,-.5,-.5,1,0,0,0,.5,.5,0,-.5,.5,1,0,0),p.normal.push(-1,0,0,-1,0,0,-1,0,0,-1,0,0,h,2*h,0,h,2*h,0,h,2*h,0,h,0,-2*h,h,0,-2*h,h,0,-2*h,h,-2*h,0,h,-2*h,0,h,-2*h,0,h,0,2*h,h,0,2*h,h,0,2*h),p.color.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.opacity.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.shininess.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.emissive.push(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),p.texpos.push(1,1,0,1,0,0,1,0,0,0,.25,0,.125,1,1,0,.75,0,.875,1,.5,0,.75,0,.625,1,.25,0,.5,0,.375,1),p.bumpaxis.push(0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0),p.index.push(0,1,2,0,2,3,4,5,6,7,8,9,10,11,12,13,14,15),p},makeCurveSegment:function(p){for(var h,o,i=16,u=2*Math.PI/i,t=Math.sin(u),n=Math.cos(u),e=0,a=-p,r=new s,l=0;l<=2*i;l+=2)r.pos.push(0,e,a,0,0,e,a,1),r.normal.push(0,e,a,0,e,a),r.color.push(1,1,1,1,1,1),r.opacity.push(1,1),r.shininess.push(1,1),r.emissive.push(0,0),r.texpos.push(0,0,0,0),r.bumpaxis.push(0,0,0,0,0,0),l!=2*i&&r.index.push(l,l+2,l+1,l+1,l+2,l+3),h=e*n+a*t,o=a*n-e*t,e=h,a=o;for(var m=r.pos.length/4,x=s.makeSphere(p,i,!0),_=x.pos.length,l=0;l<_;l++)r.pos.push(x.pos[3*l],x.pos[3*l+1],x.pos[3*l+2],1),r.normal.push(x.normal[3*l],x.normal[3*l+1],x.normal[3*l+2]),r.color.push(1,1,1),r.opacity.push(1),r.shininess.push(1),r.emissive.push(0),r.texpos.push(x.texpos[2*l],x.texpos[2*l+1]),r.bumpaxis.push(x.bumpaxis[3*l],x.bumpaxis[3*l+1],x.bumpaxis[3*l+2]);for(var l=0;l<x.index.length;l++)r.index.push(x.index[l]+m);return r}});var p={Mesh:s};Export(p)}();
!function(){"use strict";function t(i){if(!(this instanceof t))return new t(i);i||(i={}),t.all.push(this),t.selected=this,t.hasmouse=null,this.__title_anchor=$("<div/>"),this.__caption_anchor=$("<div/>"),this.__titletext="",this.__captiontext="","title"in i&&(this.__titletext=i.title,delete i.title),"caption"in i&&(this.__captiontext=i.caption,delete i.caption),this.__align="none","align"in i&&(this.__align=i.align,delete i.align),this.__lastevent=null,this.__autoscale=!0,"autoscale"in i&&(this.__autoscale=i.autoscale,delete i.autoscale),this.__range=10,"width"in i&&(this.__width=i.width,delete i.width),"height"in i&&(this.__height=i.height,delete i.height);for(var s in i)this[s]=i[s];this.hasmouse=!1,this.__needs_update=!1,this.events=$("<div/>"),this.wrapper=$("<div/>"),this.menu=$("<div/>"),this.__canvas_element=document.createElement("canvas"),this.__overlay_element=document.createElement("canvas"),this.elements=$([this.__canvas_element,this.__overlay_element]),this.__overlay_objects={objects:[],__changed:!1},this.__visiblePrimitives={},this.lights=[{direction:vec(.21821789,.4364357,.8728715),color:vec(.8,.8,.8)},{direction:vec(-.872872,-.218218,-.436436),color:vec(.3,.3,.3)}],this.trails=[],this.arrows=[],this.billboards=[],this.update_billboards=!1,this.__points_objects=[],this.__opaque_objects={},this.__transparent_objects={},this.vertex_id=1;var a=100;this.__vertices={Nalloc:a,pos:new Float32Array(3*a),normal:new Float32Array(3*a),color:new Float32Array(3*a),opacity:new Float32Array(a),shininess:new Float32Array(a),emissive:new Float32Array(a),texpos:new Float32Array(2*a),bumpaxis:new Float32Array(3*a),index:new Uint16Array(a),model_transparent:!1,object_info:{},available:[]},this.__vertices.normal[2]=1,this.__sort_objects={opaque:{plain:{},textures:{},bumpmaps:{},textures_and_bumpmaps:{}},transparent:{plain:{},textures:{},bumpmaps:{},textures_and_bumpmaps:{}}},this.camera=orbital_camera(this),this.mouse=new e(this),this.mouse.pos=vec(0,0,0),this.mouse.ray=vec(0,0,1),this.textures={},this.textures_requested={},this.__changed={},this.__vertex_changed={},this.visible=!0,this.waitfor_textures=!1,n="",this.__expecting_key=!1}function e(t){this.canvas=t}var i=["","","","","","","","","backspace","tab","","","","\n","","","shift","ctrl","alt","","caps lock","","","","","","","esc","","","",""," ","pageup","pagedown","end","home","left","up","right","down","","","",",","insert","delete","/","0","1","2","3","4","5","6","7","8","9","",";","","=","","","","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","[","\\","]","","","`","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","delete"];i[187]="=",i[189]="-",i[192]="`",i[219]="[",i[220]="\\",i[221]="]",i[186]=";",i[222]="'",i[188]=",",i[190]=".",i[191]="/";var s=["","","","","","","","","backspace","tab","","","","\n","","","shift","ctrl","alt","break","caps lock","","","","","","","esc","","","","","","!",'"',"//","$","%","&",'"',"(",")","*","+","<","_",">","?",")","!","@","#","$","%","^","&","*","(",":",":","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","^","_","~","","","","","","","","","","*","+","","","","","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","","{","|","}","~","delete"];s[187]="+",s[189]="_",s[192]="~",s[219]="{",s[220]="|",s[221]="}",s[186]=":",s[222]='"',s[188]="<",s[190]=">",s[191]="?";var n,a,_,r=!1;$.fn.extend({gsmenubar:function(t){return this.is("ul")?(this.addClass("gsmenubar"),void this.children("li").children("ul").each(function(){$(this).menu()})):void alert("MenuBar top level must be unordered list, i.e. <ul>.")}}),$.fn.waitfor=function(t,e){function i(r){s.unbind(t,i),n="",a.__expecting_key=_,e(null,r)}var s=this;this.bind(t,i)},$.fn.pause=function(t,e){function i(r){t.visible=!1,s.unbind("click",i),n="",a.__expecting_key=_,e(null,r)}var s=this;this.bind("click",i)},window.print_anchor=$("<div/>").css("white-space","pre").appendTo($("body")),window.print_anchor.css({"float":"left"}),property.declare(t.prototype,{__activate:function(){this.__activated=!0,this.__activate=function(){};var e=t.container;this.__title_anchor.css("white-space","pre").appendTo(e),this.menu.css("white-space","pre").appendTo(e),this.wrapper.addClass("glowscript-canvas-wrapper").css("display","inline-block").appendTo(e),this.__caption_anchor.css("white-space","pre").appendTo(e),this.wrapper.css("position","relative");var i=this.__canvas_element;i.style.position="absolute";var s=this.__overlay_element;s.style.position="relative",s.style.backgroundColor="transparent",this.width=this.__width,this.height=this.__height,this.wrapper.append(this.__canvas_element),this.wrapper.append(this.__overlay_element),this.wrapper.resizable({alsoResize:[this.__canvas_element,this.__overlay_element],resize:function(t,e){this.__canvas_element.width=this.__canvas_element.style.width=this.__overlay_element.width=this.__overlay_element.style.width=this.__width=e.size.width,this.__canvas_element.height=this.__canvas_element.style.height=this.__overlay_element.height=this.__overlay_element.style.height=this.__height=e.size.height,this.trigger("resize",{event:"resize"})}.bind(this)}),this.resizable||this.wrapper.resizable("disable"),this.wrapper.css("float",this.__align),this.__renderer=new WebGLRenderer(this,i,s),this.camera.__activate&&this.camera.__activate(),this.__handleEvents(),this.__titletext&&(this.title=this.__titletext),this.__captiontext&&(this.caption=this.__captiontext)},remove:function(){for(var t in this.__visiblePrimitives)this.__visiblePrimitives[t].visible=!1;for(var t in this.__overlay_objects.objects)this.__overlay_objects.objects[t].visible=!1;this.wrapper.remove()},__handleEvents:function(){var t=this,e=t.elements;e.bind("mouseenter mouseleave",function(e){t.trigger("mouse",e)});var n={shift:16,ctrl:17,alt:18};$(document).bind("keydown keyup",function(e){for(var a in n)if(n[a]==e.which){t.mouse[a]="keydown"==e.type;break}t.__expecting_key&&(e.event=e.type,20==e.which&&"keydown"==e.type&&(r=!r),e.shift=t.mouse.shift||r,e.key=i[e.which],r&&65<=e.which&&e.which<=90?e.key=s[e.which]:t.mouse.shift&&(e.key=s[e.which]),e.alt=t.mouse.alt,e.ctrl=t.mouse.ctrl,t.trigger(e.type,e))})},waitfor:function(t,e){return a=this,_=this.__expecting_key,t.search("key")>=0?(n=t,this.__expecting_key=!0):(n="",this.__expecting_key=!1),"textures"==t&&(this.waitfor_textures=!0),this.events.waitfor(t,e)},pause:function(t){a=this,_=this.__expecting_key,n="";var e,i="";if(1==arguments.length?e=arguments[0]:(i=arguments[0],e=arguments[1]),i.length>0)void 0==this.__prompt&&(this.__prompt=label({canvas:this,align:"right",pixel_pos:!0,height:14,color:color.black,background:color.white,opacity:1,box:!1})),this.__prompt.pos=vec(this.__width,this.__height-12,0),this.__prompt.text=i,this.__prompt.visible=!0,this.events.pause(this.__prompt,e);else{void 0==this.__draw&&(this.__draw=draw({canvas:this}));var s=this.width-5,r=this.height-20;this.__draw.points=[vec(s,r,0),vec(s-30,r-13,0),vec(s-30,r+15,0),vec(s,r,0)],this.__draw.opacity=1,this.__draw.color=color.black,this.__draw.fillcolor=color.white,this.__draw.visible=!0,this.events.pause(this.__draw,e)}},select:function(){window.__context.canvas_selected=this},title_anchor:{get:function(){return this.__activated||this.__activate(),this.__title_anchor},set:function(t){throw new Error("Cannot change title_anchor")}},caption_anchor:{get:function(){return this.__activated||this.__activate(),this.__caption_anchor},set:function(t){throw new Error("Cannot change caption_anchor")}},title:{get:function(){return this.__titletext},set:function(t){this.__titletext=t,this.__title_anchor.html(t)}},caption:{get:function(){return this.__captiontext},set:function(t){this.__captiontext=t,this.__caption_anchor.html(t)}},append_to_title:function(t){for(var e="",i=arguments.length,s=0;s<i;s++)e+=print_to_string(arguments[s])+" ";e=e.slice(0,-1),this.__titletext+=e,this.__title_anchor.append(e)},append_to_caption:function(t){for(var e="",i=arguments.length,s=0;s<i;s++)e+=print_to_string(arguments[s])+" ";e=e.slice(0,-1),this.__captiontext+=e,this.__caption_anchor.append(e)},bind:function(t,e){return t.search("key")>=0&&(this.__expecting_key=!0),this.events.bind(t,e)},unbind:function(t,e){return t.search("key")>=0&&(this.__expecting_key=!1),this.events.unbind(t,e)},one:function(t,e){return this.events.one(t,e)},trigger:function(t,e){if(void 0===e&&(e={type:t,event:event}),"mouse"==t){t=e.type;var e={type:t,pageX:e.pageX,pageY:e.pageY,which:1};this.mouse.__update(e),e.event=e.type,e.pos=this.mouse.pos,"mousedown"==e.type?(e.press="left",e.release=null):"mousemove"==e.type?(e.press=null,e.release=null):"mouseup"==e.type?(e.press=null,e.release="left"):"mouseenter"==e.type||"mouseleave"==e.type?(e.press=null,e.release=null):"click"==e.type&&(e.press=null,e.release="left")}null!==e&&(e.canvas=this);var i=new $.Event(t,e);this.events.trigger(i)},background:new vec(0,0,0),opacity:1,ambient:new vec(.2,.2,.2),__change:function(){null!==this.__lastevent&&this.hasmouse&&this.mouse.__update(this.__lastevent)},center:new attributeVector(null,0,0,0),forward:new attributeVector(null,0,0,(-1)),up:new attributeVector(null,0,1,0),__last_forward:null,__last_center:null,__activated:!1,userzoom:!0,userspin:!0,fov:60*Math.PI/180,width:{value:480,onchanged:function(){this.__canvas_element.width=this.__canvas_element.style.width=this.__overlay_element.width=this.__overlay_element.style.width=this.__width}},height:{value:300,onchanged:function(){this.__canvas_element.height=this.__canvas_element.style.height=this.__overlay_element.height=this.__overlay_element.style.height=this.wrapper[0].style.height=this.__height}},align:{get:function(){return this.__align},set:function(t){if("left"!=t&&"right"!=t&&"none"!=t)throw new Error("align must be 'left', 'right', or 'none' (the default).");this.__align=t}},resizable:{value:!0,onchanged:function(){this.__activated&&this.wrapper.resizable((this.resizable?"en":"dis")+"able")}},autoscale:{get:function(){return this.__autoscale},set:function(t){this.__autoscale&&!t&&Autoscale.compute_autoscale(this),this.__autoscale=t}},range:{get:function(){return this.__autoscale&&Autoscale.compute_autoscale(this),this.__range},set:function(t){this.__autoscale=!1,this.__range=t,null!==this.__lastevent&&this.mouse.__update(this.__lastevent)}},pixel_to_world:{get:function(){var t=this.__width,e=this.__height,i=2*this.range;return t>=e?i/e:i/t},set:function(t){throw new Error("Cannot assign a value to pixel_to_world.")}},objects:{get:function(){var t=[];for(var e in this.__visiblePrimitives){var i=this.__visiblePrimitives[e];i.__obj?i==i.__obj.__components[0]&&i.__obj.visible&&t.push(i.__obj):t.push(i)}for(var e in this.__overlay_objects.objects){var s=this.__overlay_objects.objects[e];s instanceof label&&t.push(s)}return t}}}),property.declare(t,{selected:{get:function(){return window.__context.canvas_selected||null},set:function(t){window.__context.canvas_selected=t}},get_selected:function(){return window.__context.canvas_selected||null},all:{get:function(){var t=window.__context.canvas_all;return void 0===t&&(t=window.__context.canvas_all=[]),t}},container:{get:function(){return window.__context.glowscript_container||null},set:function(t){window.__context.glowscript_container=$(t)}}}),property.declare(e.prototype,{canvas:null,pos:null,ray:null,__pickx:null,__picky:null,pick:function(){return this.canvas.__renderer.render(1)},project:function(t){if(void 0===t.normal)throw new Error("scene.mouse.project() must specify a normal");var e,i=t.normal;void 0===t.d&&void 0===t.point?e=i.dot(this.canvas.__center):void 0!==t.d?e=t.d:void 0!==t.point&&(e=i.dot(t.point));var s=i.dot(this.canvas.camera.pos)-e,n=i.dot(this.ray);if(0==n)return null;var a=-s/n;return this.canvas.camera.pos.add(this.ray.multiply(a))},alt:!1,ctrl:!1,shift:!1,__update:function(e){var i,s=this.canvas;i=s.__width>s.__height?2*s.__range/s.__height:2*s.__range/s.__width;var n=$(s.__canvas_element).offset();this.__pickx=e.pageX-n.left,this.__picky=s.__height-(e.pageY-n.top);var a=(this.__pickx-s.__width/2)*i,_=(this.__picky-s.__height/2)*i,r=s.__forward.norm().cross(s.__up).norm(),o=r.cross(s.__forward.norm());this.pos=s.__center.add(r.multiply(a).add(o.multiply(_))),this.ray=this.pos.sub(s.camera.pos).norm(),t.hasmouse=s,s.__lastevent=e}});var o={canvas:t};Export(o)}();
!function(){"use strict";function e(n,t){return this instanceof e?(this.canvas=n,void(this.follower=null)):new e(n,t)}property.declare(e.prototype,{pos:{get:function(){var e=this.canvas;return e.center.sub(e.forward.norm().multiply(e.range/Math.tan(e.fov/2)))},set:function(e){var n=this.canvas;n.center=e.add(this.axis)}},axis:{get:function(){var e=this.canvas;return e.forward.norm().multiply(e.range/Math.tan(e.fov/2))},set:function(e){var n=this.canvas;n.center=this.pos.add(e),n.forward=norm(e),n.range=mag(e)*Math.tan(n.fov/2)}},rotate:function(e){if(void 0===e||void 0===e.angle)throw new Error("object.rotate() requires an angle");var n,t,r=e.angle;n=void 0===e.axis?this.axis.norm():e.axis.norm(),t=void 0===e.origin?this.pos:e.origin,this.pos=t.add(this.pos.sub(t).rotate({angle:r,axis:n})),this.axis=this.axis.rotate({angle:r,axis:n})},follow:function(e){this.follower=e},__activate:function(){var e,n,t,r,a,i=this.canvas,o=!1,l=[null,null],u=[null,null],s=[null,null],c=[null,null],g=0,h=0,f=!1,p=!1,m=!1,v=null,d=null,w=0,_=!1,b=[null,null],x=function(e){var n=Math.exp(.05*-e);i.range=i.range*n},M=function(e){i.up=i.up.rotate({angle:2*e,axis:i.__forward})},Y=function(e){var n=e.pageX-l[0],t=e.pageY-u[0];g+=.01*n,h+=.01*t,h<-1.4&&(h=-1.4),h>1.4&&(h=1.4),i.__forward=i.__forward.rotate({angle:-.01*n,axis:i.up});var r=i.up.diff_angle(i.__forward.multiply(-1)),a=.01*t;a>=r||a<=r-Math.PI||(i.__forward=i.__forward.rotate({angle:-a,axis:i.__forward.cross(i.__up)}))};$(document).bind("contextmenu",function(e){return!o}),i.elements.mousewheel(function(e,n){return i.userzoom&&x(n),!1}),i.elements.mousedown(function(n){if(1==n.which&&(p=!0),3==n.which&&(m=!0),e=i.userspin&&(3==n.which||1==n.which&&i.mouse.ctrl&&!i.mouse.alt),t=i.userzoom&&(2==n.which||1==n.which&&i.mouse.alt&&!i.mouse.ctrl||p&&m),3!=n.which||e||t)return s[0]=l[0]=n.pageX,c[0]=u[0]=n.pageY,e||t?o=!0:1==n.which&&i.trigger("mouse",n),f=!0,n.preventDefault(),n.stopPropagation(),!1}),i.elements.mousemove(function(n){if(n.pageX!==l[0]||n.pageY!==u[0]){if(!f)return void i.mouse.__update(n);if(t){var r=u[0]-n.pageY;0!==r&&x(.1*r)}else e?Y(n):1==n.which&&i.trigger("mouse",n);l[0]=n.pageX,u[0]=n.pageY}}),i.elements.mouseup(function(n){if(1==n.which&&(p=!1),3==n.which&&(m=!1),f){if(3==n.which&&o&&setTimeout(function(){o=!1},0),!e&&!t)if(1==n.which)i.trigger("mouse",n),abs(n.pageX-s[0])<=5&&abs(n.pageY-c[0])<=5&&(n.type="click",i.trigger("mouse",n));else if(3==n.which)return void(o=!0);e=t=f=!1,l=[null,null],u=[null,null]}}),i.elements.bind("touchstart",function(n){e=t=_=!1,v=d=null;var o,g=n.originalEvent.targetTouches;if(!(g.length>2)&&(2!=g.length||i.userspin||i.userzoom)){w++;for(var h=0;h<g.length;h++)o=g[h],s[h]=l[h]=o.clientX,c[h]=u[h]=o.clientY,b[h]=vec(s[h],c[h],0);return v=null,a={type:"mousedown",pageX:s[0],pageY:c[0],which:1},i.userspin||i.userzoom||(i.trigger("mouse",a),a=null),r=msclock(),n.preventDefault(),n.stopPropagation(),!1}}),i.elements.bind("touchmove",function(o){if(_)return void i.mouse.__update(o);var g=msclock()-r,h=o.originalEvent.targetTouches;if(!(h.length>2)){for(var f,p=[null,null],m=[null,null],w=[0,0],X=[0,0],y=0;y<h.length;y++)f=h[y],p[y]=f.clientX,m[y]=f.clientY,w[y]=p[y]-s[y],X[y]=m[y]-c[y];if(2==h.length){if(!i.userspin&&!i.userzoom)return;var z=[null,null];if(!t){n=!1;for(var y=0;y<2;y++)z[y]=vec(p[y],m[y],0).sub(b[y]);if(!(z[0].mag>15||z[1].mag>15))return;a=null,t=!0;var E=b[1].sub(b[0]).norm(),k=E.cross(z[1]).sub(E.cross(z[0])).mag;k>10&&(n=i.userspin,i.userspin||(t=!1))}}if(null!==a)if(2==h.length)a=null;else{var T=w[0]<=5&&X[0]<=5;!e&&g>150&&T?(i.trigger("mouse",a),a=null):T||(e=i.userspin,a=null)}else{if(p[0]===l[0]&&m[0]===u[0]&&p[1]===l[1]&&m[1]===u[1])return;if(o.pageX=p[0],o.pageY=m[0],o.type="mousemove",e)Y(o);else if(t){var P=p[1]-p[0],q=m[1]-m[0];if(n){var D=Math.atan2(q,P);if(null!==d){var j,I=vec(Math.cos(d),Math.sin(d),0),$=vec(Math.cos(D),Math.sin(D),0),A=I.cross($),B=Math.abs(Math.asin(A.mag));j=A.z>=0?-B:B,M(j)}d=D}else if(i.userzoom){var C=Math.sqrt(P*P+q*q);null!==v&&C!=v&&x(.2*(C-v)),v=C}}else i.trigger("mouse",o)}l[0]=p[0],l[1]=p[1],u[0]=m[0],u[1]=m[1]}}),i.elements.bind("touchend",function(n){w--,null===a||e||t||(i.trigger("mouse",a),a=null);var r=n.originalEvent.changedTouches;n.pageX=r[0].clientX,n.pageY=r[0].clientY,e||t||(n.type="mouseup",i.trigger("mouse",n),abs(n.pageX-s[0])<=5&&abs(n.pageY-c[0])<=5&&(n.type="click",i.trigger("mouse",n))),t&&(w>0?_=!0:t=_=!1),e=!1,l=[null,null],u=[null,null],v=d=null})}});var n={orbital_camera:e};Export(n)}();
!function(){"use strict";function a(){}$.extend(a.prototype,{xmin:null,ymin:null,zmin:null,xmax:null,ymax:null,zmax:null,zx_camera:0,zy_camera:0,last_zx_camera:-1,last_zy_camera:-1,point_extent:function(a,_){this.xmin=Math.min(_.x,this.xmin),this.ymin=Math.min(_.y,this.ymin),this.zmin=Math.min(_.z,this.zmin),this.xmax=Math.max(_.x,this.xmax),this.ymax=Math.max(_.y,this.ymax),this.zmax=Math.max(_.z,this.zmax),a.__xmin=Math.min(_.x,a.__xmin),a.__ymin=Math.min(_.y,a.__ymin),a.__zmin=Math.min(_.z,a.__zmin),a.__xmax=Math.max(_.x,a.__xmax),a.__ymax=Math.max(_.y,a.__ymax),a.__zmax=Math.max(_.z,a.__zmax)}});var _={Autoscale:{compute_autoscale:function(_){var t=_.__extent;t||(t=_.__extent=new a);var e=_.center.x,m=_.center.y,n=_.center.z,i=_.__visiblePrimitives;t.zx_camera=0,t.zy_camera=0;var r=1/Math.tan(_.__fov/2);t.__cot_hfov=r,t.__centerx=_.center.x,t.__centery=_.center.y,t.__centerz=_.center.z;var x,c=!1;for(var h in i)if(x=i[h],"point"!=x.constructor.name&&"points"!=x.constructor.name){if(c=!0,_.__changed[x.__id]||null===x.__zx_camera||null===x.__zy_camera){if(x.__get_extent(t),null===x.__xmin)continue;var z=Math.max(Math.abs(x.__xmin-e),Math.abs(x.__xmax-e)),s=Math.max(Math.abs(x.__ymin-m),Math.abs(x.__ymax-m)),o=Math.max(Math.abs(x.__zmin-n),Math.abs(x.__zmax-n));x.__zx_camera=z*r+o,x.__zy_camera=s*r+o}t.zx_camera=Math.max(t.zx_camera,x.__zx_camera),t.zy_camera=Math.max(t.zy_camera,x.__zy_camera)}if(c&&(t.zx_camera>t.last_zx_camera||t.zx_camera<t.last_zx_camera/3||t.zy_camera>t.last_zy_camera||t.zy_camera<t.last_zy_camera/3)){var y=t.zx_camera*_.__height/_.__width;y>t.zy_camera?_.__width>=_.__height?_.__range=1.1*(_.__height/_.__width)*t.zx_camera/r:_.__range=1.1*t.zx_camera/r:_.__width>=_.__height?_.__range=1.1*t.zy_camera/r:_.__range=1.1*(_.__width/_.__height)*t.zy_camera/r,t.last_zx_camera=t.zx_camera,t.last_zy_camera=t.zy_camera}},find_extent:function(a,_){if("points"!=a.constructor.name){var t,e=a.__size,m=e.x,n=e.y,i=e.z,r=a.__pos,x=r.x,c=r.y,h=r.z,z=a.__hasPosAtCenter;t=z?Math.sqrt(m*m+n*n+i*i)/2:Math.sqrt(m*m+n*n/4+i*i/4);var s=x-_.__centerx,o=c-_.__centery,y=h-_.__centerz,l=(Math.abs(s)+t)*_.__cot_hfov+Math.abs(y)+t,u=(Math.abs(o)+t)*_.__cot_hfov+Math.abs(y)+t;if(!(l<_.zx_camera&&u<_.zy_camera)){var M=a.__axis.norm(),d=a.__up.norm();z&&(r=r.sub(M.multiply(m/2)));var p=M.multiply(m),v=M.cross(d).norm();v.dot(v)<1e-10&&(v=M.cross(vec(1,0,0)).norm(),v.dot(v)<1e-10&&(v=M.cross(vec(0,1,0)).norm()));var f=v.cross(M),b=r.add(f.multiply(-n/2).add(v.multiply(-i/2))),g=b.add(f.multiply(n)),w=b.add(v.multiply(i)),q=g.add(v.multiply(i)),A=b.add(p),P=g.add(p),C=w.add(p),E=q.add(p);_.point_extent(a,b),_.point_extent(a,g),_.point_extent(a,w),_.point_extent(a,q),_.point_extent(a,A),_.point_extent(a,P),_.point_extent(a,C),_.point_extent(a,E)}}}}};Export(_)}();
!function(){"use strict";function e(e,r,t){function A(e,r,t){function a(e,r,t){var a=t.createShader(r);if(t.shaderSource(a,e),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS))throw alert(t.getShaderInfoLog(a)),new Error("Shader compile error");return a}var i=a(r,t.VERTEX_SHADER,t),n=a(e,t.FRAGMENT_SHADER,t),_=t.createProgram();if(t.attachShader(_,i),t.attachShader(_,n),t.linkProgram(_),!t.getProgramParameter(_,t.LINK_STATUS))throw alert(t.getProgramInfoLog(_)),new Error("Shader link error");var s=t.getProgramParameter(_,t.ACTIVE_UNIFORMS);_.uniforms={};for(var o=0;o<s;o++){var f=t.getActiveUniform(_,o),u=f.name;"[0]"==u.substring(u.length-3)&&(u=u.substring(0,u.length-3)),_.uniforms[u]=t.getUniformLocation(_,u)}var l=t.getProgramParameter(_,t.ACTIVE_ATTRIBUTES);_.attributes={};for(var o=0;o<l;o++){var f=t.getActiveAttrib(_,o);_.attributes[f.name]=t.getAttribLocation(_,f.name)}return _}function x(e){return 0===(e&e-1)}function T(e){--e;for(var r=1;r<32;r<<=1)e|=e>>r;return e+1}function F(r,t,a){var i,n,_;a?(i=t.__tex.bumpmap,_=t.__tex.bumpmap_ref,n=t.__tex.bumpmap_t0):(i=t.__tex.file,_=t.__tex.texture_ref,n=t.__tex.texture_t0);var s=msclock();if(s-=n,i in e.textures)_.reference=e.textures[i];else{if(e.textures[i]=_.reference=U.createTexture(),U.bindTexture(U.TEXTURE_2D,_.reference),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,!0),!x(r.width)||!x(r.height)){var o=document.createElement("canvas");o.width=T(r.width),o.height=T(r.height);var f=o.getContext("2d");f.drawImage(r,0,0,o.width,o.height),r=o}U.texImage2D(U.TEXTURE_2D,0,U.RGBA,U.RGBA,U.UNSIGNED_BYTE,r),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR_MIPMAP_NEAREST),U.generateMipmap(U.TEXTURE_2D),U.bindTexture(U.TEXTURE_2D,null)}if(i in e.textures_requested)for(var u=e.textures_requested[i];u.length>0;){var l=u.pop();l[1]?l[0].__tex.bumpmap_ref.reference=_.reference:l[0].__tex.texture_ref.reference=_.reference,l[0].__change()}}function B(r){U.activeTexture(ke[r]),U.bindTexture(U.TEXTURE_2D,Me[r]),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texImage2D(U.TEXTURE_2D,0,U.RGBA,Ce*e.__width,Ce*e.__height,0,U.RGBA,U.UNSIGNED_BYTE,null),U.bindTexture(U.TEXTURE_2D,null)}function g(){var t=v>0,i=msclock(),n=0;t&&(n=i-v),v=i,e.trigger("redraw",{dt:n}),D.render(a),i=msclock(),n=0,t&&(n=i-E),E=i,t?(h=.95*h+.05*(i-v),b=.95*b+1e3/n*.05):(h=i-v,b=0);var _=b*h;$("#fps").text(b.toFixed(1)+" renders/s * "+h.toFixed(1)+" ms/render = "+_.toFixed(1)+" ms rendering/s"),e.trigger("draw_complete",{dt:n}),e.__last_center=e.__center,e.__last_forward=e.__forward,e.__last_range=e.__range,e.__last_up=e.__up,window.requestAnimFrame(g,r)}var D=this,U=WebGLUtils.setupWebGL(r);if(!U)throw new Error("Can't create canvas: WebGL not supported");e.overlay_context=t.getContext("2d");var w=8,y=new Float32Array(4*w),Y=new Float32Array(3*w),N=new Float32Array(3),C=new Float32Array(2),M=new Array(4),P=new Uint8Array(4),k=null,I=null,X=null,L=null,S=null,j=null,O=null,G=null,q=null,W=null,z=null,H=null,V=null,K=null,Q=null,J=null,Z=null,ee=null,re=null,te=null,ae=null,ie=null,ne=null,_e=null,se=null,oe=null,fe=null,ue=null,le=null,de=null,ce=null,Re=null,pe=null,me=null,be=null,he=null,ve=function(e,r){r?this.dynamism=U.DYNAMIC_DRAW:this.dynamism=U.STATIC_DRAW,this.elementType=U.TRIANGLES,this.mesh=e,this.model_transparent=e.model_transparent,this.pos=new Float32Array(e.pos),this.normal=new Float32Array(e.normal),this.color=new Float32Array(e.color),this.opacity=new Float32Array(e.opacity),this.shininess=new Float32Array(e.shininess),this.emissive=new Float32Array(e.emissive),this.texpos=new Float32Array(e.texpos),this.bumpaxis=new Float32Array(e.bumpaxis),this.index=new Uint16Array(e.index),this.posBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.posBuffer),U.bufferData(U.ARRAY_BUFFER,this.pos,this.dynamism),this.normalBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.normalBuffer),U.bufferData(U.ARRAY_BUFFER,this.normal,this.dynamism),this.colorBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.colorBuffer),U.bufferData(U.ARRAY_BUFFER,this.color,this.dynamism),this.opacityBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.opacityBuffer),U.bufferData(U.ARRAY_BUFFER,this.opacity,this.dynamism),this.shininessBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.shininessBuffer),U.bufferData(U.ARRAY_BUFFER,this.shininess,this.dynamism),this.emissiveBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.emissiveBuffer),U.bufferData(U.ARRAY_BUFFER,this.emissive,this.dynamism),this.texposBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.texposBuffer),U.bufferData(U.ARRAY_BUFFER,this.texpos,this.dynamism),this.bumpaxisBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.bumpaxisBuffer),U.bufferData(U.ARRAY_BUFFER,this.bumpaxis,this.dynamism),this.indexBuffer=U.createBuffer(),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,this.indexBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,this.index,this.dynamism)},Ee=new ve(Mesh.makeCube(),(!1)),Ae=new ve(Mesh.makeCylinder(.5),(!1)),xe=new ve(Mesh.makeSphere(.5,30,!1),(!1)),Te=new ve(Mesh.makePyramid(),(!1)),Fe=new ve(Mesh.makeCone(.5),(!1)),Be=new ve(Mesh.makeRing(.45,.05),(!1)),ge={triangle:new ve(e.__vertices,(!0)),quad:new ve(Mesh.makeQuad(),(!1)),curve:new ve(Mesh.makeCurveSegment(1),(!1))};"vpython"==window.__GSlang?(ge.vp_box=Ee,ge.vp_pyramid=Te,ge.vp_cylinder=Ae,ge.vp_cone=Fe,ge.vp_sphere=xe,ge.vp_ellipsoid=xe,ge.vp_ring=Be):(ge.box=Ee,ge.pyramid=Te,ge.cylinder=Ae,ge.cone=Fe,ge.sphere=xe,ge.ring=Be);var De=this.models={};for(var Ue in ge)De[Ue]=ge[Ue];this.add_model=function(e,r){var t=e.__mesh_id;De[t]=ge[t]=new ve(e,r),De[t].id_object={}},this.remove_model=function(e,r){var t=e.__mesh_id;delete De[t],delete ge[t]},this.screenshot=function(t){e.waitfor("draw_complete",function(e){var a=new Image;a.src=r.toDataURL(),t(e,a)})},this.reset=function(){for(var e in ge)ge[e].id_object={}};var we={target:vec3.create([0,0,0]),up:vec3.create([0,1,0]),fovy:60,angleX:0,angleY:0,distance:1};this.reset(),this.initTexture=function(r,t,a){if(a?t.__tex.bumpmap=r:t.__tex.file=r,r in e.textures)return void(a?t.__tex.bumpmap_ref.reference=e.textures[r]:t.__tex.texture_ref.reference=e.textures[r]);if(r in e.textures_requested)return void e.textures_requested[r].push([t,a]);e.textures_requested[r]=[[t,a]];var i=msclock();a?t.__tex.bumpmap_t0=i:t.__tex.texture_t0=i;var n=new Image;n.crossOrigin="anonymous",n.src=r,n.onload=function(){F(n,t,a)}};var ye=0,Ye=-1,Ne=-1,Ce=1,Me={C0:null,D0:null,C1:null,D1:null,C2:null,D2:null,C3:null,D3:null,C4:null,EXTENT_TEXTURE:null},Pe=U.getParameter(U.MAX_TEXTURE_IMAGE_UNITS)>=16,ke={C0:U.TEXTURE2,D0:U.TEXTURE3,C1:U.TEXTURE4,D1:U.TEXTURE5,C2:U.TEXTURE6,D2:U.TEXTURE7,C3:U.TEXTURE8,D3:U.TEXTURE9,C4:U.TEXTURE10,EXTENT_TEXTURE:U.TEXTURE11};for(var Ie in Me)Me[Ie]=U.createTexture(),B(Ie);var Xe=U.createFramebuffer();U.bindFramebuffer(U.FRAMEBUFFER,Xe);var Le=U.createRenderbuffer();U.bindRenderbuffer(U.RENDERBUFFER,Le),U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,Ce*e.__width,Ce*e.__height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,Le),U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null),Ye=e.__width,Ne=e.__height;var Se=new Uint8Array(3),je=U.createTexture();U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,je),U.texImage2D(U.TEXTURE_2D,0,U.RGB,1,1,0,U.RGB,U.UNSIGNED_BYTE,Se);var Oe=U.createTexture();U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,Oe),U.texImage2D(U.TEXTURE_2D,0,U.RGB,1,1,0,U.RGB,U.UNSIGNED_BYTE,Se),this.render=function(t){function b(e,r,t){if(void 0===t.__owner||t.__owner.__vis){var a=e[r];void 0===a&&(a=e[r]=[t]),3==$e?a.push(t.v0.__id,t.v1.__id,t.v2.__id):a.push(t.v0.__id,t.v1.__id,t.v2.__id,t.v0.__id,t.v2.__id,t.v3.__id)}}function h(e,r){Rr=e,U.useProgram(e),U.enableVertexAttribArray(e.attributes.pos),(t==m||r>o)&&U.uniform2fv(e.uniforms.canvas_size,C),r!=m&&(t!=a&&r!=s&&r!=f&&r!=l&&r!=c&&r!=p||(U.uniform1i(e.uniforms.light_count,Se),U.uniform4fv(e.uniforms.light_pos,y),U.uniform3fv(e.uniforms.light_color,Y),U.uniform3fv(e.uniforms.light_ambient,N),U.enableVertexAttribArray(e.attributes.normal),e!=I&&(U.enableVertexAttribArray(e.attributes.color),U.enableVertexAttribArray(e.attributes.opacity),U.enableVertexAttribArray(e.attributes.shininess),U.enableVertexAttribArray(e.attributes.emissive),U.enableVertexAttribArray(e.attributes.texpos),U.enableVertexAttribArray(e.attributes.bumpaxis),U.uniform1i(e.uniforms.texmap,0),U.uniform1i(e.uniforms.bumpmap,1))),U.uniformMatrix4fv(e.uniforms.viewMatrix,!1,Ie),U.uniformMatrix4fv(e.uniforms.projMatrix,!1,Ue)),r==m?(U.uniform1i(e.uniforms.C0,2),U.uniform1i(e.uniforms.C1,4),Pe&&(U.uniform1i(e.uniforms.C2,6),U.uniform1i(e.uniforms.C3,8),U.uniform1i(e.uniforms.C4,10))):r>o&&(U.uniform1i(e.uniforms.D0,3),r==l||r==d?U.uniform1i(e.uniforms.D1,5):r==c||r==R?U.uniform1i(e.uniforms.D2,7):r==p&&U.uniform1i(e.uniforms.D3,9))}function v(r,b,v){function E(){var _=ge.curve,f=_.id_object,u=_.elementType,l=_.index.length,d=!0;for(var c in f){if(!f[c].visible)break;if(r>o)break;d&&(r==a||r==s?(null==I&&(I=A(shaders.opaque_render_fragment,shaders.curve_render_vertex,U)),h(I,r)):r==o?(null==le&&(le=A(shaders.peel_depth_fragmentD0,shaders.curve_peel_depth_vertex,U)),h(le,r)):r==i&&(null==ce&&(ce=A(shaders.pick_fragment,shaders.curve_pick_vertex,U)),h(ce,r)),U.bindBuffer(U.ARRAY_BUFFER,_.posBuffer),U.vertexAttribPointer(Rr.attributes.pos,4,U.FLOAT,!1,0,0),r!=i&&r<o&&(U.bindBuffer(U.ARRAY_BUFFER,_.normalBuffer),U.vertexAttribPointer(Rr.attributes.normal,3,U.FLOAT,!1,0,0)),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,_.indexBuffer),t==n&&(u=U.POINTS),d=!1);var R=f[c],p=R.__points,m=p.length,b=R.__data[15];0===b&&(R.__data[15]=4*e.__range/e.__width),U.uniform4fv(Rr.uniforms.objectData,R.__data);for(var v=1;v<m;v++){var E=p[v];if(E.visible){var x=E.__prevsegment;if(t==i)for(var T=E.__falsecolor,F=0;F<4;F++)M[F]=x[8+F],M[F+4]=x[12+F],x[12+F]=x[8+F]=T[F];if(U.uniform4fv(Rr.uniforms.segmentData,x),U.drawElements(u,l,U.UNSIGNED_SHORT,0),t==i)for(var F=0;F<8;F++)x[8+F]=M[F]}}R.__data[15]=b}}function x(){var m=ge.triangle,b=m.elementType,v=e.__vertices;if(t==i)return null==Re&&(Re=A(shaders.pick_fragment,shaders.tri_pick_vertex,U)),h(Re,r),v={},v.pos=new Float32Array(sr.pos),v.color=new Float32Array(sr.color),w=new Uint16Array(sr.index),y=w.length,U.bindBuffer(U.ARRAY_BUFFER,m.posBuffer),U.bufferData(U.ARRAY_BUFFER,v.pos,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.pos,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,m.colorBuffer),U.bufferData(U.ARRAY_BUFFER,v.color,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.color,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,m.indexBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,w,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.color,4,U.FLOAT,!1,0,0),U.drawElements(b,y,U.UNSIGNED_SHORT,0),U.bindBuffer(U.ARRAY_BUFFER,m.posBuffer),U.bufferData(U.ARRAY_BUFFER,e.__vertices.pos,U.DYNAMIC_DRAW),U.bindBuffer(U.ARRAY_BUFFER,m.colorBuffer),void U.bufferData(U.ARRAY_BUFFER,e.__vertices.color,U.DYNAMIC_DRAW);var E=e.__sort_objects;for(var x in E){if(r>o){if("opaque"==x)continue}else if("transparent"==x)continue;var T=!0;for(var F in E[x])for(var B in E[x][F]){if(T){switch(T=!1,r){case a:case s:null===X&&(X=A(shaders.opaque_render_fragment,shaders.tri_render_vertex,U)),h(X,r);break;case n:null===me&&(me=A(shaders.pick_fragment,shaders.extent_vertex,U)),h(me,r);break;case o:null===ae&&(ae=A(shaders.peel_depth_fragmentD0,shaders.tri_peel_depth_vertex,U)),h(ae,r);break;case u:null===ne&&(ne=A(shaders.peel_depth_fragmentD1,shaders.tri_peel_depth_vertex,U)),h(ne,r);break;case d:null===se&&(se=A(shaders.peel_depth_fragmentD2,shaders.tri_peel_depth_vertex,U)),h(se,r);break;case R:null===fe&&(fe=A(shaders.peel_depth_fragmentD3,shaders.tri_peel_depth_vertex,U)),h(fe,r);break;case f:null===ie&&(ie=A(shaders.peel_color_fragmentC1,shaders.tri_render_vertex,U)),h(ie,r);break;case l:null===_e&&(_e=A(shaders.peel_color_fragmentC2,shaders.tri_render_vertex,U)),h(_e,r);break;case c:null===oe&&(oe=A(shaders.peel_color_fragmentC3,shaders.tri_render_vertex,U)),h(oe,r);break;case p:null===ue&&(ue=A(shaders.peel_color_fragmentC4,shaders.tri_render_vertex,U)),h(ue,r)}U.bindBuffer(U.ARRAY_BUFFER,m.posBuffer),ye&&U.bufferData(U.ARRAY_BUFFER,v.pos,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.pos,3,U.FLOAT,!1,0,0),t!=a&&r!=s&&r!=f&&r!=l&&r!=c&&r!=p||(U.bindBuffer(U.ARRAY_BUFFER,m.normalBuffer),ye&&U.bufferData(U.ARRAY_BUFFER,v.normal,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.normal,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,m.colorBuffer),ye&&U.bufferData(U.ARRAY_BUFFER,v.color,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.color,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,m.opacityBuffer),ye&&U.bufferData(U.ARRAY_BUFFER,v.opacity,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.opacity,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,m.shininessBuffer),ye&&U.bufferData(U.ARRAY_BUFFER,v.shininess,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.shininess,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,m.emissiveBuffer),ye&&U.bufferData(U.ARRAY_BUFFER,v.emissive,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.emissive,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,m.texposBuffer),ye&&U.bufferData(U.ARRAY_BUFFER,v.texpos,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.texpos,2,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,m.bumpaxisBuffer),ye&&U.bufferData(U.ARRAY_BUFFER,v.bumpaxis,U.DYNAMIC_DRAW),U.vertexAttribPointer(Rr.attributes.bumpaxis,3,U.FLOAT,!1,0,0),ye=0)}var g=E[x][F][B],D=g[0],w=new Uint16Array(g.slice(1)),y=w.length;U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,m.indexBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,w,U.DYNAMIC_DRAW),t==n&&(b=U.POINTS);var Y=0,N=0;if("textures"==F){if((t==a||t==_)&&null!==D.__tex.file){if(null===D.__tex.texture_ref.reference)continue;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,D.__tex.texture_ref.reference),Y=1}}else if("bumpmaps"==F){if((t==a||t==_)&&null!==D.__tex.bumpmap){if(null===D.__tex.bumpmap_ref.reference)continue;U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,D.__tex.bumpmap_ref.reference),N=1}}else if("textures_and_bumpmaps"==F){if((t==a||t==_)&&null!==D.__tex.file){if(null===D.__tex.texture_ref.reference)continue;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,D.__tex.texture_ref.reference),Y=1}if((t==a||t==_)&&null!==D.__tex.bumpmap){if(null===D.__tex.bumpmap_ref.reference)continue;U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,D.__tex.bumpmap_ref.reference),N=1}}U.uniform1f(Rr.uniforms.T,Y),U.uniform1f(Rr.uniforms.B,N),U.drawElements(b,y,U.UNSIGNED_SHORT,0)}}}function T(){var e=ge.quad,t=e.elementType,a=e.index.length;Pe?(null==be&&(be=A(shaders.merge_fragment,shaders.merge_vertex,U)),h(be,r)):(null==he&&(he=A(shaders.merge_fragment2,shaders.merge_vertex,U)),h(he,r)),U.bindBuffer(U.ARRAY_BUFFER,e.posBuffer),U.vertexAttribPointer(Rr.attributes.pos,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,e.indexBuffer),U.drawElements(t,a,U.UNSIGNED_SHORT,0)}if(t==_&&v.length>0)for(var F=0;F<v.length;F++){var B=v[F];B!=b&&(U.activeTexture(ke[B]),U.bindTexture(U.TEXTURE_2D,Me[B]))}null===b?U.bindFramebuffer(U.FRAMEBUFFER,null):(U.bindFramebuffer(U.FRAMEBUFFER,Xe),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,Me[b],0)),U.viewport(0,0,C[0],C[1]),U.enable(U.DEPTH_TEST),t==i||r>s?U.clearColor(0,0,0,0):t==n?U.clearColor(0,0,0,1):U.clearColor(e.__background.x,e.__background.y,e.__background.z,e.__opacity),t==n?(U.depthFunc(U.GREATER),U.clearDepth(0)):(U.depthFunc(U.LEQUAL),U.clearDepth(1)),U.clear(U.COLOR_BUFFER_BIT|U.DEPTH_BUFFER_BIT);for(var g in ge){if(r>=m){T();break}if("quad"!=g&&"triangle"!=g)if("curve"!=g){var D,w=ge[g],y=w.elementType,Y=w.index.length;if(r>o){if(void 0===e.__transparent_objects[g])continue;D=e.__transparent_objects[g]}else{if(void 0===e.__opaque_objects[g])continue;D=e.__opaque_objects[g]}var N=!1;for(var P in D){N=!0;break}if(N){var $="ring"==g||"vp_ring"==g;switch(r){case a:case s:$?(null===L&&(L=A(shaders.opaque_render_fragment,shaders.ring_render_vertex,U)),h(L,r)):(null===k&&(k=A(shaders.opaque_render_fragment,shaders.render_vertex,U)),h(k,r));break;case i:$?(null===pe&&(pe=A(shaders.pick_fragment,shaders.ring_pick_vertex,U)),h(pe,r)):(null===de&&(de=A(shaders.pick_fragment,shaders.pick_vertex,U)),h(de,r));break;case n:null===me&&(me=A(shaders.pick_fragment,shaders.extent_vertex,U)),h(me,r);break;case o:$?(null===V&&(V=A(shaders.peel_depth_fragmentD0,shaders.ring_peel_depth_vertex,U)),h(V,r)):(null===S&&(S=A(shaders.peel_depth_fragmentD0,shaders.peel_depth_vertex,U)),h(S,r));break;case u:$?(null===Q&&(Q=A(shaders.peel_depth_fragmentD1,shaders.ring_peel_depth_vertex,U)),h(Q,r)):(null===O&&(O=A(shaders.peel_depth_fragmentD1,shaders.peel_depth_vertex,U)),h(O,r));break;case d:$?(null===Z&&(Z=A(shaders.peel_depth_fragmentD2,shaders.ring_peel_depth_vertex,U)),h(Z,r)):(null===q&&(q=A(shaders.peel_depth_fragmentD2,shaders.peel_depth_vertex,U)),h(q,r));break;case R:$?(null===re&&(re=A(shaders.peel_depth_fragmentD3,shaders.ring_peel_depth_vertex,U)),h(re,r)):(null===z&&(z=A(shaders.peel_depth_fragmentD3,shaders.peel_depth_vertex,U)),h(z,r));break;case f:$?(null===K&&(K=A(shaders.peel_color_fragmentC1,shaders.ring_render_vertex,U)),h(K,r)):(null===j&&(j=A(shaders.peel_color_fragmentC1,shaders.render_vertex,U)),h(j,r));break;case l:$?(null===J&&(J=A(shaders.peel_color_fragmentC2,shaders.ring_render_vertex,U)),h(J,r)):(null===G&&(G=A(shaders.peel_color_fragmentC2,shaders.render_vertex,U)),h(G,r));break;case c:$?(null===ee&&(ee=A(shaders.peel_color_fragmentC3,shaders.ring_render_vertex,U)),h(ee,r)):(null===W&&(W=A(shaders.peel_color_fragmentC3,shaders.render_vertex,U)),h(W,r));break;case p:$?(null===te&&(te=A(shaders.peel_color_fragmentC4,shaders.ring_render_vertex,U)),h(te,r)):(null===H&&(H=A(shaders.peel_color_fragmentC4,shaders.render_vertex,U)),h(H,r))}U.bindBuffer(U.ARRAY_BUFFER,w.posBuffer),U.vertexAttribPointer(Rr.attributes.pos,3,U.FLOAT,!1,0,0),t==i||t!=a&&r!=s&&r!=f&&r!=l&&r!=c&&r!=p?$&&(U.bindBuffer(U.ARRAY_BUFFER,w.normalBuffer),U.vertexAttribPointer(Rr.attributes.normal,3,U.FLOAT,!1,0,0)):(U.bindBuffer(U.ARRAY_BUFFER,w.normalBuffer),U.vertexAttribPointer(Rr.attributes.normal,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,w.colorBuffer),U.vertexAttribPointer(Rr.attributes.color,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,w.opacityBuffer),U.vertexAttribPointer(Rr.attributes.opacity,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,w.shininessBuffer),U.vertexAttribPointer(Rr.attributes.shininess,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,w.emissiveBuffer),U.vertexAttribPointer(Rr.attributes.emissive,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,w.texposBuffer),U.vertexAttribPointer(Rr.attributes.texpos,2,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,w.bumpaxisBuffer),U.vertexAttribPointer(Rr.attributes.bumpaxis,3,U.FLOAT,!1,0,0)),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,w.indexBuffer),t==n&&(y=U.POINTS);for(var P in D){var ve=D[P],Ee=ve.__data;if(r<m&&t!=i){if((t==a||t==_)&&null!==ve.__tex.file){if(null===ve.__tex.texture_ref.reference)continue;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,ve.__tex.texture_ref.reference)}if((t==a||t==_)&&null!==ve.__tex.bumpmap){if(null===ve.__tex.bumpmap_ref.reference)continue;U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,ve.__tex.bumpmap_ref.reference)}}if(t==i)for(var Ae=ve.__falsecolor,F=0;F<4;F++)M[F]=Ee[16+F],Ee[16+F]=Ae[F];if(U.uniform4fv(Rr.uniforms.objectData,Ee),U.drawElements(y,Y,U.UNSIGNED_SHORT,0),t==i)for(var F=0;F<4;F++)Ee[16+F]=M[F]}}}else E();else or&&x()}t!=i&&(U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null))}if(t==a&&e.waitfor_textures){var E=e.objects;for(var x in E){var T=E[x];if(void 0!==T.__tex&&!T.ready)return}e.waitfor_textures=!1,e.trigger("textures",null)}if(!e.visible){if(t==a)return;return null}if(e.__width!=Ye||e.__height!=Ne){for(var F in Me)B(F);U.bindFramebuffer(U.FRAMEBUFFER,Xe),U.bindRenderbuffer(U.RENDERBUFFER,Le),U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,Ce*e.__width,Ce*e.__height),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,Le),U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null),Ye=e.__width,Ne=e.__height}for(var g={},D=0;D<2;D++){var $=[];for(var ve in e.__changed){var Ee=e.__changed[ve];if(Ee.__obj){if(!Ee.__obj.visible)continue;$.indexOf(Ee.__obj)<0&&(Ee.__obj.__update(),$.push(Ee.__obj)),g[Ee.__id]=Ee,delete e.__changed[Ee.__id],Ee.__obj.visible||delete Ee.__model.id_object[Ee.__id]}else Ee.__update(),Ee.constructor!=text&&(g[ve]=Ee),delete e.__changed[ve]}}if(e.__changed=g,e.autoscale&&Autoscale.compute_autoscale(e),e.__changed={},null!==e.camera.follower&&(e.center="function"!=typeof e.camera.follower?e.camera.follower.pos:e.camera.follower()),t==a){for(var D in e.arrows){var Ae,xe=e.arrows[D];if(xe.run){if(void 0!==xe.obj){if(void 0===xe.obj.pos)continue;Ae=xe.obj.pos}null!==xe.last_pos&&Ae.equals(xe.last_pos)||(xe.arrow.pos=Ae,void 0!==xe.obj[xe.attr]&&(xe.arrow.visible||(xe.arrow.visible=!0),"vpython"==window.__GSlang?xe.arrow.axis=xe.obj[xe.attr].multiply(xe.scale):xe.arrow.axis_and_length=xe.obj[xe.attr].multiply(xe.scale)))}}for(var D in e.trails){var Ae,xe=e.trails[D];if(xe.__run){var T=xe.__obj;if(void 0!==T){if("string"==typeof T){if(Ae=xe[T],void 0===Ae)continue}else if("function"!=typeof T){if(void 0===T||!T.visible)continue;if(!T._pos_set)continue;if(T.__interval>0)continue;if(void 0===T.__pos)continue;Ae=T.__pos}else Ae=T();if(null===xe.__last_pos||!Ae.equals(xe.__last_pos)){if(xe.pps>0){var Te=msclock();if(null===xe.__last_time&&(xe.last_time=Te),Te-xe.__last_time>1e3/xe.pps)xe.__last_time=Te;else if(Te!=xe.__last_time)continue}xe.__trail.push({pos:Ae,color:xe.color,radius:xe.radius,retain:xe.retain}),xe.__last_pos=vec(Ae)}}}}if(e.update_billboards||!e.__forward.equals(e.__last_forward)||!e.__up.equals(e.__last_up)){e.update_billboards=!1;for(var D=0;D<e.billboards.length;D++){var F=e.billboards[D];if(F.billboard){var Fe=cross(e.__forward,e.__up),Be=cross(Fe,e.forward);"vpython"==window.__GSlang?F.axis=norm(Fe).multiply(mag(F.axis)):F.axis=Fe,F.up=Be}}}}we.target=vec3.create([e.__center.x,e.__center.y,e.__center.z]),we.up=vec3.create([e.__up.x,e.__up.y,e.__up.z]),we.fovy=180*e.__fov/Math.PI;var De=vec(e.__forward.x,0,e.__forward.z).norm();we.angleX=Math.atan2(De.x,-De.z),we.angleY=Math.PI/2-Math.acos(-e.__forward.norm().y),r.clientWidth>=r.clientHeight?we.distance=e.__range/Math.tan(e.__fov/2):we.distance=e.__range*(r.clientHeight/r.clientWidth)/Math.tan(e.__fov/2),we.pos=mat4.multiplyVec3(mat4.rotateX(mat4.rotateY(mat4.identity(mat4.create()),-we.angleX),-we.angleY),vec3.create([0,0,we.distance])),we.pos=vec3.create([e.__center.x+we.pos[0],e.__center.y+we.pos[1],e.__center.z+we.pos[2]]),we.zNear=we.distance/100,we.zFar=10*we.distance;for(var Ue=mat4.perspective(we.fovy,r.clientWidth/r.clientHeight,we.zNear,we.zFar),Ie=mat4.lookAt(we.pos,we.target,we.up),Se=Math.min(e.lights.length,w),D=0;D<Se;D++){var je=e.lights[D];if(void 0===je.direction)var Oe=[je.pos.x,je.pos.y,je.pos.z,1];else var Oe=[je.direction.x,je.direction.y,je.direction.z,0];mat4.multiplyVec4(Ie,Oe);for(var Ee=0;Ee<4;Ee++)y[4*D+Ee]=Oe[Ee];Y[3*D]=je.color.x,Y[3*D+1]=je.color.y,Y[3*D+2]=je.color.z}if(N[0]=e.ambient.x,N[1]=e.ambient.y,N[2]=e.ambient.z,e.__points_objects.length>0)for(var Ge,qe=e.__points_objects,We=3*e.__range/e.__width,D=0;D<qe.length;D++){var ze=qe[D];if(ze.__pixels){if(void 0===ze||ze.__last_range===e.__range)continue;ze.__last_range=e.__range,Ge=0===ze.__radius?10*We:2*We*ze.__radius}else Ge=2*ze.__radius;for(var He=0;He<ze.__points.length;He++)ze.__points[He].size=vec(Ge,Ge,Ge)}if(t==a&&e.__overlay_objects.objects.length>0&&(e.__overlay_objects.__changed||!(e.__forward.equals(e.__last_forward)&&e.__center.equals(e.__last_center)&&e.__up.equals(e.__last_up)&&e.__range==e.__last_range))){e.__overlay_objects.__changed=!1;var Ve=e.overlay_context;Ve.clearRect(0,0,e.__width,e.__height);for(var D=0;D<e.__overlay_objects.objects.length;D++){var T=e.__overlay_objects.objects[D];T.visible&&T.__update(Ve,we)}}var Ke={pos:3,normal:3,color:3,opacity:1,shininess:1,emissive:1,texpos:2,bumpaxis:3},Ee=e.__vertices;for(var ve in e.__vertex_changed){var Qe=e.__vertex_changed[ve],$e=Qe.__id;ye++;for(var Je in Ke){var Ze=Qe["__"+Je];1==Ke[Je]?Ee[Je][$e]=Ze:2==Ke[Je]?(Ee[Je][2*$e]=Ze.x,Ee[Je][2*$e+1]=Ze.y):(Ee[Je][3*$e]=Ze.x,Ee[Je][3*$e+1]=Ze.y,Ee[Je][3*$e+2]=Ze.z)}}e.__vertex_changed={};for(var er in ge)e.__opaque_objects[er]={},e.__transparent_objects[er]={};var rr=!1;for(var er in ge)if("triangle"!=er&&"quad"!=er&&"point"!=er){var tr=ge[er],ar=tr.id_object;for(var ve in ar){var T=ar[ve];"curve"!=er&&t==a&&(T.__data[19]<1||tr.model_transparent)?(e.__transparent_objects[er][ve]=T,rr=!0):e.__opaque_objects[er][ve]=T}}var ir=e.__sort_objects;for(var nr in ir)for(var xe in ir[nr])ir[nr][xe]={};for(var $e,tr,_r=["v0","v1","v2","v3"],sr={pos:[],color:[],index:[]},or=!1,er=0;er<2;er++){0===er?($e=3,tr=ge.triangle):($e=4,tr=ge.quad);var ar=tr.id_object;for(var ve in ar){or=!0;var T=ar[ve];if(t==i){for(var ze,fr=T.__falsecolor,D=0;D<3;D++)ze=T[_r[D]].pos,sr.pos.push(ze.x,ze.y,ze.z),sr.color.push(fr[0],fr[1],fr[2],fr[3]),sr.index.push(sr.index.length);if(4==$e)for(var ur=[0,2,3],lr=0;lr<3;lr++){var D=ur[lr];ze=T[_r[D]].pos,sr.pos.push(ze.x,ze.y,ze.z),sr.color.push(fr[0],fr[1],fr[2],fr[3]),sr.index.push(sr.index.length)}}else if(t==a){for(var dr=!0,D=0;D<$e;D++)if(T[_r[D]].opacity<1){dr=!1;break}var Je=T.__tex.file,cr=T.__tex.bumpmap;dr?null!==Je?(b(ir.opaque.textures,Je,T),null!=cr&&b(ir.opaque.textures_and_bumpmaps,cr,T)):null!=cr?b(ir.opaque.bumpmaps,cr,T):b(ir.opaque.plain,"all",T):(rr=!0,null!==Je?(b(ir.transparent.textures,Je,T),null!=cr&&b(ir.transparent.textures_and_bumpmaps,cr,T)):null!=cr?b(ir.transparent.bumpmaps,cr,T):b(ir.transparent.plain,"all",T))}}}rr&&(t=_);var Rr;if(C[0]=Ce*e.__width,C[1]=Ce*e.__height,t==a?v(t,null,[]):t==i?v(t,"C0",[""]):t==n?v(t,"EXTENT_TEXTURE",[]):t==_&&(v(s,"C0",[]),v(o,"D0",[]),v(f,"C1",["D0"]),Pe?(v(u,"D1",["D0"]),v(l,"C2",["D0","D1"]),v(d,"D2",["D0","D1"]),v(c,"C3",["D0","D2"]),v(R,"D3",["D0","D2"]),v(p,"C4",["D0","D3"]),v(m,null,["C0","C1","C2","C3","C4"])):v(m,null,["C0","C1"])),t==n){U.readPixels(0,0,1,1,U.RGBA,U.UNSIGNED_BYTE,P);var pr=(256*P[1]+P[2])/65536,mr=P[0];mr>128&&(mr=-(mr-128),pr=-pr);var br;return br=0==pr&&0==mr?0:Math.exp(pr+mr),null}if(t==i){U.readPixels(e.mouse.__pickx,e.mouse.__picky,1,1,U.RGBA,U.UNSIGNED_BYTE,P);var ve=16777216*P[0]+65536*P[1]+256*P[2]+P[3],T=e.__visiblePrimitives[ve];if(!T)return null;if(T.__obj&&T.__obj.pickable)return T.__obj;if("point"==T.constructor.name){if(!T.__curve.pickable||!T.pickable)return null;for(var hr=T.__curve.__points,vr=hr.length,D=0;D<vr;D++)if(hr[D]===T)return T=T.__curve,T.pick=D,T.segment=D,T;return null}return T.pickable?T:null}},this.reset(),g()}function r(e,r){if(void 0===r)throw new Error("rate(iterations_per_second, wait) called without wait");x>0?(x--,msclock()>t&&(x=0),x>0?r():setTimeout(r,Math.ceil(1e3/A))):e<=120?setTimeout(r,Math.ceil(1e3/e)):(x=Math.ceil(e/A),t=msclock()+Math.ceil(1e3/A),r())}var t,a=0,i=1,n=2,_=3,s=4,o=5,f=6,u=7,l=8,d=9,c=10,R=11,p=12,m=13,b=0,h=0,v=0,E=0,A=60,x=0,T={WebGLRenderer:e,rate:r};Export(T)}();
!function(){"use strict";function t(t){return Math.log(t)/Math.LN10}function i(i,o){if(0==o.ticks.length){for(var s,e,r=o.tickSize,n=o.min,h=o.max,a=Math.floor((h-n)/r+.5)+1,_=0;_<a;_++)e=abs(n+_*r),(void 0===s||e>s&&0!=e)&&(s=e);p=Math.floor(t(s))+1;var u=Math.floor(t(r))+1;u>3?(l=!0,d=u):u>0?(l=!1,d=0):u<0?(l=!0,d=u,p>=0&&(l=!1,d=-u+1)):(l=!1,d=1)}if(0==i)return"0";if(l){var g,c,f=i*pow(10,-d+1);return g=0,c=d-1,p>d&&(f*=.1,g+=1,c+=1),f.toFixed(g)+"e"+c}return i.toFixed(d)}function o(s){if(!(this instanceof o))return new o(s);if(void 0===s&&(s={}),this.graph_options={series:{shadowSize:0},crosshair:{mode:"xy",color:"rgba(0,0,0,1)"},xaxes:[{position:"bottom",axisLabel:s.xtitle,axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial",axisLabelPadding:10}],yaxes:[{position:"left",axisLabel:s.ytitle,axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial",axisLabelPadding:10}]},this.__width=480,this.__height=300,this.__title="",this.__plot=null,this.__xmin=this.__xmax=this.__ymin=this.__ymax=null,this.wrapper=$("<div/>"),void 0!==s.width&&(this.__width=s.width,delete s.width),void 0!==s.height&&(this.__height=s.height,delete s.height),this.__align="none",void 0!==s.align&&(this.__align=s.align,delete s.align),this.graph_options.xaxis={min:null,max:null,tickFormatter:i},this.graph_options.yaxis={min:null,max:null,tickFormatter:i},void 0!==s.title&&(null!==s.title&&(this.__title=s.title),delete s.title),void 0!==s.xtitle&&(null!==s.xtitle&&(this.__xtitle=s.xtitle),delete s.xtitle),void 0!==s.ytitle&&(null!==s.ytitle&&(this.__ytitle=s.ytitle),delete s.ytitle),this.__foreground=color.black,this.__background=color.gray(.95),void 0!==s.foreground){var e=s.foreground;if(!(e instanceof vec))throw new Error("graph foreground must be a vector.");this.__foreground=e,delete s.foreground}if(void 0!==s.background){var e=s.background;if(!(e instanceof vec))throw new Error("graph background must be a vector.");this.__background=e,delete s.background}this.graph_options.grid={color:color.to_html(this.__foreground),backgroundColor:color.to_html(this.__background)},void 0!==s.xmin&&(this.__xmin=this.graph_options.xaxis.min=s.xmin,delete s.xmin),void 0!==s.xmax&&(this.__xmax=this.graph_options.xaxis.max=s.xmax,delete s.xmax),void 0!==s.ymin&&(this.__ymin=this.graph_options.yaxis.min=s.ymin,delete s.ymin),void 0!==s.ymax&&(this.__ymax=this.graph_options.yaxis.max=s.ymax,delete s.ymax),this.__logx=this.__logy=!1,void 0!==s.logx&&(this.__logx=this.graph_options.logx=s.logx,delete s.logx),void 0!==s.logy&&(this.__logy=this.graph_options.logy=s.logy,delete s.logy),this.__logx&&(this.graph_options.xaxis.transform=function(i){return t(i)},this.graph_options.xaxis.inverseTransform=function(t){return pow(10,t)}),this.__logy&&(this.graph_options.yaxis.transform=function(i){return t(i)},this.graph_options.yaxis.inverseTransform=function(t){return pow(10,t)});var r="",n=0;for(var h in s)n+=1,r+=h+", ";if(r.length>0)throw 1==n?new Error(r.slice(0,r.length-2)+" is not an attribute of a graph"):new Error("These are not attributes of a graph: "+r.slice(0,r.length-2));o.selected=this,this.graph_series=[],this.__activated=!1}function s(t){void 0===t?t={data:[]}:void 0===t.data&&(t.data=[]),this.__color=vec(0,0,0),this.__label=null,this.__delta=1,this.__width=1,this.__radius=3,this.__horizontal=!1,this.__dot=!1,this.__dot_color=null,this.__dot_radius=null,this.__data=[],this.__xmin=null,this.__xmax=null,this.__ymin=null,this.__ymax=null,this.__interval=-1,void 0!==t.graph?(this.__graph=t.graph,delete t.graph):void 0!==t.gdisplay?(this.__graph=t.gdisplay,delete t.gdisplay):(this.__graph=o.selected,this.__graph||(this.__graph=o())),this.__type="line",void 0!==t.type&&(this.__type=t.type,delete t.type);var i=this.__ftype=u[this.__type];if(!i)throw new Error("Unknown series type: "+this.__type);if(this.options={},this.options.data=t.data,delete t.data,this.options[i]={show:!0,align:"center",horizontal:!1,barWidth:1},"scatter"==this.__type?this.options.fill=1:"bar"==this.__type?this.options.fill=.5:this.options.fill=0,void 0!==t.horizontal&&(this.__horizontal=this.options[i].horizontal=t.horizontal,delete t.horizontal),void 0!==t.delta&&(this.__delta=this.options[i].barWidth=t.delta,delete t.delta),void 0!==t.width&&(this.__width=this.options[i].lineWidth=t.width,delete t.width),void 0!==t.color){var s=t.color;if(!(s instanceof vec))throw new Error("graph color must be a vector.");this.__color=s,delete t.color}if(this.options.color=color.to_html(this.__color),"scatter"==this.__type?this.options[i].fillColor=this.options.color:this.options.fillColor=this.options.color,void 0!==t.radius&&(this.__radius=this.options[i].radius=t.radius,delete t.radius),void 0!==t.dot&&(this.__dot=t.dot,delete t.dot),void 0!==t.dot_color){var e=t.dot_color;if(!(e instanceof vec))throw new Error("graph dot_color must be a vector.");this.__dot_color=e,delete t.dot_color}void 0!==t.dot_radius&&(this.__dot_radius=t.dot_radius,delete t.dot_radius),void 0!==t.label&&(this.__label=this.options.label=t.label,delete t.label),void 0!==t.interval&&(this.__interval=t.interval,this.__ninterval=t.interval,delete t.interval),this.options.data.length>0&&(this.__graph.changed=!0),this.__visible=!0,void 0!==t.visible&&(this.__visible=t.visible,delete t.visible);var r="",n=0;for(var h in t)n+=1,r+=h+", ";if(r.length>0)throw 1==n?new Error(r.slice(0,r.length-2)+" is not an attribute of a series"):new Error("These are not attributes of a graph object: "+r.slice(0,r.length-2));this.__graph.add_to_graph(this),this.remove=function(){this.__graph.changed=!0,this.options.data=[]};var a=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},_=function(t){var i,o;if(o=[],"array"!=a(arguments[0]))return 2==arguments.length?[[arguments[0],arguments[1]]]:null;if("array"!=a(arguments[0][0]))for(var s=0;s<arguments.length;s++){if(i=arguments[s],"array"!=a(i)||2!=i.length)return null;o.push(i)}else for(var s=0;s<arguments[0].length;s++){if(i=arguments[0][s],"array"!=a(i)||2!=i.length)return null;o.push(i)}return o},a=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},_=function(t){var i,o;if(o=[],"array"!=a(arguments[0][0]))for(var s=0;s<arguments.length;s++){if(i=arguments[s],"array"!=a(i)||2!=i.length)return null;o.push(i)}else for(var s=0;s<arguments[0].length;s++){if(i=arguments[0][s],"array"!=a(i)||2!=i.length)return null;o.push(i)}return o};this.plot=function(t){if(0!==this.__interval){var i;if(void 0!==t.color)throw new Error("Cannot currently change color in a plot statement.");if(void 0!==t.pos)i=_(t.pos);else if("array"==a(t)&&1==arguments.length)i=_(t);else{for(var o=[],s=0;s<arguments.length;s++)o.push(arguments[s]);i=_("array"==a(o[0])?o:[o])}if(null===i)throw new Error("Must be plot(x,y) or plot(pos=[x,y]) or plot([x,y]) or plot([x,y], ...) or plot([ [x,y], ... ])");if("line"!=this.__type)for(var s=0;s<i.length;s++){if(this.__interval>0){if(this.__ninterval++,!(this.__ninterval>=this.__interval))continue;this.__ninterval=0}this.options.data.push(i[s])}else{var e,r,n,h,l,d,p,u,g,c,f,v=this.__graph,x=v.__xmin,y=v.__xmax,m=v.__ymin,w=v.__ymax;0===this.options.data.length&&(e=i[0],r=e[0],n=e[1],null===x&&(this.__xmin=r),null===y&&(this.__xmax=r),null===m&&(this.__ymin=n),null===w&&(this.__ymax=n),this.__lastx=1e300,this.__lasty=1e300);for(var s=0;s<i.length;s++){if(this.__interval>0){if(this.__ninterval++,!(this.__ninterval>=this.__interval))continue;this.__ninterval=0}e=i[s],r=e[0],n=e[1],null===x&&r<this.__xmin&&(this.__xmin=r),null===y&&r>this.__xmax&&(this.__xmax=r),null===m&&n>this.__ymin&&(this.__ymin=n),null===w&&n<this.__ymax&&(this.__ymax=n),u=null===x?this.__xmin:x,g=null===y?this.__xmax:y,c=null===m?this.__ymin:m,f=null===w?this.__ymax:w,h=v.__width/(g-u),l=v.__height/(f-c),d=h*Math.abs(r-this.__lastx),p=l*Math.abs(n-this.__lasty),d<2&&p<2||(this.__lastx=r,this.__lasty=n,this.options.data.push(e))}}this.__graph.changed=!0,this.__graph.__activate()}}}function e(t){return new s(t)}function r(t){return void 0===t?new o:(void 0!==t.x&&delete t.x,void 0!==t.y&&delete t.y,new o(t))}function n(t){void 0===t&&(t={}),t.type="line",void 0!==t.pos&&(t.data=t.pos,delete t.pos),void 0!==t.size?(t.dot_radius=t.size/2,delete t.size):t.dot_radius=4;var i=new s(t);return i.gcurve=i,i}function h(t){void 0===t&&(t={}),t.type="scatter",void 0!==t.pos&&(t.data=t.pos,delete t.pos),void 0!==t.size?(t.radius=t.size/2,delete t.size):t.radius=2.6;var i=new s(t);return i.dots=i,i}function a(t){return void 0===t&&(t={}),t.type="bar",void 0!==t.pos&&(t.data=t.pos,delete t.pos),new s(t)}function _(t){return void 0===t&&(t={}),t.type="bar",t.horizontal=!0,void 0!==t.pos&&(t.data=t.pos,delete t.pos),new s(t)}var l=!1,d=0,p=0;property.declare(o,{selected:{get:function(){return window.__context.graph_selected||null},set:function(t){window.__context.graph_selected=t}}}),property.declare(o.prototype,{__activate:function(){this.__activated||(this.__activated=!0,this.__activate=function(){},void 0!==this.__title&&this.__title.length>0&&$("<div>"+this.__title+"</div>").appendTo(canvas.container),this.wrapper.addClass("glowscript-graph").css("width",this.__width).css("height",this.__height).appendTo(canvas.container),this.wrapper.css("float",this.__align),this.__update())},__update:function(){var t=this;if(window.requestAnimFrame(function(){t.__update.call(t)},this.wrapper.get(0)),this.changed){for(var i=[],o=0;o<this.graph_series.length;o++){var s=this.graph_series[o];if(s.__visible&&(i.push(s.options),s.__dot&&"line"==s.__type&&s.options.data.length>0)){var e={points:{show:!0}};null!==s.__dot_radius?e.points.radius=s.__dot_radius:e.points.radius=s.__width+1,null!==s.__dot_color?e.color=color.to_html(s.__dot_color):e.color=color.to_html(s.__color),e.points.fillColor=e.color,e.data=[s.options.data[s.options.data.length-1]],i.push(e)}}this.changed=!1,0!=i.length&&(this.__plot=$.plot(this.wrapper,i,this.graph_options),this.__plot.draw())}},add_to_graph:function(t){this.graph_series.push(t),t.options.data.length>0&&this.__activate()},changed:!1,remove:function(){this.wrapper.remove()},width:{get:function(){return this.__width},set:function(t){this.__width=t,this.wrapper.css("width",t);var i=$.plot(this.wrapper,[],this.graph_options);i.resize(),i.setupGrid(),this.changed=!0}},height:{get:function(){return this.__height},set:function(t){this.__height=t,this.wrapper.css("height",t);var i=$.plot(this.wrapper,[],this.graph_options);i.resize(),i.setupGrid(),this.changed=!0}},align:{get:function(){return this.__align},set:function(t){if("left"!=t&&"right"!=t&&"none"!=t)throw new Error("align must be 'left', 'right', or 'none' (the default).");this.__align=t}},title:{get:function(){return this.__title},set:function(t){this.__title=t,this.changed=!0}},xmin:{get:function(){return this.__xmin},set:function(t){this.__xmin=this.graph_options.xaxis.min=t,this.changed=!0}},xmax:{get:function(){return this.__xmax},set:function(t){this.__xmax=this.graph_options.xaxis.max=t,this.changed=!0}},ymin:{get:function(){return this.__ymin},set:function(t){this.__ymin=this.graph_options.yaxis.min=t,this.changed=!0}},ymax:{get:function(){return this.__ymax},set:function(t){this.__ymax=this.graph_options.yaxis.max=t,this.changed=!0}},logx:{get:function(){return this.__logx},set:function(i){this.__logx!=i&&(i?(this.graph_options.xaxis.transform=function(i){return t(i)},this.graph_options.xaxis.inverseTransform=function(t){return pow(10,t)}):(delete this.graph_options.xaxis.transform,delete this.graph_options.xaxis.inverseTransform),this.__logx=i,this.changed=!0)}},logy:{get:function(){return this.__logy},set:function(i){this.__logy!=i&&(i?(this.graph_options.yaxis.transform=function(i){return t(i)},this.graph_options.yaxis.inverseTransform=function(t){return pow(10,t)}):(delete this.graph_options.yaxis.transform,delete this.graph_options.yaxis.inverseTransform),this.__logy=i,this.changed=!0)}},foreground:{get:function(){return this.__foreground},set:function(t){if(!(t instanceof vec))throw new Error("graph foreground color must be a vector.");this.__foreground.equals(t)||(this.__foreground=t,this.graph_options.grid.color=color.to_html(t),this.changed=!0)}},background:{get:function(){return this.__background},set:function(t){if(!(t instanceof vec))throw new Error("graph background color must be a vector.");this.__background.equals(t)||(this.__background=t,this.graph_options.grid.backgroundColor=color.to_html(t),this.changed=!0)}}});var u={line:"lines",scatter:"points",bar:"bars",__proto__:null};property.declare(s.prototype,{graph:{get:function(){return this.__graph},set:function(t){this.__graph.changed=!0,this.__graph.graph_series.splice(this.__graph.graph_series.indexOf(this),1),this.__graph=t,this.__graph.add_to_graph(this),this.__graph.changed=!0}},type:{get:function(){return this.__type},set:function(t){var i=this.__ftype,o=u[t];if(!o)throw new Error("Unknown series type: "+t);o!=i&&(this.options[o]=this.options[i],delete this.options[i],"scatter"==t?(this.options.fill=1,this.options[o].fillColor=this.options.color):"bar"==t?(this.options.fill=.5,this.options.fillColor=this.options.color):(this.options.fill=0,this.options.fillColor=this.options.color),this.__type=t,this.__graph.changed=!0)}},color:{get:function(){return this.__color},set:function(t){if(!(t instanceof vec))throw new Error("graph color must be a vector.");this.__color.equals(t)||(this.__color=t,this.options.color=color.to_html(t),"scatter"==this.__type?this.options[this.__ftype].fillColor=this.options.color:this.options.fillColor=this.options.color,this.__graph.changed=!0)}},label:{get:function(){return void 0===this.options.label?"":this.options.label},set:function(t){this.options.label!=t&&(this.options.label=t,this.__graph.changed=!0)}},delta:{get:function(){return this.__delta},set:function(t){if(this.__delta!=t){this.__delta=t;var i=u[this.__type];this.options[i].barWidth=t,this.__graph.changed=!0}}},width:{get:function(){return this.__width},set:function(t){if(this.__width!=t){this.__width=t;var i=u[this.__type];this.options[i].lineWidth=t,this.__graph.changed=!0}}},radius:{get:function(){return this.__radius},set:function(t){if(this.__radius!=t){this.__radius=t;var i=u[this.__type];this.options[i].radius=t,this.__graph.changed=!0}}},size:{get:function(){return 2*this.__radius},set:function(t){if(2*this.__radius!=t){this.__radius=t/2;var i=u[this.__type];this.options[i].radius=t/2,this.__graph.changed=!0}}},horizontal:{get:function(){return this.__horizontal},set:function(t){if(this.__horizontal!=t){this.__horizontal=t;var i=u[this.__type];this.options[i].horizontal=t,this.__graph.changed=!0}}},dot:{get:function(){return this.__dot},set:function(t){this.__dot!=t&&(this.__dot=t,this.__graph.changed=!0)}},dot_color:{get:function(){return this.__dot_color},set:function(t){if(!(t instanceof vec))throw new Error("graph dot_color must be a vector.");this.__dot_color.equals(t)||(this.__dot_color=t,this.__graph.changed=!0)}},dot_radius:{get:function(){return this.__dot_radius},set:function(t){this.__dot_radius!=t&&(this.__dot_radius=t,this.__graph.changed=!0)}},visible:{get:function(){return this.__visible},set:function(t){this.__visible!=t&&(this.__visible=t,this.__graph.changed=!0)}},data:{get:function(){return this.options.data},set:function(t){this.options.data=[],this.plot(t)}}});var g={graph:o,series:e,gdisplay:r,vp_graph:r,gcurve:n,gdots:h,gvbars:a,ghbars:_};Export(g)}();
!function(){"use strict";var r={red:vec(1,0,0),green:vec(0,1,0),blue:vec(0,0,1),yellow:vec(1,1,0),orange:vec(1,.6,0),cyan:vec(0,1,1),magenta:vec(1,0,1),white:vec(1,1,1),black:vec(0,0,0),gray:function(r){return vec(r,r,r)},hsv_to_rgb:function(r){var e=r.x,t=r.y,c=r.z;if(0==t)return vec(c,c,c);var a=Math.floor(6*e),n=6*e-a,o=c*(1-t),v=c*(1-t*n),u=c*(1-t*(1-n)),a=a%6;switch(a){case 0:return vec(c,u,o);case 1:return vec(v,c,o);case 2:return vec(o,c,u);case 3:return vec(o,v,c);case 4:return vec(u,o,c);case 5:return vec(c,o,v)}},rgb_to_hsv:function(r){var e=r.x,t=r.y,c=r.z,a=Math.max(e,t,c),n=Math.min(e,t,c),o=a;if(n==a)return vec(0,0,o);var v,u=(a-n)/a,f=(a-e)/(a-n),h=(a-t)/(a-n),l=(a-c)/(a-n);return v=e==a?l-h:t==a?2+f-l:4+h-f,v/=6,v<0&&v++,vec(v,u,o)},to_html:function(r){var e=Math.floor(255*r.x),t=Math.floor(255*r.y),c=Math.floor(255*r.z);return"rgb("+e+","+t+","+c+")"},to_html_rgba:function(r,e){var t=Math.floor(255*r.x),c=Math.floor(255*r.y),a=Math.floor(255*r.z);return"rgba("+t+","+c+","+a+","+e+")"}},e={color:r};Export(e)}();
!function(){"use strict";function s(){}function t(){}var e=64;s.prototype.roundc=function(s,t){var e,a=[];for(e=0;e<s.length;e++)a.push(vec(s[e][0],s[e][1],0));t=t||{};var o=.1,i=16,n=!1;void 0!==t.roundness&&(o=t.roundness),void 0!==t.nseg&&(i=t.nseg),void 0!==t.invert&&(n=t.invert);var r,h,d,c,l,p,u,v,g,y,M,f;h=0,a.pop();var k=a.length;for(e=0;e<k;e++)g=(e+1)%k,y=(e+2)%k,M=a[g].sub(a[e]),f=a[y].sub(a[g]),r=cross(M,f).z,h+=r;for(h<0&&a.reverse(),p=1e200,e=0;e<k;e++)d=a[e],c=a[(e+1)%k],l=mag(c.sub(d)),l<p&&(p=l);u=p*o;var x,m;for(v=[[0,0]],e=0;e<k;e++){M=a[(e+1)%k].sub(a[e%k]),f=a[(e+2)%k].sub(a[(e+1)%k]);var w=diff_angle(M,f);x=u*Math.tan(w/2),d=a[e].add(M.sub(norm(M).multiply(x))),c=a[(e+1)%k].add(norm(f).multiply(x)),v.push([d.x,d.y]);var P=cross(norm(M),norm(f)),T=d.add(norm(cross(P,M)).multiply(u)),I=d.sub(T);if(m=w/(i+1),P.z<0&&(m=-m),n){var b=d.add(c).multiply(.5);T=b.add(b.sub(T)),I=d.sub(T),m=-m}for(var B=1;B<=i;B++)M=T.add(I.rotate(B*m)),v.push([M.x,M.y]);v.push([c.x,c.y])}return M=a[1].sub(a[0]),M=a[0].add(norm(M).multiply(x)),v[0]=[M.x,M.y],v},s.prototype.rotatecp=function(s,t,e){var a,o,i,n,r,h,d,c,l,p;a=Math.sin(e),o=Math.cos(e),h=t[0],d=t[1],i=[];for(var u=0;u<s.length;u++)p=s[u],n=p[0],r=p[1],c=n*o-r*a-h*o+d*a+h,l=n*a+r*o-h*a-d*o+d,i.push([c,l]);return i},s.prototype.scale=function(s,t,e){var a,o;a=[];for(var i=0;i<s.length;i++)o=s[i],a.push([t*o[0],e*o[1]]);return a},s.prototype.addpos=function(s,t){for(var e,a=0;a<t.length;a++)e=t[a],e[0]+=s[0],e[1]+=s[1];return t},s.prototype.rframe=function(s){s=s||{},void 0===s.thickness&&(s.thickness=null),void 0===s.pos&&(s.pos=[0,0]),void 0===s.width&&(s.width=1),void 0===s.height&&(s.height=null),void 0===s.rotate&&(s.rotate=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),null===s.height&&(s.height=s.width),null===s.thickness?s.thickness=.2*min(s.height,s.width):s.thickness=min(s.height,s.width)*s.thickness*2;var t,e;return t=this.rectangle({pos:s.pos,width:s.width,height:s.height}),e=this.rectangle({pos:s.pos,width:s.width-s.thickness,height:s.height-s.thickness}),0!==s.rotate&&(t=this.rotatecp(t,s.pos,s.rotate),e=this.rotatecp(e,s.pos,s.rotate)),1===s.xscale&&1===s.yscale||(t=this.scale(t,s.xscale,s.yscale),e=this.scale(e,s.xscale,s.yscale)),s.roundness>0&&(t=this.roundc(t,{roundness:s.roundness,invert:s.invert}),e=this.roundc(e,{roundness:s.roundness,invert:s.invert})),[t,e]},s.prototype.rectangle=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.width&&(s.width=1),void 0===s.height&&(s.height=null),void 0===s.rotate&&(s.rotate=0),void 0===s.thickness&&(s.thickness=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1);var t,e,a;return null===s.height&&(s.height=s.width),0===s.thickness?(a=[],t=s.width/2,e=s.height/2,a=[[t,-e],[t,e],[-t,e],[-t,-e],[t,-e]],a=this.addpos(s.pos,a),0!==s.rotate&&(a=this.rotatecp(a,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(a=this.scale(a,s.xscale,s.yscale)),s.roundness>0&&(a=this.roundc(a,{roundness:s.roundness,invert:s.invert}))):a=this.rframe(s),a},s.prototype.cross=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.width&&(s.width=1),void 0===s.rotate&&(s.rotate=0),void 0===s.thickness&&(s.thickness=.2),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1);var t,e,a,o;return t=(s.width+s.thickness)/2,e=s.width/2,a=s.thickness/2,o=[[e,-a],[e,a],[a,a],[a,e],[-a,e],[-a,a],[-e,a],[-e,-a],[-a,-a],[-a,-e],[a,-e],[a,-a],[e,-a]],o=this.addpos(s.pos,o),0!==rotate&&(o=this.rotatecp(o,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(o=this.scale(o,s.xscale,s.yscale)),s.roundness>0&&(o=this.roundc(o,{roundness:s.roundness,invert:s.invert})),o},s.prototype.trframe=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.width&&(s.width=2),void 0===s.height&&(s.height=1),void 0===s.top&&(s.top=null),void 0===s.rotate&&(s.rotate=0),void 0===s.thickness&&(s.thickness=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1);var t,e,a,o;return null===s.top&&(s.top=width/2),null===s.thickness?s.thickness=.2*min(s.height,s.top):s.thickness=min(s.height,s.top)*s.thickness*2,a=this.trapezoid({pos:s.pos,width:s.width,height:s.height,top:s.top}),t=Math.atan((s.width-s.top)/2/s.height),e=s.thickness/Math.cos(t),o=this.trapezoid({pos:s.pos,width:s.width-e-s.thickness*Math.tan(t),height:s.height-s.thickness,top:s.top-(e-s.thickness*Math.tan(t))}),a=this.addpos(s.pos,a),o=this.addpos(s.pos,o),0!==s.rotate&&(a=this.rotatecp(a,s.pos,s.rotate),o=this.rotatecp(o,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(a=this.scale(a,s.xscale,s.yscale),o=this.scale(o,s.xscale,s.yscale)),s.roundness>0&&(a=this.roundc(a,{roundness:s.roundness,invert:s.invert}),o=this.roundc(o,{roundness:s.roundness,invert:s.invert})),[a,o]},s.prototype.trapezoid=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.width&&(s.width=2),void 0===s.height&&(s.height=1),void 0===s.top&&(s.top=null),void 0===s.rotate&&(s.rotate=0),void 0===s.thickness&&(s.thickness=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1);var t,e,a,o;return t=s.width/2,e=s.height/2,null===s.top&&(s.top=t),a=s.top/2,0===s.thickness?(o=[[t,-e],[a,e],[-a,e],[-t,-e],[t,-e]],o=this.addpos(s.pos,o),0!==s.rotate&&(o=this.rotatecp(o,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(o=this.scale(o,s.xscale,s.yscale)),s.roundness>0&&(o=this.roundc(o,{roundness:s.roundness,invert:s.invert}))):o=this.trframe(s),o},s.prototype.circframe=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.radius&&(s.radius=.5),void 0===s.iradius&&(s.iradius=null),void 0===s.np&&(s.np=e),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),void 0===s.angle1&&(s.angle1=0),void 0===s.angle2&&(s.angle2=2*Math.PI),void 0===s.rotate&&(s.rotate=0),s.thickness=0;var t,a;if(null===s.iradius&&(s.iradius=.8*s.radius),t=this.circle(s),0===s.angle1&&s.angle2==2*Math.PI)s.radius=s.iradius;else{var o=s.radius-s.iradius,i=(s.angle1+s.angle2)/2,n=o/Math.sin((s.angle2-s.angle1)/2);s.corner=[s.pos[0]+n*Math.cos(i),s.pos[1]+n*Math.sin(i)];var r=Math.asin(o/s.iradius);s.angle1=s.angle1+r,s.angle2=s.angle2-r,s.radius=s.iradius}return a=this.circle(s),0!==s.rotate&&(t=this.rotatecp(t,s.pos,s.rotate),a=this.rotatecp(a,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(t=this.scale(t,s.xscale,s.yscale),a=this.scale(a,s.xscale,s.yscale)),[t,a]},s.prototype.circle=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]);var t=s.pos;void 0!==s.corner&&(t=s.corner),void 0===s.radius&&(s.radius=.5),void 0===s.np&&(s.np=e),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),void 0===s.thickness&&(s.thickness=0),void 0===s.angle1&&(s.angle1=0),void 0===s.angle2&&(s.angle2=2*Math.PI),void 0===s.rotate&&(s.rotate=0);var a,o,i,n,r,h,d,c,l,p,u,v;if(v=[],s.thickness>0)s.iradius=s.radius-s.radius*s.thickness,v=this.circframe(s);else{for(0===s.angle1&&s.angle2===2*Math.PI||v.push([t[0],t[1]]),a=2*Math.PI/s.np,o=Math.floor(Math.abs((s.angle2-s.angle1)/a+.5)),a=(s.angle2-s.angle1)/o,0===s.angle1&&s.angle2===2*Math.PI||(o+=1),l=s.radius*Math.cos(s.angle1),p=s.radius*Math.sin(s.angle1),i=Math.cos(a),n=Math.sin(a),r=s.pos[0],h=s.pos[1],v.push([r+l,h+p]),u=0;u<o-1;u++)d=l*i-p*n,c=p*i+l*n,v.push([r+d,h+c]),l=d,p=c;v.push(v[0]),0===s.rotate||0===s.angle1&&s.angle2===2*Math.PI||(v=this.rotatecp(v,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(v=this.scale(v,s.xscale,s.yscale))}return v},s.prototype.arc=function(s){s=s||{},void 0===s.path&&(s.path=!1),void 0===s.pos&&(s.pos=[0,0]),void 0===s.radius&&(s.radius=.5),void 0===s.np&&(s.np=e),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),void 0===s.thickness&&(s.thickness=null),void 0===s.angle1&&(s.angle1=0),void 0===s.angle2&&(s.angle2=2*Math.PI),void 0===s.rotate&&(s.rotate=0),void 0===s.path&&(s.path=!1);var t,a,o,i,n,r,h;for(null===s.thickness&&(s.thickness=.01*s.radius),h=[],t=[],o=2*Math.PI/s.np,a=Math.floor(Math.abs(s.angle2-s.angle1)/o)+1,o=(s.angle2-s.angle1)/a,r=0;r<a+1;r++)i=Math.cos(s.angle1+r*o),n=Math.sin(s.angle1+r*o),h.push([s.radius*i+s.pos[0],s.radius*n+s.pos[1]]),s.path||t.push([(s.radius-s.thickness)*i+s.pos[0],(s.radius-s.thickness)*n+s.pos[1]]);if(!s.path){t.reverse();for(var r=0;r<t.length;r++)h.push(t[r]);h.push(h[0])}return 0!==s.rotate&&(h=rotatecp(h,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||this.scale(h,s.xscale,s.yscale),h},s.prototype.ellipse=function(s){return s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.width&&(s.width=1),void 0===s.height&&(s.height=null),void 0===s.np&&(s.np=e),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),void 0===s.thickness&&(s.thickness=0),void 0===s.angle1&&(s.angle1=0),void 0===s.angle2&&(s.angle2=2*Math.PI),void 0===s.rotate&&(s.rotate=0),null===s.height&&(s.height=.5*s.width),s.yscale*=s.height/s.width,s.radius=s.width,this.circle(s)},s.prototype.line=function(s){s=s||{},void 0===s.path&&(path=s.path),void 0===s.pos&&(s.pos=[0,0]),void 0===s.np&&(s.np=2),void 0===s.rotate&&(s.rotate=0),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),void 0===s.thickness&&(s.thickness=null),void 0===s.start&&(s.start=[0,0]),void 0===s.end&&(s.end=[0,1]);var t,e,a,o,i,n,r,h,d,c;t=vec(s.end[0]-s.start[0],s.end[1]-s.start[1],0),null===s.thickness&&(s.thickness=.01*mag(t)),e=s.thickness*norm(cross(vec(0,0,1),t)),a=e.x,o=e.y,c=[],i=[];vec(s.start[0],s.start[1],0);for(t=vec(s.end[0]-s.start[0],s.end[1]-s.start[1],0),n=t.divide(Math.floor(s.np-1)),d=0;d<s.np;d++)r=s.start[0]+n.multiply(d).x,h=s.start[1]+n.multiply(d).y,c.push([r+s.pos[0],h+s.pos[1]]),i.push([r+s.pos[0]+a,h+s.pos[1]+o]);i.reverse();for(var d=0;d<i.length;d++)c.push(i[d]);return c.push(c[0]),0!==s.rotate&&(c=this.rotatecp(c,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||this.scale(c,s.xscale,s.yscale),c},s.prototype.nframe=function(s){s=s||{},void 0===s.thickness&&(s.thickness=0),void 0===s.pos&&(s.pos=[0,0]),void 0===s.length&&(s.length=1),void 0===s.np&&(s.np=3),void 0===s.thickness&&(s.thickness=null),void 0===s.rotate&&(s.rotate=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1);var t,e,a,o;return null===s.thickness?s.thickness=.1*s.length:s.thickness=s.length*s.thickness,a=this.ngon({pos:s.pos,np:s.np,length:s.length}),t=Math.PI*(.5-1/s.np),e=s.length-2*s.thickness/Math.tan(t),o=this.ngon({pos:s.pos,np:s.np,length:e}),0!==s.rotate&&(a=this.rotatecp(a,s.pos,s.rotate),o=this.rotatecp(o,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(a=this.scale(a,s.xscale,s.yscale),o=this.scale(o,s.xscale,s.yscale)),s.roundness>0&&(a=this.roundc(a,{roundness:s.roundness,invert:s.invert}),o=this.roundc(o,{roundness:s.roundness,invert:s.invert})),[a,o]},s.prototype.ngon=function(s){s=s||{},void 0===s.thickness&&(s.thickness=0),void 0===s.pos&&(s.pos=[0,0]),void 0===s.length&&(s.length=1),void 0===s.rotate&&(s.rotate=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),void 0===s.np&&(s.np=3);var t,e,a,o,i,n,r;if(r=[],s.np<3)throw Error("number of sides can not be less than 3");if(o=2*Math.PI/s.np,i=s.length/2/Math.sin(o/2),0===s.thickness){for(t=2*Math.PI/s.np,o=0,n=0;n<s.np;n++)e=i*Math.cos(o)+s.pos[0],a=i*Math.sin(o)+s.pos[1],r.push([e,a]),o+=t;r.push(r[0]),0!==s.rotate&&(r=this.rotatecp(r,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(r=this.scale(r,s.xscale,s.yscale)),s.roundness>0&&(r=this.roundc(r,{roundness:s.roundness,invert:s.invert}))}else r=this.nframe(s);return r},s.prototype.triangle=function(s){return s=s||{},void 0===s.rotate&&(s.rotate=0),s.np=3,s.rotate=s.rotate-Math.PI/6,this.ngon(s)},s.prototype.pentagon=function(s){return s=s||{},void 0===s.rotate&&(s.rotate=0),s.np=5,s.rotate=s.rotate+Math.PI/10,this.ngon(s)},s.prototype.hexagon=function(s){return s=s||{},void 0===s.rotate&&(s.rotate=0),s.np=6,this.ngon(s)},s.prototype.octagon=function(s){return s=s||{},void 0===s.rotate&&(s.rotate=0),s.np=8,s.rotate=s.rotate+Math.PI/8,this.ngon(s)},s.prototype.sframe=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.radius&&(s.radius=1),void 0===s.n&&(s.n=5),void 0===s.iradius&&(s.iradius=null),void 0===s.rotate&&(s.rotate=0),void 0===s.thickness&&(s.thickness=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1);var t,e;return null===s.iradius&&(s.iradius=.5*s.radius),null===s.thickness?s.thickness=.2*s.radius:s.thickness=2*s.thickness*s.iradius,t=this.star({pos:s.pos,n:s.n,radius:s.radius,iradius:s.iradius}),e=this.star({pos:s.pos,n:s.n,radius:s.radius-s.thickness,iradius:(s.radius-s.thickness)*s.iradius/s.radius}),0!==s.rotate&&(t=this.rotatecp(t,s.pos,s.rotate),e=this.rotatecp(e,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(t=this.scale(t,s.xscale,s.yscale),e=this.scale(e,s.xscale,s.yscale)),s.roundness>0&&(t=this.roundc(t,{roundness:s.roundness,invert:s.invert}),e=this.roundc(e,{roundness:s.roundness,invert:s.invert})),[t,e]},s.prototype.star=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.radius&&(s.radius=1),void 0===s.n&&(s.n=5),void 0===s.iradius&&(s.iradius=null),void 0===s.rotate&&(s.rotate=0),void 0===s.thickness&&(s.thickness=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1);var t,e,a,o;if(null===s.iradius&&(s.iradius=.5*s.radius),0===s.thickness){for(o=[],t=Math.PI/s.n,e=0,a=0;a<2*s.n+1;a++)a%2===0?o.push([-s.radius*Math.sin(e),s.radius*Math.cos(e)]):o.push([-s.iradius*Math.sin(e),s.iradius*Math.cos(e)]),e+=t;o=this.addpos(s.pos,o),o[o.length-1]=o[0],0!==s.rotate&&(o=this.rotatecp(o,s.pos,s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(o=this.scale(o,s.xscale,s.yscale)),s.roundness>0&&(o=this.roundc(o,{roundness:s.roundness,invert:s.invert}))}else o=this.sframe(s);return o},s.prototype.points=function(s){s=s||{};var t=!1;void 0===s.pos&&(s.pos=[]),void 0===s.rotate&&(s.rotate=0),void 0===s.roundness&&(s.roundness=0),void 0===s.invert&&(s.invert=!1),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),void 0===s.path&&(t=s.path);var e,a;return a=s.pos,e=a[a.length-1][0]===a[0][0]&&a[a.length-1][1]===a[0][1],e||t||a.push(a[0]),a.length&&0!==s.rotate&&(a=this.rotatecp(a,a[0],s.rotate)),1!==s.scale&&(s.xscale=s.yscale=s.scale),1===s.xscale&&1===s.yscale||(a=this.scale(a,s.xscale,s.yscale)),s.roundness>0&&(a=this.roundc(a,{roundness:s.roundness,invert:s.invert})),a},s.prototype.ToothOutline=function(s){s=s||{},void 0===s.n&&(s.n=30),void 0===s.res&&(s.res=1),void 0===s.phi&&(s.phi=20),void 0===s.radius&&(s.radius=50),void 0===s.addendum&&(s.addendum=.4),void 0===s.dedendum&&(s.dedendum=.5),void 0===s.fradius&&(s.fradius=.1),void 0===s.bevel&&(s.bevel=.05);var t,e,a,o,i,n,r,h,d,c,l,p,u,v,g,y,M,f,k,x,m,w,P,T,I,b,B,A,D,R;for(t={PitchRadius:s.radius,TeethN:s.n,PressureAng:s.phi,Addendum:s.addendum,Dedendum:s.dedendum,Fillet:s.fradius,Bevel:s.bevel,Resolution:s.res},e={Bottom:t.PitchRadius-t.Dedendum-t.Fillet,Ded:t.PitchRadius-t.Dedendum,Base:t.PitchRadius*cos(t.PressureAng*Math.PI/180),Bevel:t.PitchRadius+t.Addendum-t.Bevel,Add:t.PitchRadius+t.Addendum},a=t.TeethN/(2*t.PitchRadius),o=Math.PI/2/a,i=Math.PI/a,n=sqrt((1-Math.cos(t.PressureAng*Math.PI/1800))/Math.cos(t.PressureAng*Math.PI/180)),r=sqrt(e.Bevel*e.Bevel/(e.Ded*e.Ded)-1),h=Math.atan((sin(n)-n*Math.cos(n))/(Math.cos(n)+n*Math.sin(n))),d=Math.atan((sin(r)-r*Math.cos(r))/(Math.cos(r)+r*Math.sin(r))),c=h+o/(2*t.PitchRadius),l={Theta0:i/(2*t.PitchRadius),Theta1:c+t.Fillet/e.Ded,Theta2:c,Theta3:c-d,Theta4:c-d-t.Bevel/e.Add},A=t.Resolution,p=[],u=[],v=0;v<2*A;v++)B=(l.Theta1-l.Theta0)*v/(2*A-1)+l.Theta0,p.push([e.Bottom*Math.cos(B),e.Bottom*Math.sin(B)]),u.push([-Math.cos(B),-Math.sin(B)]);for(P=e.Ded*Math.cos(l.Theta1),T=e.Ded*Math.sin(l.Theta1),g=Math.PI/2+l.Theta2-l.Theta1,v=0;v<A;v++)B=g*(v+1)/A+Math.PI+l.Theta1,p.push([P+t.Fillet*Math.cos(B),T+t.Fillet*Math.sin(B)]),u.push([Math.cos(B),Math.sin(B)]);for(v=0;v<A;v++)y=(e.Base-e.Ded)*(v+1)/A+e.Ded,p.push([y*Math.cos(l.Theta2),y*Math.sin(l.Theta2)]),u.push([Math.cos(l.Theta2-Math.PI/2),Math.sin(l.Theta2-Math.PI/2)]);for(v=0;v<3*A;v++)y=(e.Bevel-e.Base)*(v+1)/(3*A)+e.Base,M=Math.sqrt(y*y/(e.Base*e.Base)-1),f=e.Base*(Math.cos(M)+M*Math.sin(M)),k=-e.Base*(Math.sin(M)-M*Math.cos(M)),p.push([f*Math.cos(l.Theta2)-k*Math.sin(l.Theta2),f*Math.sin(l.Theta2)+k*Math.cos(l.Theta2)]),u.push([-Math.sin(M),-Math.cos(M)]);for(x=-M,x=x+c+Math.PI/2,m=Math.tan(x),I=p[p.length-1],w=t.Bevel/(1-Math.cos(x-l.Theta4)),P=I[0]-w*Math.cos(x),T=I[1]-w*Math.sin(x),v=0;v<A;v++)B=(l.Theta4-x)*(v+1)/A+x,p.push([P+w*Math.cos(B),T+w*Math.sin(B)]),u.push([-Math.cos(B),-Math.sin(B)]);for(I=p[p.length-1],l.Theta4=Math.atan(I[1]/I[0]),b=Math.sqrt(I[0]*I[0]+I[1]*I[1]),v=0;v<A;v++)B=-l.Theta4*(v+1)/A+l.Theta4,p.push([b*Math.cos(B),b*Math.sin(B)]),u.push([-Math.cos(B),-Math.sin(B)]);for(A=p.length,v=0;v<A-1;v++)D=p[A-2-v],p.push([D[0],-D[1]]),R=u[A-2-v],u.push([R[0],-R[1]]);return p},s.prototype.RackOutline=function(s){s=s||{},void 0===s.n&&(s.n=30),void 0===s.res&&(s.res=1),void 0===s.phi&&(s.phi=20),void 0===s.radius&&(s.radius=5),void 0===s.addendum&&(s.addendum=.4),void 0===s.dedendum&&(s.dedendum=.5),void 0===s.fradius&&(s.fradius=.1),void 0===s.bevel&&(s.bevel=.05);var t,e,a,o,i,n,r,h,d,c,l,p,u,v,g,y,M,f,k,x,m,w,P,T,I;for(t={PitchRadius:s.radius,TeethN:s.n,PressureAng:s.phi,Addendum:s.addendum,Dedendum:s.dedendum,Fillet:s.fradius,Bevel:s.bevel,Resolution:s.res},e={Bottom:-t.Dedendum-t.Fillet,Ded:-t.Dedendum,Bevel:t.Addendum-t.Bevel,Add:t.Addendum},a=t.TeethN/(2*t.PitchRadius),o=Math.PI/2/a,i=Math.PI/a,n=t.PressureAng*Math.PI/180,r=o/2,h=(-e.Ded+t.Fillet*Math.sin(n))*Math.tan(n),d=t.Fillet*Math.cos(n),c={y0:i/2,y1:r+h+d,y2:r+h,y3:r-(e.Add-t.Bevel)*Math.tan(n),y4:r-(e.Add-t.Bevel)*Math.tan(n)-cos(n)/(1-Math.sin(n))*t.Bevel},P=t.Resolution,l=[],p=[],u=0,s.fradius&&(u=1),v=u;v<2*P;v++)w=(c.y1-c.y0)*v/(2*P-1)+c.y0,l.push([e.Bottom,w]),p.push([-1,-0]);for(k=e.Ded,x=c.y1,g=Math.PI/2-n,v=0;v<P;v++)m=g*(v+1)/P+Math.PI,l.push([k+t.Fillet*Math.cos(m),x+t.Fillet*Math.sin(m)]),p.push([Math.cos(m),Math.sin(m)]);for(y=e.Ded-t.Fillet*Math.sin(n),v=0;v<4*P;v++)M=(e.Bevel-y)*(v+1)/(4*P)+y,l.push([M,r-Math.tan(n)*M]),p.push([-Math.sin(n),-Math.cos(n)]);for(f=t.Bevel/(1-Math.sin(n)),k=e.Add-f,x=c.y4,v=0;v<P;v++)m=(-Math.PI/2+n)*(v+1)/P+Math.PI/2-n,l.push([k+f*Math.cos(m),x+f*Math.sin(m)]),p.push([-Math.cos(m),-Math.sin(m)]);for(v=0;v<P;v++)w=-c.y4*(v+1)/P+c.y4,l.push([e.Add,w]),p.push([-1,0]);for(P=l.length,v=0;v<P-1;v++)T=l[P-2-v],l.push([T[0],-T[1]]),I=p[P-2-v],p.push([I[0],-I[1]]);return l},s.prototype.gear=function n(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.n&&(s.n=20),void 0===s.radius&&(s.radius=1),void 0===s.phi&&(s.phi=20),void 0===s.addendum&&(s.addendum=.08*s.radius),void 0===s.dedendum&&(s.dedendum=.1*s.radius),void 0===s.fradius&&(s.fradius=.02*s.radius),void 0===s.rotate&&(s.rotate=0),void 0===s.scale&&(s.scale=1),void 0===s.res&&(s.res=1);var t=0;void 0!==s.bevel&&(t=s.bevel);var e,a,o,i,r,h,d,c,l,n;for(s.bevel=0,a=this.ToothOutline(s),s.bevel=t,n=[],l=0;l<s.n;l++){o=2*-l*Math.PI/s.n,i=[];for(var p=0;p<a.length;p++)e=a[p],d=e[0],c=e[1],r=d*Math.cos(o)-c*Math.sin(o)+s.pos[0],h=d*Math.sin(o)+c*Math.cos(o)+s.pos[1],i.push([r,h]);n=n.concat(i)}1!==s.scale&&(n=this.scale(n,s.scale,s.scale)),0!==s.rotate&&(n=this.rotatecp(n,s.pos,s.rotate));for(var u,v,g,y=[],l=0;l<n.length&&(u=n[l],y.push(u),l!=n.length-1);l++)v=n[l+1],l<n.length-2?(g=n[l+2],Math.abs(g[0]-u[0])<.001*s.radius&&Math.abs(g[1]-u[1])<.001*s.radius&&(l+=2),v=n[l],u[0]===v[0]&&u[1]===v[1]&&l++):u[0]!==v[0]||u[1]!==v[1]||l++;return u=y[0],v=y[y.length-1],u[0]===v[0]&&u[1]===v[1]||y.push(u),y},s.prototype.rackgear=function(s){s=s||{},void 0===s.pos&&(s.pos=[0,0]),void 0===s.n&&(s.n=30),void 0===s.radius&&(s.radius=5),void 0===s.phi&&(s.phi=20),void 0===s.addendum&&(s.addendum=.08*s.radius),void 0===s.dedendum&&(s.dedendum=.1*s.radius),void 0===s.fradius&&(s.fradius=.02*s.radius),void 0===s.rotate&&(s.rotate=0),void 0===s.scale&&(s.scale=1),void 0===s.length&&(s.length=10*Math.PI),void 0===s.res&&(s.res=1),void 0===s.bevel&&(s.bevel=.05),void 0===s.depth&&(s.depth=1.1);var t,e,a,o,i,n,r,h,d,c,l,p,u,v,g,y,M,f,k,x,m,w=1e4,P=1e4;for(t=this.RackOutline(s),e=t[0][1]-t[t.length-1][1],a=Math.floor(s.length/e),o=a*e,i=[],d=0;d<a;d++){n=[];for(var T=0;T<t.length;T++)m=t[T],c=m[0],l=m[1],c!=w&&l!=P&&(r=c+s.pos[0],h=-d*e+l+s.pos[1],n.push([r,h]),w=c,P=l);i=i.concat(n)}for(i.push([i[i.length-1][0]-s.depth,i[i.length-1][1]]),i.push([i[0][0]-s.depth,i[0][1]]),i.push(i[0]),p=1e3,u=-1e3,v=1e3,g=-1e3,d=0;d<i.length;d++)y=i[d],c=y[0],l=y[1],c<p&&(p=c),c>u&&(u=c),l<v&&(v=l),l>g&&(g=l);for(M=[(p+u)/2,(v+g)/2],f=s.pos[0]-M[0],k=s.pos[1]-M[1],x=[],d=0;d<i.length;d++)y=i[d],x.push([y[0]+f,y[1]+k]);1!==s.scale&&(x=this.scale(x,s.scale,s.scale)),0!==s.rotate&&(x=this.rotate(x,s.pos,s.rotate));var I=x[0],b=x[x.length-1];return I[0]===b[0]&&I[1]===b[1]||x.push(I),x},t.prototype.convert=function(s){s=s||{},void 0===s.pos&&(s.pos=vec(0,0,0)),void 0===s.up&&(s.up=vec(0,1,0)),void 0===s.pts&&(s.pts=null),void 0===s.closed&&(s.closed=!0);var t,e,a,o,i,n,r,h;for(s.up=norm(s.up),t=vec(0,1,0),e=Math.acos(s.up.dot(t)),a=e>0,o=t.cross(s.up),i=[],h=0;h<s.pts.length;h++)r=s.pts[h],n=vec(r[0],0,0-r[1]),a&&(n=n.rotate({angle:e,axis:o})),i.push(s.pos.add(n));return closed&&!i[i.length-1].equals(i[0])&&i.push(pts[0]),i},t.prototype.setuppath=function(s){s.path=!0;var t;if(void 0===s.pos)t=vec(0,0,0);else{if(t=s.pos,void 0===t.x)throw new Error("The pos attribute of a path must be a vector.");delete s.pos}return t},t.prototype.rectangle=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in a rectangular path");var t=this.setuppath(s),e=o.rectangle(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.cross=function(s){s=s||{};var t=this.setuppath(s),e=o.cross(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.trapezoid=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in a trapezoid path");var t=this.setuppath(s),e=o.trapezoid(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.circle=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in a circle path");var t=this.setuppath(s),e=o.circle(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.line=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in a line path");void 0===s.np&&(s.np=2),void 0===s.rotate&&(s.rotate=0),void 0===s.scale&&(s.scale=1),void 0===s.xscale&&(s.xscale=1),void 0===s.yscale&&(s.yscale=1),void 0===s.start&&(s.start=vec(0,0,0)),void 0===s.end&&(s.end=vec(0,0,-.1));var t,e,a,o=[s.start];for(t=s.end.sub(s.start),e=t.divide(Math.floor(s.np-1)),a=1;a<s.np;a++)o.push(s.start.add(e)),e=e.add(e);return o},t.prototype.arc=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in an arc path");s.path=!0;var t=this.setuppath(s),e=o.arc(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.ellipse=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in an ellipse path");var t=this.setuppath(s),e=o.ellipse(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.ngon=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in an ngon path");var t=this.setuppath(s),e=o.ngon(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.triangle=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in a pentagon path");var t=this.setuppath(s),e=o.triangle(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.pentagon=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in a triangle path");var t=this.setuppath(s),e=o.pentagon(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.hexagon=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in a hexagon path");var t=this.setuppath(s),e=o.hexagon(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.octagon=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in an octagon path");var t=this.setuppath(s),e=o.octagon(s);return this.convert({pos:t,up:s.up,pts:e})},t.prototype.star=function(s){if(s=s||{},void 0!==s.thickness)throw Error("Thickness is not allowed in a star path");var t=this.setuppath(s),e=o.star(s);return this.convert({pos:t,up:s.up,pts:e})};var a=new t,o=new s,i={paths:a,shapes:o};Export(i)}();
!function(){function subclass(t,i){t.prototype=new i({visible:!1,canvas:null}),t.prototype.constructor=t}function id_to_falsecolor(t){var i=0,e=0,s=0;return t>=16777216&&(i=Math.floor(t/16777216),t-=16777216*i),t>=65536&&(e=Math.floor(t/65536),t-=65536*e),t>=256&&(s=Math.floor(t/256),t-=256*s),[i/255,e/255,s/255,t/255]}function init(t,i){if(t.constructor!=text){if("vpython"==window.__GSlang&&void 0!==i.display&&(i.canvas=i.display,delete i.display),void 0!==i.canvas?(t.canvas=i.canvas,delete i.canvas):t.canvas=canvas.selected,t.canvas&&(t.canvas.__activate(),t.__model=t.__get_model()),i.__obj&&(t.__obj=i.__obj,delete i.__obj),void 0!==i.radius&&(t.radius=i.radius,delete i.radius),void 0!==i.size_units&&(t.size_units=i.size_units,delete i.size_units),void 0!==i.axis&&(0===i.axis.mag2&&(t.__oldaxis=vec(1,0,0)),t.axis=i.axis,delete i.axis),void 0!==i.size&&(t.size=i.size,delete i.size),void 0!==i.up&&(0===i.up.mag2&&(t.__oldup=vec(0,1,0)),t.up=i.up,delete i.up),void 0!==i.color&&(t.color=i.color,delete i.color),t.__interval=-1,t.constructor!=curve&&t.constructor!=points&&void 0!==i.make_trail){if(t.__make_trail=i.make_trail,delete i.make_trail,t.__trail_type="curve",void 0!==i.trail_type){if("curve"!=i.trail_type&&"points"!=i.trail_type&&"spheres"!=i.trail_type)throw new Error("trail_type = "+i.trail_type+" but must be 'curve' or 'points' (or 'spheres').");t.__trail_type=i.trail_type,delete i.trail_type}if(void 0!==i.interval?(t.__interval=i.interval,delete i.interval):"curve"!=t.__trail_type&&(t.__interval=1),void 0!==i.retain?(t.__retain=i.retain,delete i.retain):t.__retain=-1,t.__trail_color=color.white,void 0!==t.color&&(t.__trail_color=t.color),void 0!==i.trail_color&&(t.__trail_color=i.trail_color,delete i.trail_color),t.__trail_radius=0,void 0!==i.trail_radius?(t.__trail_radius=i.trail_radius,delete i.trail_radius):"points"==t.__trail_type&&(t.__trail_radius=.1*t.__size.y),t.__pps=0,void 0!==i.pps){if(t.__interval>0)throw"curve"!=t.__trail_type?new Error("pps cannot be used with a "+t.__trail_type+"-type trail"):new Error("pps cannot be used with interval > 0");t.__pps=i.pps,delete i.pps}t.__trail_object=attach_trail(t,{type:t.__trail_type,color:t.__trail_color,radius:t.__trail_radius,pps:t.__pps,retain:t.__retain}),void 0!==i.pos&&t.__make_trail&&t.__trail_object.__trail.push(i.pos),t.__make_trail||t.__trail_object.stop(),t.__ninterval=0}t._pos_set=void 0!==i.pos;for(var e in i)t[e]=i[e];void 0===i.visible&&null!==t.canvas&&(t.visible=!0)}}function initObject(t,i,e){if(!(t instanceof i))return new i(e);if(e=e||{},t.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:!1,right:!1,sides:!1,flipx:!1,flipy:!1,turn:0,flags:0},i==curve&&(t.origin=t.origin),i!=curve&&i!=points&&i!=text&&(t.pos=t.pos),i!=points&&i!=text){if(i==arrow){if(void 0!==e.axis)throw new Error("arrow does not have axis; replace with axis_and_length");t.axis_and_length=t.axis_and_length}else{if(i==vp_arrow&&void 0!==e.axis_and_length)throw new Error("VPython arrow does not have axis_and_length; replace with axis");t.axis=t.axis}t.up=t.up,t.size=t.size,t.color=t.color}t.__sizing=!1,"vpython"==window.__GSlang&&i!=vp_sphere&&i!=vp_ring&&i!=text&&i!=compound&&(t.__sizing=!0),void 0===e.opacity&&(t.__opacity=1),void 0===e.make_trail&&(t.__make_trail=!1),t.__opacity_change=!0,init(t,e)}function setup_texture(t,i,e){if(":"==t.slice(0,1)){var s=window.Jupyter_VPython;t=void 0!==s?s+t.slice(1):navigator.onLine?"https://s3.amazonaws.com/glowscript/textures/"+t.slice(1):"../lib/FilesInAWS/"+t.slice(1)}i.canvas.__renderer.initTexture(t,i,e)}function Primitive(){}function box(t){return initObject(this,box,t)}function cylinder(t){return initObject(this,cylinder,t)}function cone(t){return initObject(this,cone,t)}function pyramid(t){return initObject(this,pyramid,t)}function sphere(t){return initObject(this,sphere,t)}function vp_box(t){return initObject(this,vp_box,t)}function vp_pyramid(t){return initObject(this,vp_pyramid,t)}function vp_sphere(t){return initObject(this,vp_sphere,t)}function vp_ellipsoid(t){return initObject(this,vp_ellipsoid,t)}function vp_cylinder(t){return initObject(this,vp_cylinder,t)}function vp_cone(t){return initObject(this,vp_cone,t)}function arrow_update(t,i){var e,s=t.__pos;t.__color;e=i?t.__axis:t.__axis_and_length;var n=mag(e),o=e.norm(),r=t.__shaftwidth||.1*n,_=t.__headwidth||2*r,a=t.__headlength||3*r;if(r<.02*n){var h=.02*n/r;t.__shaftwidth||(r*=h),t.__headwidth||(_*=h),t.__headlength||(a*=h)}if(a>.5*n){var h=.5*n/a;t.__shaftwidth||(r*=h),t.__headwidth||(_*=h),t.__headlength||(a*=h)}var c=t.__components;c||(c=i?t.__components=[vp_box({canvas:t.canvas,__obj:t}),vp_pyramid({canvas:t.canvas,__obj:t})]:t.__components=[box({canvas:t.canvas,__obj:t}),pyramid({canvas:t.canvas,__obj:t})]);var l=c[0],u=c[1];l.pos=s.add(o.multiply(.5*(n-a))),u.pos=s.add(o.multiply(n-a)),l.axis=u.axis=e,l.size=vec(n-a,r,r),u.size=vec(a,_,_),l.color=u.color=t.color,l.opacity=u.opacity=t.opacity,l.pickable=u.pickable=t.pickable,t.size=vec(n,_,_),l.__update(),u.__update()}function arrow(t){return this instanceof arrow?(this.__shaftwidth=0,this.__headwidth=0,this.__headlength=0,initObject(this,arrow,t)):new arrow(t)}function vp_arrow(t){return this instanceof vp_arrow?(this.__shaftwidth=0,this.__headwidth=0,this.__headlength=0,initObject(this,vp_arrow,t)):new vp_arrow(t)}function text(t){if(!(this instanceof text))return new text(t);if(null!==t.canvas){if(t=t||{},void 0!==t.length)throw new Error("The length cannot be specified when constructing 3D text.");if(void 0!==t.size)throw new Error("A text object does not have a size attribute.");if(this.pos=this.pos,this.axis=this.axis,this.up=this.up,this.color=this.color,void 0===t.__comp){var i=text3D(t);this.__id=nextVisibleId,nextVisibleId++,this.__comp=i[0],t=i[1]}else this.__id=nextVisibleId,nextVisibleId++;for(var e in t)this[e]=t[e];this.__pseudosize=vec(this.__comp.size),this.__height_fraction=this.__height/this.__comp.size.y,this.__descender_fraction=this.__descender/this.__comp.size.y,t={},initObject(this,text,{}),this.__billboard&&(this.canvas.update_billboards=!0,this.canvas.billboards.push(this))}}function vertex(t){if(!(this instanceof vertex))return new vertex(t);t=t||{},void 0!==t.canvas?this.canvas=t.canvas:void 0!==t.display?this.canvas=t.display:this.canvas=canvas.selected;for(var i in t)"canvas"!=i&&"display"!=i&&(this[i]=t[i]);if(void 0===this.opacity&&(this.opacity=1),0!==this.__texpos.z)throw new Error("In a vertex the z component of texpos must be zero.");if(this.canvas.vertex_id>=65536)throw new Error("Currently the number of vertices is limited to 65536.");var e={pos:3,normal:3,color:3,opacity:1,shininess:1,emissive:1,texpos:2,bumpaxis:3};if(this.__id=this.canvas.__vertices.available.pop(),void 0===this.__id){this.__id=this.canvas.vertex_id;var s=this.canvas.__vertices;if(this.canvas.vertex_id%s.Nalloc===0){var n,o=this.canvas.vertex_id+s.Nalloc;for(var r in e)n=new Float32Array(e[r]*o),n.set(s[r],0),s[r]=n}this.canvas.vertex_id++}this.canvas.__vertices.object_info[this.__id]={},this.__change()}function tri_quad_error(t,i){throw new Error("A "+t+" has no "+i+" attribute.")}function triangle(t){if(!(this instanceof triangle))return new triangle(t);t=t||{};var i=["v0","v1","v2"];if(void 0===t.vs)for(var e=0;e<3;e++)if(void 0===t[i[e]])throw new Error("A triangle must have a vertex "+i[e]+".");this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:!1,right:!1,sides:!1,flipx:!1,flipy:!1,turn:0,flags:0},init(this,t);for(var s=this.vs,e=0;e<3;e++)this.canvas.__vertices.object_info[s[e].__id][this.__id]=this}function quad(t){if(!(this instanceof quad))return new quad(t);t=t||{};var i=["v0","v1","v2","v3"];if(void 0===t.vs)for(var e=0;e<4;e++)if(void 0===t[i[e]])throw new Error("A quad must have a vertex "+i[e]+".");this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:!1,right:!1,sides:!1,flipx:!1,flipy:!1,turn:0,flags:0},init(this,t);for(var s=this.vs,e=0;e<4;e++)this.canvas.__vertices.object_info[s[e].__id][this.__id]=this}function make_compound(t,i){function e(t,i){if(null!==i.__xmin)for(var e in i){var s=i[e];"min"==e.slice(-3)?(null===t[e]||s<t[e])&&(t[e]=s):(null===t[e]||s>t[e])&&(t[e]=s)}}var s=i.self;delete i.self;for(var n=new Mesh,o=[],r=0;r<t.length;r++){var _=t[r];if(_ instanceof curve)throw new Error("Currently cannot include a curve in a compound.");if(_ instanceof helix)throw new Error("Currently cannot include a helix in a compound.");if(_ instanceof label)throw new Error("Currently cannot include a label in a compound.");if(null!==_.__tex.file)throw new Error("Currently objects in a compound cannot have their own texture.");if(null!==_.__tex.bumpmap)throw new Error("Currently objects in a compound cannot have their own bumpmap.");if(_ instanceof triangle||_ instanceof quad){var a=_.vs,h=3;_ instanceof quad&&(h=4);for(var c=0;c<h;c++)3==c?(e(s,n.merge(_.v0,_.v0,-3)),e(s,n.merge(_.v2,_.v2,-1)),e(s,n.merge(_.v3,_.v3,0))):e(s,n.merge(a[c],a[c],0)),void 0!==s.canvas.__vertices.object_info[a[c].__id][_.__id]&&delete s.canvas.__vertices.object_info[a[c].__id][_.__id],0===Object.keys(s.canvas.__vertices.object_info[a[c].__id]).length&&o.indexOf(a[c].__id)<0&&o.push(a[c].__id)}else if(_ instanceof text){var l=_.__comp;e(s,n.merge(l.getTransformedMesh(),l,0))}else if(void 0!==_.__components)for(var u=_.__components,p=0;p<u.length;p++){var l=u[p];e(s,n.merge(l.getTransformedMesh(),l,0))}else e(s,n.merge(_.getTransformedMesh(),_,0));_.visible=!1,_.__deleted=!0}for(var c=0;c<o.length;c++)s.canvas.__vertices.available.push(o[c]);s.pos=vec((s.__xmin+s.__xmax)/2,(s.__ymin+s.__ymax)/2,(s.__zmin+s.__zmax)/2);var d=s.size=vec(s.__xmax-s.__xmin,s.__ymax-s.__ymin,s.__zmax-s.__zmin);if("vpython"==window.__GSlang&&(s.axis=norm(s.axis).multiply(d.x)),0===Math.min(d.x,d.y,d.z)){var v=Math.max(d.x,d.y,d.z);0===d.x&&(s.size.__x=.001*v),0===d.y&&(s.size.__y=.001*v),0===d.z&&(s.size.__z=.001*v)}0===mag(s.axis)&&(s.axis.__x=s.size.__x),n.adjust(s.pos,s.size),compound_id++,n.__mesh_id="compound"+compound_id,s.canvas.__renderer.add_model(n,!1),s.__mesh=n,s.__model=s.canvas.__renderer.models[n.__mesh_id];var f=["axis","size","up"];for(var g in f){var b=f[g];void 0!==i[b]&&(s[b]=i[b],delete i[b])}for(var g in i)s[g]=i[g]}function compound(t,i){if(!(this instanceof compound))return new compound(t,i);if(void 0!==t.length||null!==t.canvas){if(i=i||{},void 0===t.length)throw new Error("compound takes a list of objects");initObject(this,compound,{});var e=!1;if(i.__cloning){e=!0;var s=i.__cloning;delete i.__cloning}var n=!0;if(void 0!==i.visible&&(n=i.visible,delete i.visible),e){this.__mesh=s,this.__model=this.canvas.__renderer.models[s.__mesh_id];for(var o in i)this[o]=i[o]}else i.self=this,make_compound(t,i);this.visible=n}}function vp_compound(t,i){if(!(this instanceof vp_compound))return new vp_compound(t,i);if(void 0!==t.length||null!==t.canvas){if(i=i||{},void 0===t.length)throw new Error("compound takes a list of objects");initObject(this,compound,{});var e=!1;if(i.__cloning){e=!0;var s=i.__cloning;delete i.__cloning}var n=!0;if(void 0!==i.visible&&(n=i.visible,delete i.visible),e){this.__mesh=s,this.__model=this.canvas.__renderer.models[s.__mesh_id];for(var o in i)this[o]=i[o]}else i.self=this,make_compound(t,i);this.visible=n}}function curve(t){if(!(this instanceof curve))return new curve(arguments);if(t=t||{},null!==t.canvas){var i=[];if(void 0!==arguments.length)for(var e=0;e<t.length;e++)i.push(t[e]);else for(var e=0;e<arguments.length;e++)i.push(arguments[e]);if(this.__color=vec(1,1,1),this.__radius=0,this.__retain=-1,this.pickable=!0,this.__points=[],1==i.length&&"object"==toType(i[0])){var s=i[0];if(void 0!==s.texture)throw new Error("Textures are not available for curve objects.");if(void 0!==s.opacity)throw new Error("Opacity is not available for curve objects.");var n=!1;void 0!==s.pos&&(n=!0,this.__pos=s.pos,delete s.pos),initObject(this,curve,s),n&&this.push(this.__pos)}else initObject(this,curve,{}),"array"==toType(i)&&"array"==toType(i[0])?this.push(i[0]):this.push(i)}}function point(t){if(!(this instanceof point))return new point(t);t instanceof vec&&(t={pos:t});for(var i in t)this[i]=t[i];if(void 0===this.pos)throw new Error("Must specify pos for a point on a curve")}function points(t){if(!(this instanceof points))return new points(arguments);if(t=t||{},null!==t.canvas){if(void 0!==t.texture)throw new Error("Textures are not available for points objects.");if(void 0!==t.opacity)throw new Error("Opacity is not available for points objects.");var i=[];if(void 0!==arguments.length)for(var e=0;e<t.length;e++)i.push(t[e]);else for(var e=0;e<arguments.length;e++)i.push(arguments[e]);if(this.__color=vec(1,1,1),this.__radius=0,this.__retain=-1,this.__pixels=!0,this.__points=[],this.pickable=!1,"array"==toType(i)&&1==i.length&&"object"==toType(i[0])){var s=i[0];if(void 0!==s.texture)throw new Error("Textures are not available for points objects.");if(void 0!==s.opacity)throw new Error("Opacity is not available for points objects.");var n=!1;void 0!==s.pos&&(n=!0,this.__pos=s.pos,delete s.pos),void 0!==s.size_units&&("world"==s.size_units&&(this.__pixels=!1),delete s.size_units),initObject(this,points,s),n&&this.push(this.__pos)}else initObject(this,points,{}),"array"==toType(i)&&"array"==toType(i[0])?this.push(i[0]):this.push(i);this.__last_range=-1,this.canvas.__points_objects.push(this)}}function helix(t){return initObject(this,helix,t)}function vp_helix(t){return initObject(this,vp_helix,t)}function arrayequals(t,i){var e=t.length,s=i.length;if(e!==s)return!1;for(var n=0;n<e;n++)if(t[n]!==i[n])return!1;return!0}function ring(t){return initObject(this,ring,t)}function vp_ring(t){return initObject(this,vp_ring,t)}function distant_light(t){if(!(this instanceof distant_light))return new distant_light(t);if(void 0===t.direction)throw new Error("Must specify the distant_light, direction:..");init(this,t),this.canvas.lights.push(this)}function local_light(t){if(!(this instanceof local_light))return new local_light(t);if(void 0===t.pos)throw new Error("Must specify the local_light position, pos:..");init(this,t),this.canvas.lights.push(this)}function draw(t){return this instanceof draw?(t=t||{},this.points=[],init(this,t),void this.canvas.__overlay_objects.objects.push(this)):new draw(t)}function label(t){return this instanceof label?(t=t||{},this.pos=this.pos,this.color=this.color,init(this,t),void this.canvas.__overlay_objects.objects.push(this)):new label(t)}function attach_trail(t,i){if(!(this instanceof attach_trail))return new attach_trail(t,i);void 0===i&&(i={}),this.__options={},this.__obj=t,void 0!==i.canvas?this.canvas=i.canvas:this.canvas=canvas.selected;var e=0;if(void 0===i.type)this.type="curve";else switch(i.type){case"curve":this.type=i.type;break;case"spheres":case"points":this.type="points",this.__options.size_units="world";break;default:throw new Error("attach_trail type must be 'curve' or 'points' (or 'spheres')")}"function"!=typeof t&&"string"!=typeof t?(this.canvas=t.canvas,this.__options.color=t.color,void 0===i.radius?"points"==this.type&&(e=.1*t.size.y):e=i.radius):void 0!==i.radius&&(e=i.radius),this.__options.radius=this.__radius=e,this.__options.canvas=this.canvas,void 0!==i.color?this.__options.color=i.color:this.__options.color=vec(1,1,1),this.__options.retain=-1,void 0!==i.retain&&(this.__options.retain=i.retain),this.pps=0,void 0!==i.pps&&(this.pps=i.pps),this.__options.pickable=!1;var s={};for(var n in this.__options)s[n]=this.__options[n];"curve"==this.type?this.__trail=curve(s):this.__trail=points(s),this.__trails=[this.__trail],this.canvas.trails.push(this),this.__last_pos=null,this.__last_time=null,this.__run=!0,this.__elements=0}function attach_arrow(t,i,e){if(!(this instanceof attach_arrow))return new attach_arrow(t,i,e);void 0===e&&(e={}),void 0===e.canvas&&(e.canvas=t.canvas),this.obj=t,this.attr=i,this.scale=1,void 0!==e.scale&&(this.scale=e.scale,delete e.scale),void 0===e.color&&(e.color=t.color),this.options=e;var s=e.canvas;"vpython"==window.__GSlang?this.arrow=vp_arrow(this.options):this.arrow=arrow(this.options),this.arrow.visible=!1,this.arrow.pickable=!1,this.last_pos=null,this.run=!0,this.shaftwidth=this.arrow.shaftwidth,this.color=this.arrow.color,s.arrows.push(this),this.start=function(){this.arrow.visible=this.run=!0},this.stop=function(){this.arrow.visible=this.run=!1}}function rgb_to_css(t){var i=Math.floor(255*t.x).toString(),e=Math.floor(255*t.y).toString(),s=Math.floor(255*t.z).toString();return"rgb("+i+","+e+","+s+")"}function radio(t){if(!(this instanceof radio))return new radio(t);var i=canvas.get_selected(),e={pos:i.caption_anchor,checked:!1,text:""};if(void 0===t.bind)throw new Error("A radio button must have a bind attribute.");e.bind=t.bind,delete t.bind;for(n in e)void 0!==t[n]&&(e[n]=t[n],delete t[n]);e.jradio=$('<input type="radio"/>').css({width:"16px",height:"16px"}).appendTo(e.pos).click(function(){e.checked=!e.checked,$(e.jradio).prop("checked",e.checked),e.bind(s)}),widgetid++,e._id=widgetid.toString(),$("<span id="+e._id+"> "+e.text+"</span>").appendTo(e.pos);var s={get checked(){return e.checked},set checked(t){e.checked=t,$(e.jradio).prop("checked",t)},get text(){return e.text},set text(t){e.text=t,$("#"+e.id).text(" "+t)}};for(var n in t)s[n]=t[n];return s.checked=e.checked,s}function checkbox(t){if(!(this instanceof checkbox))return new checkbox(t);var i=canvas.get_selected(),e={pos:i.caption_anchor,checked:!1,text:""};if(void 0===t.bind)throw new Error("A checkbox must have a bind attribute.");e.bind=t.bind,delete t.bind;for(n in e)void 0!==t[n]&&(e[n]=t[n],delete t[n]);e.jcheckbox=$('<input type="checkbox"/>').css({width:"16px",height:"16px"}).appendTo(e.pos).click(function(){e.checked=!e.checked,$(e.jcheckbox).prop("checked",e.checked),e.bind(s)}),widgetid++,e._id=widgetid.toString(),$("<span id="+e._id+"> "+e.text+"</span>").appendTo(e.pos);var s={get checked(){return e.checked},set checked(t){e.checked=t,$(e.jcheckbox).prop("checked",t)},get text(){return e.text},set text(t){e.text=t,$("#"+e.id).text(" "+t)}};for(var n in t)s[n]=t[n];return s.checked=e.checked,s}function button(t){if(!(this instanceof button))return new button(t);var i=canvas.get_selected(),e={pos:i.caption_anchor,text:" ",textcolor:vec(0,0,0),background:vec(1,1,1),disabled:!1};if(void 0===t.bind)throw new Error("A button must have a bind attribute.");e.bind=t.bind,delete t.bind;for(n in e)void 0!==t[n]&&(e[n]=t[n],delete t[n]);e.jbutton=$("<button/>").html(e.text).appendTo(e.pos).css({color:rgb_to_css(e.textcolor),backgroundColor:rgb_to_css(e.background),"font-size":"15px"}).click(function(){e.bind(s)}),$(e.pos).append(" ");var s={get disabled(){return e.disabled},set disabled(t){0===t?t=!1:1==t&&(t=!0),e.disabled=t,$(e.jbutton).attr("disabled",e.disabled),e.disabled?$(e.jbutton).css({color:rgb_to_css(vec(.7,.7,.7)),backgroundColor:rgb_to_css(vec(1,1,1))}):$(e.jbutton).css({color:rgb_to_css(e.textcolor),backgroundColor:rgb_to_css(e.background)})},get text(){return e.text},set text(t){e.text=t,$(e.jbutton).html(e.text)},get textcolor(){return e.textcolor},set textcolor(t){e.textcolor=t,$(e.jbutton).css({color:rgb_to_css(e.textcolor)})},get background(){return e.background},set background(t){e.background=t,$(e.jbutton).css({backgroundColor:rgb_to_css(e.background)})}};for(var n in t)s[n]=t[n];return s.disabled=e.disabled,s}function slider(t){if(!(this instanceof slider))return new slider(t);var i=canvas.get_selected(),e={pos:i.caption_anchor,length:400,width:10,vertical:!1,min:0,max:1,align:"left",left:0,right:0,top:0,bottom:0};if(void 0===t.bind)throw new Error("A slider must have a bind attribute.");e.bind=t.bind,delete t.bind;for(a in e)void 0!==t[a]&&(e[a]=t[a],delete t[a]);e.step=.001*(e.max-e.min),void 0!==t.step&&(e.step=t.step,delete t.step),e.value=e.min,void 0!==t.value&&(e.value=t.value,delete t.value),e._id="s"+slider_id,slider_id+=1;var s=e.top+"px "+e.right+"px "+e.bottom+"px "+e.left+"px",n="horizontal",o=e.length,r=e.width;e.vertical&&(n="vertical",o=e.width,r=e.length),$("<span id="+e._id+"></span>").css({width:o,height:r,"float":e.align,margin:s}).appendTo(e.pos),e.jslider=$("#"+e._id).slider({orientation:n,range:"min",min:e.min,max:e.max,value:e.value,step:e.step,change:function(t){void 0!==t.originalEvent&&e.bind(_)},slide:function(t){void 0!==t.originalEvent&&e.bind(_)}});var _={get min(){return e.min},set min(t){throw new Error("Cannot change the min of an existing slider.")},get max(){return e.max},set max(t){throw new Error("Cannot change the max of an existing slider.")},get value(){return $(e.jslider).slider("value")},set value(t){$(e.jslider).slider("value",t)},get width(){return e.width},set width(t){throw new Error("Cannot change the width of an existing slider.")},get length(){return e.length},set length(t){throw new Error("Cannot change the length of an existing slider.")}};for(var a in t)_[a]=t[a];return _}function menu(t){if(!(this instanceof menu))return new menu(t);var i=canvas.get_selected(),e={pos:i.caption_anchor,selected:null};if(void 0===t.bind)throw new Error("A menu must have a bind attribute.");if(e.bind=t.bind,delete t.bind,void 0!==t.pos&&(e.pos=t.pos,delete t.pos),void 0===t.choices)throw new Error("A menu must have a a list of choices.");e.choices=t.choices,delete t.choices,void 0!==t.selected&&(e.selected=t.selected,delete t.selected);for(var s="",n=0;n<e.choices.length;n++){var o=e.choices[n];s+=o===e.selected?'<option selected="selected">'+o+"</option>\n":"<option>"+o+"</option>\n"}e.jmenu=$("<select>"+s+"</select>").css("font-size","15px").change(function(){e.bind(r)}).appendTo(e.pos),$(e.pos).append(" ");var r={get selected(){return $(e.jmenu).val()},set selected(t){$(e.jmenu).val(t)},get choices(){return e.choices},set choices(t){throw new Error("The list of choices cannot be changed after creating a menu.")},get index(){return e.choices.indexOf($(e.jmenu).val())},set index(t){$(e.jmenu).val(e.choices[t])}};for(var _ in t)r[_]=t[_];return r}window.__adjustupaxis=!0;var nextVisibleId=1,textures={flower:":flower_texture.jpg",granite:":granite_texture.jpg",gravel:":gravel_texture.jpg",earth:":earth_texture.jpg",metal:":metal_texture.jpg",rock:":rock_texture.jpg",rough:":rough_texture.jpg",rug:":rug_texture.jpg",stones:":stones_texture.jpg",stucco:":stucco_texture.jpg",wood:":wood_texture.jpg",wood_old:":wood_old_texture.jpg"},bumpmaps={gravel:":gravel_bumpmap.jpg",rock:":rock_bumpmap.jpg",stones:":stones_bumpmap.jpg",stucco:":stucco_bumpmap.jpg",wood_old:":wood_old_bumpmap.jpg"};property.declare(Primitive.prototype,{__id:null,__hasPosAtCenter:!1,__deleted:!1,__zx_camera:null,__zy_camera:null,__xmin:null,__ymin:null,__zmin:null,__xmax:null,__ymax:null,__zmax:null,pos:new attributeVectorPos(null,0,0,0),size:new attributeVector(null,1,1,1),axis:new attributeVectorAxis(null,1,0,0),up:new attributeVectorUp(null,0,1,0),color:new attributeVector(null,1,1,1),opacity:{get:function(){return this.__opacity},set:function(t){t!=this.__opacity&&((this.__opacity<1&&1==t||1==this.__opacity&&t<1)&&(this.__opacity_change=!0),this.__opacity=t,this.__change())}},x:{get:function(){throw new Error('"object.x" is not supported; perhaps you meant "object.pos.x"')},set:function(t){throw new Error('"object.x" is not supported; perhaps you meant "object.pos.x"')}},y:{get:function(){throw new Error('"object.y" is not supported; perhaps you meant "object.pos.y"')},set:function(t){throw new Error('"object.y" is not supported; perhaps you meant "object.pos.y"')}},z:{get:function(){throw new Error('"object.z" is not supported; perhaps you meant "object.pos.z"')},set:function(t){throw new Error('"object.z" is not supported; perhaps you meant "object.pos.z"')}},__opacity_change:!1,__prev_opacity:null,shininess:{value:.6,onchanged:function(){this.__change()}},emissive:{value:!1,onchanged:function(){this.__change()}},pickable:{value:!0,onchanged:function(){this.__change()}},ready:{get:function(){return null===this.__tex.file||null!==this.__tex.texture_ref.reference&&null===this.__tex.bumpmap||null!==this.__tex.bumpmap_ref.reference}},make_trail:{get:function(){return this.__make_trail},set:function(t){this.__make_trail!==t&&(t?(this.__trail_object.start(),this.__trail_object.__trail.push(this.__pos)):this.__trail_object.stop(),this.__make_trail=t)}},retain:{get:function(){return this.__retain},set:function(t){this.__retain=t,void 0!==this.__trail_object&&(this.__trail_object.retain=t)}},trail_type:{get:function(){return"curve"==this.__trail_type?"curve":"spheres"==this.__trail_type?"points":this.__trail_type},set:function(t){throw new Error('"trail_type" cannot be changed.')}},trail_color:{get:function(){return this.__color},set:function(t){this.__trail_color=t,void 0!==this.__trail_object&&(this.__trail_object.color=t)}},trail_radius:{get:function(){return this.__radius},set:function(t){this.__trail_radius=t,void 0!==this.__trail_object&&(this.__trail_object.radius=t)}},pps:{get:function(){return this.__pps},set:function(t){this.__pps=t,void 0!==this.__trail_object&&(this.__trail_object.pps=t)}},clear_trail:function(){void 0!==this.__trail_object&&this.__trail_object.clear()},__update_trail:function(t){if(this.__trail_object.__run&&this.visible&&this.__interval!==-1){this.__ninterval++;var i=!1;this.__ninterval>=this.__interval?(this.__ninterval=0,i=!0):1==this.__ninterval&&0===this.__trail_object.__trail.__points.length&&(i=!0),i&&(this.__retain==-1?this.__trail_object.__trail.push({pos:t,color:this.__trail_color,radius:this.__trail_radius}):this.__trail_object.__trail.push({pos:t,color:this.__trail_color,radius:this.__trail_radius,retain:this.__retain}))}},texture:{get:function(){return{file:this.__tex.file,bumpmap:this.__tex.bumpmap,left:this.__tex.left,right:this.__tex.right,sides:this.__tex.sides,flipx:this.__tex.flipx,flipy:this.__tex.flipy,turn:this.__tex.turn}},set:function(t){if(this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:!1,right:!1,sides:!1,flipx:!1,flipy:!1,turn:0,flags:0},null===t);else if("string"==typeof t)this.__tex.left=this.__tex.right=this.__tex.sides=!0,setup_texture(t,this,!1);else{if(void 0===t.file||"string"!=typeof t.file)throw new Error("You must specify a file name for a texture.");if(setup_texture(t.file,this,!1),void 0!==t.bumpmap&&null!==t.bumpmap){if("string"!=typeof t.bumpmap)throw new Error("You must specify a file name for a bumpmap.");setup_texture(t.bumpmap,this,!0)}if(void 0!==t.flipx&&(this.__tex.flipx=t.flipx),void 0!==t.flipy&&(this.__tex.flipy=t.flipy),void 0!==t.turn&&(this.__tex.turn=Math.round(t.turn)),void 0!==t.place){"string"==typeof t.place&&(t.place=[t.place]);for(var i=0;i<t.place.length;i++)switch(t.place[i]){case"left":this.__tex.left=!0;break;case"right":this.__tex.right=!0;break;case"sides":this.__tex.sides=!0;break;case"ends":this.__tex.left=this.__tex.right=!0;break;case"all":this.__tex.left=this.__tex.right=this.__tex.sides=!0}}else this.__tex.left=this.__tex.right=this.__tex.sides=!0}this.__tex.flags=0,null!==this.__tex.file&&(this.__tex.flags+=1),null!==this.__tex.bumpmap&&(this.__tex.flags+=2),this.__tex.left&&(this.__tex.flags+=4),this.__tex.right&&(this.__tex.flags+=8),this.__tex.sides&&(this.__tex.flags+=16),this.__tex.flipx&&(this.__tex.flags+=32),this.__tex.flipy&&(this.__tex.flags+=64);var e=this.__tex.turn%4;e<0&&(e+=4),this.__tex.flags+=128*e,this.__change()}},visible:{get:function(){return this.__obj?null!=this.__obj.__id:null!=this.__id},set:function(t){if(!this.__obj){var i=this;if(t!=(null!=i.__id)&&!i.__deleted)if(i.__curve&&(i.__curve.visible=t),t){if(i.constructor==vp_arrow||i.constructor==arrow){i.__components||i.__update(),i.__id=nextVisibleId;var e;nextVisibleId++;for(var s=0;s<i.__components.length;s++){var n=i.__components[s];n.__id=nextVisibleId,0===s&&(e=id_to_falsecolor(nextVisibleId)),n.__falsecolor=e,i.canvas.__visiblePrimitives[nextVisibleId]=n,i.canvas.__changed[nextVisibleId]=n,nextVisibleId++}}else i.__id=nextVisibleId,i.__falsecolor=id_to_falsecolor(nextVisibleId),i.canvas.__visiblePrimitives[nextVisibleId]=i,i.canvas.__changed[nextVisibleId]=i,nextVisibleId++;i instanceof extrusion&&(i.__vis=t)}else{if(i.constructor==vp_arrow||i.constructor==arrow)for(var s=0;s<i.__components.length;s++){var n=i.__components[s];delete i.canvas.__visiblePrimitives[n.__id],delete i.canvas.__changed[n.__id],n.__model&&delete n.__model.id_object[n.__id]}else delete i.canvas.__visiblePrimitives[i.__id],delete i.canvas.__changed[i.__id],i.__model&&delete i.__model.id_object[i.__id];i instanceof extrusion&&(i.__vis=t),i.__id=null}}}},clone:function(t){if(this instanceof triangle||this instanceof quad)throw new Error("Cannot clone a "+this.constructor.name+" object.");t=t||{};var i,e={up:vec(this.__up),color:vec(this.__color)};if(this instanceof curve||(e.pos=vec(this.__pos)),this instanceof text||(e.size=vec(this.__size)),this instanceof arrow?e.__axis_and_length=vec(this.__axis_and_length):e.__axis=vec(this.__axis),this instanceof text){var s=this.__comp.clone(),n=this.__billboard;void 0!==t.billboard&&(n=t.billboard,delete t.billboard);var o={canvas:this.canvas,__text:this.text,__align:this.align,__height:this.height,__depth:this.depth,__comp:s,__font:this.font,__billboard:this.billboard,__color:this.color,shininess:this.shininess,emissive:this.emissive,opacity:this.opacity,__show_start_face:this.show_start_face,__show_end_face:this.show_end_face,__start_face_color:this.start_face_color,__end_face_color:this.end_face_color,__descender:this.descender,__lines:this.lines,visible:!0,__pickable:this.__pickable};i=new text(o)}else if(this instanceof curve){e.__origin=vec(this.__origin);for(var r=[],_=0;_<this.npoints;_++)r.push(this.point(_).pos);var o={pos:r,__radius:this.__radius,__shininess:this.__shininess,__emissive:this.__emissive,visible:!0,__pickable:this.__pickable};i=new curve(o)}else if(this instanceof helix||this instanceof vp_helix){var o={__thickness:this.__thickness,__coils:this.__coils,__shininess:this.__shininess,__emissive:this.__emissive,visible:!0,__pickable:this.__pickable};i=new this.constructor(o)}else{var o={__opacity:this.__opacity,__tex:this.__tex,__shininess:this.__shininess,__emissive:this.__emissive,visible:!0,__pickable:this.__pickable};(this instanceof arrow||this instanceof vp_arrow)&&(o.shaftwidth=this.__shaftwidth,o.headwidth=this.__headwidth,o.headlength=this.__headlength),i=new this.constructor(o)}for(var a in e)i[a].__x=e[a].x,i[a].__y=e[a].y,i[a].__z=e[a].z;for(var a in t)i[a]=t[a];return i.__update(),i},__change:function(){this.__id&&(this.canvas.__changed[this.__id]=this)},__get_extent:function(t){Autoscale.find_extent(this,t)},__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__update:function(){if(null!==this.__id){var t=this.__pos,i=this.__size,e=this.__color,s=this.__axis,n=this.__up,o=this.__data;o||(this.__data=o=new Float32Array(20)),this.__model.id_object[this.__id]=this,o[0]=t.__x,o[1]=t.__y,o[2]=t.__z,o[3]=this.__shininess,o[4]=s.__x,o[5]=s.__y,o[6]=s.__z,o[7]=this.__emissive?1:0,o[8]=n.__x,o[9]=n.__y,o[10]=n.__z,o[11]=this.__tex.flags,o[12]=i.__x,o[13]=i.__y,o[14]=i.__z,o[16]=e.__x,o[17]=e.__y,o[18]=e.__z,o[19]=this.__opacity}},rotate:function(t){var i=this,e=i.constructor==curve,s=i.constructor==arrow,n=e?i.origin:i.pos;if(void 0!==t.origin&&(n=t.origin),void 0===t||void 0===t.angle)throw new Error("object.rotate() requires an angle.");var o=t.angle;if(0!==o){var r;r=void 0===t.axis?i.__axis:t.axis,e?i.origin=n.add(i.__origin.sub(n).rotate({angle:o,axis:r})):n.equals(i.pos)||(i.pos=n.add(i.__pos.sub(n).rotate({angle:o,axis:r}))),window.__adjustupaxis=!1,diff_angle(i.__axis,r)>1e-6?(s?i.axis_and_length=i.axis_and_length.rotate({angle:o,axis:r}):i.axis=i.__axis.rotate({angle:o,axis:r}),i.up=i.__up.rotate({angle:o,axis:r})):i.up=i.__up.rotate({angle:o,axis:r}),window.__adjustupaxis=!0}},
getTransformedMesh:function(){var t=this.__axis.norm(),i=this.__up.norm(),e=t.cross(i),s=this.__pos;if(this instanceof ring||this instanceof vp_ring){var n=Mesh.makeRing_compound(this.__size),o=[t.x,t.y,t.z,0,i.x,i.y,i.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,1];return n.transformed(o)}t=t.multiply(this.__size.x),i=i.multiply(this.__size.y),e=e.multiply(this.__size.z);var o=[t.x,t.y,t.z,0,i.x,i.y,i.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,1];return this.__model.mesh.transformed(o)}}),subclass(box,Primitive),box.prototype.__hasPosAtCenter=!0,subclass(cylinder,Primitive),subclass(cone,cylinder),subclass(pyramid,box),subclass(sphere,Primitive),sphere.prototype.__hasPosAtCenter=!0,subclass(vp_box,box),property.declare(vp_box.prototype,{size:new attributeVectorSize(null,1,1,1),length:{get:function(){return this.__size.__x},set:function(t){this.axis=this.__axis.norm().multiply(t),this.__change()}},height:{get:function(){return this.__size.__y},set:function(t){this.__size.__y=t,this.__change()}},width:{get:function(){return this.__size.__z},set:function(t){this.__size.__z=t,this.__change()}},red:{get:function(){return this.__color.__x},set:function(t){this.__color.__x=t,this.__change()}},green:{get:function(){return this.__color.__y},set:function(t){this.__color.__y=t,this.__change()}},blue:{get:function(){return this.__color.__z},set:function(t){this.__color.__z=t,this.__change()}}}),subclass(vp_pyramid,vp_box),subclass(vp_sphere,vp_box),property.declare(vp_sphere.prototype,{axis:new attributeVectorAxis(null,1,0,0),size:new attributeVector(null,2,2,2),radius:{get:function(){return this.__size.__y/2},set:function(t){this.size=vec(2*t,2*t,2*t),this.__change()}}}),subclass(vp_ellipsoid,vp_box),property.declare(vp_ellipsoid.prototype,{radius:{get:function(){throw new Error("An ellipsoid does not have a radius attribute.")},set:function(t){throw new Error("An ellipsoid does not have a radius attribute.")}}}),subclass(vp_cylinder,vp_box),property.declare(vp_cylinder.prototype,{size:new attributeVectorSize(null,1,2,2),radius:{get:function(){return this.__size.__y/2},set:function(t){this.__size.__y=this.__size.__z=2*t,this.__change()}}}),subclass(vp_cone,vp_cylinder),subclass(arrow,box),property.declare(arrow.prototype,{__primitiveCount:2,shaftwidth:{get:function(){return this.__shaftwidth},set:function(t){this.__shaftwidth=t,this.__change()}},headwidth:{get:function(){return this.__headwidth},set:function(t){this.__headwidth=t,this.__change()}},headlength:{get:function(){return this.__headlength},set:function(t){this.__headlength=t,this.__change()}},axis_and_length:new attributeVectorAxis(null,1,0,0),axis:{get:function(){new Error("arrow has an axis_and_length attribute but no axis attribute")},set:function(t){new Error("arrow has an axis_and_length attribute but no axis attribute")}},__change:function(){this.__components&&(this.__components[0].__change(),this.__components[1].__change())},__update:function(){arrow_update(this,!1)},__get_extent:function(t){this.__components||this.__update(),Autoscale.find_extent(this.__components[0],t),Autoscale.find_extent(this.__components[1],t)}}),subclass(vp_arrow,arrow),property.declare(vp_arrow.prototype,{axis:new attributeVectorAxis(null,1,0,0),axis_and_length:{get:function(){new Error("arrow has an axis attribute but no axis_and_length attribute")},set:function(t){new Error("arrow has an axis attribute but no axis_and_length attribute")}},length:{get:function(){return mag(this.__axis)},set:function(t){this.axis=this.__axis.norm().multiply(t)}},__update:function(){arrow_update(this,!0)}}),subclass(text,Primitive),property.declare(text.prototype,{size:{get:function(){throw new Error("A text object does not have a size attribute.")},set:function(t){throw new Error("A text object does not have a size attribute.")}},visible:{get:function(){return this.__comp.visible},set:function(t){this.__comp.visible=t}},__update:function(){window.__adjustupaxis=!1,this.__comp.axis=this.axis,this.__comp.up=this.up,window.__adjustupaxis=!0;var t=this.__pseudosize.y;this.__comp.size=vec(this.length,t,Math.abs(this.depth)),this.__comp.color=this.color;var i=this.upper_left,e=cross(this.axis,this.up).multiply(this.depth/2);this.__comp.pos=i.add(this.axis.norm().multiply(this.length/2)).sub(this.up.norm().multiply(t/2)).add(e)},length:{get:function(){return this.__pseudosize.x},set:function(t){t!==this.__pseudosize.x&&(this.__pseudosize.x=t,this.__change())}},height:{get:function(){return this.__height_fraction*this.__pseudosize.y},set:function(t){this.__pseudosize.size.y=t/this.__height_fraction,this.__change()}},depth:{get:function(){return this.__depth>=0?this.__pseudosize.z:-this.__pseudosize.z},set:function(t){var i=this.__depth;Math.abs(t)<.01*i&&(t=t<0?-.01*i:.01*i),this.__depth=t,this.__size.z=Math.abs(t),this.__change()}},descender:{get:function(){return this.__descender_fraction*this.__pseudosize.y},set:function(t){throw new Error("descender is read-only")}},opacity:{get:function(){return this.__opacity},set:function(t){this.__comp.opacity=this.__opacity=t,this.__change()}},shininess:{get:function(){return this.__shininess},set:function(t){this.__shininess=this.__comp.shininess=t,this.__change()}},emissive:{get:function(){return this.__emissive},set:function(t){this.__comp.emissive=this.__emissive=t,this.__change()}},texture:{get:function(){throw new Error("Cannot currently apply a texture to a text object")},set:function(t){throw new Error("Cannot currently apply a texture to a text object")}},text:{get:function(){return this.__text},set:function(t){throw new Error("text is read-only")}},font:{get:function(){return this.__font},set:function(t){throw new Error("font is read-only")}},align:{get:function(){return this.__align},set:function(t){throw new Error("align is read-only")}},billboard:{get:function(){return this.__billboard},set:function(t){throw new Error("billboard is read-only")}},show_start_face:{get:function(){return this.__show_start_face},set:function(t){throw new Error("show_start_face is read-only")}},show_end_face:{get:function(){return this.__show_end_face},set:function(t){throw new Error("show_end_face is read-only")}},start_face_color:{get:function(){return this.__start_face_color},set:function(t){throw new Error("start_face_color is read-only")}},end_face_color:{get:function(){return this.__end_face_color},set:function(t){throw new Error("end_face_color is read-only")}},start:{get:function(){return this.upper_left.sub(this.up.norm().multiply(this.height))},set:function(t){throw new Error("start is read-only")}},end:{get:function(){return this.upper_right.sub(this.up.norm().multiply(this.height))},set:function(t){throw new Error("end is read-only")}},vertical_spacing:{get:function(){return 1.5*this.height},set:function(t){throw new Error("vertical_spacing is read-only")}},upper_left:{get:function(){var t=0;return"right"==this.__align?t=-this.length:"center"==this.__align&&(t=-this.length/2),this.pos.add(this.up.norm().multiply(this.height)).add(this.axis.norm().multiply(t))},set:function(t){throw new Error("upper_left is read-only")}},upper_right:{get:function(){return this.upper_left.add(this.axis.norm().multiply(this.length))},set:function(t){throw new Error("upper_right is read-only")}},lower_left:{get:function(){return this.upper_left.add(this.up.norm().multiply(-this.height-this.descender-1.5*this.height*(this.__lines-1)))},set:function(t){throw new Error("lower_left is read-only")}},lower_right:{get:function(){return this.lower_left.add(this.axis.norm().multiply(this.length))},set:function(t){throw new Error("lower_right is read-only")}},lines:{get:function(){return this.__lines},set:function(t){throw new Error("lines is read-only")}}}),property.declare(vertex.prototype,{__id:null,__hasPosAtCenter:!0,pos:new attributeVector(null,0,0,0),normal:new attributeVector(null,0,0,1),color:new attributeVector(null,1,1,1),opacity:{get:function(){return this.__opacity},set:function(t){if(t!=this.__opacity){if(this.__opacity<1&&1==t||1==this.__opacity&&t<1){var i=this.canvas.__vertices.object_info[this.__id];for(var e in i)i[e].__change(),i[e].__opacity_change=!0}this.__opacity=t,this.canvas.__vertex_changed[this.__id]=this}}},texpos:new attributeVector(null,0,0,0),bumpaxis:new attributeVector(null,1,0,0),shininess:{value:.6,onchanged:function(){this.__change()}},emissive:{value:!1,onchanged:function(){this.__change()}},__change:function(){if(this.__id&&(this.canvas.__vertex_changed[this.__id]=this,this.canvas.__autoscale)){var t=this.canvas.__vertices.object_info[this.__id];for(var i in t)t[i].__change()}},rotate:function(t){if(void 0===t.angle)throw new Error("vertex.rotate() requires angle:...");var i=t.angle;if(void 0===t.axis)throw new Error("vertex.rotate() requires axis:...");var e,s=t.axis.norm();e=void 0===t.origin?vec(0,0,0):t.origin,this.pos=e.add(this.__pos.sub(e).rotate({angle:i,axis:s})),this.__change()}}),subclass(triangle,box),property.declare(triangle.prototype,{v0:{get:function(){return this.__v0},set:function(t){if(!(t instanceof vertex))throw new Error("v0 must be a vertex object.");this.__v0=t,this.__change()}},v1:{get:function(){return this.__v1},set:function(t){if(!(t instanceof vertex))throw new Error("v1 must be a vertex object.");this.__v1=t,this.__change()}},v2:{get:function(){return this.__v2},set:function(t){if(!(t instanceof vertex))throw new Error("v2 must be a vertex object.");this.__v2=t,this.__change()}},vs:{get:function(){return[this.__v0,this.__v1,this.__v2]},set:function(t){if("array"!=toType(t)||3!=t.length)throw new Error("triangle.vs must be a list of 3 vertex objects.");for(var i=0;i<3;i++)if(!(t[i]instanceof vertex))throw new Error("triangle.vs must contain vertex objects.");this.__v0=t[0],this.__v1=t[1],this.__v2=t[2],this.__change()}},pos:{get:function(){tri_quad_error("triangle","pos")},set:function(t){tri_quad_error("triangle","pos")}},color:{get:function(){tri_quad_error("triangle","color")},set:function(t){tri_quad_error("triangle","color")}},size:{get:function(){tri_quad_error("triangle","size")},set:function(t){tri_quad_error("triangle","size")}},axis:{get:function(){tri_quad_error("triangle","axis")},set:function(t){tri_quad_error("triangle","axis")}},up:{get:function(){tri_quad_error("triangle","up")},set:function(t){tri_quad_error("triangle","up")}},opacity:{get:function(){tri_quad_error("triangle","opacity")},set:function(t){tri_quad_error("triangle","opacity")}},shininess:{get:function(){tri_quad_error("triangle","shininess")},set:function(t){tri_quad_error("triangle","shininess")}},emissive:{get:function(){tri_quad_error("triangle","emissive")},set:function(t){tri_quad_error("triangle","emissive")}},__prev_texture:null,__prev_bumpmap:null,__update:function(){this.__model.id_object[this.__id]=this},__get_extent:function(t){for(var i=["__v0","__v1","__v2"],e=0;e<3;e++)t.point_extent(this,this[i[e]].pos)},rotate:function(t){throw new Error("A triangle has no rotate method; rotate the vertices instead.")}}),subclass(quad,box),property.declare(quad.prototype,{v0:{get:function(){return this.__v0},set:function(t){if(!(t instanceof vertex))throw new Error("v0 must be a vertex object.");this.__v0=t,this.__change()}},v1:{get:function(){return this.__v1},set:function(t){if(!(t instanceof vertex))throw new Error("v1 must be a vertex object.");this.__v1=t,this.__change()}},v2:{get:function(){return this.__v2},set:function(t){if(!(t instanceof vertex))throw new Error("v2 must be a vertex object.");this.__v2=t,this.__change()}},v3:{get:function(){return this.__v3},set:function(t){if(!(t instanceof vertex))throw new Error("v3 must be a vertex object.");this.__v3=t,this.__change()}},vs:{get:function(){return[this.__v0,this.__v1,this.__v2,this.__v3]},set:function(t){if("array"!=toType(t)||4!=t.length)throw new Error("quad.vs must be a list of 4 vertex objects.");for(var i=0;i<4;i++)if(!(t[i]instanceof vertex))throw new Error("quad.vs must contain vertex objects.");this.__v0=t[0],this.__v1=t[1],this.__v2=t[2],this.__v3=t[3],this.__change()}},pos:{get:function(){tri_quad_error("quad","pos")},set:function(t){tri_quad_error("quad","pos")}},color:{get:function(){tri_quad_error("quad","color")},set:function(t){tri_quad_error("quad","color")}},size:{get:function(){tri_quad_error("quad","size")},set:function(t){tri_quad_error("quad","size")}},axis:{get:function(){tri_quad_error("quad","axis")},set:function(t){tri_quad_error("quad","axis")}},up:{get:function(){tri_quad_error("quad","up")},set:function(t){tri_quad_error("quad","up")}},opacity:{get:function(){tri_quad_error("quad","opacity")},set:function(t){tri_quad_error("quad","opacity")}},shininess:{get:function(){tri_quad_error("quad","shininess")},set:function(t){tri_quad_error("quad","shininess")}},__prev_texture:null,__prev_bumpmap:null,__update:function(){this.__model.id_object[this.__id]=this},__get_extent:function(t){for(var i=["__v0","__v1","__v2","__v3"],e=0;e<4;e++)t.point_extent(this,this[i[e]].pos)},rotate:function(t){throw new Error("A quad has no rotate method; rotate the vertices instead.")}});var compound_id=0;subclass(compound,box),property.declare(compound.prototype,{clone:function(t){t=t||{};var i={__pos:vec(this.__pos),__axis:vec(this.__axis),__size:vec(this.__size),__up:vec(this.__up),__color:vec(this.__color)},e={__opacity:this.__opacity,__shininess:this.__shininess,__emissive:this.__emissive,visible:!0,__pickable:this.__pickable,__center:this.__center,__pseudosize:this.__pseudosize};null!==this.texture.file&&(e.texture=this.texture),e.__cloning=this.__mesh;var s=new this.constructor([],e);for(var n in i)s[n].__x=i[n].x,s[n].__y=i[n].y,s[n].__z=i[n].z;for(var n in t)s[n]=t[n];return s.__update(),s},_world_zaxis:function(){return this.__axis.cross(this.__up).norm()},world_to_compound:function(t){var i=this.__axis,e=this._world_zaxis(),s=this.__up,n=i.norm(),t=t.sub(this.__pos);return vec(t.dot(n),t.dot(s),t.dot(e))},compound_to_world:function(t){var i=this.__axis,e=this._world_zaxis(),s=this.__up,n=i.norm();return this.__pos.add(n.multiply(t.x)).add(s.multiply(t.y)).add(e.multiply(t.z))},__get_model:function(){return this.__model}}),subclass(vp_compound,compound),property.declare(vp_compound.prototype,{size:new attributeVectorSize(null,1,1,1),length:{get:function(){return this.__size.__x},set:function(t){this.axis=this.__axis.norm().multiply(t),this.__change()}},height:{get:function(){return this.__size.__y},set:function(t){this.__size.__y=t,this.__change()}},width:{get:function(){return this.__size.__z},set:function(t){this.__size.__z=t,this.__change()}},red:{get:function(){return this.__color.__x},set:function(t){this.__color.__x=t,this.__change()}},green:{get:function(){return this.__color.__y},set:function(t){this.__color.__y=t,this.__change()}},blue:{get:function(){return this.__color.__z},set:function(t){this.__color.__z=t,this.__change()}}});var toType=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};subclass(curve,Primitive),property.declare(curve.prototype,{origin:new attributeVectorPos(null,0,0,0),pos:{get:function(){throw new Error("Use methods to read curve or points pos attribute.")},set:function(t){throw new Error("Use methods to change curve or points pos attribute.")}},radius:{get:function(){return this.__radius},set:function(t){this.__radius=t,this.__change()}},retain:{get:function(){return this.__retain},set:function(t){this.__retain=t,this.__change()}},npoints:{get:function(){return this.__points.length},set:function(t){throw new Error("Cannot change curve or points npoints.")}},__no_autoscale:!1,__get_extent:function(t){if(!this.__no_autoscale){for(var i,e=null,s=null,n=null,o=null,r=null,_=null,a=this.__points.length,h=this.__points,c=0;c<a;c++)i=h[c].__pos,(null===e||i.x<e)&&(e=i.x),(null===s||i.y<s)&&(s=i.y),(null===n||i.z<n)&&(n=i.z),(null===o||i.x>o)&&(o=i.x),(null===r||i.y>r)&&(r=i.y),(null===_||i.z>_)&&(_=i.z);var l=vec((e+o)/2,(s+r)/2,(n+_)/2),u=vec(o-e,r-s,_-n),p=this.__pos,d=this.__size;this.__pos=l,this.__size=u,this.__hasPosAtCenter=!0,t.xmin=e,t.xmax=o,t.ymin=s,t.ymax=r,t.zmin=n,t.zmax=_,Autoscale.find_extent(this,t),this.__pos=p,this.__size=d}},push:function(t){var i,e=[];if(void 0!==t.length)e=1==t.length?t[0]:t;else for(var s=0;s<arguments.length;s++)e.push(arguments[s]);var n={},o=["color","radius","retain","visible"];for(var r in o){var _=o[r];if("radius"==_&&_ in e&&this.constructor==points)throw new Error("In a points object, you cannot specify the radius of an individual point.");_ in e&&(n[_]=e[_])}var a=toType(e),h=!1;e instanceof vec?e=[{pos:e}]:"array"==a?e[0]instanceof vec?e=[{pos:e}]:"object"==toType(e[0])&&(h=!0):"object"==a&&(e=[e]);for(var s=0;s<e.length;s++){var c=e[s];i=c,"pos"in c&&(i=c.pos),"array"!=toType(i)&&(i=[i]);for(var l=0;l<i.length;l++){var u=i[l];"array"==toType(u)&&(u=vec(u[0],u[1],u[2]));var p;if(h)p=c,p.pos=u;else{p={pos:u};for(var r in n)p[r]=n[r]}if(this.constructor==curve){var d=point(p),v=this.__retain;if(void 0!==p.retain&&(v=p.retain),v>-1&&this.__points.length>=v){for(var f=this.__points.length-v,g=0;g<f;g++){var b=this.__points.shift();b.visible=!1}var x=this.__points[this.__points.length-1],d=this.__points.shift();for(var r in p)d[r]=p[r];this.__points.push(d);var w=d.__prevsegment=x.__nextsegment=new Float32Array(16);w[11]=w[15]=1,x.__change(),d.__change()}else{if(d.__curve=this,d.__id=nextVisibleId++,this.canvas.__visiblePrimitives[d.__id]=d,d.__falsecolor=id_to_falsecolor(d.__id),this.__points.length){var x=this.__points[this.__points.length-1],w=d.__prevsegment=x.__nextsegment=new Float32Array(16);w[11]=w[15]=1,x.__change()}this.__points.push(d),d.__change()}}else{var v=this.__retain;if(void 0!==p.retain&&(v=p.retain),v>-1&&this.__points.length>=v){for(var f=this.__points.length-v,g=0;g<f;g++){var b=this.__points.shift();b.visible=!1}var x=this.__points[this.__points.length-1],d=this.__points.shift();for(var r in p)d[r]=p[r];this.__points.push(d),d.__change()}else{var m=2*this.__radius,y=void 0===p.color?this.__color:p.color;this.__points.length>0&&this.__last_range!=-1&&this.__last_range===this.canvas.__range?m=this.__points[0].__size.x:(m=0,this.__last_range=-1),"vpython"==window.__GSlang?this.__points.push(vp_sphere({pos:p.pos,size:vec(m,m,m),color:y,pickable:!1})):this.__points.push(sphere({pos:p.pos,size:vec(m,m,m),color:y,pickable:!1}))}}}}this.__change()},append:function(t){var i=[];if(void 0!==t.length)i=t;else for(var e=0;e<arguments.length;e++)i.push(arguments[e]);this.push(i)},pop:function(){var t=this.__points.pop();return t.visible=!1,this.__change(),{pos:t.pos,color:t.color,radius:t.radius,visible:t.visible}},point:function(t){var i=this.__points.slice(t,t+1)[0];return{pos:i.pos,color:i.color,radius:i.radius,visible:i.visible}},clear:function(){this.splice(0,this.__points.length),this.__points=[],this.__change()},shift:function(){var t=this.__points.shift();return t.visible=!1,this.__change(),{pos:t.pos,color:t.color,radius:t.radius,visible:t.visible}},unshift:function(t){var i=[];if(void 0!==t.length)i=t;else for(var e=0;e<arguments.length;e++)i.push(arguments[e]);this.splice(0,0,i),this.__change()},splice:function(t){for(var i=arguments[0],e=arguments[1],s=[],n=2;n<arguments.length;n++)s.push(arguments[n]);1==s.length&&void 0!==s[0].length&&(s=s[0]);for(var o=this.__points.slice(i+e),r=[],n=0;n<o.length;n++)r.push({pos:o[n].pos,color:o[n].color,radius:o[n].radius,visible:o[n].visible});for(var n=i;n<this.__points.length;n++)this.__points[n].visible=!1;this.__points.splice(i),this.push(s),this.push(r),this.__change()},modify:function(t,i){t<0&&(t+=this.__points.length),i instanceof vec&&(i={pos:i});for(var e in i)"x"==e?this.__points[t].pos.x=i[e]:"y"==e?this.__points[t].pos.y=i[e]:"z"==e?this.__points[t].pos.z=i[e]:this.__points[t][e]=i[e];this.__points[t].__change(),this.__change()},slice:function(t,i){t<0&&(t+=this.__points.length),i<0&&(i+=this.__points.length);for(var e=this.__points.slice(t,i),s=[],n=0;n<e.length;n++)s.push({pos:e[n].pos,color:e[n].color,radius:e[n].radius,visible:e[n].visible});return s},__update:function(){var t=this.__origin,i=this.__size,e=this.__color,s=this.__axis,n=this.__up,o=this.__data;o||(this.__data=o=new Float32Array(20)),this.__model.id_object[this.__id]=this,o[0]=t.__x,o[1]=t.__y,o[2]=t.__z,o[3]=this.__shininess,o[4]=s.__x,o[5]=s.__y,o[6]=s.__z,o[7]=this.__emissive?1:0,o[8]=n.__x,o[9]=n.__y,o[10]=n.__z,o[12]=i.__x,o[13]=i.__y,o[14]=i.__z,o[15]=this.__radius,o[16]=e.__x,o[17]=e.__y,o[18]=e.__z,o[19]=this.__opacity}}),property.declare(point.prototype,{__curve:null,pos:new attributeVector(null,0,0,0),color:new attributeVector(null,(-1),(-1),(-1)),pickable:{value:!0,onchanged:function(){this.__change()}},visible:{value:!0,onchanged:function(){this.__change()}},__change:function(){this.__id&&(this.__curve.canvas.__changed[this.__id]=this,this.__curve.canvas.__changed[this.__curve.__id]=this.__curve)},__update:function(){var t=this.__pos,i=this.radius||-1,e=this.color||vec(-1,-1,-1),s=this.__prevsegment;s&&(s[4]=t.x,s[5]=t.y,s[6]=t.z,s[7]=i,s[12]=e.x,s[13]=e.y,s[14]=e.z),s=this.__nextsegment,s&&(s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=i,s[8]=e.x,s[9]=e.y,s[10]=e.z)}}),subclass(points,curve),property.declare(points.prototype,{origin:{get:function(){throw new Error("The points object has no origin attribute.")},set:function(t){throw new Error("The points object has no origin attribute.")}},axis:{get:function(){throw new Error("The points object has no axis attribute.")},set:function(t){throw new Error("The points object has no axis attribute.")}},up:{get:function(){throw new Error("The points object has no up attribute.")},set:function(t){throw new Error("The points object has no up attribute.")}},size:{get:function(){throw new Error("The points object has no size attribute.")},set:function(t){throw new Error("The points object has no size attribute.")}},size_units:{get:function(){return this.__pixels?"pixels":"world"},set:function(t){if("pixels"==t)this.__pixels=!0;else{if("world"!=t)throw new Error("The points object ");this.__pixels=!1}}},rotate:{get:function(t){throw new Error("The points object has no rotate method.")}},shape:{get:function(){return"round"},set:function(t){if("round"!=t)throw new Error('The points object only supports shape = "round".')}},visible:{get:function(){return this.__visible},set:function(t){for(var i in this.__points)this.__points[i].visible=t;this.__visible=t}},__update:function(){}}),subclass(helix,cylinder),property.declare(helix.prototype,{__initialize:!0,thickness:{value:0,onchanged:function(){this.__change()}},coils:{value:5,onchanged:function(){this.__initialize=!0,this.__change()}},__update:function(){var t=20;this.__initialize&&(void 0!==this.__curve?this.__curve.clear():this.__curve=curve({canvas:this.canvas,__no_autoscale:!0}));var i=this.__curve;if(i.origin=this.__pos,i.axis=this.__axis,i.up=this.__up,i.size=this.__size,i.color=this.__color,i.radius=this.__thickness?this.__thickness/2:this.__size.y/40,this.__initialize){for(var e,s=(vec(1,0,0),vec(0,1,0),vec(0,0,1),.5),n=this.__coils*t,o=1/n,r=Math.sin(2*Math.PI/t),_=Math.cos(2*Math.PI/t),a=0,h=0,c=s,l=0;l<n+1;l++)i.push(vec(a,h,c)),a+=o,e=c*_-h*r,h=h*_+c*r,c=e;this.__initialize=!1}}}),subclass(vp_helix,helix),property.declare(vp_helix.prototype,{size:new attributeVectorSize(null,1,2,2),radius:{get:function(){return this.__size.__y/2},set:function(t){this.__size.__y=this.__size.__z=2*t,this.__change()}},length:{get:function(){return this.__size.__x},set:function(t){this.__size.__x=t,this.__change()}},height:{get:function(){return this.__size.__y},set:function(t){this.__size.__y=t,this.__change()}},width:{get:function(){return this.__size.__z},set:function(t){this.__size.__z=t,this.__change()}}}),subclass(ring,box),property.declare(ring.prototype,{size:new attributeVector(null,.1,1,1)}),subclass(vp_ring,vp_box),property.declare(vp_ring.prototype,{size:new attributeVector(null,.2,2.2,2.2),thickness:{get:function(){return this.__size.__x/2},set:function(t){var i=this.radius;this.__thickness=t,this.__size.x=2*t,this.__size.y=this.__size.z=2*(t+i),this.__change()}},radius:{get:function(){return(this.__size.y-this.__size.x)/2},set:function(t){var i=this.thickness;this.__radius=t,this.__size.y=this.__size.z=2*(t+i),this.__change()}}}),property.declare(distant_light.prototype,{direction:new attributeVector(null,0,0,1),color:new attributeVector(null,1,1,1),__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__change:function(){}}),property.declare(local_light.prototype,{pos:new attributeVector(null,0,0,0),color:new attributeVector(null,1,1,1),__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__change:function(){}}),property.declare(draw.prototype,{color:{value:null,type:property.nullable_attributeVector},fillcolor:{value:null,type:property.nullable_attributeVector},linewidth:{value:1,onchanged:function(){this.__change()}},opacity:{value:.66,onchanged:function(){this.__change()}},visible:{value:!1,onchanged:function(){this.__change()}},__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__update:function(t,i){var e=this.points.length;if(!(e<2)){if(null!=this.fillcolor){t.lineWidth=1,t.fillStyle=color.to_html_rgba(this.fillcolor,this.opacity),t.beginPath();for(var s=0;s<e;s++)0==s?t.moveTo(this.points[s].x,this.points[s].y):t.lineTo(this.points[s].x,this.points[s].y);t.fill()}if(null!=this.color){t.lineWidth=this.linewidth,t.strokeStyle=color.to_html_rgba(this.color,this.opacity),t.beginPath();for(var s=0;s<e;s++)0==s?t.moveTo(this.points[s].x,this.points[s].y):s==e-1&&this.points[s].equals(this.points[0])?t.closePath():t.lineTo(this.points[s].x,this.points[s].y);t.stroke()}}},__change:function(){this.canvas.__overlay_objects.__changed=!0}}),property.declare(label.prototype,{pos:new attributeVector(null,0,0,0),color:{value:null,type:property.nullable_attributeVector},line:{value:!0,onchanged:function(){this.__change()}},linecolor:{value:null,type:property.nullable_attributeVector},background:{value:null,type:property.nullable_attributeVector},opacity:{value:.66,onchanged:function(){this.__change()}},text:{value:"",onchanged:function(){this.__change()}},font:{value:"Arial",onchanged:function(){this.__change()}},height:{value:15,onchanged:function(){this.__change()}},visible:{value:!1,onchanged:function(){this.__change()}},align:{value:null,onchanged:function(){this.__change()}},box:{value:!0,onchanged:function(){this.__change()}},border:{value:5,onchanged:function(){this.__change()}},linewidth:{value:1,onchanged:function(){this.__change()}},xoffset:{value:0,onchanged:function(){this.__change()}},yoffset:{value:0,onchanged:function(){this.__change()}},space:{value:0,onchanged:function(){this.__change()}},pixel_pos:{value:!1,onchanged:function(){this.__change()}},__get_model:function(){return null},__update:function(t,i){var e,s,n=this.__xoffset,o=this.__yoffset;if(this.__pixel_pos)e=this.__pos.x,s=this.canvas.__height-this.__pos.y,o=-o;else{if(this.canvas.__width>=this.canvas.__height)var r=2*this.canvas.__range/this.canvas.__height;else var r=2*this.canvas.__range/this.canvas.__width;var _=mat4.lookAt(i.pos,i.target,i.up),a=mat4.multiplyVec3(_,vec3.create([this.pos.x,this.pos.y,this.pos.z]));if(a[2]>-i.zNear||a[2]<-i.zFar)return;var h=i.distance,c=-h/(a[2]*r);e=Math.round(c*a[0]+this.canvas.__width/2),s=Math.round(-c*a[1]+this.canvas.__height/2)}var l=this.__height,u=this.__font;"Verdana"==this.__font?l*=13/15:"sans"==this.__font?u="Arial":"serif"==this.__font&&(u="Georgia"),t.font=l+"px "+u,t.textAlign="left",t.textBaseline="middle",t.lineWidth=this.__linewidth;var p=vec(1,1,1);this.canvas.__background.equals(vec(1,1,1))&&(p=vec(0,0,0)),t.strokeStyle=color.to_html(this.__linecolor||this.__color||p);var d,v,f=1.2*this.__height,g=.4*this.__height;d="string"==typeof this.__text?this.__text.split("\n"):[print_to_string(this.__text)],v=d.length;for(var b=this.__height+(v-1)*f,x=0,w=[],m=0;m<v;m++){var y=Math.ceil(t.measureText(d[m]).width);w.push(y),y>x&&(x=y)}for(var j=[],m=0;m<v;m++)switch(this.__align){case null:0===n&&0===o?j.push((x-w[m])/2):Math.abs(o)>Math.abs(n)?j.push((x-w[m])/2):n>0?j.push(0):n<0&&j.push(x-w[m]);break;case"center":j.push((x-w[m])/2);break;case"right":j.push(x-w[m]);break;case"left":j.push(0);break;default:throw new Error('Label align must be "center" or "left" or "right".')}var z,k,E=this.__border;if(n||o)Math.abs(o)>Math.abs(n)?o>0?(z=e+n-x/2,k=s-o-b-E+g):(z=e+n-x/2,k=s-o+E+g):Math.abs(n)>0&&(k=s-o-b/2+g,n>0?z=e+n+E:n<0&&(z=e+n-x-E));else switch(k=s,this.__align){case null:case"center":z=e-x/2;break;case"right":z=e-x;break;case"left":z=e}var q;if(q=null==this.__background?this.canvas.__background:this.__background,t.fillStyle=color.to_html_rgba(q,this.__opacity),t.fillRect(z-E,k-g-E,x+2*E,b+2*E),(n||o)&&this.__line){if(t.beginPath(),this.space>0){var O=vec(n,-o,0).norm().multiply(this.space);O=O.add(vec(e,s,0)),t.moveTo(O.x,O.y)}else t.moveTo(e,s);t.lineTo(e+n,s-o),t.stroke()}this.__box&&(t.beginPath(),t.moveTo(z-E,k-g-E),t.lineTo(z+x+E,k-g-E),t.lineTo(z+x+E,k-g+b+E),t.lineTo(z-E,k-g+b+E),t.closePath(),t.stroke()),t.fillStyle=color.to_html(this.__color||p);for(var m=0;m<v;m++){var T=z+j[m],V=k+f*m;t.fillText(d[m],T,V)}},__change:function(){void 0!==this.canvas&&(this.canvas.__overlay_objects.__changed=!0)}}),property.declare(attach_trail.prototype,{color:{get:function(){return this.__options.color},set:function(t){this.__options.color=t}},radius:{get:function(){return this.__options.radius},set:function(t){this.__options.radius=t}},retain:{get:function(){return this.__options.retain},set:function(t){this.__options.retain=t}},start:function(){this.__run=!0;var t={};for(var i in this.__options)t[i]=this.__options[i];"curve"===this.type?this.__trail=curve(t):this.__trail=points(t),this.__trails.push(this.__trail)},stop:function(){this.__run=!1},clear:function(){this.__last_pos=null,this.__last_time=null,this.__elements=0;for(var t=0;t<this.__trails.length;t++)this.__trails[t].clear();"function"!=typeof this.__obj&&(this.__obj.__ninterval=0)}});var widgetid=0,slider_id=0;eval("0");var exports={box:box,vp_box:vp_box,cylinder:cylinder,vp_cylinder:vp_cylinder,cone:cone,vp_cone:vp_cone,pyramid:pyramid,vp_pyramid:vp_pyramid,sphere:sphere,vp_sphere:vp_sphere,vp_ellipsoid:vp_ellipsoid,arrow:arrow,vp_arrow:vp_arrow,curve:curve,points:points,paths:paths,shapes:shapes,helix:helix,vp_helix:vp_helix,ring:ring,vp_ring:vp_ring,compound:compound,vp_compound:vp_compound,vertex:vertex,triangle:triangle,quad:quad,draw:draw,label:label,distant_light:distant_light,local_light:local_light,attach_trail:attach_trail,attach_arrow:attach_arrow,textures:textures,bumpmaps:bumpmaps,text:text,radio:radio,checkbox:checkbox,button:button,slider:slider,menu:menu};Export(exports)}();
!function(){"use strict";function e(e,n){function t(){if(o)return void n();var a=u();if(a-i>6e3){var l=confirm("Timed out trying to access the library\n  "+e+"\nTry again?");if(!l)return void n();i=u()}r(.05,t)}if(void 0===n)throw new Error("get_display(URL, wait) called without wait");var o=!1,i=u();$.getScript(e).done(function(e,n){o=!0}).fail(function(t,r,o){alert("Could not access the library\n  "+e),n()}),t()}function n(e,n){function t(e){var n,t;return n=e.target.files[0],n?(t=new FileReader,t.onload=function(e){a=e.target.result;var t=n.lastModifiedDate?n.lastModifiedDate.toLocaleDateString():"";i={name:n.name,text:a,size:n.size,type:n.type,date:t},$("#read_local_file").remove()},t.readAsText(n)):void alert("Failed to load file")}function o(){return null!==a?void n(null,i):void r(.05,o)}var i;if(0===arguments.length)throw new Error("read_local_file(place, wait) called with no arguments");if(1==arguments.length){if(n=e,"function"!==w(n))throw new Error("Should be 'read_local_file(wait)'");e=$("body")}else if(arguments.length>2||"function"!==w(n))throw new Error("Should be 'read_local_file(place, wait)'");e.append('<input type="file" id="read_local_file"/>');var a=null;document.getElementById("read_local_file").addEventListener("change",t,!1),o()}function t(e){r(0,e)}function r(e,n){function t(){n()}e=1e3*e,e>5?setTimeout(t,e-5):setTimeout(t,0)}function o(e){function n(){void 0!==window.__font_sans&&void 0!==window.__font_serif?e():setTimeout(n,15)}n()}function i(){if(void 0===window.__font_sans){var e;e=navigator.onLine?"https://s3.amazonaws.com/glowscript/fonts/Roboto-Medium.ttf":"../lib/FilesInAWS/Roboto-Medium.ttf",opentype_load(e,function(n,t){if(n)throw new Error("Font "+e+" could not be loaded: "+n);window.__font_sans=t})}if(void 0===window.__font_serif){var n;n=navigator.onLine?"https://s3.amazonaws.com/glowscript/fonts/NimbusRomNo9L-Med.otf":"../lib/FilesInAWS/NimbusRomNo9L-Med.otf",opentype_load(n,function(e,t){if(e)throw new Error("Font "+n+" could not be loaded: "+e);window.__font_serif=t})}}function a(e){if(e instanceof vec)e=e.toString();else if(null===e)e="null";else if(void 0===e)e="undefined";else if("object"==w(e)){var n="{";for(var t in e)n+=t+":"+e[t]+", ";e=n.slice(0,-2)+"}"}else"number"==w(e)?(e=e.toPrecision(6),e.match(/e/)?(e=e.replace(/0*e/,"e"),e=e.replace(/\.e/,"e")):e.match(/\./)&&(e=e.replace(/0*$/,"")),e=e.replace(/\.$/,"")):e=e.toString();return e}function l(){var e=void 0===_.width?640:_.width,n=void 0===_.height?100:_.height,t=void 0===_.readonly||_.readonly;"right"==_.pos?canvas.container.css({"float":"left"}):"bottom"==_.pos&&canvas.container.css({clear:"both"}),m.css("width",e).css("height",n),t?m.attr("readonly","readonly"):m.attr("readonly",null)}function c(e){for(var n="",t=arguments.length,r=0;r<t;r++){var o=arguments[r];o="array"==w(o)?o.toString():null===o?"null":a(o),n+=0===n.length?o:" "+o}return n}function s(e){if(null===m){var n=b;n.appendTo($("body")),window.__context.print_container=n,m=$('<textarea id=print spellcheck="false"/>').appendTo(n).css("font-family","Verdana","Sans-Serif").css("font-size","100%"),l()}var t=" ",r="\n",o=arguments.length,i=arguments[o-1];if(null!=i&&void 0!==i){var c=!1;void 0!==i.sep&&(t=i.sep,c=!0),void 0!==i.end&&(r=i.end,c=!0),c&&o--}for(var s="",f=0;f<o;f++){var i=arguments[f];i="array"==w(i)?i.toString():null===i?"null":a(i),s+=0===s.length?i:t+i}s+=r,m.val(m.val()+s),m.scrollTop(m.scrollTop()+1e4)}function f(e){var n="";for(var t in e)_[t]=e[t];return null!==m&&(void 0!==e.clear&&e.clear&&m.val(""),l(),void 0!==e.contents&&e.contents&&(n=m.val()),(void 0!==e["delete"]&&e["delete"]||void 0!==e.remove&&e.remove)&&(m.remove(),m=null)),n}function u(){return performance.now?performance.now():(new Date).getTime()}function d(){return.001*u()}function h(e){if(e<=0){if(0===e)return 1;throw new Error("Cannot take factorial of negative number "+e)}for(var n=1,t=2;t<=e;)n*=t,t++;if(t!=e+1)throw new Error("Argument of factorial must be an integer, not "+e);return n}function v(e,n){var t=e-n,r=1;if(n>t){var o=n;n=t,t=o}for(var i=t+1,a=1;i<=e;)r*=i/a,i++,a++;if(i!=e+1)throw new Error("Illegal arguments ("+e+","+n+") for combin function");return r}function p(e){for(var n="[",t=0;t<e.length;t++){var r=e[t];n+=void 0===r?"undefined, ":null===r?"null ":"array"==w(r)?p(r):"string"==w(r)?r+", ":r.toString()+", "}return", "==n.slice(-2)&&(n=n.slice(0,-2)),n+"], "}function g(e){return void 0===e?"undefined":null===e?"null":p(e).slice(0,-2)}var w=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},m=null,_={width:640,height:100,readonly:!0,pos:"bottom"},b=$("<div/>");window.performance=window.performance||{},Array.prototype.toString=function(){return g(this)},String.prototype.format=function(e){function n(e,n,t,r){function o(e,n){for(var t="",r=0;r<n-e.length;r++)t+=" ";return t+e}var i={b:function(){return o(e.toString(2),t)},c:function(){return o(String.fromCharCode(e),t)},d:function(){return o(Math.floor(Math.round(e)).toString(),t)},e:function(){var n=o(e.toExponential(r||6),t),i=n.search("e"),a=n.slice(i);return n=n.slice(0,i),3==a.length&&(a=a.slice(0,2)+"0"+a.slice(-1)),n+a},E:function(){return i.e()},f:function(){return 0==r?r=6:r==-1&&(r=0),o(e.toFixed(r),t)},F:function(){return i.f()},g:function(){if(0==e)return"0";0==r&&(r=6);var n,t=Math.abs(e);if(1e-4<=t&&t<Math.pow(10,r)){if(t<.1){var o=e.toExponential(r);o=o.replace(".","");var a=o.search("e"),l=o.slice(a+2),c=o.slice(0,a),s=c.length;e<0&&(s++,r++),s>r&&(c=c.slice(0,r));var f="";for("-"==c.slice(0,1)&&(f="-",c=c.slice(1)),n=c.slice(0,r);"0"==n.slice(-1);)n=n.slice(0,-1);return 2==l?f+"0.0"+n:3==l?f+"0.00"+n:f+"0.000"+n}t>=1&&r--,n=i.e();var a=n.search("e"),l=Number(n.slice(a+1)),c=Number(n.slice(0,a));for(e=c*pow(10,l),n=i.f();"0"==n.slice(-1);)n=n.slice(0,-1);return"."==n.slice(-1)&&(n=n.slice(0,-1)),n}r--,n=i.e();var a=n.search("e"),l=n.slice(a);for(n=n.slice(0,a);"0"==n.slice(-1);)n=n.slice(0,-1);return"."==n.slice(-1)&&(n=n.slice(0,-1)),n+l},G:function(){return i.g().toUpperCase()},n:function(){return i.g()},o:function(){return o(e.toString(8),t)},s:function(){for(var n=e.slice(0,r),o=0;o<t-r;o++)n+=" ";return n},x:function(){return o(e.toString(16),t)},X:function(){return i.x().toUpperCase()},"%":function(){return e*=100,i.f()+"%"}};return i[n]()}for(var t=this,r=Array.prototype.slice.call(arguments),o=[],i=[],a=/(\{[^\}]*\})/g,l=0;;){var c=a.exec(t);if(null===c){o.push(t.slice(l));break}var s=t.slice(c.index+1,a.lastIndex-1);i.push(s.replace(/\s*/g,"")),o.push(t.slice(l,c.index)),l=a.lastIndex}for(var f="",u=0;u<o.length&&(f+=o[u],!(u>=i.length));u++){var d=i[u],h=u,v=d.search(":");if(v<0){if(d.length>0&&null!==d.slice(-1).match(/[a-z]/))throw new Error('Format error: missing ":" in "{'+d+'}"');if(null!==d.match(/\./))throw new Error('Format error: should not have "." in "{'+d+'}"');d.length>0&&(h=Number(d)),f+=r[h].toString()}else{var p=d.slice(-1);if(null===p.match(/[a-z]/))throw new Error('Format error: final character in "{'+d+'}" must be a letter.');v>0&&(h=Number(d.slice(0,v))),d=d.slice(v+1);var g,w,m=d.search(/\./);m>=0?(g=d.slice(0,m),g=""==g?0:Number(g),w=Number(d.slice(m+1,-1)),0===w&&(w=-1)):(g=d.length>=2?Number(d.slice(0,-1)):0,w=0),f+=n(r[h],p,g,w)}}return f};var M={sqrt:Math.sqrt,pi:Math.PI,abs:Math.abs,sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,atan2:Math.atan2,exp:Math.exp,log:Math.log,pow:Math.pow,ceil:Math.ceil,floor:Math.floor,max:Math.max,min:Math.min,random:Math.random,round:Math.round,factorial:h,combin:v,radians:function(e){return e*Math.PI/180},degrees:function(e){return 180*e/Math.PI},sleep:r,waitforfonts:o,fontloading:i,update:t,print:s,GSprint:s,print_to_string:c,print_options:f,clock:d,msclock:u,get_library:e,read_local_file:n};Export(M)}();
!function(){"use strict";function e(e){if(""==e.text||void 0==e.text)throw new Error("A text object needs non-empty text");if(_.canvas=void 0===e.canvas?canvas.selected:e.canvas,_.text=e.text,_.align=void 0===e.align?"left":e.align,_.height=void 0===e.height?1:e.height,_.depth=void 0===e.depth?.2*_.height:e.depth,Math.abs(_.depth)<.01*_.height&&(_.depth=.01*_.height),_.pos=vec(0,0,0),_.font=void 0===e.font?"sans":e.font,_.billboard=void 0!==e.billboard&&e.billboard,_.color=void 0===e.color?vec(1,1,1):vec(e.color),_.opacity=void 0===e.opacity?1:e.opacity,_.shininess=void 0===e.shininess?.6:e.shininess,_.emissive=void 0!=e.emissive&&e.emissive,_.show_start_face=void 0===e.show_start_face||e.show_start_face,_.show_end_face=void 0===e.show_end_face||e.show_end_face,_.start_face_color=void 0===e.start_face_color?_.color:vec(e.start_face_color),_.end_face_color=void 0===e.end_face_color?_.color:vec(e.end_face_color),m.color=_.color,g=[],f=!1,"sans"==_.font)p=window.__font_sans;else{if("serif"!=_.font)throw new Error('The text font must be either "sans" or "serif".');f=!0,p=window.__font_serif}if(void 0===p)throw new Error("Font not available for text object.");var t=p.names.fullName.en;if(void 0===x[t]){var r=o("h",0,!0),n=o("y",0,!0);x[t]=[r,r-n]}u=x[t][0];for(var a=x[t][1],s=_.text.split("\n"),l=0,h=0,i=0;i<s.length;i++)l=1.5*-i*u,o(s[i],l,!1),d>h&&(h=d);var c={canvas:_.canvas},v=new compound(g,c),y={canvas:_.canvas,__text:_.text,__align:_.align,__height:_.height,__depth:_.depth,__font:_.font,__billboard:_.billboard,__color:_.color,shininess:_.shininess,emissive:_.emissive,opacity:_.opacity,__show_start_face:_.show_start_face,__show_end_face:_.show_end_face,__start_face_color:_.start_face_color,__end_face_color:_.end_face_color,__descender:a*_.height,__lines:s.length};delete e.canvas,delete e.text,delete e.align,delete e.height,delete e.depth,delete e.font,delete e.billboard,delete e.color,delete e.opacity,delete e.shininess,delete e.emissive,delete e.show_start_face,delete e.show_end_face,delete e.start_face_color,delete e.end_face_color;for(var w in e)y[w]=e[w];return[v,y]}function o(e,o,t){function r(e){for(var o={},t=0;t<e.length;t++)o[e[t]]=!0;for(var r=Object.keys(o),n=0;n<r.length;n++){var s=r[n],l=p.getPath(s,100,300,288),h=l.commands;o[s]=[];for(var i=0;i<h.length;i++){var c=h[i];"M"==c.type?(y=[],y.push(new Point(c.x,c.y))):"L"===c.type||"C"===c.type||"Q"===c.type?y.push(new Point(c.x,c.y)):"Z"===c.type&&(y.push(y[0]),o[s].push(a(y)))}}return o}d=0;var l,h=0,i=p.getPath(e,0,-o,1),v=i.commands;f&&(l=r(e));for(var g=[],m=[],x=[],y=[],w=[],b=0;b<v.length;b++){var P=v[b];switch(P.type){case"M":if(y.length>0){var q=y[0],E=y[y.length-1];Point.equals(q,E)&&y.pop(),x.push(y),w.push(a(y))}y=[];case"L":y.push(new Point(P.x,P.y)),P.x>d&&(d=P.x),P.y<h&&(h=P.y);break;case"C":var M=[y.pop()];M.push(new Point(P.x1,P.y1)),P.x1>d&&(d=P.x1),P.y1<h&&(h=P.y1),f?(M.push(new Point(P.x2,P.y2)),M.push(new Point(P.x,P.y)),P.x>d&&(d=P.x),P.y<h&&(h=P.y)):(M.push(new Point(P.x,P.y)),M.push(new Point(P.x2,P.y2)),P.x2>d&&(d=P.x2),P.y2<h&&(h=P.y2));var A=n(3,M,8);y=y.concat(A);break;case"Q":var M=[y.pop()];M.push(new Point(P.x1,P.y1)),M.push(new Point(P.x,P.y)),P.x>d&&(d=P.x),P.x1>d&&(d=P.x1),P.y<h&&(h=P.y),P.y1<h&&(h=P.y1);var A=n(2,M,8);y=y.concat(A);break;case"Z":var q=y[0],E=y[y.length-1];Point.equals(q,E)&&y.pop(),f?a(y)?(g.push(y),w.push(!0)):(m.push(y),w.push(!1)):(x.push(y),w.push(a(y))),y=[]}}if(t)return-h;if(d*=_.height/u,f){for(var k=[],z=0;z<e.length;z++){var E=e[z],C=l[E],j=C.reduce(function(e,o){return e+o},0);if(C.length>1&&j/C.length<=.51)C=C.sort(),C=C.reverse(),k.push(C);else if(j/C.length<.8){for(var S=p.getPath(E,100,300,288),T=(S.commands,[]),H=[],L=[],Q=0;Q<v.length;Q++){var P=v[Q];"M"==P.type?(L=[],L.push(new Point(P.x,P.y))):"L"===P.type||"C"===P.type||"Q"===P.type?L.push(new Point(P.x,P.y)):"Z"===P.type&&(L.push(L[0]),a(L)?T.push(L):H.push(L))}for(var b=0;b<T.length;b++){F=[!0];for(var Z=0;Z<H.length;Z++)c(T[b],H[Z][0])&&F.push(!1);k.push(F)}}else if(j==C.length)for(var D=0;D<C.length;D++){var F=C[D];k.push([F])}}for(var b=0;b<k.length;b++){for(var G=[],Z=0;Z<k[b].length;Z++)k[b][Z]?G.push(g.shift()):G.push(m.shift());x.push(G)}return s(x,w,k)}return s(x,w,null)}function t(e,o){var t=e*e,r=1-e,n=r*r;return new Point(o[0].x*n+2*o[1].x*r*e+o[2].x*t,o[0].y*n+2*o[1].y*r*e+o[2].y*t)}function r(e,o){var t=e*e,r=t*e,n=1-e,a=n*n,s=a*n;return new Point(o[0].x*s+3*o[1].x*a*e+3*o[2].x*n*t+o[3].x*r,o[0].y*s+3*o[1].y*a*e+3*o[2].y*n*t+o[3].y*r)}function n(e,o,n){for(var a=[],s=0;s<n+1;s++){var l=s/n;if(2==e)var h=t(l,o);else if(3==e)var h=r(l,o);a.push(h)}return a}function a(e){for(var o=0,t=0;t<e.length;){var r=(t+1)%e.length;o+=e[t].x*e[r].y,o-=e[r].x*e[t].y,t+=1}return o<0}function s(e,o,t){var r=0;"right"==_.align?r=-d:"center"==_.align&&(r=-d/2);var n=_.depth;if(f)for(var s=0;s<e.length;s++){var l=e[s];Point.equals(l[0][0],l[0][l[0].length-1])&&l[0].pop(),0!==n&&(g=g.concat(h(l[0],!1,r,n)));var c=new SweepContext(l[0]);for(x=1;x<l.length;x++)t[s][x]||(0!==n&&(g=g.concat(h(l[x],!1,r,n))),Point.equals(l[x][0],l[x][l[x].length-1])&&l[x].pop(),c.addHole(l[x]));c.triangulate();var v=c.getTriangles();g=g.concat(i(v,r,n))}else{for(var p=[],u=[],s=0;s<e.length;){var m=e[s];a(m)?u.push(s):(u.length>0&&p.push(u),u=[s]),s+=1}p.push(u);for(var s=0;s<p.length;s++){var u=p[s];0!==n&&(g=g.concat(h(e[u[0]],!1,r,n)));for(var c=new SweepContext(e[u[0]]),x=1;x<u.length;x++)c.addHole(e[u[x]]),g=g.concat(h(e[u[x]],o[x],r,n));c.triangulate();var v=c.getTriangles();g=g.concat(i(v,r,n))}}}function l(e,o){var t=[];Point.equals(e[e.length-1],e[0])||e.push(e[0]);for(var r,n=e.length,a=Point.sub(e[0],e[n-2]),s=0;s<n;s++){r=s==n-1?Point.sub(e[1],e[0]):Point.sub(e[s+1],e[s]);var l=new Point(a.y,(-a.x)),h=new Point(r.y,(-r.x));l.normalize(),h.normalize(),a.normalize(),r.normalize(),o&&(l.negate(),h.negate());var i=Point.dot(r,a),c=e[s];if(i<=y)0===s?t.push({pos:vec(c.x,c.y,0),normal:vec(h.x,-h.y,0),smooth:!1}):(t.push({pos:vec(c.x,c.y,0),normal:vec(l.x,-l.y,0),smooth:!1}),s!=n-1&&t.push({pos:vec(c.x,c.y,0),normal:vec(h.x,-h.y,0),smooth:!1}));else{var v=Point.add(l,h);v.normalize(),t.push({pos:vec(c.x,c.y,0),normal:vec(v.x,-v.y,0),smooth:!0})}a=r}Point.equals(e[e.length-1],e[0])&&e.pop();return t}function h(e,o,t,r){var n,a,s,h,i=l(e,o),c=_.height/u,v=[],p=0,f=r;r<0&&(p=r,f=0);for(var d=!1,g=0;g<i.length;g++){var x=i[g];if(d){m.pos=vec(c*x.pos.x+t,-c*x.pos.y,p),m.normal=x.normal,s=vertex(m),m.pos.z=f,h=vertex(m);v.push(quad({vs:[n,a,s,h]})),x.smooth?(n=h,a=s,d=!0):d=!1}else m.pos=vec(c*x.pos.x+t,-c*x.pos.y,f),m.normal=x.normal,n=vertex(m),m.pos.z=p,a=vertex(m),d=!0}return v}function i(e,o,t){for(var r,n,a,s,l,h,i,c,v=_.height/u,p=[],f=0;f<e.length;f++)if(n=e[f],a=n.getPoint(0),s=n.getPoint(1),l=n.getPoint(2),r=t,t>=0&&(r=0),_.show_start_face&&(m.color=_.start_face_color,t>=0?m.normal=vec(0,0,-1):(m.normal=vec(0,0,1),r=0),m.pos=vec(v*a.x+o,-v*a.y,r),h=vertex(m),m.pos=vec(v*s.x+o,-v*s.y,r),i=vertex(m),m.pos=vec(v*l.x+o,-v*l.y,r),c=vertex(m),p.push(triangle({vs:[h,i,c]}))),0!==t&&_.show_end_face){r=t,m.color=_.end_face_color,t>0?m.normal=vec(0,0,1):m.normal=vec(0,0,-1),m.pos=vec(v*a.x+o,-v*a.y,r);var h=vertex(m);m.pos=vec(v*s.x+o,-v*s.y,r);var i=vertex(m);m.pos=vec(v*l.x+o,-v*l.y,r);var c=vertex(m);p.push(triangle({vs:[h,i,c]}))}return m.color=_.color,p}function c(e,o){var t=0,r=0,n=0,a=e.length;for(t=0,r=a-1;t<a;r=t++)e[t].y>o.y!=e[r].y>o.y&&o.x<(e[r].x-e[t].x)*(o.y-e[t].y)/(e[r].y-e[t].y)+e[t].x&&(n=!n);return n}function v(e){function o(e){if(void 0===e.length)throw new Error("A shape must be a list of [x,y] elements.");if("number"==typeof e[0])throw new Error("A shape must be a list of [x,y] elements.");if("number"==typeof e[0][0])return 1;if("number"==typeof e[0][0][0])return 2;if("number"==typeof e[0][0][0][0])return 3;throw new Error("A shape must be a list of lists of [x,y] elements.")}function t(e){for(var o=0;o<e.length;o++)for(var t=0;t<e[o].length-1;t++){var r=e[o][t],n=r[0],a=r[1];G=void 0===G?n:Math.min(n,G),N=void 0===N?n:Math.max(n,N),O=void 0===O?a:Math.min(a,O),B=void 0===B?a:Math.max(a,B)}}function r(o,t){for(var r=[],n=0;n<o.length;n++)r.push(vec(o[n][0],o[n][1],0));var a=r[r.length-1].equals(r[0]);if(!a)throw new Error("An extrusion shape must be a closed curve.");i=[];var n,s,l,h,c=vec(0,0,1),v=r.length,p=null,f=0,u=[],d=[];for(n=0;n<v-1;n++){s=r[n+1].sub(r[n]),(void 0===l||r[n].y<l)&&(l=r[n].y,h=n);var g=mag(s);f+=g,u.push(s),d.push(g)}var _=[];for(n=0;n<d.length;n++)d[n]/=f,_.push(0);var m=0,x=0;for(n=0;n<d.length;n++){var y=(h+n)%d.length;if(m+=d[y],m>.5){m-=d[y];break}x+=1}var w=0;for(n=0;n<x;n++){var b=(h+n+1)%d.length;w+=d[b],_[b]=w/m}for(w=0,n=0;n<d.length-x;n++){var b=(y+n+1)%d.length;w+=d[b],_[b]=1-w/(1-m)}var P=u[u.length-1];for(n=0;n<v-1;n++){s=u[n];var q=(d[n],P.cross(c).norm()),E=s.cross(c).norm();t||(q=q.multiply(-1),E=E.multiply(-1));var M=norm(s).dot(norm(P)),A=r[n];if(M<=e.smooth)0===n?p={pos:A,normal:q,smooth:!1,length:_[n]}:i.push({pos:A,normal:q,smooth:!1,length:_[n]}),i.push({pos:A,normal:E,smooth:!1,length:_[n]});else{var k=norm(q.add(E));i.push({pos:A,normal:k,smooth:!0,length:_[n]})}P=s}null!==p&&i.push(p)}function n(o,t,r,n,a,s,l,v,p,f){for(_=0;_<2;_++){1==_&&(n=s,a=l);for(var u,d,g,m,x,y,w,b,r,P=dot(r,a),q=dot(r,n),E=dot(t,a),M=dot(t,n),A=P*M-q*E,k=i.length,z=0;z<k;z++)u=i[z],x=u.pos.x,y=u.pos.y,w=(x*P-y*q)/A,b=(y*M-x*E)/A,d=o.add(t.multiply(w).add(r.multiply(b))),g=u.normal,m=norm(n.multiply(g.x).add(a.multiply(g.y))),0===_?h.push(vertex({pos:d,normal:m,color:e.color,texpos:vec(f,u.length,0)})):h[h.length-k+z].normal=norm(h[h.length-k+z].normal.add(m));if(v)break}if(p)for(var C=h.length-2*k,z=C;z<C+k;z++)z==C+k-1?c.push(quad({v0:h[z],v1:h[z+k],v2:h[C+k],v3:h[C]})):(c.push(quad({v0:h[z],v1:h[z+k],v2:h[z+k+1],v3:h[z+1]})),i[z-C+1].smooth||z++)}function a(e,o){if(o||!v){r(e,o);var t,a;for(d=u.length,y=0;y<d;y++)t=u[y],w=t[0],b=t[1],P=t[2],a=t[3],m=t[4],x=t[5],q=t[6],E=t[7],M=t[8],A=t[9],j=t[10],0===y?P?n(a,m,x,M,A,M,A,P,!1,0):n(a,m,x,q,E,M,A,P,!1,0):y==d-1?v?(t=u[0],P=t[2],a=t[3],m=t[4],x=t[5],q=t[6],E=t[7],M=t[8],A=t[9],j=t[10],n(a,m,x,q,E,M,A,P,!0,j)):n(a,m,x,q,E,M,A,P,!0,j):P?(y>0&&n(a,m,x,q,E,M,A,!0,!0,1),y<d-1&&n(a,m,x,M,A,M,A,!0,!1,0)):n(a,m,x,q,E,M,A,!1,y>0,j)}}function s(e){function o(e){var o=e.x,t=e.y;return vec((o-G)/(N-G),(t-O)/(B-O),0)}var t,r,n=null,a=e[0];a[0][0]===a[a.length-1][0]&&a[0][1]===a[a.length-1][1]&&(n=a.pop());var s=[];for(t=0;t<a.length;t++)s.push(new Point(a[t][0],a[t][1]));var l=new SweepContext(s);for(r=1;r<e.length;r++){for(a=e[r],a[0][0]===a[a.length-1][0]&&a[0][1]===a[a.length-1][1]&&a.pop(),s=[],t=0;t<e[r].length;t++)s.push(new Point(a[t][0],a[t][1]));l.addHole(s)}null!==n&&a.push(n),l.triangulate();var i,c,v,p,f=l.getTriangles(),u=vec(0,0,1),d=[];for(t=0;t<f.length;t++)p=f[t],i=p.getPoint(0),c=p.getPoint(1),v=p.getPoint(2),h.push(vertex({pos:vec(i.x,i.y,0),normal:u,texpos:o(i)})),h.push(vertex({pos:vec(c.x,c.y,0),normal:u,texpos:o(c)})),h.push(vertex({pos:vec(v.x,v.y,0),normal:u,texpos:o(v)})),d.push([3*t,3*t+1,3*t+2]);return d}function l(o){if(!v&&(e.show_start_face||e.show_end_face)){var t,r=h.length;t=s(o);var n=[],a=h.length-r;if(e.show_start_face&&!v){var l=u[0],i=l[3],p=l[0];p=p.multiply(-1);for(var f=l[4],d=l[5],g=0;g<a;g++){var _=h[r+g];n.push([_.pos.x,_.pos.y]);var m=i.add(f.multiply(_.pos.x).add(d.multiply(_.pos.y)));h[r+g].pos=m,h[r+g].normal=p,h[r+g].color=e.start_face_color}for(var x=0;x<t.length;x++){var y=t[x];c.push(triangle({vs:[h[r+y[0]],h[r+y[1]],h[r+y[2]]]}))}}if(e.show_end_face&&!v){for(var l=u[u.length-1],i=l[3],p=l[0],f=l[4],d=l[5],g=0;g<a;g++)if(e.show_start_face){var _=n[g],m=i.add(f.multiply(_[0]).add(d.multiply(_[1])));h.push(vertex({pos:m,normal:p,color:e.end_face_color,texpos:h[r+g].texpos}))}else{var _=h[r+g];_.color=e.end_face_color;var m=i.add(f.multiply(_.pos.x).add(d.multiply(_.pos.y)));h[r+g].pos=m,h[r+g].normal=p}e.show_start_face&&(r+=a);for(var x=0;x<t.length;x++){var y=t[x];c.push(triangle({vs:[h[r+y[0]],h[r+y[1]],h[r+y[2]]]}))}}}}if(void 0!==e.canvas?e.canvas=e.canvas:e.canvas=canvas.get_selected(),void 0===e.path)throw new Error("An extrusion object needs a path attribute.");if(void 0===e.shape)throw new Error("An extrusion object needs a shape attribute.");e.pos=void 0===e.pos?null:e.pos,e.axis=void 0===e.axis?null:e.axis,e.up=void 0===e.up?vec(0,1,0):norm(e.up),e.color=void 0===e.color?color.white:e.color,e.opacity=void 0===e.opacity?1:e.opacity,e.shininess=void 0===e.shininess?.6:e.shininess,e.emissive=void 0!==e.emissive&&e.emissive,e.show_start_face=void 0===e.show_start_face||e.show_start_face,e.show_end_face=void 0===e.show_end_face||e.show_end_face,e.start_face_color=void 0===e.start_face_color?e.color:e.start_face_color,e.end_face_color=void 0===e.end_face_color?e.color:e.end_face_color,e.smooth=void 0===e.smooth?.95:e.smooth;for(var h=[],i=[],c=[],v=e.path[e.path.length-1].equals(e.path[0]),p=[],f=Math.acos(e.smooth),u=[],d=e.path.length,g=[e.path[0]],_=1;_<d;_++)e.path[_].equals(g[g.length-1])||g.push(e.path[_]);d=e.path.length;var m,x,y,w,b,P,q,E,M,A,k,z,C,j=0;if(d<2)throw new Error("An extrusion pos must contain more than one distinct point.");if(2==d)w=norm(g[1].sub(g[0])),E=e.up,q=w.cross(E),q.dot(q)<1e-10&&(q=E.cross(vec(1,0,0)),q.dot(q)<1e-10&&(q=E.cross(vec(0,1,0)))),q=norm(q),E=q.cross(w),u.push([w,w,!0,g[0],q,E,q,E,q,E,0]),u.push([w,w,!0,g[1],q,E,q,E,q,E,1]);else{for(y=0;y<d;y++){if(0===y){if(w=g[1].sub(g[0]),E=e.up,q=w.cross(E),q.dot(q)<1e-10&&(q=E.cross(vec(1,0,0)),q.dot(q)<1e-10&&(q=E.cross(vec(0,1,0)))),q=norm(q),E=norm(q.cross(w)),u.push([w,w,!0,g[y],q,E,q,E,q,E,0]),!v){p.push(0);continue}}else if(y==d-1){if(w=g[y].sub(g[y-1]),j+=mag(w),v){C=w.diff_angle(u[0][0]),P=C>=f,P&&p.push(y);for(var S=[],T=0;T<u[0].length;T++)S.push(u[0][T]);u.push(S),u[u.length-1][10]=j}else m=q,p.push(y),u.push([w,w,!0,g[y],m,E,q,E,q,E,j]);continue}if(0===y?(w=g[0].sub(g[d-2]),b=g[1].sub(g[0])):(w=g[y].sub(g[y-1]),b=g[y+1].sub(g[y])),C=b.diff_angle(w),P=C>=f,y>0&&(j+=mag(w)),x=norm(w.cross(b)),k=norm(norm(w).add(norm(b))),z=C/2,m=norm(x.cross(k)),M=q.rotate({angle:C,axis:x}),A=norm(M.cross(b)),0!==y)u.push([w,b,P,g[y],m,x,q,E,M,A,j]),P&&(p.push(u.length-1),u.push([w,b,P,g[y],m,x,q,E,M,A,j])),q=M,E=A;else{var H=u[0];H[0]=w,H[1]=b,H[2]=P,H[4]=m,H[5]=x,H[6]=q.rotate({angle:-C,axis:x}),H[7]=E,H[10]=0}}var _,T,L,Q,Z,D,d;if(0===p.length)if(v){for(T=1;T<u.length&&!(Math.abs(u[T][10]-j/2)<.001*j);T++)if(u[T][10]>j/2){T-=1;break}for(D=u[T][10],_=0;_<=T;_++)u[_][10]/=D;for(d=j-D,_=T+1;_<u.length;_++)u[_][10]=1-(u[_][10]-D)/d}else for(_=0;_<u.length;_++)u[_][10]/=j;else for(T=0,Q=0,L=0;T<p.length;){Z=p[T],D=u[Z][10],d=D-Q;for(var F=L;F<=Z;F++)u[F][10]=(u[F][10]-Q)/d;if(Q=D,L=Z+1,T++,T==p.length&&v){d=u[0][10]-Q;for(var F=L;F<u.length;F++)u[F][10]=(u[F][10]-Q)/d}}}var G,N,O,B,I=e.shape,J=o(I);if(1==J)t([I]);else if(2==J)t([I[0]]);else{for(var K=[],R=0;R<I.length;R++)K.push(I[R][0]);t(K)}if(1==J)I=[I],a(I[0],!0),l(I);else if(2==J){for(var U=0;U<I.length;U++)a(I[U],0===U);l(I)}else for(var R=0;R<I.length;R++){for(var V=I[R],U=0;U<V.length;U++)a(V[U],0===U);l(V)}return delete e.path,delete e.shape,delete e.start_face_color,delete e.end_face_color,delete e.show_start_face,delete e.show_end_face,delete e.color,delete e.smooth,delete e.up,null===e.pos&&delete e.pos,null===e.axis&&delete e.axis,"vpython"==window.__GSlang?vp_compound(c,e):compound(c,e)}var p,f,u,d,g,_={},m={},x={},y=.95,w={text3D:e,extrusion:v};Export(w)}();
Export({shaders:{curve_peel_depth_vertex:'// Vertex shader for rendering curve segments, parameterized by\n// pos1, pos2, radius, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in a normal basis with x pointing along the segment and scaled by radius\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvec4 start;\nvec4 end;\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nmat3 getSegmentRotation() {\n  // Construct the segment rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(vec3(0,1,0)));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start.w or end.w inside the if statement fails\n    // if the curve radius is less than about 1e-7. After setting the value\n    // inside the if, it\'s zero upon exit from the if. !!?!\n    float sw = 0.0;\n    if (segmentPosR(0).w < 0.0) { // -1 means use the curve global radius\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w < 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n    \n    // The position and radius of "this" end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n    \n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n    \n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    \n    gl_Position = projMatrix * pos4;\n}',curve_pick_vertex:'#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in an normal basis with x pointing along the segment and scaled by radius\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nvec4 start;\nvec4 end;\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nmat3 getSegmentRotation() {\n    // Construct the object rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    vec4 start_color = segmentColor(0);\n    vec4 end_color = segmentColor(1);\n    if (start_color.r < 0.0) start_color.rgb = objectColor;\n    if (end_color.r < 0.0) end_color.rgb = objectColor.rgb;\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start or end inside the if statement fails\n    // if the curve radius is less than about 1e-7 !!??\n    float sw = 0.0;\n    if (segmentPosR(0).w < 0.0) {\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w < 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n\n    // The position and radius of "this" end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n\n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    vcolor = start_color * (1.-pos.w) + end_color * pos.w;\n    gl_Position = projMatrix * pos4;\n}\n',curve_render_vertex:'// Vertex shader for rendering curve segments, parameterized by\n// pos1, pos2, radius, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in a normal basis with x pointing along the segment and scaled by radius\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nvec4 start;\nvec4 end;\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nmat3 getSegmentRotation() {\n  // Construct the segment rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(vec3(0,1,0)));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    vec4 start_color = segmentColor(0);\n    vec4 end_color = segmentColor(1);\n    if (start_color.r < 0.0) start_color.rgb = objectColor;\n    if (end_color.r < 0.0) end_color.rgb = objectColor.rgb;\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start.w or end.w inside the if statement fails\n    // if the curve radius is less than about 1e-7. After setting the value\n    // inside the if, it\'s zero upon exit from the if. !!?!\n    float sw = 0.0;\n    if (segmentPosR(0).w < 0.0) { // -1 means use the curve global radius\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w < 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n\n    // The position and radius of "this" end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n\n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot * (normal/objectScale), 0.0)).xyz;\n    \n    // no texture or bump map yet for curve object:\n    parameters = vec4(objectShininess, objectEmissive, 0.0, 0.0);\n    mat_pos = vec2(0.0, 0.0);\n    bumpX = vec3(1.0, 0.0, 0.0);\n    \n    vcolor = start_color * (1.-pos.w) + end_color * pos.w;\n    gl_Position = projMatrix * pos4;\n}',extent_vertex:"// Vertex shader for rendering standard 'objects' parameterized by\n// pos, axis, up, scale, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform vec3 center;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nvec3 encode_float(float k) { // assumes k is >= 0\n    if (k <= 0.0) return vec3(0.0, 0.0, 0.0);\n    float logk = log(k);\n    if (logk < 0.0) {\n        logk = -logk + 128.0;\n    }\n    return vec3(\n        floor(logk)/255.0,\n        floor(256.0*fract(logk))/255.0,\n        floor(256.0*fract(256.0*logk))/255.0);\n}\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*position) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*(normal/objectScale), 0.0)).xyz;\n    //gl_Position = posp;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    float extent = abs(ws_pos.x-center.x);\n    extent = max(abs(ws_pos.y-center.y), extent);\n    extent = max(abs(ws_pos.z-center.z), extent);\n    mat_color = vec4(encode_float(extent), 1.0);\n    // Setting gl_Position.xy to (-1.0, -1.0) should store into pixel (0, 0), but doesn't work:\n    gl_Position = vec4(-1.0, -1.0, 1e-20*extent, 1.0);\n\n    parameters = vec4(objectShininess, objectEmissive, 0.0, 0.0);\n}\n",merge_fragment:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform sampler2D C0; // TEXTURE2 - opaque color map (minormode 4)\nuniform sampler2D C1; // TEXTURE4 - color map for transparency render 1 (minormode 6)\nuniform sampler2D C2; // TEXTURE6 - color map for transparency render 2 (minormode 8)\nuniform sampler2D C3; // TEXTURE8 - color map for transparency render 3 (minormode 10)\nuniform sampler2D C4; // TEXTURE10 - color map for transparency render 4 (minormode 12)\nuniform vec2 canvas_size;\n\nvoid main(void) {\n    // need to combine colors from C0, C1, C2, C3, C4\n    vec2 loc = vec2( gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    vec4 c0 = texture2D(C0, loc);\n    vec4 c1 = texture2D(C1, loc);\n    vec4 c2 = texture2D(C2, loc);\n    vec4 c3 = texture2D(C3, loc);\n    vec4 c4 = texture2D(C4, loc);\n    \n    vec3 mcolor = c1.rgb*c1.a + \n                 (1.0-c1.a)*(c2.rgb*c2.a +\n                 (1.0-c2.a)*(c3.rgb*c3.a +\n                 (1.0-c3.a)*(c4.rgb*c4.a + \n                 (1.0-c4.a)*c0.rgb)));\n    gl_FragColor = vec4 (mcolor, 1.0);\n}\n",merge_fragment2:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform sampler2D C0; // TEXTURE2 - opaque color map (minormode 4)\nuniform sampler2D C1; // TEXTURE4 - color map for transparency render 1 (minormode 6)\nuniform vec2 canvas_size;\n\nvoid main(void) {\n    // need to combine colors from C0 and C1\n    // This is used with mobile devices that have few texture image units.\n    vec2 loc = vec2( gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    vec4 c0 = texture2D(C0, loc);\n    vec4 c1 = texture2D(C1, loc);    \n    \n    vec3 mcolor = c1.rgb*c1.a + (1.0-c1.a)*c0.rgb;\n    gl_FragColor = vec4 (mcolor, 1.0);\n}\n",merge_vertex:"// Vertex shader for rendering standard 'objects' parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nvoid main(void) {\n    gl_Position = vec4(pos, 1.0);\n}\n",opaque_render_fragment:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * lcolor * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nvoid main(void) {\n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    gl_FragColor = vec4( color, 1.0 );\n}\n",peel_color_fragmentC1:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    \tb1,\n    \tb2,\n    \t0,\n    \t0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n\n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n\t\n\tif (zmin < z) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n    \tdiscard;\n    }\n}\n",peel_color_fragmentC2:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D1; // TEXTURE5 - depth map (minormode 7)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    \tb1,\n    \tb2,\n    \t0,\n    \t0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D1, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin < z && z < zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n",peel_color_fragmentC3:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D2; // TEXTURE7 - depth map (minormode 9)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    \tb1,\n    \tb2,\n    \t0,\n    \t0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D2, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin < z && z < zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n",peel_color_fragmentC4:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D3; // TEXTURE9 - depth map (minormode 11)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    \tb1,\n    \tb2,\n    \t0,\n    \t0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D3, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin < z && z < zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n",
peel_depth_fragmentD0:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    \tb1,\n    \tb2,\n    \t0,\n    \t0);\n}\n\nvoid main(void) {\n    // create depth map D0 (5)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n}",peel_depth_fragmentD1:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    \tb1,\n    \tb2,\n    \t0,\n    \t0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D1 (6)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    if (zmin < z) {\n        gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}\n",peel_depth_fragmentD2:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D1; // TEXTURE5 - 1st transparency depth map (minormode 7)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    \tb1,\n    \tb2,\n    \t0,\n    \t0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D2 (7)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D1, loc));\n    if (zmin < z && z < zmax) {\n    \tgl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}",peel_depth_fragmentD3:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D2; // TEXTURE7 - 2nd transparency depth map (minormode 9)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    \tb1,\n    \tb2,\n    \t0,\n    \t0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D3 (8)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D2, loc));\n    if (zmin < z && z < zmax) {\n        gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}",peel_depth_vertex:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n}\n",pick_fragment:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nvarying vec4 vcolor;\n\nvoid main(void) {\n    gl_FragColor = vcolor;\n}\n",pick_vertex:"// Vertex shader for picking standard 'objects' parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectAxis objectData[1].xyz\n#define objectUp objectData[2].xyz\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n    vcolor = objectColor;\n}\n",render_vertex:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*(normal/objectScale), 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color*objectColor.rgb, opacity*objectColor.a);\n    \n    float f = flags; // turn, flipy, flipx, sides, right, left, bumpmap, texture\n    float turn = floor(f/128.0);\n    f -= 128.0*turn;\n    float flipy = floor(f/64.0);\n    f -= 64.0*flipy;\n    float flipx = floor(f/32.0);\n    f -= 32.0*flipx;\n    float sides = floor(f/16.0);\n    f -= 16.0*sides;\n    float right = floor(f/8.0);\n    f -= 8.0*right;\n    float left = floor(f/4.0);\n    f -= 4.0*left;\n    float B = floor(f/2.0);\n    f -= 2.0*B;\n    float T = f;\n    if (T != 0.0) {\n        if (flipx != 0.0) {\n            mat_pos.x = 1.0 - mat_pos.x;\n        }\n        if (flipy != 0.0) {\n            mat_pos.y = 1.0 - mat_pos.y;\n        }\n        if (turn > 0.0 && turn <= 3.0) {\n            if (turn == 1.0) {\n                mat_pos = vec2(mat_pos.y,1.0 - mat_pos.x);\n            } else if (turn == 2.0) {\n                mat_pos = vec2(1.0 - mat_pos.x,1.0 - mat_pos.y);\n            } else {\n                mat_pos = vec2(1.0 - mat_pos.y,mat_pos.x);\n            }\n        }\n        T = 0.0;\n        bool L = (normal.x == -1.0);\n        bool R = (normal.x == 1.0);\n        bool S = !L && !R;\n        if (L && left == 1.0) T = 1.0;\n        if (R && right == 1.0) T = 1.0;\n        if (S && sides == 1.0) T = 1.0;\n        if (T == 0.0) {\n            B = 0.0;\n        } else if (left == 0.0 || right == 0.0 || sides == 0.0) {\n            // don't mix texture and object color if texture doesn't cover entire object\n            vcolor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    }\n    float emit = 0.0;\n    if (objectEmissive != 0.0) emit = 1.0;\n    if (emissive != 0.0) emit = 1.0;\n    parameters = vec4(objectShininess * shininess, emit, T, B);\n}\n",ring_peel_depth_vertex:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nvoid main(void) {\n\tmat3 rot = getObjectRotation();\n\t// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;           // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(r/objectScale);     // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n}\n",ring_pick_vertex:"// Vertex shader for picking standard 'objects' parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectAxis objectData[1].xyz\n#define objectUp objectData[2].xyz\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nvoid main(void) {\n\tmat3 rot = getObjectRotation();\n\t// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;           // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(r/objectScale);     // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n    vcolor = objectColor;\n}\n",ring_render_vertex:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nmat3 getObjectRotation() { // Construct the object rotation matrix.\n    // Divide objectAxis by its largest component before normalizing,\n    // to avoid problems with very large or very small magnitudes.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Y = normalize(objectUp);\n    // Note that axis and up are kept perpendicular to each other by CPU code.\n    return mat3( X, Y, cross(X,Y));\n}\n\nvoid main(void) {\n\tmat3 rot = getObjectRotation();\n\t// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;  // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(normal);   // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    vec3 N = adjpos - (r-0.5*objectScale.x*n);                              // normal in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*N, 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color*objectColor.rgb, opacity*objectColor.a);\n    \n    float f = flags; // turn, flipy, flipx, sides, right, left, bumpmap, texture\n    float turn = floor(f/128.0);\n    f -= 128.0*turn;\n    float flipy = floor(f/64.0);\n    f -= 64.0*flipy;\n    float flipx = floor(f/32.0);\n    f -= 32.0*flipx;\n    float sides = floor(f/16.0);\n    f -= 16.0*sides;\n    float right = floor(f/8.0);\n    f -= 8.0*right;\n    float left = floor(f/4.0);\n    f -= 4.0*left;\n    float B = floor(f/2.0);\n    f -= 2.0*B;\n    float T = f;\n    if (T != 0.0) {\n        if (flipx != 0.0) {\n            mat_pos.x = 1.0 - mat_pos.x;\n        }\n        if (flipy != 0.0) {\n            mat_pos.y = 1.0 - mat_pos.y;\n        }\n        if (turn > 0.0 && turn <= 3.0) {\n            if (turn == 1.0) {\n                mat_pos = vec2(mat_pos.y,1.0 - mat_pos.x);\n            } else if (turn == 2.0) {\n                mat_pos = vec2(1.0 - mat_pos.x,1.0 - mat_pos.y);\n            } else {\n                mat_pos = vec2(1.0 - mat_pos.y,mat_pos.x);\n            }\n        }\n        T = 0.0;\n        bool L = (normal.x == -1.0);\n        bool R = (normal.x == 1.0);\n        bool S = !L && !R;\n        if (L && left == 1.0) T = 1.0;\n        if (R && right == 1.0) T = 1.0;\n        if (S && sides == 1.0) T = 1.0;\n        if (T == 0.0) {\n            B = 0.0;\n        } else if (left == 0.0 || right == 0.0 || sides == 0.0) {\n            // don't mix texture and object color if texture doesn't cover entire object\n            vcolor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    }\n    float emit = 0.0;\n    if (objectEmissive != 0.0) emit = 1.0;\n    if (emissive != 0.0) emit = 1.0;\n    parameters = vec4(objectShininess * shininess, emit, T, B);\n}\n",tri_peel_depth_vertex:"// Vertex shader for rendering triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvoid main(void) {\n    gl_Position = projMatrix * viewMatrix * vec4( pos, 1.0);\n}\n",tri_pick_vertex:"// Vertex shader for picking triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec4 color;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nvoid main(void) {\n    gl_Position = projMatrix * viewMatrix * vec4( pos, 1.0);\n    vcolor = color;\n}\n",tri_render_vertex:"// Vertex shader for rendering triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform float T; // 1.0 if there is a texture, else 0.0\nuniform float B; // 1.0 if there is a bumpmap, else 0.0\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n\nvoid main(void) {\n    vec4 pos4 = viewMatrix * vec4( pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(normal, 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color, opacity);\n    parameters = vec4(shininess, emissive, T, B);\n}\n"}});
function srequire(e){if("streamline/lib/util/flows"==e)return Streamline.flows;if("streamline/lib/globals"==e)return Streamline.globals;if("streamline/lib/version"==e)return Streamline.version;if("streamline/lib/callbacks/runtime"==e)return Streamline.runtime;if("streamline/lib/callbacks/transform"==e)return Streamline;if("streamline/lib/callbacks/builtins"==e)return Streamline.builtins;if("streamline/lib/util/future"==e)return Streamline.future;if("streamline/lib/util/source-map"==e)return Streamline.sourceMap.exports;throw new Error("Cannot require "+e)}Object.create&&Object.defineProperty&&Object.defineProperties||alert("Example will fail because your browser does not support ECMAScript 5. Try with another browser!");var __filename=""+window.location;if(window.Streamline={globals:{}},function(){var e={options:{version:185},hostGlobal:this};Narcissus=e}(),Narcissus.definitions=function(){function e(e,t,n,r,i){Object.defineProperty(e,t,{get:n,configurable:!r,enumerable:!i})}function t(e,t,n,r,i,a){Object.defineProperty(e,t,{value:n,writable:!i,configurable:!r,enumerable:!a})}function n(e){return"function"==typeof e&&e.toString().match(/\[native code\]/)}function r(e,t){for(;e;){if({}.hasOwnProperty.call(e,t))return Object.getOwnPropertyDescriptor(e,t);e=Object.getPrototypeOf(e)}}function i(e){var t={};for(var n in Object.getOwnPropertyNames(e))t[n]=Object.getOwnPropertyDescriptor(e,n);return t}function a(e){return{getOwnPropertyDescriptor:function(t){var n=Object.getOwnPropertyDescriptor(e,t);return n.configurable=!0,n},getPropertyDescriptor:function(t){var n=r(e,t);return n.configurable=!0,n},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(e)},defineProperty:function(t,n){Object.defineProperty(e,t,n)},"delete":function(t){return delete e[t]},fix:function(){if(Object.isFrozen(e))return i(e)},has:function(t){return t in e},hasOwn:function(t){return{}.hasOwnProperty.call(e,t)},get:function(t,n){return e[n]},set:function(t,n,r){return e[n]=r,!0},enumerate:function(){var t=[];for(E in e)t.push(E);return t},keys:function(){return Object.keys(e)}}}function s(){}function o(){this.table=Object.create(null,{}),this.size=0}function c(e){this.elts=e||null}for(var u=["END","\n",";",",","=","?",":","CONDITIONAL","||","&&","|","^","&","==","!=","===","!==","<","<=",">=",">","<<",">>",">>>","+","-","*","/","%","!","~","UNARY_PLUS","UNARY_MINUS","++","--",".","[","]","{","}","(",")","SCRIPT","BLOCK","LABEL","FOR_IN","CALL","NEW_WITH_ARGS","INDEX","ARRAY_INIT","OBJECT_INIT","PROPERTY_INIT","GETTER","SETTER","GROUP","LIST","LET_BLOCK","ARRAY_COMP","GENERATOR","COMP_TAIL","IDENTIFIER","NUMBER","STRING","REGEXP","break","case","catch","const","continue","debugger","default","delete","do","else","false","finally","for","function","if","in","instanceof","let","new","null","return","switch","this","throw","true","try","typeof","var","void","yield","while","with"],l=["break","const","continue","debugger","do","for","if","return","switch","throw","try","var","yield","while","with"],p={"\n":"NEWLINE",";":"SEMICOLON",",":"COMMA","?":"HOOK",":":"COLON","||":"OR","&&":"AND","|":"BITWISE_OR","^":"BITWISE_XOR","&":"BITWISE_AND","===":"STRICT_EQ","==":"EQ","=":"ASSIGN","!==":"STRICT_NE","!=":"NE","<<":"LSH","<=":"LE","<":"LT",">>>":"URSH",">>":"RSH",">=":"GE",">":"GT","++":"INCREMENT","--":"DECREMENT","+":"PLUS","-":"MINUS","*":"MUL","/":"DIV","%":"MOD","!":"NOT","~":"BITWISE_NOT",".":"DOT","[":"LEFT_BRACKET","]":"RIGHT_BRACKET","{":"LEFT_CURLY","}":"RIGHT_CURLY","(":"LEFT_PAREN",")":"RIGHT_PAREN"},f={__proto__:null},d={},_="var ",h=0,m=u.length;h<m;h++){h>0&&(_+=", ");var E,y=u[h];/^[a-z]/.test(y)?(E=y.toUpperCase(),f[y]=h):E=/^\W/.test(y)?p[y]:y,_+=E+" = "+h,d[E]=h,u[y]=h}_+=";";var b={__proto__:null};for(h=0,m=l.length;h<m;h++)b[f[l[h]]]=!0;var v=["|","^","&","<<",">>",">>>","+","-","*","/","%"];for(h=0,m=v.length;h<m;h++)y=v[h],v[y]=u[y];var T={}.hasOwnProperty;return o.prototype={has:function(e){return T.call(this.table,e)},set:function(e,t){T.call(this.table,e)||this.size++,this.table[e]=t},get:function(e){return this.table[e]},getDef:function(e,t){return T.call(this.table,e)||(this.size++,this.table[e]=t()),this.table[e]},forEach:function(e){var t=this.table;for(var n in t)e.call(this,n,t[n])},toString:function(){return"[object StringMap]"}},c.prototype={push:function(e){return new c({top:e,rest:this.elts})},top:function(){if(!this.elts)throw new Error("empty stack");return this.elts.top},isEmpty:function(){return null===this.top},find:function(e){for(var t=this.elts;t;t=t.rest)if(e(t.top))return t.top;return null},has:function(e){return Boolean(this.find(function(t){return t===e}))},forEach:function(e){for(var t=this.elts;t;t=t.rest)e(t.top)}},{tokens:u,opTypeNames:p,keywords:f,isStatementStartCode:b,tokenIds:d,consts:_,assignOps:v,defineGetter:e,defineProperty:t,isNativeCode:n,makePassthruHandler:a,noPropFound:s,StringMap:o,Stack:c}}(),Narcissus.lexer=function(){function Tokenizer(e,t,n){this.cursor=0,this.source=String(e),this.tokens=[],this.tokenIndex=0,this.lookahead=0,this.scanNewlines=!1,this.unexpectedEOF=!1,this.filename=t||"",this.lineno=n||1}var definitions=Narcissus.definitions;eval(definitions.consts);var opTokens={};for(var op in definitions.opTypeNames)if("\n"!==op&&"."!==op)for(var node=opTokens,i=0;i<op.length;i++){var ch=op[i];ch in node||(node[ch]={}),node=node[ch],node.op=op}return Tokenizer.prototype={get done(){return this.peek(!0)===END},get token(){return this.tokens[this.tokenIndex]},match:function(e,t){return this.get(t)===e||this.unget()},mustMatch:function(e){if(!this.match(e))throw this.newSyntaxError("Missing "+definitions.tokens[e].toLowerCase());return this.token},forceIdentifier:function(){if(!this.match(IDENTIFIER)){if(!(this.get()>=definitions.keywords[0]||this.unget))throw this.newSyntaxError("Missing identifier");this.token.type=IDENTIFIER}return this.token},peek:function(e){var t,n;return this.lookahead?(n=this.tokens[this.tokenIndex+this.lookahead&3],t=this.scanNewlines&&n.lineno!==this.lineno?NEWLINE:n.type):(t=this.get(e),this.unget()),t},peekOnSameLine:function(e){this.scanNewlines=!0;var t=this.peek(e);return this.scanNewlines=!1,t},skip:function(){for(var e=this.source;;){var t=e[this.cursor++],n=e[this.cursor];if("\n"!==t||this.scanNewlines){if("/"===t&&"*"===n)for(this.cursor++;;){if(t=e[this.cursor++],void 0===t)throw this.newSyntaxError("Unterminated comment");if("*"===t){if(n=e[this.cursor],"/"===n){this.cursor++;break}}else"\n"===t&&this.lineno++}else if("/"===t&&"/"===n)for(this.cursor++;;){if(t=e[this.cursor++],void 0===t)return;if("\n"===t){this.lineno++;break}}else if(" "!==t&&"\t"!==t)return void this.cursor--}else this.lineno++}},lexExponent:function(){var e=this.source,t=e[this.cursor];if("e"===t||"E"===t){if(this.cursor++,ch=e[this.cursor++],"+"!==ch&&"-"!==ch||(ch=e[this.cursor++]),ch<"0"||ch>"9")throw this.newSyntaxError("Missing exponent");do ch=e[this.cursor++];while(ch>="0"&&ch<="9");return this.cursor--,!0}return!1},lexZeroNumber:function(e){var t=this.token,n=this.source;if(t.type=NUMBER,e=n[this.cursor++],"."===e){do e=n[this.cursor++];while(e>="0"&&e<="9");this.cursor--,this.lexExponent(),t.value=parseFloat(n.substring(t.start,this.cursor))}else if("x"===e||"X"===e){do e=n[this.cursor++];while(e>="0"&&e<="9"||e>="a"&&e<="f"||e>="A"&&e<="F");this.cursor--,t.value=parseInt(n.substring(t.start,this.cursor))}else if(e>="0"&&e<="7"){do e=n[this.cursor++];while(e>="0"&&e<="7");this.cursor--,t.value=parseInt(n.substring(t.start,this.cursor),8),t.value.isOctal=!0}else this.cursor--,this.lexExponent(),t.value=0},lexNumber:function(e){var t=this.token,n=this.source;t.type=NUMBER;var r=!1;do e=n[this.cursor++],"."!==e||r||(r=!0,e=n[this.cursor++]);while(e>="0"&&e<="9");this.cursor--;var i=this.lexExponent();r=r||i;var a=n.substring(t.start,this.cursor);t.value=r?parseFloat(a):parseInt(a)},lexDot:function(e){var t=this.token,n=this.source,r=n[this.cursor];if(r>="0"&&r<="9"){do e=n[this.cursor++];while(e>="0"&&e<="9");this.cursor--,this.lexExponent(),t.type=NUMBER,t.value=parseFloat(n.substring(t.start,this.cursor))}else t.type=DOT,t.assignOp=null,t.value="."},lexString:function(ch){var token=this.token,input=this.source;token.type=STRING;for(var hasEscapes=!1,delim=ch;(ch=input[this.cursor++])!==delim;){if(this.cursor==input.length)throw this.newSyntaxError("Unterminated string literal");if("\\"===ch&&(hasEscapes=!0,"\n"===input[this.cursor]&&this.lineno++,++this.cursor==input.length))throw this.newSyntaxError("Unterminated string literal")}token.value=hasEscapes?eval(input.substring(token.start,this.cursor)):input.substring(token.start+1,this.cursor-1)},lexRegExp:function(ch){var token=this.token,input=this.source;token.type=REGEXP;do if(ch=input[this.cursor++],"\\"===ch)this.cursor++;else if("["===ch){do{if(void 0===ch)throw this.newSyntaxError("Unterminated character class");"\\"===ch&&this.cursor++,ch=input[this.cursor++]}while("]"!==ch)}else if(void 0===ch)throw this.newSyntaxError("Unterminated regex");while("/"!==ch);do ch=input[this.cursor++];while(ch>="a"&&ch<="z");this.cursor--,token.value=eval(input.substring(token.start,this.cursor))},lexOp:function(e){var t=this.token,n=this.source,r=opTokens[e],i=n[this.cursor];i in r&&(r=r[i],this.cursor++,i=n[this.cursor],i in r&&(r=r[i],this.cursor++,i=n[this.cursor]));var a=r.op;definitions.assignOps[a]&&"="===n[this.cursor]?(this.cursor++,t.type=ASSIGN,t.assignOp=definitions.tokenIds[definitions.opTypeNames[a]],a+="="):(t.type=definitions.tokenIds[definitions.opTypeNames[a]],t.assignOp=null),t.value=a},lexIdent:function(e){var t=this.token,n=this.source;do e=n[this.cursor++];while(e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"$"===e||"_"===e);this.cursor--;var r=n.substring(t.start,this.cursor);t.type=definitions.keywords[r]||IDENTIFIER,t.value=r},get:function(e){for(var t;this.lookahead;)if(--this.lookahead,this.tokenIndex=this.tokenIndex+1&3,t=this.tokens[this.tokenIndex],t.type!==NEWLINE||this.scanNewlines)return t.type;this.skip(),this.tokenIndex=this.tokenIndex+1&3,t=this.tokens[this.tokenIndex],t||(this.tokens[this.tokenIndex]=t={});var n=this.source;if(this.cursor===n.length)return t.type=END;t.start=this.cursor,t.lineno=this.lineno;var r=n[this.cursor++];if(r>="a"&&r<="z"||r>="A"&&r<="Z"||"$"===r||"_"===r)this.lexIdent(r);else if(e&&"/"===r)this.lexRegExp(r);else if(r in opTokens)this.lexOp(r);else if("."===r)this.lexDot(r);else if(r>="1"&&r<="9")this.lexNumber(r);else if("0"===r)this.lexZeroNumber(r);else if('"'===r||"'"===r)this.lexString(r);else{if(!this.scanNewlines||"\n"!==r)throw this.newSyntaxError("Illegal token");t.type=NEWLINE,t.value="\n",this.lineno++}return t.end=this.cursor,t.type},unget:function(){if(4===++this.lookahead)throw"PANIC: too much lookahead!";this.tokenIndex=this.tokenIndex-1&3},newSyntaxError:function(e){var t=new SyntaxError(this.filename+":"+this.lineno+":"+e);return t.source=this.source,t.cursor=this.lookahead?this.tokens[this.tokenIndex+this.lookahead&3].start:this.cursor,t}},{Tokenizer:Tokenizer}}(),Narcissus.parser=function(){function pushDestructuringVarDecls(e,t){for(var n in e){var r=e[n];r.type===IDENTIFIER?t.varDecls.push(r):pushDestructuringVarDecls(r,t)}}function StaticContext(e,t,n,r,i){this.parentScript=e,this.parentBlock=t,this.inFunction=n,this.inForLoopInit=r,this.nesting=i,this.allLabels=new Stack,this.currentLabels=new Stack,this.labeledTargets=new Stack,this.defaultTarget=null,Narcissus.options.ecma3OnlyMode&&(this.ecma3OnlyMode=!0),Narcissus.options.parenFreeMode&&(this.parenFreeMode=!0)}function Script(e,t){var n=new Node(e,scriptInit()),r=new StaticContext(n,n,t,(!1),NESTING_TOP);return Statements(e,r,n),n}function Node(e,t){var n=e.token;n?(this.type=n.type,this.value=n.value,this.lineno=n.lineno,this.start=n.start,this.end=n.end):this.lineno=e.lineno,this.tokenizer=e,this.children=[];for(var r in t)this[r]=t[r]}function tokenString(e){var t=definitions.tokens[e];return/^\W/.test(t)?definitions.opTypeNames[t]:t.toUpperCase()}function blockInit(){return{type:BLOCK,varDecls:[]}}function scriptInit(){return{type:SCRIPT,funDecls:[],varDecls:[],modDecls:[],impDecls:[],expDecls:[],loadDeps:[],hasEmptyReturn:!1,hasReturnWithValue:!1,isGenerator:!1}}function MaybeLeftParen(e,t){return t.parenFreeMode?e.match(LEFT_PAREN)?LEFT_PAREN:END:e.mustMatch(LEFT_PAREN).type}function MaybeRightParen(e,t){t===LEFT_PAREN&&e.mustMatch(RIGHT_PAREN)}function Statements(e,t,n){try{for(;!e.done&&e.peek(!0)!==RIGHT_CURLY;)n.push(Statement(e,t))}catch(r){throw e.done&&(e.unexpectedEOF=!0),r}}function Block(e,t){e.mustMatch(LEFT_CURLY);var n=new Node(e,blockInit());return Statements(e,t.update({parentBlock:n}).pushTarget(n),n),e.mustMatch(RIGHT_CURLY),n.end=e.token.end,n}function Statement(e,t){var n,r,i,a,s,o,c,u,l=e.get(!0);switch(l){case FUNCTION:return FunctionDefinition(e,t,!0,t.nesting!==NESTING_TOP?STATEMENT_FORM:DECLARED_FORM);case LEFT_CURLY:return r=new Node(e,blockInit()),Statements(e,t.update({parentBlock:r}).pushTarget(r).nest(NESTING_SHALLOW),r),e.mustMatch(RIGHT_CURLY),r.end=e.token.end,r;case IF:return r=new Node(e),r.condition=HeadExpression(e,t),c=t.pushTarget(r).nest(NESTING_DEEP),r.thenPart=Statement(e,c),r.elsePart=e.match(ELSE)?Statement(e,c):null,r;case SWITCH:for(r=new Node(e,{cases:[],defaultIndex:-1}),r.discriminant=HeadExpression(e,t),c=t.pushTarget(r).nest(NESTING_DEEP),e.mustMatch(LEFT_CURLY);(l=e.get())!==RIGHT_CURLY;){switch(l){case DEFAULT:if(r.defaultIndex>=0)throw e.newSyntaxError("More than one switch default");case CASE:i=new Node(e),l===DEFAULT?r.defaultIndex=r.cases.length:i.caseLabel=Expression(e,c,COLON);break;default:throw e.newSyntaxError("Invalid switch case")}for(e.mustMatch(COLON),i.statements=new Node(e,blockInit());(l=e.peek(!0))!==CASE&&l!==DEFAULT&&l!==RIGHT_CURLY;)i.statements.push(Statement(e,c));r.cases.push(i)}return r.end=e.token.end,r;case FOR:if(r=new Node(e,LOOP_INIT),e.match(IDENTIFIER)&&("each"===e.token.value?r.isEach=!0:e.unget()),t.parenFreeMode||e.mustMatch(LEFT_PAREN),c=t.pushTarget(r).nest(NESTING_DEEP),u=t.update({inForLoopInit:!0}),(l=e.peek())!==SEMICOLON&&(l===VAR||l===CONST?(e.get(),i=Variables(e,u)):l===LET?(e.get(),e.peek()===LEFT_PAREN?i=LetBlock(e,u,!1):(u.parentBlock=r,r.varDecls=[],i=Variables(e,u))):i=Expression(e,u)),i&&e.match(IN))if(r.type=FOR_IN,r.object=Expression(e,u),i.type===VAR||i.type===LET){if(s=i.children,1!==s.length&&1!==i.destructurings.length)throw new SyntaxError("Invalid for..in left-hand side",e.filename,i.lineno);i.destructurings.length>0?r.iterator=i.destructurings[0]:r.iterator=s[0],r.varDecl=i}else i.type!==ARRAY_INIT&&i.type!==OBJECT_INIT||(i.destructuredNames=checkDestructuring(e,u,i)),r.iterator=i;else{if(r.setup=i,e.mustMatch(SEMICOLON),r.isEach)throw e.newSyntaxError("Invalid for each..in loop");r.condition=e.peek()===SEMICOLON?null:Expression(e,u),e.mustMatch(SEMICOLON),o=e.peek(),r.update=(t.parenFreeMode?o===LEFT_CURLY||definitions.isStatementStartCode[o]:o===RIGHT_PAREN)?null:Expression(e,u)}return t.parenFreeMode||e.mustMatch(RIGHT_PAREN),r.body=Statement(e,c),r.end=e.token.end,r;case WHILE:return r=new Node(e,{isLoop:!0}),r.condition=HeadExpression(e,t),r.body=Statement(e,t.pushTarget(r).nest(NESTING_DEEP)),r.end=e.token.end,r;case DO:if(r=new Node(e,{isLoop:!0}),r.body=Statement(e,t.pushTarget(r).nest(NESTING_DEEP)),e.mustMatch(WHILE),r.condition=HeadExpression(e,t),!t.ecmaStrictMode)return e.match(SEMICOLON),r.end=e.token.end,r;break;case BREAK:case CONTINUE:if(r=new Node(e),c=t.pushTarget(r),e.peekOnSameLine()===IDENTIFIER&&(e.get(),r.label=e.token.value),r.target=r.label?c.labeledTargets.find(function(e){return e.labels.has(r.label)}):c.defaultTarget,!r.target)throw e.newSyntaxError("Invalid "+(l===BREAK?"break":"continue"));if(l===CONTINUE){for(var p=r.target;p&&!p.isLoop;p=p.target);if(!p)throw e.newSyntaxError("Invalid continue")}break;case TRY:for(r=new Node(e,{catchClauses:[]}),r.tryBlock=Block(e,t);e.match(CATCH);){switch(i=new Node(e),a=MaybeLeftParen(e,t),e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget(),i.varName=DestructuringExpression(e,t,!0);break;case IDENTIFIER:i.varName=e.token.value;break;default:throw e.newSyntaxError("missing identifier in catch")}if(e.match(IF)){if(t.ecma3OnlyMode)throw e.newSyntaxError("Illegal catch guard");if(r.catchClauses.length&&!r.catchClauses.top().guard)throw e.newSyntaxError("Guarded catch after unguarded");i.guard=Expression(e,t)}MaybeRightParen(e,a),i.block=Block(e,t),r.catchClauses.push(i)}if(e.match(FINALLY)&&(r.finallyBlock=Block(e,t)),!r.catchClauses.length&&!r.finallyBlock)throw e.newSyntaxError("Invalid try statement");return r.end=e.token.end,r;case CATCH:case FINALLY:throw e.newSyntaxError(definitions.tokens[l]+" without preceding try");case THROW:r=new Node(e),r.exception=Expression(e,t);break;case RETURN:r=ReturnOrYield(e,t);break;case WITH:return r=new Node(e),r.object=HeadExpression(e,t),r.body=Statement(e,t.pushTarget(r).nest(NESTING_DEEP)),r.end=e.token.end,r;case VAR:case CONST:r=Variables(e,t),r.eligibleForASI=!0;break;case LET:r=e.peek()===LEFT_PAREN?LetBlock(e,t,!0):Variables(e,t),r.eligibleForASI=!0;break;case DEBUGGER:r=new Node(e);break;case NEWLINE:case SEMICOLON:return r=new Node(e,{type:SEMICOLON}),r.expression=null,r;default:if(l===IDENTIFIER&&(l=e.peek(),l===COLON)){if(n=e.token.value,t.allLabels.has(n))throw e.newSyntaxError("Duplicate label");return e.get(),r=new Node(e,{type:LABEL,label:n}),r.statement=Statement(e,t.pushLabel(n).nest(NESTING_SHALLOW)),r.target=r.statement.type===LABEL?r.statement.target:r.statement,r.end=e.token.end,r}r=new Node(e,{type:SEMICOLON}),e.unget(),r.expression=Expression(e,t),r.end=r.expression.end}return MagicalSemicolon(e),r.end=e.token.end,r}function MagicalSemicolon(e){var t;if(e.lineno===e.token.lineno&&(t=e.peekOnSameLine(),t!==END&&t!==NEWLINE&&t!==SEMICOLON&&t!==RIGHT_CURLY))throw e.newSyntaxError("missing ; before statement");e.match(SEMICOLON)}function ReturnOrYield(e,t){var n,r,i=e.token.type,a=t.parentScript;if(i===RETURN);else{if(!t.inFunction)throw e.newSyntaxError("Yield not in function");a.isGenerator=!0}if(n=new Node(e,{value:void 0}),r=e.peek(!0),r!==END&&r!==NEWLINE&&r!==SEMICOLON&&r!==RIGHT_CURLY&&(i!==YIELD||r!==i&&r!==RIGHT_BRACKET&&r!==RIGHT_PAREN&&r!==COLON&&r!==COMMA)?i===RETURN?(n.value=Expression(e,t),a.hasReturnWithValue=!0):n.value=AssignExpression(e,t):i===RETURN&&(a.hasEmptyReturn=!0),a.hasReturnWithValue&&a.isGenerator)throw e.newSyntaxError("Generator returns a value");return n}function FunctionDefinition(e,t,n,r){var i,a=new Node(e,{params:[]});if(a.type!==FUNCTION&&(a.type="get"===a.value?GETTER:SETTER),e.match(IDENTIFIER))a.name=e.token.value;else if(n)throw e.newSyntaxError("missing function identifier");var s=new StaticContext(null,null,(!0),(!1),NESTING_TOP);if(e.mustMatch(LEFT_PAREN),!e.match(RIGHT_PAREN)){do switch(e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget(),a.params.push(DestructuringExpression(e,s));break;case IDENTIFIER:a.params.push(e.token.value);break;default:throw e.newSyntaxError("missing formal parameter")}while(e.match(COMMA));e.mustMatch(RIGHT_PAREN)}if(i=e.get(),i!==LEFT_CURLY&&e.unget(),i!==LEFT_CURLY){if(a.body=AssignExpression(e,s),a.body.isGenerator)throw e.newSyntaxError("Generator returns a value")}else a.body=Script(e,!0);return i===LEFT_CURLY&&e.mustMatch(RIGHT_CURLY),a.end=e.token.end,a.functionForm=r,r===DECLARED_FORM&&t.parentScript.funDecls.push(a),a}function Variables(e,t,n){var r,i,a,s;switch(s=e.token.type){case VAR:case CONST:a=t.parentScript;break;case LET:a=t.parentBlock;break;case LEFT_PAREN:s=LET,a=n}r=new Node(e,{type:s,destructurings:[]});do if(s=e.get(),s!==LEFT_BRACKET&&s!==LEFT_CURLY){if(s!==IDENTIFIER)throw e.newSyntaxError("missing variable name");if(i=new Node(e,{type:IDENTIFIER,name:e.token.value,readOnly:r.type===CONST}),r.push(i),a.varDecls.push(i),e.match(ASSIGN)){if(e.token.assignOp)throw e.newSyntaxError("Invalid variable initialization");i.initializer=AssignExpression(e,t)}}else{e.unget();var o=DestructuringExpression(e,t,!0);if(i=new Node(e,{type:IDENTIFIER,name:o,readOnly:r.type===CONST}),r.push(i),pushDestructuringVarDecls(i.name.destructuredNames,a),r.destructurings.push({exp:o,decl:i}),t.inForLoopInit&&e.peek()===IN)continue;if(e.mustMatch(ASSIGN),e.token.assignOp)throw e.newSyntaxError("Invalid variable initialization");i.initializer=AssignExpression(e,t)}while(e.match(COMMA));return r.end=e.token.end,r}function LetBlock(e,t,n){var r,i;return r=new Node(e,{type:LET_BLOCK,varDecls:[]}),e.mustMatch(LEFT_PAREN),r.variables=Variables(e,t,r),e.mustMatch(RIGHT_PAREN),n&&e.peek()!==LEFT_CURLY&&(i=new Node(e,{type:SEMICOLON,expression:r}),n=!1),n?r.block=Block(e,t):r.expression=AssignExpression(e,t),r}function checkDestructuring(e,t,n,r){if(n.type===ARRAY_COMP)throw e.newSyntaxError("Invalid array comprehension left-hand side");if(n.type===ARRAY_INIT||n.type===OBJECT_INIT){for(var i,a,s,o,c={},u=n.children,l=0,p=u.length;l<p;l++)if(i=u[l])if(i.type===PROPERTY_INIT?(o=i.children,s=o[1],a=o[0].value):n.type===OBJECT_INIT?(s=i,a=i.value):(s=i,a=l),s.type===ARRAY_INIT||s.type===OBJECT_INIT)c[a]=checkDestructuring(e,t,s,r);else{if(r&&s.type!==IDENTIFIER)throw e.newSyntaxError("missing name in pattern");c[a]=s}return c}}function DestructuringExpression(e,t,n){var r=PrimaryExpression(e,t);return r.destructuredNames=checkDestructuring(e,t,r,n),r}function GeneratorExpression(e,t,n){return new Node(e,{type:GENERATOR,expression:n,tail:ComprehensionTail(e,t)})}function ComprehensionTail(e,t){var n,r,i,a,s;n=new Node(e,{type:COMP_TAIL});do{switch(r=new Node(e,{type:FOR_IN,isLoop:!0}),e.match(IDENTIFIER)&&("each"===e.token.value?r.isEach=!0:e.unget()),s=MaybeLeftParen(e,t),e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget(),r.iterator=DestructuringExpression(e,t);break;case IDENTIFIER:r.iterator=a=new Node(e,{type:IDENTIFIER}),a.name=a.value,r.varDecl=i=new Node(e,{type:VAR}),i.push(a),t.parentScript.varDecls.push(a);break;default:throw e.newSyntaxError("missing identifier")}e.mustMatch(IN),r.object=Expression(e,t),MaybeRightParen(e,s),n.push(r)}while(e.match(FOR));return e.match(IF)&&(n.guard=HeadExpression(e,t)),n}function HeadExpression(e,t){var n=MaybeLeftParen(e,t),r=ParenExpression(e,t);if(MaybeRightParen(e,n),n===END&&!r.parenthesized){var i=e.peek();if(i!==LEFT_CURLY&&!definitions.isStatementStartCode[i])throw e.newSyntaxError("Unparenthesized head followed by unbraced body")}return r}function ParenExpression(e,t){var n=Expression(e,t.update({inForLoopInit:t.inForLoopInit&&e.token.type===LEFT_PAREN}));if(e.match(FOR)){if(n.type===YIELD&&!n.parenthesized)throw e.newSyntaxError("Yield expression must be parenthesized");if(n.type===COMMA&&!n.parenthesized)throw e.newSyntaxError("Generator expression must be parenthesized");n=GeneratorExpression(e,t,n)}return n}function Expression(e,t){var n,r;if(n=AssignExpression(e,t),e.match(COMMA)){r=new Node(e,{type:COMMA}),r.push(n),n=r;do{if(r=n.children[n.children.length-1],r.type===YIELD&&!r.parenthesized)throw e.newSyntaxError("Yield expression must be parenthesized");n.push(AssignExpression(e,t))}while(e.match(COMMA))}return n}function AssignExpression(e,t){var n,r;if(e.match(YIELD,!0))return ReturnOrYield(e,t);if(n=new Node(e,{type:ASSIGN}),r=ConditionalExpression(e,t),!e.match(ASSIGN))return r;switch(r.type){case OBJECT_INIT:case ARRAY_INIT:r.destructuredNames=checkDestructuring(e,t,r);case IDENTIFIER:case DOT:case INDEX:case CALL:break;default:throw e.newSyntaxError("Bad left-hand side of assignment")}return n.assignOp=e.token.assignOp,n.push(r),n.push(AssignExpression(e,t)),n}function ConditionalExpression(e,t){var n,r;if(n=OrExpression(e,t),e.match(HOOK)){if(r=n,n=new Node(e,{type:HOOK}),n.push(r),n.push(AssignExpression(e,t.update({inForLoopInit:!1}))),!e.match(COLON))throw e.newSyntaxError("missing : after ?");n.push(AssignExpression(e,t))}return n}function OrExpression(e,t){var n,r;for(n=AndExpression(e,t);e.match(OR);)r=new Node(e),r.push(n),r.push(AndExpression(e,t)),n=r;return n}function AndExpression(e,t){var n,r;for(n=BitwiseOrExpression(e,t);e.match(AND);)r=new Node(e),r.push(n),r.push(BitwiseOrExpression(e,t)),n=r;return n}function BitwiseOrExpression(e,t){var n,r;for(n=BitwiseXorExpression(e,t);e.match(BITWISE_OR);)r=new Node(e),r.push(n),r.push(BitwiseXorExpression(e,t)),n=r;return n}function BitwiseXorExpression(e,t){var n,r;for(n=BitwiseAndExpression(e,t);e.match(BITWISE_XOR);)r=new Node(e),r.push(n),r.push(BitwiseAndExpression(e,t)),n=r;return n}function BitwiseAndExpression(e,t){var n,r;for(n=EqualityExpression(e,t);e.match(BITWISE_AND);)r=new Node(e),r.push(n),r.push(EqualityExpression(e,t)),n=r;return n}function EqualityExpression(e,t){var n,r;for(n=RelationalExpression(e,t);e.match(EQ)||e.match(NE)||e.match(STRICT_EQ)||e.match(STRICT_NE);)r=new Node(e),r.push(n),r.push(RelationalExpression(e,t)),n=r;return n}function RelationalExpression(e,t){var n,r,i=t.update({inForLoopInit:!1});for(n=ShiftExpression(e,i);e.match(LT)||e.match(LE)||e.match(GE)||e.match(GT)||!t.inForLoopInit&&e.match(IN)||e.match(INSTANCEOF);)r=new Node(e),r.push(n),r.push(ShiftExpression(e,i)),n=r;return n}function ShiftExpression(e,t){var n,r;for(n=AddExpression(e,t);e.match(LSH)||e.match(RSH)||e.match(URSH);)r=new Node(e),r.push(n),r.push(AddExpression(e,t)),n=r;return n}function AddExpression(e,t){var n,r;for(n=MultiplyExpression(e,t);e.match(PLUS)||e.match(MINUS);)r=new Node(e),r.push(n),r.push(MultiplyExpression(e,t)),n=r;return n}function MultiplyExpression(e,t){var n,r;for(n=UnaryExpression(e,t);e.match(MUL)||e.match(DIV)||e.match(MOD);)r=new Node(e),r.push(n),r.push(UnaryExpression(e,t)),n=r;return n}function UnaryExpression(e,t){var n,r,i;switch(i=e.get(!0)){case DELETE:case VOID:case TYPEOF:case NOT:case BITWISE_NOT:case PLUS:case MINUS:n=i===PLUS?new Node(e,{type:UNARY_PLUS}):i===MINUS?new Node(e,{type:UNARY_MINUS}):new Node(e),n.push(UnaryExpression(e,t));break;case INCREMENT:case DECREMENT:n=new Node(e),n.push(MemberExpression(e,t,!0));break;default:e.unget(),n=MemberExpression(e,t,!0),e.tokens[e.tokenIndex+e.lookahead-1&3].lineno===e.lineno&&(e.match(INCREMENT)||e.match(DECREMENT))&&(r=new Node(e,{postfix:!0}),r.push(n),n=r)}return n}function MemberExpression(e,t,n){var r,i,a;for(e.match(NEW)?(r=new Node(e),r.push(MemberExpression(e,t,!1)),e.match(LEFT_PAREN)&&(r.type=NEW_WITH_ARGS,r.push(ArgumentList(e,t)))):r=PrimaryExpression(e,t);(a=e.get())!==END;){switch(a){case DOT:i=new Node(e),i.push(r),e.forceIdentifier(),i.push(new Node(e));break;case LEFT_BRACKET:i=new Node(e,{type:INDEX}),i.push(r),i.push(Expression(e,t)),e.mustMatch(RIGHT_BRACKET),i.end=e.token.end;break;case LEFT_PAREN:if(n){i=new Node(e,{type:CALL}),i.push(r),i.push(ArgumentList(e,t));break}default:return e.unget(),r}r=i}return r}function ArgumentList(e,t){var n,r;if(n=new Node(e,{type:LIST}),e.match(RIGHT_PAREN,!0))return n.end=e.token.end,n;do{if(r=AssignExpression(e,t),r.type===YIELD&&!r.parenthesized&&e.peek()===COMMA)throw e.newSyntaxError("Yield expression must be parenthesized");if(e.match(FOR)&&(r=GeneratorExpression(e,t,r),n.children.length>1||e.peek(!0)===COMMA))throw e.newSyntaxError("Generator expression must be parenthesized");n.push(r)}while(e.match(COMMA));return e.mustMatch(RIGHT_PAREN),n.end=e.token.end,n}function PrimaryExpression(e,t){var n,r,i=e.get(!0);switch(i){case FUNCTION:n=FunctionDefinition(e,t,!1,EXPRESSED_FORM);break;case LEFT_BRACKET:for(n=new Node(e,{type:ARRAY_INIT});(i=e.peek(!0))!==RIGHT_BRACKET;)if(i!==COMMA){if(n.push(AssignExpression(e,t)),i!==COMMA&&!e.match(COMMA))break}else e.get(),n.push(null);1===n.children.length&&e.match(FOR)&&(r=new Node(e,{type:ARRAY_COMP,expression:n.children[0],tail:ComprehensionTail(e,t)}),n=r),e.mustMatch(RIGHT_BRACKET),n.end=e.token.end;break;case LEFT_CURLY:var a;n=new Node(e,{type:OBJECT_INIT});e:if(!e.match(RIGHT_CURLY)){do if(i=e.get(),"get"!==e.token.value&&"set"!==e.token.value||e.peek()!==IDENTIFIER){switch(i){case IDENTIFIER:case NUMBER:case STRING:a=new Node(e,{type:IDENTIFIER});break;case RIGHT_CURLY:if(t.ecma3OnlyMode)throw e.newSyntaxError("Illegal trailing ,");break e;default:if(e.token.value in definitions.keywords){a=new Node(e,{type:IDENTIFIER});break}throw e.newSyntaxError("Invalid property name")}if(e.match(COLON))r=new Node(e,{type:PROPERTY_INIT}),r.push(a),r.push(AssignExpression(e,t)),n.push(r);else{if(e.peek()!==COMMA&&e.peek()!==RIGHT_CURLY)throw e.newSyntaxError("missing : after property");n.push(a)}}else{if(t.ecma3OnlyMode)throw e.newSyntaxError("Illegal property accessor");n.push(FunctionDefinition(e,t,!0,EXPRESSED_FORM))}while(e.match(COMMA));e.mustMatch(RIGHT_CURLY)}n.end=e.token.end;break;case LEFT_PAREN:var s=e.token.start;n=ParenExpression(e,t),e.mustMatch(RIGHT_PAREN),n.start=s,n.end=e.token.end,n.parenthesized=!0;break;case LET:n=LetBlock(e,t,!1);break;case NULL:case THIS:case TRUE:case FALSE:case IDENTIFIER:case NUMBER:case STRING:case REGEXP:n=new Node(e);break;default:throw e.newSyntaxError("missing operand")}return n}function parse(e,t,n){var r=new lexer.Tokenizer(e,t,n),i=Script(r,!1);if(!r.done)throw r.newSyntaxError("Syntax error");return i}function parseStdin(e,t){for(;;)try{var n=new lexer.Tokenizer(e,"stdin",t.value),r=Script(n,!1);return t.value=n.lineno,r}catch(i){if(!n.unexpectedEOF)throw i;var a=readline();if(!a)throw i;e+="\n"+a}}var lexer=Narcissus.lexer,definitions=Narcissus.definitions;const StringMap=definitions.StringMap,Stack=definitions.Stack;eval(definitions.consts);const NESTING_TOP=0,NESTING_SHALLOW=1,NESTING_DEEP=2;StaticContext.prototype={ecma3OnlyMode:!1,parenFreeMode:!1,update:function(e){var t={};for(var n in e)t[n]={value:e[n],writable:!0,enumerable:!0,configurable:!0};return Object.create(this,t)},pushLabel:function(e){return this.update({currentLabels:this.currentLabels.push(e),allLabels:this.allLabels.push(e)})},pushTarget:function(e){var t=e.isLoop||e.type===SWITCH;return t&&(e.target=this.defaultTarget),this.currentLabels.isEmpty()?t?this.update({defaultTarget:e}):this:(e.labels=new StringMap,this.currentLabels.forEach(function(t){e.labels.set(t,!0)}),this.update({currentLabels:new Stack,labeledTargets:this.labeledTargets.push(e),defaultTarget:t?e:this.defaultTarget}))},nest:function(e){var t=Math.max(this.nesting,e);return t!==this.nesting?this.update({nesting:t}):this}},definitions.defineProperty(Array.prototype,"top",function(){return this.length&&this[this.length-1]},!1,!1,!0);var Np=Node.prototype={};Np.constructor=Node,Np.toSource=Object.prototype.toSource,Np.push=function(e){return null!==e&&(e.start<this.start&&(this.start=e.start),this.end<e.end&&(this.end=e.end)),this.children.push(e)},Node.indentLevel=0,Np.toString=function(){var e=[];for(var t in this)this.hasOwnProperty(t)&&"type"!==t&&"target"!==t&&e.push({id:t,value:this[t]});e.sort(function(e,t){return e.id<t.id?-1:1});const n="    ";var r=++Node.indentLevel,i="{\n"+n.repeat(r)+"type: "+tokenString(this.type);for(t=0;t<e.length;t++)i+=", "+e[t].id+": "+e[t].value;return r=--Node.indentLevel,i+="\n"+n.repeat(r)+"}"},Np.getSource=function(){return this.tokenizer.source.slice(this.start,this.end)};const LOOP_INIT={isLoop:!0};definitions.defineGetter(Np,"filename",function(){return this.tokenizer.filename}),definitions.defineGetter(Np,"length",function(){throw new Error("Node.prototype.length is gone; use n.children.length instead")}),definitions.defineProperty(String.prototype,"repeat",function(e){for(var t="",n=this+t;--e>=0;)t+=n;return t},!1,!1,!0);const DECLARED_FORM=0,EXPRESSED_FORM=1,STATEMENT_FORM=2;return{parse:parse,parseStdin:parseStdin,Node:Node,DECLARED_FORM:DECLARED_FORM,EXPRESSED_FORM:EXPRESSED_FORM,STATEMENT_FORM:STATEMENT_FORM,Tokenizer:lexer.Tokenizer,FunctionDefinition:FunctionDefinition}}(),Narcissus.decompiler=function(){function indent(e,t){for(var n="",r=!0,i=0,a=t.length;i<a;i++){if(r)for(var s=0;s<e;s++)n+=" ";n+=t[i],r="\n"===t[i]}return n}function isBlock(e){return e&&e.type===BLOCK}function isNonEmptyBlock(e){
return isBlock(e)&&e.children.length>0}function nodeStr(e){return'"'+e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}function pp(e,t,n){var r=!1;if(!e)return"";if(!(e instanceof Object))return e;t||(r=!0,t=1);var i="";switch(e.parenthesized&&(i+="("),e.type){case FUNCTION:case GETTER:case SETTER:i+=e.type===FUNCTION?"function":e.type===GETTER?"get":"set",i+=(e.name?" "+e.name:"")+"(";for(var a=0,s=e.params.length;a<s;a++)i+=(a>0?", ":"")+pp(e.params[a],t);i+=") "+pp(e.body,t);break;case SCRIPT:case BLOCK:var o=e.children;if(r){for(var a=0,s=o.length;a<s;a++){a>0&&(i+="\n"),i+=pp(o[a],t);var c=i[i.length-1];";"!=c&&(i+=";")}break}i+="{",void 0!==e.id&&(i+=" /* "+e.id+" */"),i+="\n";for(var a=0,s=o.length;a<s;a++){a>0&&(i+="\n"),i+=indent(4,pp(o[a],t));var c=i[i.length-1];";"!=c&&(i+=";")}i+="\n}";break;case LET_BLOCK:i+="let ("+pp(e.variables,t,!0)+") ",i+=e.expression?pp(e.expression,t):pp(e.block,t);break;case IF:i+="if ("+pp(e.condition,t)+") ";var u=e.thenPart,l=e.elsePart,p=isBlock(u)||isBlock(l);p||(i+="{\n"),i+=(p?pp(u,t):indent(4,pp(u,t)))+"\n",l&&(i+=p?" else ":"} else {\n",i+=(p?pp(l,t):indent(4,pp(l,t)))+"\n"),p||(i+="}");break;case SWITCH:i+="switch ("+pp(e.discriminant,t)+") {\n";for(var a=0,s=e.cases.length;a<s;a++){var f=e.cases[a];i+=f.type===CASE?"  case "+pp(f.caseLabel,t)+":\n":"  default:\n",ps=pp(f.statements,t),i+=ps.slice(2,ps.length-2)+"\n"}i+="}";break;case FOR:i+="for ("+pp(e.setup,t)+"; "+pp(e.condition,t)+"; "+pp(e.update,t)+") ";var d=pp(e.body,t);isBlock(e.body)?e.body&&(i+=d):i+="{\n"+indent(4,d)+";\n}";break;case WHILE:i+="while ("+pp(e.condition,t)+") ";var d=pp(e.body,t);i+=isBlock(e.body)?d:"{\n"+indent(4,d)+";\n}";break;case FOR_IN:var _=e.varDecl;i+=e.isEach?"for each (":"for (",i+=(_?pp(_,t):pp(e.iterator,t))+" in "+pp(e.object,t)+") ";var d=pp(e.body,t);isBlock(e.body)?e.body&&(i+=d):i+="{\n"+indent(4,d)+";\n}";break;case DO:i+="do "+pp(e.body,t),i+=" while ("+pp(e.condition,t)+");";break;case BREAK:i+="break"+(e.label?" "+e.label:"")+";";break;case CONTINUE:i+="continue"+(e.label?" "+e.label:"")+";";break;case TRY:i+="try ",i+=pp(e.tryBlock,t);for(var a=0,s=e.catchClauses.length;a<s;a++){var h=e.catchClauses[a];i+=" catch ("+pp(h.varName,t)+(h.guard?" if "+pp(h.guard,t):"")+") ",i+=pp(h.block,t)}e.finallyBlock&&(i+=" finally ",i+=pp(e.finallyBlock,t));break;case THROW:i+="throw "+pp(e.exception,t);break;case RETURN:i+="return",e.value&&(i+=" "+pp(e.value,t));break;case YIELD:i+="yield",e.value.type&&(i+=" "+pp(e.value,t));break;case GENERATOR:i+=pp(e.expression,t)+" "+pp(e.tail,t);break;case WITH:i+="with ("+pp(e.object,t)+") ",i+=pp(e.body,t);break;case LET:case VAR:case CONST:var o=e.children;n||(i+=tokens[e.type]+" ");for(var a=0,s=o.length;a<s;a++){a>0&&(i+=", ");var _=o[a];i+=pp(_.name,t),_.initializer&&(i+=" = "+pp(_.initializer,t))}break;case DEBUGGER:i+="debugger\n";break;case SEMICOLON:e.expression&&(i+=pp(e.expression,t)+";");break;case LABEL:i+=e.label+":\n"+pp(e.statement,t);break;case COMMA:case LIST:for(var o=e.children,a=0,s=o.length;a<s;a++)a>0&&(i+=", "),i+=pp(o[a],t);break;case ASSIGN:var o=e.children,h=e.assignOp;i+=pp(o[0],t)+" "+(h?tokens[h]:"")+"= "+pp(o[1],t);break;case HOOK:var o=e.children;i+="("+pp(o[0],t)+" ? "+pp(o[1],t)+" : "+pp(o[2],t),i+=")";break;case OR:case AND:var o=e.children;i+="("+pp(o[0],t)+" "+tokens[e.type]+" "+pp(o[1],t),i+=")";break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var o=e.children;i+="("+pp(o[0],t)+" "+tokens[e.type]+" "+pp(o[1],t)+")";break;case DELETE:case VOID:case TYPEOF:i+=tokens[e.type]+" "+pp(e.children[0],t);break;case NOT:case BITWISE_NOT:i+=tokens[e.type]+pp(e.children[0],t);break;case UNARY_PLUS:i+="+"+pp(e.children[0],t);break;case UNARY_MINUS:i+="-"+pp(e.children[0],t);break;case INCREMENT:case DECREMENT:i+=e.postfix?pp(e.children[0],t)+tokens[e.type]:tokens[e.type]+pp(e.children[0],t);break;case DOT:var o=e.children;i+=pp(o[0],t)+"."+pp(o[1],t);break;case INDEX:var o=e.children;i+=pp(o[0],t)+"["+pp(o[1],t)+"]";break;case CALL:var o=e.children;i+=pp(o[0],t)+"("+pp(o[1],t)+")";break;case NEW:case NEW_WITH_ARGS:var o=e.children;i+="new "+pp(o[0],t),o[1]&&(i+="("+pp(o[1],t)+")");break;case ARRAY_INIT:i+="[";for(var o=e.children,a=0,s=o.length;a<s;a++)o[a]&&(i+=pp(o[a],t)),i+=",";i+="]";break;case ARRAY_COMP:i+="["+pp(e.expression,t)+" ",i+=pp(e.tail,t),i+="]";break;case COMP_TAIL:for(var o=e.children,a=0,s=o.length;a<s;a++)a>0&&(i+=" "),i+=pp(o[a],t);e.guard&&(i+=" if ("+pp(e.guard,t)+")");break;case OBJECT_INIT:var o=e.children;i+=o[0]&&o[0].type===PROPERTY_INIT?"{\n":"{";for(var a=0,s=o.length;a<s;a++){a>0&&(i+=",\n");var h=o[a];if(h.type===PROPERTY_INIT){var m,E=h.children;m="string"!=typeof E[0].value||/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(E[0].value)?pp(E[0],t):nodeStr(E[0]),i+=indent(4,m)+": "+indent(4,pp(E[1],t)).substring(4)}else i+=indent(4,pp(h,t))}i+="\n}";break;case NULL:i+="null";break;case THIS:i+="this";break;case TRUE:i+="true";break;case FALSE:i+="false";break;case IDENTIFIER:case NUMBER:case REGEXP:i+=e.value.isOctal?"0"+e.value.toString(8):e.value;break;case STRING:i+=nodeStr(e);break;case GROUP:i+="("+pp(e.children[0],t)+")";break;default:throw"PANIC: unknown operation "+tokens[e.type]+" "+e.toSource()}return e.parenthesized&&(i+=")"),i}const parser=Narcissus.parser,definitions=Narcissus.definitions,tokens=definitions.tokens;return eval(definitions.consts),{pp:pp}}(),function(e){e.version="0.10.8"}("undefined"!=typeof exports?exports:Streamline.version=Streamline.version||{}),function(){var e;if("undefined"!=typeof exports){var t=srequire;try{e=t("source-map")}catch(n){}}e||(e={SourceNode:function(e,t,n,r){this.children=r?[r]:[]}},e.SourceNode.prototype.add=function(e){return Array.isArray(e)?this.children=this.children.concat(e):this.children.push(e),this},e.SourceNode.prototype.prepend=function(e){return Array.isArray(e)?this.children=e.concat(this.children.concat):this.children.unshift(e),this},e.SourceNode.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},e.SourceNode.prototype.walk=function(t){return this.children.forEach(function(n){n instanceof e.SourceNode?n.walk(t):t(n)}),this}),function(t){function n(){e.SourceNode.apply(this,arguments)}n.prototype=Object.create(e.SourceNode.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0},length:{get:function(){var e=0;return this.walk(function(t){e+=t.length}),e}}}),n.prototype.stripPrefix=function(e){for(var t;this.children.length>0&&e>0&&(t=this.children[0].length)<=e;)this.children.shift(),e-=t;return 0==this.children.length||0==e?this:("string"==typeof this.children[0]?this.children[0]=this.children[0].substring(e):this.children[0].stripPrefix(e),this)},n.prototype.stripSuffix=function(e){for(var t,n;(n=this.children.length)>0&&e>0&&(t=this.children[n-1].length)<=e;)this.children.pop(),e-=t;return 0==n||0==e?this:("string"==typeof this.children[n-1]?this.children[n-1]=this.children[0].slice(0,-e):this.children[n-1].stripSuffix(e),this)},n.prototype.map=function(t){return this.children=this.children.map(function(n){return n instanceof e.SourceNode?n.map(t):t(n)}),this},n.prototype.lastChar=function(){for(var e=this.children.length;e--;){var t;if(t="string"==typeof this.children[e]?this.children[e].slice(-1):this.children[e].lastChar())return t}return""},t.exports=Object.create(e,{SourceNode:{value:n}})}("undefined"!=typeof exports?module:Streamline.sourceMap=Streamline.sourceMap||{})}(),"undefined"!=typeof exports)var Narcissus=srequire("streamline/deps/narcissus");var sourceMap=srequire("streamline/lib/util/source-map");if(function(exports){function _pp(e){function t(e){return o+=1,e}function n(e,t){var n=new Array(e+1).join(" ");return t.map(function(e){return e.replace(/\n/g,"\n"+n)}),t.prepend(new sourceMap.SourceNode(null,null,null,n)),t}function r(e){return e&&e.type===BLOCK}function i(e,t){var n,r,i=e.tokenizer&&e.tokenizer.filename;i=i||void 0;var a=e.start,s=e.end,o=e.tokenizer&&e.tokenizer.source;if(!(i&&a&&s&&o))return new sourceMap.SourceNode((void 0),(void 0),(void 0),t);if(i&&!l){l=[],l[-1]=0;for(var n=1,c=o.indexOf("\n");c>=0;c=o.indexOf("\n",c+1))l[c]=n,n++}for(;a<s&&" \n\t;{}".indexOf(o[a])>=0;)a++;if(a<s){var u=(o.substring(a,s),o.lastIndexOf("\n",a));n=l[u]+1,r=a-(u+1)}else i=void 0;return new sourceMap.SourceNode(n,r,i,t)}function a(e){return i(e,'"'+e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"')}function s(e,u,l){var p=!1;if(!e)return"";if(!(e instanceof Object))return""+e;u||(p=!0,u=1),c[o]||(c[o]=[]),c[o].push(e);var f=i(e);switch(e.parenthesized&&f.add("("),e.type){case FUNCTION:case GETTER:case SETTER:e.type===FUNCTION?f.add("function"):e.type===GETTER?f.add("get"):f.add("set"),e.name&&f.add([" ",i(e,e.name)]),f.add("(");for(var d=0,_=e.params.length;d<_;d++)f.add([d>0?", ":"",s(e.params[d],u)]);f.add([") ",s(e.body,u)]);break;case SCRIPT:case BLOCK:var h=e.children;if(p){for(var d=0,_=h.length;d<_;d++)d>0&&f.add(t("\n")),f.add(s(h[d],u)),";"!=f.lastChar()&&f.add(";");break}f.add("{"),void 0!==e.id&&f.add(" /* "+e.id+" */"),f.add(t("\n"));for(var d=0,_=h.length;d<_;d++)d>0&&f.add(t("\n")),f.add(n(2,s(h[d],u))),";"!=f.lastChar()&&f.add(";");f.add(t("\n}"));break;case LET_BLOCK:f.add(["let (",s(e.variables,u,!0),") "]),e.expression?f.add(s(e.expression,u)):f.add(s(e.block,u));break;case IF:f.add(["if (",s(e.condition,u),") "]);var m=e.thenPart,E=e.elsePart,y=r(m)||r(E);y||f.add(t("{\n")),f.add(y?s(m,u):n(2,s(m,u))),E&&";}".indexOf(f.lastChar())<0&&f.add(";"),f.add(t("\n")),E&&(y?f.add(" else "):f.add(t("} else {\n")),f.add([y?s(E,u):n(2,s(E,u)),t("\n")])),y||f.add("}");break;case SWITCH:f.add(["switch (",s(e.discriminant,u),t(") {\n")]);for(var d=0,_=e.cases.length;d<_;d++){var b=e.cases[d];b.type===CASE?f.add(["case ",s(b.caseLabel,u),t(":\n")]):f.add(t("  default:\n")),f.add([s(b.statements,u).stripPrefix(2).stripSuffix(2),t("\n")]),o-=2}f.add("}");break;case FOR:f.add(["for (",s(e.setup,u),"; ",s(e.condition,u),"; ",s(e.update,u),") "]);var v=s(e.body,u);r(e.body)?e.body&&f.add(v):f.add([t("{\n"),n(2,v),t(";\n}")]);break;case WHILE:f.add(["while (",s(e.condition,u),") "]);var v=s(e.body,u);r(e.body)?f.add(v):f.add([t("{\n"),n(2,v),t(";\n}")]);break;case FOR_IN:var T=e.varDecl;f.add([e.isEach?"for each (":"for (",T?s(T,u):s(e.iterator,u)," in ",s(e.object,u),") "]);var v=s(e.body,u);r(e.body)?e.body&&f.add(v):f.add([t("{\n"),n(2,v),t(";\n}")]);break;case DO:f.add(["do ",s(e.body,u)," while (",s(e.condition,u),");"]);break;case BREAK:f.add(["break",e.label?" "+e.label:"",";"]);break;case CONTINUE:f.add(["continue",e.label?" "+e.label:"",";"]);break;case TRY:f.add(["try ",s(e.tryBlock,u)]);for(var d=0,_=e.catchClauses.length;d<_;d++){var I=e.catchClauses[d];f.add([" catch (",s(I.varName,u),I.guard?" if "+s(I.guard,u):"",") ",s(I.block,u)])}e.finallyBlock&&f.add([" finally ",s(e.finallyBlock,u)]);break;case THROW:f.add(["throw ",s(e.exception,u)]);break;case RETURN:f.add("return"),e.value&&f.add([" ",s(e.value,u)]);break;case YIELD:f.add("yield"),e.value.type&&f.add([" ",s(e.value,u)]);break;case GENERATOR:f.add([s(e.expression,u)," ",s(e.tail,u)]);break;case WITH:f.add(["with (",s(e.object,u),") ",s(e.body,u)]);break;case LET:case VAR:case CONST:var h=e.children;l||f.add([tokens[e.type]," "]);for(var d=0,_=h.length;d<_;d++){d>0&&f.add(", ");var T=h[d];f.add(s(T.name,u)),T.initializer&&f.add([" = ",s(T.initializer,u)])}break;case DEBUGGER:f.add(t("debugger\n"));break;case SEMICOLON:e.expression&&f.add([s(e.expression,u),";"]);break;case LABEL:f.add([e.label,t(":\n"),s(e.statement,u)]);break;case COMMA:case LIST:for(var h=e.children,d=0,_=h.length;d<_;d++)d>0&&f.add(", "),f.add(s(h[d],u));break;case ASSIGN:var h=e.children,I=e.assignOp;f.add([s(h[0],u)," ",I?tokens[I]:"","="," ",s(h[1],u)]);break;case HOOK:var h=e.children;f.add(["(",s(h[0],u)," ? ",s(h[1],u)," : ",s(h[2],u),")"]);break;case OR:case AND:var h=e.children;f.add(["(",s(h[0],u)," ",tokens[e.type]," ",s(h[1],u),")"]);break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var h=e.children;f.add(["(",s(h[0],u)," ",tokens[e.type]," ",s(h[1],u),")"]);break;case DELETE:case VOID:case TYPEOF:f.add([tokens[e.type]," ",s(e.children[0],u)]);break;case NOT:case BITWISE_NOT:f.add([tokens[e.type],s(e.children[0],u)]);break;case UNARY_PLUS:f.add(["+",s(e.children[0],u)]);break;case UNARY_MINUS:f.add(["-",s(e.children[0],u)]);break;case INCREMENT:case DECREMENT:e.postfix?f.add([s(e.children[0],u),tokens[e.type]]):f.add([tokens[e.type],s(e.children[0],u)]);break;case DOT:var h=e.children;f.add([s(h[0],u),".",s(h[1],u)]);break;case INDEX:var h=e.children;f.add([s(h[0],u),"[",s(h[1],u),"]"]);break;case CALL:var h=e.children;f.add([s(h[0],u),"(",s(h[1],u),")"]);break;case NEW:case NEW_WITH_ARGS:var h=e.children;f.add("new "),f.add(s(h[0],u)),h[1]&&f.add(["(",s(h[1],u),")"]);break;case ARRAY_INIT:f.add("[");for(var h=e.children,d=0,_=h.length;d<_;d++)h[d]&&f.add(s(h[d],u)),f.add(",");f.add("]");break;case ARRAY_COMP:f.add(["[",s(e.expression,u)," ",s(e.tail,u),"]"]);break;case COMP_TAIL:for(var h=e.children,d=0,_=h.length;d<_;d++)d>0&&f.add(" "),f.add(s(h[d],u));e.guard&&f.add([" if (",s(e.guard,u),")"]);break;case OBJECT_INIT:var h=e.children;h[0]&&h[0].type===PROPERTY_INIT?f.add(t("{\n")):f.add("{");for(var d=0,_=h.length;d<_;d++){d>0&&f.add(t(",\n"));var I=h[d];if(I.type===PROPERTY_INIT){var N,g=I.children;"string"!=typeof g[0].value||/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(g[0].value)?(N=s(g[0],u),f.add(n(2,N))):(N=a(g[0]),f.add(N)),f.add([": ",n(2,s(g[1],u)).stripPrefix(2)])}else f.add(n(2,s(I,u)))}f.add(t("\n}"));break;case NULL:f.add("null");break;case THIS:f.add("this");break;case TRUE:f.add("true");break;case FALSE:f.add("false");break;case IDENTIFIER:case NUMBER:case REGEXP:e.value.isOctal?f.add("0"+e.value.toString(8)):f.add(""+e.value);break;case STRING:f.add(a(e));break;case GROUP:f.add(["(",s(e.children[0],u),")"]);break;default:throw"PANIC: unknown operation "+tokens[e.type]+" "+e.toSource()}return e.parenthesized&&f.add(")"),f}var o=0,c={},u=s(e);return{source:u,lineMap:c};var l}eval(Narcissus.definitions.consts);var tokens=Narcissus.definitions.tokens;exports.format=function(e,t){var n="",r=_pp(e);if("sourcemap"==t)return r.source;if(r.source=r.source.toString(),"ignore"==t)return r.source;var i=r.lineMap,a=r.source.split("\n");if("preserve"==t){for(var s=1,o=!0,c=0;c<a.length;c++){var u=(i[c]||[]).filter(function(e){return e._isSourceNode});if(u.length>0)for(var l=u[0].lineno;s<l;)n+="\n",s+=1,o=!0;n+=o?a[c]:a[c].replace(/^\s+/," "),o=!1}n+="\n"}else{if("mark"!=t)throw new Error("bad --lines option: "+t);for(var c=0;c<a.length;c++){var p=a[c],u=(i[c]||[]).filter(function(e){return e._isSourceNode}),f="            ";if(u.length>0){var l=""+u[0].lineno;f="/* ";for(var d=l.length;d<5;d++)f+=" ";f+=l+" */ "}n+=f+p+"\n"}}return n}}("undefined"!=typeof exports?exports:window.Streamline=window.Streamline||{}),"undefined"!=typeof exports)var Narcissus=srequire("../../deps/narcissus"),format=srequire("./format").format;else var format=Streamline.format;!function(exports){function _assert(e){if(!e)throw new Error("Assertion failed!")}function _tag(e){if(!e||!e.type)return"*NOT_A_NODE*";var t=definitions.tokens[e.type];return/^\W/.test(t)?definitions.opTypeNames[t]:t.toUpperCase()}function originalLine(e,t,n){if(!e.prevMap)return t;null==n&&(n=1e3);var r=e.prevMap.originalPositionFor({line:t,column:n}).line;return null==r?t:r}function originalCol(e,t,n){return e.prevMap?e.prevMap.originalPositionFor({line:t,column:n}).column||0:n}function _node(e,t,n){return{_scope:e&&e._scope,_async:e&&e._async,type:t,children:n}}function _identifier(e,t){return{_scope:t&&t._scope,type:IDENTIFIER,name:e,value:e,initializer:t}}function _number(e){return{type:NUMBER,value:e}}function _string(e){return{type:STRING,value:e}}function _return(e){return{type:RETURN,_scope:e._scope,value:e}}function _semicolon(e){var t=_node(e,SEMICOLON);return t.expression=e,t}function _safeName(e,t){if("__"===t.substring(0,2))for(;e[t];)t+="A";return t}function _flatten(e){if(e.type==BLOCK||e.type==SCRIPT)do{var t=!1,n=[];e.children.forEach(function(r){r._isFunctionReference||r.type==SEMICOLON&&(null==r.expression||r.expression._isFunction)||(e._async|=r._async,r.type==BLOCK||r.type==SCRIPT?(n=n.concat(r.children),t=!0):n.push(r))}),e.children=n}while(t);return e}function _propagate(e,t,n,r){var i=r?r:e;for(var a in e)if(e.hasOwnProperty(a)&&a.indexOf("Decls")<0&&(n||"target"!=a)&&"_"!=a[0]){var s=e[a];if(null!=s)if(Array.isArray(s)){r&&(i[a]=s=[].concat(s));for(var o=!1,c=0;c<s.length;c++)(n||s[c]&&s[c].type)&&(s[c]=t(s[c],e),o|="undefined"==typeof s[c]);o&&(i[a]=s.filter(function(e){return"undefined"!=typeof e}))}else(n||s&&s.type)&&(i[a]=t(s,e))}return i}function _clone(e){function t(e){if(!e||!e.type)return e;var i=e._cloneId;i||(i=e._cloneId=++n);var a=r[i];return a?a:(r[i]=a={_cloneId:i},_propagate(e,t,!0,a))}var n=0,r={};return _propagate(e,t,!0,{})}function Template(e,t,n,r){var i=parse("function _t(){"+t+"}").children[0].body;i=1==i.children.length?i.children[0]:_node(i.children[0],BLOCK,i.children),this.generate=function(t,a){function s(t){if(t.type!=SCRIPT&&t.type!=BLOCK&&(t._pass=e),t.type==FUNCTION&&r&&(_assert(null==u),u=t),!t||!t.type)return"_"==t?c.options.callback:"string"==typeof t?"$"===t[0]?a[t]:_safeName(c.options.precious,t):t;t._scope=c;var n=t.type==SEMICOLON?t.expression:t;if(n&&n.type==IDENTIFIER&&"$"===n.value[0]){var i=a[n.value];return n.initializer&&(i.initializer=s(n.initializer),i.initializer._async&&(i._async=!0)),i}return t=_propagate(t,function(e){return e=s(e),e&&(e._async||e===c.options.callback&&r)&&t.type!==FUNCTION&&(t._async=!0),e},!0),t=_flatten(t)}function o(e,t){return e.type==FUNCTION?e:(e._scope=c,_propagate(e,o))}var c=t._scope;_assert(null!=c),a=a||{};var u=null,l=s(_clone(i));if(u){u.parenthesized=!0;var c=new Scope(u.body,u._scope.options);c.name=u._scope.name,c.line=u._scope.line,c.last=u._scope.last,_assert(u.params[0]===u._scope.options.callback),c.cbIndex=0,_propagate(u,o)}return n?l.value:l},this.root=n?i.value:i}function Scope(e,t){this.script=e,this.line=0,this.last=0,this.vars=[],this.functions=[],this.options=t,this.cbIndex=-1,this.isAsync=function(){return this.cbIndex>=0}}function _genId(e){return _safeName(e._scope.options.precious,"__"+ ++e._scope.last)}function _removeFast(e,t){function n(e){return e.type===IDENTIFIER&&e.value===t.callback}function r(e){return e.type===CALL&&n(e.children[0])&&2===e.children[1].children.length}return e.type===BITWISE_NOT&&n(e.children[0])?(t.needsTransform=!0,e.children[0]):e.type===ARRAY_INIT&&1===e.children.length&&n(e.children[0])?(t.needsTransform=!0,e.children[0]._returnArray=!0,e.children[0]):e.type===RSH&&n(e.children[0])?(t.needsTransform=!0,e.children[1]):e.type===LSH&&n(e.children[0])?(t.needsTransform=!0,e.children[1]):e.type===NOT&&n(e.children[0])?(t.needsTransform=!0,e.type=FALSE,e.children=[],e):r(e)?(e._isStar=!0,t.needsTransform=!0,e.children[0].value=_safeName(t.precious,"__rt")+".streamlinify",e):e}function _markSource(e,t){function n(e){"string"==typeof e.value&&(t.precious[e.value]=!0),e.params&&e.params.forEach(function(e){t.precious[e]=!0}),e._isSourceNode=!0,_propagate(e,function(e){return e=_removeFast(e,t),n(e),e})}n(e)}function _isScriptAsync(e,t){function n(e,i){switch(e.type){case FUNCTION:return e;case IDENTIFIER:return e.value==t.callback?r=!0:_propagate(e,n),e;case CALL:var a,s=e.children[0],o=e.children[1];if(s.type===DOT&&"call"===(a=s.children[1]).value&&(s=s.children[0]).type===FUNCTION&&0===s.params.length&&!s.name&&1===o.children.length&&o.children[0].type===THIS)return _propagate(s.body,n),e;default:return r||_propagate(e,n),e}}var r=!1;return _propagate(e,n),r&&t.verbose&&console.log("WARNING: async calls found at top level in "+e.filename),r}function _canonTopLevelScript(e,t){return e._scope=new Scope(e,t),_isScriptAsync(e,t)?_rootTemplate.generate(e,{$script:e}):e}function _guessName(e,t){function n(e){return e=e.replace(/[^A-Z0-9_$]/gi,"_o_"),e&&!/^\d/.test(e)?e:"_o_"+e}var r,i,a=_genId(e);if(t.type===IDENTIFIER)return n(t.value)+a;if(t.type===ASSIGN){r=t.children[0];for(var s="";r.type===DOT&&(i=r.children[1]).type===IDENTIFIER||r.type===INDEX&&(i=r.children[1]).type===STRING;)s=s?i.value+"_"+s:i.value,r=r.children[0];if(r.type===IDENTIFIER&&(s=s?r.value+"_"+s:r.value),s)return n(s)+a}else if(t.type==PROPERTY_INIT&&(r=t.children[0],r.type===IDENTIFIER||r.type===STRING))return n(r.value)+a;return a}function _canonScopes(e,t){function n(e,r){var i=r._scope;e._scope=i;var a=i.isAsync();if(!a&&e.type!==FUNCTION){if(e.type===IDENTIFIER&&e.value===t.callback&&!r._isStar)throw new Error(e.filename+": Function contains async calls but does not have _ parameter: "+e.name+" at line "+e.lineno);return _propagate(e,n)}switch(e.type===TRY&&(e._async=!0),e.type){case FUNCTION:var s=e,o=e.params.reduce(function(e,n,r){if(n!=t.callback)return e;if(e<0)return r;throw new Error("duplicate _ parameter")},-1);if(o>=0){if(_isFatArrow(e))return e;t.needsTransform=!0,e.name||(e.name=_guessName(e,r))}!a||r.type!==SCRIPT&&r.type!==BLOCK||(i.functions.push(e),s=void 0);var c=new Scope(e.body,t);return e.body._scope=c,c.name=e.name,c.cbIndex=o,c.line=e.lineno,e.body=_propagate(e.body,n),o>=0&&c.functions.push(_string("BEGIN_BODY")),e.body.children=c.functions.concat(e.body.children),c.hasThis&&!e._inhibitThis&&c.vars.push(_identifier(_safeName(t.precious,"__this"),_node(e,THIS))),c.hasArguments&&!e._inhibitArguments&&c.vars.push(_identifier(_safeName(t.precious,"__arguments"),_identifier("arguments"))),c.vars.length>0&&e.body.children.splice(0,0,_node(e,VAR,c.vars)),s;case VAR:var u=e.children.map(function(e){return i.vars.some(function(t){return t.value==e.value})||i.vars.push(_identifier(e.value)),e.initializer?(e=_assignTemplate.generate(r,{$lhs:_identifier(e.value),$rhs:e.initializer}),r.type===FOR&&(e=e.expression),e):null}).filter(function(e){return null!=e});if(0==u.length)return;var l=r.type==BLOCK||r.type===SCRIPT?BLOCK:COMMA,s=_node(r,l,u);return s=_propagate(s,n),r._async|=s._async,s;case THIS:return i.hasThis=!0,_identifier(_safeName(t.precious,"__this"));case IDENTIFIER:if("arguments"===e.value)return i.hasArguments=!0,_identifier(_safeName(t.precious,"__arguments"));if(e=_propagate(e,n),e._async|=e.value===t.callback,e._async&&!r.isArgsList&&(r.type!==PROPERTY_INIT||e!==r.children[0])&&(r.type!==DOT||e!==r.children[1]))throw new Error("invalid usage of '_'");return r._async|=e._async,e;case NEW_WITH_ARGS:var o=e.children[1].children.reduce(function(e,n,r){if(n.type!==IDENTIFIER||n.value!==t.callback)return e;if(e<0)return r;throw new Error("duplicate _ argument")},-1);if(o>=0){var p=_node(e,CALL,[_identifier(_safeName(t.precious,"__construct")),_node(e,LIST,[e.children[0],_number(o)])]);e=_node(e,CALL,[p,e.children[1]])}return e.children[1].isArgsList=!0,e=_propagate(e,n),r._async|=e._async,e;case CALL:e.children[1].isArgsList=!0,_convertCoffeeScriptCalls(e,t),_convertApply(e,t),e.children[1].isArgsList=!0;default:return e=_propagate(e,n),_setBreaks(e),r._async|=e._async,e}}return _propagate(e,n)}function _convertCoffeeScriptCalls(e,t){var n=e.children[0],r=e.children[1];if(n.type!==FUNCTION||0!==n.params.length||n.name||0!=r.children.length){if(n.type===DOT){var i=n.children[1];n=n.children[0],n.type!==FUNCTION||0!==n.params.length||n.name||i.type!==IDENTIFIER||("call"===i.value&&1===r.children.length&&r.children[0].type===THIS?(e.children[0]=n,n._noFuture=!0,n.name="___closure",n.params=[t.callback],r.children=[_identifier(t.callback)],e._scope.hasThis=!0,n._inhibitThis=!0):"apply"===i.value&&2===r.children.length&&r.children[0].type===THIS&&r.children[1].type===IDENTIFIER&&"arguments"===r.children[1].value&&(e.children[0]=n,n._noFuture=!0,n.name="___closure",n.params=[t.callback],r.children=[_identifier(t.callback)],e._scope.hasThis=!0,e._scope.hasArguments=!0,n._inhibitThis=!0,n._inhibitArguments=!0))}}else n._noFuture=!0,n.name="___closure",n.params=[t.callback],r.children=[_identifier(t.callback)]}function _isFatArrow(e){if(1!==e.body.children.length)return!1;var t=e.body.children[0];if(t.type!==RETURN||!t.value)return!1;if(t=t.value,t.type!==CALL)return!1;var n=t.children[1].children,r=t.children[0];return 2===n.length&&"_this"===n[0].value&&"arguments"===n[1].value&&(r.type===DOT&&"apply"===r.children[1].value&&(r=r.children[0],r.type===DOT&&r.children[1].type===IDENTIFIER&&(r=r.children[0],r.type===DOT&&"prototype"===r.children[1].value&&(r=r.children[0],r.type===IDENTIFIER&&(e.params=[],!0)))))}function _convertApply(e,t){var n=e.children[0],r=e.children[1];if(n.type===DOT){var i=n.children[1];if(i.type===IDENTIFIER&&"apply"===i.value&&2===r.children.length&&r.children[0].type===THIS&&r.children[1].type===IDENTIFIER&&"arguments"===r.children[1].value){var a=n.children[0];e.children[0]=_identifier("__apply"),r.children=[_identifier(t.callback),a,_identifier("__this"),_identifier("__arguments"),_number(e._scope.cbIndex)],e._scope.hasThis=!0,e._scope.hasArguments=!0}}}function _setBreaks(e){switch(e.type){case IF:e._breaks=e.thenPart._breaks&&e.elsePart&&e.elsePart._breaks;break;case SWITCH:for(var t=0;t<e.cases.length;t++){var n=e.cases[t].statements;if(e._async&&n.children.length>0&&!n._breaks)if(t==e.cases.length-2&&e.cases[t+1].type===DEFAULT&&1===e.cases[t+1].statements.children.length&&e.cases[t+1].statements.children[0].type===SEMICOLON&&null==e.cases[t+1].statements.children[0].expression)n.children.push(_node(e,BREAK)),n._breaks=!0;else if(t===e.cases.length-1)n.children.push(_node(e,BREAK)),n._breaks=!0;else{var r=_identifier(_genId(e));e.cases[t].statements=_switchVarTemplate.generate(e.cases[t],{$v:r});var i=_switchIfTemplate.generate(e.cases[t],{$v:r,$block:n});e.cases[t+1].statements.children.splice(0,0,i)}}break;case TRY:e._breaks=e.tryBlock._breaks&&e.catchClauses[0]&&e.catchClauses[0].block._breaks;break;case BLOCK:case SCRIPT:e.children.forEach(function(t){e._breaks|=t._breaks});break;case RETURN:case THROW:case BREAK:e._breaks=!0}}function _statementify(e){function t(e){e.type===COMMA?e.children.forEach(t):n.children.push(e.type==SEMICOLON?e:_semicolon(e))}if(!e)return e;var n=_node(e,BLOCK,[]);return t(e),n}function _blockify(e){if(!e||e.type==BLOCK)return e;if(e.type==COMMA)return _statementify(e);var t=_node(e,BLOCK,[e]);return t._async=e._async,t}function _canonFlows(e,t){function n(e,t,r){function i(e){e.condition&&e.condition._async&&e.condition.type!==CALL&&(e.condition=_flowsTemplates.CONDITION.generate(e,{$name:"__$"+e._scope.name,$condition:n(e.condition,e,!0)})),e.update&&e.update._async&&(e.update=_flowsTemplates.UPDATE.generate(e,{$name:"__$"+e._scope.name,$update:_statementify(e.update)}))}var a=e._scope;if(e.type==FOR&&"flows"===e._pass&&i(e),!a||!a.isAsync()||!r&&"flows"===e._pass)return _propagate(e,n);switch(e.type){case IF:e.thenPart=_blockify(e.thenPart),e.elsePart=_blockify(e.elsePart);break;case SWITCH:if(e._async){var s=e.cases.filter(function(e){return e.type==DEFAULT})[0];s||(s=_node(e,DEFAULT),s.statements=_node(e,BLOCK,[]),e.cases.push(s)),s._breaks||s.statements.children.push(_node(e,BREAK))}break;case WHILE:e.body=_blockify(e.body),e._async&&(e=_flowsTemplates.WHILE.generate(e,{$condition:e.condition,$body:e.body}));break;case DO:e.body=_blockify(e.body),e._async&&(e=_flowsTemplates.DO.generate(e,{$firstTime:_identifier(_genId(e)),$condition:e.condition,$body:e.body}));break;case FOR:e.condition=e.condition||_number(1),e.body=_blockify(e.body),e._async&&(e.setup?e=_flowsTemplates.FOR.generate(e,{$setup:_statementify(e.setup),$condition:e.condition,$update:e.update,$body:e.body}):"flows"!==e._pass&&(e._pass="flows",i(e)));break;case FOR_IN:if(e.body=_blockify(e.body),e._async){if(e.iterator.type!=IDENTIFIER)throw new Error("unsupported 'for ... in' syntax: type="+_tag(e.iterator));e=_flowsTemplates.FOR_IN.generate(e,{$array:_identifier(_genId(e)),$i:_identifier(_genId(e)),$object:e.object,$iter:e.iterator,$body:e.body})}break;case TRY:e.tryBlock&&e.catchClauses[0]&&e.finallyBlock&&(e=_flowsTemplates.TRY.generate(e,{$try:e.tryBlock,$catch:e.catchClauses[0].block,$ex:e.catchClauses[0].varName,$finally:e.finallyBlock}));break;case AND:case OR:e._async&&(e=_flowsTemplates[_tag(e)].generate(e,{$name:"__$"+e._scope.name,$v:_identifier(_genId(e)),$op1:e.children[0],$op2:e.children[1]}));break;case HOOK:e._async&&(e=_flowsTemplates.HOOK.generate(e,{$name:"__$"+e._scope.name,$v:_identifier(_genId(e)),$condition:e.children[0],$true:e.children[1],$false:e.children[2]}));break;case COMMA:e._async&&(e=_flowsTemplates.COMMA.generate(e,{$name:"__$"+e._scope.name,$body:_node(e,BLOCK,e.children.slice(0,e.children.length-1).map(_semicolon)),$result:e.children[e.children.length-1]}))}return _propagate(e,n)}return _propagate(e,n)}function _split(e,t){var n=e[t];if(!n||!n._async)return e;var r=_genId(e),i=_identifier(r,n);return e[t]=_identifier(r),_node(e,BLOCK,[_node(e,VAR,[i]),e])}function _disassemble(e,t){function n(e,i,a){if(!e._async)return _propagate(e,r);if(e=_propagate(e,n),e.type===CALL){if(e.children[0].type===IDENTIFIER&&0==e.children[0].value.indexOf("__wrap"))return e._isWrapper=!0,e;var s=e.children[1];if(s.children.some(function(e){return e.type===IDENTIFIER&&e.value===t.callback||e._isWrapper})){if(a)return void e._scope.disassembly.push(_statementify(e));if(i.type==IDENTIFIER&&0===i.value.indexOf("__"))return e._skipDisassembly=!0,e;var o=_genId(e),c=_identifier(o,e);return e=_node(e,VAR,[c]),e._scope.disassembly.push(e),_identifier(o)}}return e}function r(e,t){var i=e._scope;if(!i||!i.isAsync()||!e._async)return _propagate(e,r);switch(e.type){case IF:e=_split(e,"condition");break;case SWITCH:e=_split(e,"discriminant");break;case FOR:break;case RETURN:e=_split(e,"value");break;case THROW:e=_split(e,"exception");break;case VAR:_assert(1===e.children.length);var a=e.children[0];return i.disassembly=[],a.initializer=n(a.initializer,a),e._async=a.initializer._skipDisassembly,i.disassembly.push(e),_node(t,BLOCK,i.disassembly);case SEMICOLON:return i.disassembly=[],e.expression=n(e.expression,e,!0),e.expression&&(e._async=!1,i.disassembly.push(e)),_node(t,BLOCK,i.disassembly)}return _propagate(e,r)}return _propagate(e,r)}function _callbackify(e,t){function n(e,r){if(e=_flatten(e),!e._scope||!e._scope.isAsync()||"cb"===e._pass)return _propagate(e,n);switch(e.type){case SCRIPT:if("cb"!==r._pass){for(var a,s=0;s<e.children.length;s++){var o=e.children[s];if(o.type===STRING&&"BEGIN_BODY"===o.value){a=e.children.splice(0,s),e.children.splice(0,1);break}}var c=r._noFuture||"flows"===r._pass?_cbTemplates.FUNCTION_INTERNAL:_cbTemplates.FUNCTION;e=c.generate(e,{$fn:r.name,$name:"__$"+e._scope.name,$fname:_string(r.name),$line:_number(originalLine(t,e._scope.line)),$index:_number(e._scope.cbIndex),$decls:_node(e,BLOCK,a||[]),$body:e})}e.type=SCRIPT;case BLOCK:for(var u=0;u<e.children.length;u++)e.children[u]=i(e,u);return e}return _propagate(e,n)}function r(e,t){return _node(e,BLOCK,e.children.splice(t+1,e.children.length-t-1))}function i(e,i){function s(e,r,i){function a(e){return e.children.reduce(function(e,n,r){return n.type==IDENTIFIER&&n.value===t.callback||n._isWrapper?r:e},-1)}var s=e.children[1],o=a(s);_assert(o>=0);var c=s.children[o]._returnArray;s.children[o]._isWrapper&&(s=s.children[o].children[1],o=a(s));for(var u=e.children[0];u.type==DOT;)u=u.children[1];var l=t.source.lastIndexOf("\n",u.start)+1,p=u.start-l;s.children[o]=(i?0===i.indexOf("__")?_cbTemplates.CALL_TMP:_cbTemplates.CALL_RESULT:_cbTemplates.CALL_VOID).generate(e,{
$v:_genId(e),$frameName:_string(e._scope.name),$offset:_number(originalLine(t,u.lineno,p)-originalLine(t,e._scope.line)),$col:_number(originalCol(t,u.lineno,p)),$name:"__$"+e._scope.name,$returnArray:c,$result:i,$tail:r}),e=_propagate(e,n);var f=_node(e,RETURN,[]);return f.value=e,f._pass="cb",f}var o=e.children[i];if("cb"===o._pass)return _propagate(o,n);switch(o.type){case RETURN:r(e,i);var c=o.value?_cbTemplates.RETURN:_cbTemplates.RETURN_UNDEFINED;o=c.generate(o,{$value:o.value});break;case THROW:r(e,i),o=_cbTemplates.THROW.generate(o,{$exception:o.exception});break;case BREAK:if(o.target&&!o.target._async)break;r(e,i),o=o.label?_cbTemplates.LABELLED_BREAK.generate(o,{$break:_safeName(t.precious,"__break__"+o.label)}):_cbTemplates.BREAK.generate(o,{});break;case CONTINUE:if(o.target&&!o.target._async)break;r(e,i),o=o.label?_cbTemplates.LABELLED_CONTINUE.generate(o,{$loop:_safeName(t.precious,"__loop__"+o.label),$more:_safeName(t.precious,"__more__"+o.label)}):_cbTemplates.CONTINUE.generate(o,{});break;case TRY:var u=r(e,i);o=o.catchClauses[0]?_cbTemplates.CATCH.generate(o,{$name:"__$"+o._scope.name,$try:o.tryBlock,$catch:o.catchClauses[0].block,$ex:o.catchClauses[0].varName,$tail:u}):_cbTemplates.FINALLY.generate(o,{$name:"__$"+o._scope.name,$try:o.tryBlock,$finally:o.finallyBlock,$tail:u});break;default:if(o._async){var u=r(e,i);switch(o.type){case IF:o=_cbTemplates.IF.generate(o,{$name:"__$"+o._scope.name,$condition:o.condition,$then:o.thenPart,$else:o.elsePart||_node(o,BLOCK,[]),$tail:u});break;case SWITCH:o._pass="cb",o=_cbTemplates.SWITCH.generate(o,{$name:"__$"+o._scope.name,$statement:o,$tail:u});break;case LABEL:var l=a;return a=o.label,o=_cbTemplates.LABEL.generate(o,{$name:"__$"+o._scope.name,$statement:o.statement,$tail:u}),o=n(o,e),a=l,o;case FOR:var p=_identifier(_genId(o)),f=_cbTemplates.LOOP1.generate(o,{$v:p,$body:o.body}),d=o.update,_=d&&_identifier(_genId(o)),h=(d?_cbTemplates.LOOP2_UPDATE:_cbTemplates.LOOP2).generate(o,{$v:p,$condition:o.condition,$beenHere:_,$update:_statementify(d),$loop1:f});o=(d?a?_cbTemplates.LABELLED_FOR_UPDATE:_cbTemplates.FOR_UPDATE:a?_cbTemplates.LABELLED_FOR:_cbTemplates.FOR).generate(o,{$name:"__$"+o._scope.name,$loop:_identifier(_safeName(t.precious,"__loop__"+a)),$break:_identifier(_safeName(t.precious,"__break__"+a)),$more:_identifier(_safeName(t.precious,"__more__"+a)),$beenHere:_,$loop2:h,$tail:u});break;case VAR:_assert(1==o.children.length);var m=o.children[0];_assert(m.type===IDENTIFIER);var E=m.initializer;return delete m.initializer,_assert(E&&E.type===CALL),s(E,u,m.value);case SEMICOLON:var E=o.expression;return _assert(E.type===CALL),s(E,u);default:throw new Error("internal error: bad node type: "+_tag(o)+": "+pp(o))}}}return n(o,e)}var a;return _propagate(e,n)}function _checkUsed(e,t){"string"==typeof e&&"__"===e.substring(0,2)&&(t[e]=!0)}function _simplify(e,t,n){function r(e,t,n,i){var a=["parenthesized","lineno","start","end","tokenizer","hasReturnWithValue"];if(0==e.indexOf("_")||a.indexOf(e)>=0)return!0;if(t==n)return!0;if(null==t||null==n)return!("children"!=e||!t||0!==t.length);if(Array.isArray(t)){if(t.length!=n.length)return!1;for(var s=0;s<t.length;s++)if(!r(e,t[s],n[s],i))return!1;return!0}if(t.type===IDENTIFIER&&"$"===t.value[0]&&n.type===NUMBER)return i[t.value]=n.value,!0;if("string"==typeof t&&"$"==t[0]&&"string"==typeof n)return i[t]=n,!0;if(t.type){var o;if(t.type==SCRIPT&&t.children[0]&&(o=t.children[0].expression)&&"string"==typeof o.value&&"$"==o.value[0])return i[o.value]=n,!0;if(t.type!=n.type)return!1;if(t.type==IDENTIFIER&&"$"==t.value)return i[t.value]=n.value,!0;for(var e in t)if(t.hasOwnProperty(e)&&e.indexOf("Decls")<0&&"target"!=e&&!r(e,t[e],n[e],i))return!1;return!0}return!1}if(e._simplified)return e;e._simplified=!0,_propagate(e,function(e){return _simplify(e,t,n)}),_checkUsed(e.value,n);var i={};return r("",_optims.function__0$fn,e,i)?_identifier(i.$fn):!r("",_optims.function$return,e,i)||"___"!==i.$fn1&&0!==i.$fn1.indexOf("__$")||"__break"!==i.$fn2?r("",_optims.function__0$arg1return_null$arg2,e,i)&&i.$arg1==i.$arg2?_identifier("_"):t.optimize&&r("",_optims.__cb__,e,i)?_identifier("_"):t.optimize&&r("",_optims.__cbt__,e,i)?_identifier("_"):!r("",_optims.function$fn,e,i)||"___"!==i.$fn1&&0!==i.$fn1.indexOf("__$")||"__then"!==i.$fn2&&"__loop"!==i.$fn2?(r("",_optims.closure,e,i)&&(e.children[1]=_identifier("_")),!r("",_optims.safeParam,e,i)||"__then"!==i.$param&&"__break"!==i.$param||(e.children[1]=_identifier("_")),_flatten(e),e):_identifier(i.$fn2):_identifier(i.$fn2)}function _extend(e,t){for(var n in t)e[n]=t[n];return e}function _cl(e){return _extend({},e)}function _trim(e){return e.toString().replace(/\s+/g," ")}function include(e,t){var n=t+"['"+e+"']=(mod={exports:{}});";n+="(function(module, exports){";var r=srequire;return n+=r("fs").readFileSync(__dirname+"/../"+e+".js","utf8").replace(/(\/\/[^"\n]*\n|\/\*[\s\S]*?\*\/|\n)[ \t]*/g,""),n+="})(mod, mod.exports);"}function requireRuntime(e){if(!e.standalone)return"srequire('streamline/lib/callbacks/runtime').runtime(__filename, "+!!e.oldStyleFutures+")";var t=_safeName(e.precious,"__modules"),n="(function(){var "+t+"={},mod;";return n+="function srequire(p){var m="+t+"[p.substring(15)]; return m && m.exports};",n+=include("globals",t),n+=include("util/future",t),n+=include("callbacks/runtime",t),["funnel","forEach_","map_","filter_","every_","some_","reduce_","reduceRight_","sort_","apply_"].some(function(t){return e.precious[t]})&&(n+=include("callbacks/builtins",t)),n+="return "+t+"['callbacks/runtime'].exports.runtime('"+e.sourceName+"', "+!!e.oldStyleFutures+");",n+="})()"}exports.version=srequire("streamline/lib/version").version+" (callbacks)";var parse=Narcissus.parser.parse,pp=Narcissus.decompiler.pp,definitions=Narcissus.definitions;eval(definitions.consts.replace(/const /g,"var "));var _rootTemplate=new Template("root","(function main(_){ $script }).call(this, __trap);"),_assignTemplate=new Template("canon","$lhs = $rhs;"),_switchVarTemplate=new Template("canon","{ var $v = true; }"),_switchIfTemplate=new Template("canon","if ($v) { $block; }"),_flowsTemplates={WHILE:new Template("flows","{\tfor (; $condition;) {\t\t$body;\t}}"),DO:new Template("flows","{\tvar $firstTime = true;\tfor (; $firstTime || $condition;) {\t\t$firstTime = false;\t\t$body;\t}}"),FOR:new Template("flows","{\t$setup;\tfor (; $condition; $update) {\t\t$body;\t}}"),FOR_IN:new Template("flows","{\tvar $array = __forIn($object);\tvar $i = 0;\tfor (; $i < $array.length;) {\t\t$iter = $array[$i++];\t\t$body;\t}}"),TRY:new Template("flows","try {\ttry { $try; }\tcatch ($ex) { $catch; }}finally { $finally; }"),AND:new Template("flows","return (function $name(_){\tvar $v = $op1;\tif (!$v) {\t\treturn $v;\t}\treturn $op2;})(_)",(!0),(!0)),OR:new Template("flows","return (function $name(_){\tvar $v = $op1;\tif ($v) {\t\treturn $v;\t}\treturn $op2;})(_)",(!0),(!0)),HOOK:new Template("flows","return (function $name(_){\tvar $v = $condition;\tif ($v) {\t\treturn $true;\t}\treturn $false;})(_);",(!0),(!0)),COMMA:new Template("flows","return (function $name(_){\t$body;\treturn $result;})(_);",(!0),(!0)),CONDITION:new Template("flows","return (function $name(_){\treturn $condition;})(_);",(!0),(!0)),UPDATE:new Template("flows","return (function $name(_){\t$update;})(_);",(!0),(!0))},_cbTemplates={FUNCTION:new Template("cb","{\t$decls;\tvar __frame = { name: $fname, line: $line };\treturn __func(_, this, arguments, $fn, $index, __frame, function $name(){\t\t$body;\t\t_();\t});}"),FUNCTION_INTERNAL:new Template("cb","{ $decls; $body; _(); }"),RETURN:new Template("cb","return _(null, $value);"),RETURN_UNDEFINED:new Template("cb","return _(null);"),THROW:new Template("cb","return _($exception);"),IF:new Template("cb","return (function $name(__then){\tif ($condition) { $then; __then(); }\telse { $else; __then(); }})(function $name(){ $tail; });"),SWITCH:new Template("cb","return (function $name(__break){\t$statement;})(function $name(){ $tail; });"),LABEL:new Template("cb","$statement;$tail;"),BREAK:new Template("cb","return __break();"),LABELLED_BREAK:new Template("cb","return $break();"),CONTINUE:new Template("cb","while (__more) { __loop(); } __more = true;return;"),LABELLED_CONTINUE:new Template("cb","while ($more.get()) { $loop(); } $more.set(true);return;"),LOOP1:new Template("cb","if ($v) {\t$body;\twhile (__more) { __loop(); } __more = true;}else { __break(); }"),LOOP2:new Template("temp","var $v = $condition; $loop1;"),LOOP2_UPDATE:new Template("temp","if ($beenHere) { $update; } else { $beenHere = true; }var $v = $condition; $loop1;"),FOR:new Template("cb","return (function ___(__break){\tvar __more;\tvar __loop = __cb(_, __frame, 0, 0, function $name(){\t\t__more = false;\t\t$loop2\t});\tdo { __loop(); } while (__more); __more = true;})(function $name(){ $tail;});"),LABELLED_FOR:new Template("cb","return (function ___(__break){\tvar __more, $more = { get: function() { return __more; }, set: function(v) { __more = v; }};\tvar __loop = __cb(_, __frame, 0, 0, function $name(){\t\tvar $break = __break, $loop = __loop;\t\t__more = false;\t\t$loop2\t});\tdo { __loop(); } while (__more); __more = true;})(function $name(){ $tail;});"),FOR_UPDATE:new Template("cb","var $beenHere = false;return (function ___(__break){\tvar __more;\tvar __loop = __cb(_, __frame, 0, 0, function $name(){\t\t__more = false;\t\t$loop2\t});\tdo { __loop(); } while (__more); __more = true;})(function $name(){ $tail; });"),LABELLED_FOR_UPDATE:new Template("cb","var $beenHere = false;return (function ___(__break){\tvar __more, $more = { get: function() { return __more; }, set: function(v) { __more = v; }};\tvar __loop = __cb(_, __frame, 0, 0, function $name(){\t\tvar $break = __break, $loop = __loop;\t\t__more = false;\t\t$loop2\t});\tdo { __loop(); } while (__more); __more = true;})(function $name(){ $tail; });"),CATCH:new Template("cb","return (function ___(__then){\t(function ___(_){\t\t__tryCatch(_, function $name(){ $try; __then(); });\t})(function ___($ex, __result){\t\t__catch(function $name(){\t\t\tif ($ex) { $catch; __then(); }\t\t\telse { _(null, __result); }\t\t});\t});})(function ___(){\t__tryCatch(_, function $name(){ $tail; });});"),FINALLY:new Template("cb","return (function ___(__then){\t(function ___(_){\t\t__tryCatch(_, function $name(){ $try; _(null, null, true); });\t})(function ___(__e, __r, __cont){\t\t(function ___(__then){\t\t\t__tryCatch(_, function $name(){ $finally; __then(); });\t\t})(function ___(){\t\t\t__tryCatch(_, function ___(){\t\t\t\tif (__cont) __then(); else _(__e, __r);\t\t\t});\t\t})\t});})(function ___(){\t__tryCatch(_, function $name(){ $tail; });});"),CALL_VOID:new Template("cb","return __cb(_, __frame, $offset, $col, function $name(){ $tail; }, true, $returnArray)",(!0)),CALL_TMP:new Template("cb","return __cb(_, __frame, $offset, $col, function ___(__0, $result){ $tail }, true, $returnArray)",(!0)),CALL_RESULT:new Template("cb","return __cb(_, __frame, $offset, $col, function $name(__0, $v){\tvar $result = $v;\t$tail}, true, $returnArray)",(!0))},_optims={function__0$fn:new Template("simplify","return function ___(__0) { $fn(); }",(!0)).root,function$return:new Template("simplify","return function $fn1() { return $fn2(); }",(!0)).root,function__0$arg1return_null$arg2:new Template("simplify","return function ___(__0, $arg1) { return _(null, $arg2); }",(!0)).root,__cb__:new Template("simplify","return __cb(_, $frameVar, $line, $col, _)",(!0)).root,__cbt__:new Template("simplify","return __cb(_, $frameVar, $line, $col, _, true)",(!0)).root,function$fn:new Template("simplify","return function $fn1() { $fn2(); }",(!0)).root,closure:new Template("simplify","return (function ___closure(_){ $body; })(__cb(_,$frameVar,$line,$col,function $fnName(){_();},true))",(!0)).root,safeParam:new Template("simplify","return (function $fnName($param){ $body; })(function $fnName(){_();})",(!0)).root};exports.transform=function(e,t){try{e=e.replace(/\r\n/g,"\n"),t=t?_extend({},t):{};var n=/streamline\.options\s*=\s*(\{.*\})/.exec(e);n&&_extend(t,JSON.parse(n[1])),t.source=e,t.callback=t.callback||"_",t.lines=t.lines||"preserve",t.precious={};var r=parse(e+"\n",t.sourceName),i=r.children[0]&&r.children[0].expression&&"use strict"==r.children[0].expression.value;if(i&&r.children.splice(0,1),_markSource(r,t),r=_canonTopLevelScript(r,t),r=_canonScopes(r,t),!t.needsTransform)return e;r=_canonFlows(r,t),r=_disassemble(r,t),r=_callbackify(r,t);var a={};r=_simplify(r,t,a);var s=format(r,t.lines);if(!t.noHelpers){var o=exports.helpersSource(t,a,i);"sourcemap"==t.lines?s.prepend(o):s=o+s}return s}catch(c){var u="error streamlining "+(t.sourceName||"source")+": "+c.message;if(c.source&&c.cursor){for(var l=1,p=0;p<c.cursor;p++)"\n"===c.source[p]&&(l+=1);u+=" on line "+l}else c.stack&&(u+="\nSTACK:\n"+c.stack);throw new Error(u)}},exports.transform.version=exports.version,exports.helpersSource=function(e,t,n){var r=""+e.sourceName,i=r.indexOf("node_modules/");i==-1&&"object"==typeof process&&"function"==typeof process.cwd&&(i=process.cwd().length),r=i>=0?r.substring(i+13):r;var a="preserve"==e.lines?" ":"\n";n=n?'"use strict";'+a:"";var s=a+n,o=["__g","__func","__cb","__future","__propagate","__trap","__catch","__tryCatch","__forIn","__apply","__construct","__setEF"],c=_safeName(e.precious,"__rt");return s+="var "+c+"="+requireRuntime(e),o.forEach(function(n){var r=_safeName(e.precious,n);t[r]&&(s+=","+r+"="+c+"."+n)}),s+=";"+a}}("undefined"!=typeof exports?exports:window.Streamline=window.Streamline||{}),function(e){e.future=function(e,t,n){var r,i,a,s=[],o=this;return t=Array.prototype.slice.call(t),t[n]=function(e,t){r=e,i=t,a=!0,s&&s.forEach(function(n){n.call(o,e,t)}),s=null},e.apply(this,t),function c(e){if("function"!=typeof e){if(e!==!1&&!srequire("streamline/lib/globals").oldStyleFutures)throw new Error("no callback given (argument #0). If you're a Streamline user, more info: https://github.com/Sage/streamlinejs/blob/master/FAQ.md#no-callback-given-error");return c}a?e.call(o,r,i):s.push(e)}},e.streamlinify=function(t,n){return function(){return arguments[n]?t.apply(this,arguments):e.future.call(this,t,arguments,n)}}}("undefined"!=typeof exports?exports:Streamline.future=Streamline.future||{}),function(e){function t(e,t,r,i,a,s,o){t.offset=r,t.col=i;var c=l.context;return function p(r,i){o&&(i=Array.prototype.slice.call(arguments,1)),o=!1;var f=l.frame;l.frame=t,l.context=c,0===l.depth&&l.emitter&&l.emitter.emit("resume"),l.depth++;try{if(!(s&&t.active&&l.trampoline))return p.dispatched=!0,r?(u(r,t),e(r)):(t.active=!0,a(null,i));l.trampoline.queue(function(){return p(r,i)})}catch(d){return n(e,d)}finally{t.active=!1,l.frame=f,0===--l.depth&&l.trampoline&&l.trampoline.flush(),0===l.depth&&l.emitter&&l.emitter.emit("yield")}}}function n(e,t){try{e(t)}catch(n){r(n)}}function r(e){e&&(l.context&&l.context.errorHandler?l.context.errorHandler(e):process.nextTick(function(){throw e}))}function i(e,t){try{t()}catch(n){try{e(n)}catch(i){r(i)}}}function a(e){var t=l.frame,n=l.context;l.trampoline.queue(function(){var r=l.frame,i=l.context;l.frame=t,l.context=n;try{e()}finally{l.frame=r,l.context=i}})}function s(e){var t=[];for(var n in e)t.push(n);return t}function o(e,t,n,r,i){return null==e?p.future(o,arguments,0):(r=Array.prototype.slice.call(r,0),r[null!=i?i:r.length]=e,t.apply(n,r))}function c(e,t){var n="__async"+t;return e[n]||(e[n]=function(){function n(){var n=this,i=r[t];return r[t]=function(e,t){i(e,n)},e.apply(n,r)}var r=arguments;return n.prototype=e.prototype,new n})}function u(t,n){function r(e,t){var n="object"==typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1;n&&(t="Error: "+e.message+"\n"+t);var r,i,a=t;if(a){var s=a.split("\n");a=s[0]+"\n    <<< async stack >>>\n"+s.slice(1).map(function(e){var t="object"==typeof navigator&&"function"==typeof srequire&&srequire.async?11:0,n=/([^@]*)\@(.*?)\:(\d+)(?:\:(\d+))?$/.exec(e);e=n?"    at "+n[1]+" ("+n[2]+":"+(parseInt(n[3])-t)+":"+(n[4]||"0")+")":e;var r=e.indexOf("__$");return r>=0&&!i?(i=!0,e.substring(0,r)+e.substring(r+3)):i?"":e}).filter(function(e){return e}).join("\n");for(var r=e.__frame;r;r=r.prev)r.offset>=0&&(a+="\n    at "+r.name+" ("+r.file+":"+(r.line+r.offset)+":"+(r.col+1)+")")}var o=t.indexOf("\n");return a+="\n    <<< raw stack >>>"+(o>=0?t.substring(o):t)}if(t.__frame=t.__frame||n,e.stackTraceEnabled&&t.__lookupGetter__&&null==t.__lookupGetter__("rawStack")){var i=t.__lookupGetter__("stack");if(!i){var a=t.stack||"raw stack unavailable";i=function(){return a}}t.__defineGetter__("rawStack",i),t.__defineGetter__("stack",function(){return r(t,i())})}}var l=srequire("streamline/lib/globals");l.runtime="callbacks";var p=srequire("streamline/lib/util/future");l.context=l.context||{},l.depth=l.depth||0,l.trampoline=function(){var e=[];return{queue:function(t){e.push(t)},flush:function(){l.depth++;try{for(var t;t=e.shift();)t()}finally{l.depth--}}}}(),e.runtime=function(e,f){function d(t,r,i,a,s,o,c){if("function"!=typeof t){if(t!==!1&&!l.oldStyleFutures)throw new Error("no callback given (argument #"+s+"). If you're a Streamline user, more info: https://github.com/Sage/streamlinejs/blob/master/FAQ.md#no-callback-given-error");return p.future.call(r,a,i,s)}o.file=e,o.prev=l.frame,l.frame=o,0===l.depth&&l.emitter&&l.emitter.emit("resume"),l.depth++;try{o.active=!0,c()}catch(u){n(t,u)}finally{o.active=!1,l.frame=o.prev,0===--l.depth&&l.trampoline&&l.trampoline.flush(),0===l.depth&&l.emitter&&l.emitter.emit("yield")}}return l.oldStyleFutures=f,{__g:l,__func:d,__cb:t,__future:p.future,__propagate:n,__trap:r,__tryCatch:i,__catch:a,__forIn:s,__apply:o,__construct:c,__setEF:u,streamlinify:p.streamlinify}},e.stackTraceEnabled=!0}("undefined"!=typeof exports?exports:Streamline.runtime=Streamline.runtime||{}),srequire&&srequire("streamline/lib/callbacks/builtins");var __rt=srequire("streamline/lib/callbacks/runtime").runtime(__filename,!1),__func=__rt.__func,__cb=__rt.__cb;!function(e){"use strict";function t(e){return"number"==typeof e?e:"number"==typeof e.parallel?e.parallel:e.parallel?-1:1}var n=3,r=function(e,t,n){var r,i,a,s=[],o=this;return t=Array.prototype.slice.call(t),t[n]=function(e,t){r=e,i=t,a=!0,s&&s.forEach(function(n){n.call(o,e,t)}),s=null},e.apply(this,t),function c(e){return e?void(a?e.call(o,r,i):s.push(e)):c}};e.funnel=function(e){if(e=null==e?-1:e,0===e&&(e=i.defaultSize),"number"!=typeof e)throw new Error("bad max number: "+e);var t=[],n=0,a=!1,s=function(i,o){function c(){var r=t.splice(0,1)[0];return r.cb?(n++,void r.fn(function(i,s){if(n--,!a)for(r.cb(i,s);n<e&&t.length>0;)c()})):r.fn()}if(null==i)return r(s,arguments,0);if(e<0||e==1/0)return o(i);for(t.push({fn:o,cb:i});n<e&&t.length>0;)c()},o=__rt.streamlinify(s,0);return o.close=function(){t=[],a=!0},o};var i=e.funnel;if(i.defaultSize=4,!(Array.prototype.forEach_&&Array.prototype.forEach_.version_>=n)){try{Object.defineProperty({},"x",{})}catch(a){return}var s=Object.prototype.hasOwnProperty;delete Array.prototype.forEach_,Object.defineProperty(Array.prototype,"forEach_",{configurable:!0,writable:!0,enumerable:!1,value:function o(e,n,r,i){var a,c,u,l=this,p={name:"value__1",line:124};return __func(e,this,arguments,o,0,p,function(){return"function"==typeof n&&(i=r,r=n,n=1),a=t(n),i=void 0!==i?i:l,c=l.length,function(t){if(1===a||c<=1){u=0;var n=!1;return function(t){var a,o=__cb(e,p,0,0,function(){a=!1,n?u++:n=!0;var f=u<c;return f?function(t){return s.call(l,u)?r.call(i,__cb(e,p,7,31,t,!0),l[u],u):void t()}(function(){for(;a;)o();a=!0}):void t()});do o();while(a);a=!0}(t)}return l.map_(__cb(e,p,10,9,t,!0),a,r,i)}(function(){return e(null,l)})})}}),Array.prototype.forEach_.version_=n,delete Array.prototype.map_,Object.defineProperty(Array.prototype,"map_",{configurable:!0,writable:!0,enumerable:!1,value:function c(e,n,r,a){var o,u,l,p,f,d=this,_={name:"value__2",line:147};return __func(e,this,arguments,c,0,_,function(){return"function"==typeof n&&(a=r,r=n,n=1),o=t(n),a=void 0!==a?a:d,u=d.length,function(t){if(1===o||u<=1){l=new Array(u),p=0;var n=!1;return function(t){var i,o=__cb(e,_,0,0,function(){i=!1,n?p++:n=!0;var c=p<u;return c?function(t){return s.call(d,p)?r.call(a,__cb(e,_,9,43,function(e,n){l[p]=n,t()},!0),d[p],p):void t()}(function(){for(;i;)o();i=!0}):void t()});do o();while(i);i=!0}(t)}f=i(o),l=d.map(function(e,t){return f(!1,function n(i){var s={name:"__1",line:161};return __func(i,this,arguments,n,0,s,function(){return r.call(a,__cb(i,s,1,16,i,!0),e,t)})})}),p=0;var c=!1;return function(t){var n,r=__cb(e,_,0,0,function(){n=!1,c?p++:c=!0;var i=p<u;return i?function(t){return s.call(d,p)?l[p](__cb(e,_,19,40,function(e,n){l[p]=n,t()},!0)):void t()}(function(){for(;n;)r();n=!0}):void t()});do r();while(n);n=!0}(t)}(function(){return e(null,l)})})}}),delete Array.prototype.filter_,Object.defineProperty(Array.prototype,"filter_",{configurable:!0,writable:!0,enumerable:!1,value:function u(e,n,r,i){var a,o,c,l,p,f=this,d={name:"value__3",line:179};return __func(e,this,arguments,u,0,d,function(){return"function"==typeof n&&(i=r,r=n,n=1),a=t(n),i=void 0!==i?i:f,o=[],c=f.length,function(t){if(1===a||c<=1){l=0;var n=!1;return function(t){var a,u=__cb(e,d,0,0,function(){a=!1,n?l++:n=!0;var _=l<c;return _?function(t){return s.call(f,l)?(p=f[l],r.call(i,__cb(e,d,10,13,function(e,n){return function(e){n?(o.push(p),e()):e()}(t)},!0),p)):void t()}(function(){for(;a;)u();a=!0}):void t()});do u();while(a);a=!0}(t)}return f.map_(__cb(e,d,14,9,t,!0),a,function u(e,t){var n={name:"__1",line:193};return __func(e,this,arguments,u,0,n,function(){return r.call(i,__cb(e,n,1,12,function(n,r){return function(e){r?(o.push(t),e()):e()}(e)},!0),t)})},i)}(function(){return e(null,o)})})}}),delete Array.prototype.every_,Object.defineProperty(Array.prototype,"every_",{configurable:!0,writable:!0,enumerable:!1,value:function l(e,n,r,a){var o,c,u,p,f,d=this,_={name:"value__4",line:207};return __func(e,this,arguments,l,0,_,function(){return"function"==typeof n&&(a=r,r=n,n=1),o=t(n),a=void 0!==a?a:d,c=d.length,function(t){if(1===o||c<=1){u=0;var n=!1;return function(t){var i,o=__cb(e,_,0,0,function(){i=!1,n?u++:n=!0;var l=u<c;return l?function(e){var t=s.call(d,u);return t?r.call(a,__cb(e,_,8,34,function(t,n){var r=!n;return e(null,r)},!0),d[u]):e(null,t)}(__cb(e,_,-206,17,function(t,n){return function(t){return n?e(null,!1):void t()}(function(){for(;i;)o();i=!0})},!0)):void t()});do o();while(i);i=!0}(t)}p=i(o),f=d.map(function(e){return p(!1,function t(n){var i={name:"__1",line:220};return __func(n,this,arguments,t,0,i,function(){return r.call(a,__cb(n,i,1,16,n,!0),e)})})}),u=0;var l=!1;return function(t){var n,r=__cb(e,_,0,0,function(){n=!1,l?u++:l=!0;var i=u<c;return i?function(e){var t=s.call(d,u);return t?f[u](__cb(e,_,18,31,function(t,n){var r=!n;return e(null,r)},!0)):e(null,t)}(__cb(e,_,-206,17,function(t,i){return function(t){return i?(p.close(),e(null,!1)):void t()}(function(){for(;n;)r();n=!0})},!0)):void t()});do r();while(n);n=!0}(t)}(function(){return e(null,!0)})})}}),delete Array.prototype.some_,Object.defineProperty(Array.prototype,"some_",{configurable:!0,writable:!0,enumerable:!1,value:function p(e,n,r,a){var o,c,u,l,f,d=this,_={name:"value__5",line:241};return __func(e,this,arguments,p,0,_,function(){return"function"==typeof n&&(a=r,r=n,n=1),o=t(n),a=void 0!==a?a:d,c=d.length,function(t){if(1===o||c<=1){u=0;var n=!1;return function(t){var i,o=__cb(e,_,0,0,function(){i=!1,n?u++:n=!0;var l=u<c;return l?function(e){var t=s.call(d,u);return t?r.call(a,__cb(e,_,7,33,e,!0),d[u]):e(null,t)}(__cb(e,_,-240,17,function(t,n){return function(t){return n?e(null,!0):void t()}(function(){for(;i;)o();i=!0})},!0)):void t()});do o();while(i);i=!0}(t)}l=i(o),f=d.map(function(e){return l(!1,function t(n){var i={name:"__1",line:253};return __func(n,this,arguments,t,0,i,function(){return r.call(a,__cb(n,i,1,16,n,!0),e)})})}),u=0;var p=!1;return function(t){var n,r=__cb(e,_,0,0,function(){n=!1,p?u++:p=!0;var i=u<c;return i?function(e){var t=s.call(d,u);return t?f[u](__cb(e,_,17,30,e,!0)):e(null,t)}(__cb(e,_,-240,17,function(t,i){return function(t){return i?(l.close(),e(null,!0)):void t()}(function(){for(;n;)r();n=!0})},!0)):void t()});do r();while(n);n=!0}(t)}(function(){return e(null,!1)})})}}),delete Array.prototype.reduce_,Object.defineProperty(Array.prototype,"reduce_",{configurable:!0,writable:!0,enumerable:!1,value:function f(e,t,n,r){var i,a,o=this,c={name:"value__6",line:274};return __func(e,this,arguments,f,0,c,function(){r=void 0!==r?r:o,i=o.length,a=0;var u=!1;return function(l){var p,f=__cb(e,c,0,0,function(){p=!1,u?a++:u=!0;var d=a<i;return d?function(i){return s.call(o,a)?t.call(r,__cb(e,c,4,34,function(e,t){n=t,i()},!0),n,o[a],a,o):void i()}(function(){for(;p;)f();p=!0}):void l()});do f();while(p);p=!0}(function(){return e(null,n)})})}}),delete Array.prototype.reduceRight_,Object.defineProperty(Array.prototype,"reduceRight_",{configurable:!0,writable:!0,enumerable:!1,value:function d(e,t,n,r){var i,a,o=this,c={name:"value__7",line:290};return __func(e,this,arguments,d,0,c,function(){r=void 0!==r?r:o,i=o.length,a=i-1;var u=!1;return function(i){var l,p=__cb(e,c,0,0,function(){l=!1,u?a--:u=!0;var f=a>=0;return f?function(i){return s.call(o,a)?t.call(r,__cb(e,c,4,34,function(e,t){n=t,i()},!0),n,o[a],a,o):void i()}(function(){for(;l;)p();l=!0}):void i()});do p();while(l);l=!0}(function(){return e(null,n)})})}}),delete Array.prototype.sort_,Object.defineProperty(Array.prototype,"sort_",{configurable:!0,writable:!0,enumerable:!1,value:function _(e,t,n,r){function i(e,n,r){var s,o,c,u,l,p={name:"_qsort",line:313};return __func(e,this,arguments,i,0,p,function(){return n>=r?e(null):function(i){return r==n+1?t(__cb(e,p,4,9,function(t,i){var o=i>0;return function(e){o?(s=a[n],a[n]=a[r],a[r]=s,e()):e()}(function(){return e(null)})},!0),a[n],a[r]):void i()}(function(){return o=Math.floor((n+r)/2),c=a[o],u=n,l=r,function(i){var o,f=__cb(e,p,0,0,function(){o=!1;var d=u<=l;return d?function(n){var i,s=__cb(e,p,0,0,function(){return i=!1,function(e){return function(e){var n=u<r;return n?t(__cb(e,p,18,26,function(t,n){var r=n<0;return e(null,r)},!0),a[u],c):e(null,n)}(__cb(e,p,-312,17,e,!0))}(__cb(e,p,-312,17,function(e,t){if(t){for(u++;i;)s();i=!0}else n()},!0))});do s();while(i);i=!0}(function(){return function(r){var i,s=__cb(e,p,0,0,function(){return i=!1,function(e){return function(e){var r=n<l;return r?t(__cb(e,p,19,26,function(t,n){var r=n<0;return e(null,r)},!0),c,a[l]):e(null,r)}(__cb(e,p,-312,17,e,!0))}(__cb(e,p,-312,17,function(e,t){if(t){for(l--;i;)s();i=!0}else r()},!0))});do s();while(i);i=!0}(function(){for(u<=l&&(s=a[u],a[u]=a[l],a[l]=s,u++,l--);o;)f();o=!0})}):void i()});do f();while(o);o=!0}(function(){return function(t){return u<r?i(__cb(e,p,30,20,t,!0),u,r):void t()}(function(){return function(t){return n<l?i(__cb(e,p,31,20,t,!0),n,l):void t()}(e)})})})})}var a,s=this,o={name:"value__8",line:308};return __func(e,this,arguments,_,0,o,function(){return a=s,n=n||0,r=null==r?a.length-1:r,i(__cb(e,o,38,3,function(){return e(null,a)},!0),n,r)})}}),delete Function.prototype.apply_,Object.defineProperty(Function.prototype,"apply_",{configurable:!0,writable:!0,enumerable:!1,value:function(e,t,n,r){return n=Array.prototype.slice.call(n,0),n.splice(null!=r&&r>=0?r:n.length,0,e),this.apply(t,n)}})}}("undefined"!=typeof exports?exports:Streamline.builtins=Streamline.builtins||{});