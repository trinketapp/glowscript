/*This is a combined, compressed file.  Look at https://github.com/BruceSherwood/glowscript for source code and copyright information.*/!function(e){function t(t){var n=t||window.event,i=[].slice.call(arguments,1),l=0,s=0,o=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(l=n.wheelDelta/120),n.detail&&(l=-n.detail/3),o=l,void 0!==n.axis&&n.axis===n.HORIZONTAL_AXIS&&(o=0,s=-1*l),void 0!==n.wheelDeltaY&&(o=n.wheelDeltaY/120),void 0!==n.wheelDeltaX&&(s=-1*n.wheelDeltaX/120),i.unshift(t,l,s,o),(e.event.dispatch||e.event.handle).apply(this,i)}var n=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var i=n.length;i;)e.event.fixHooks[n[--i]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery);
!function(t){t.color={},t.color.make=function(i,e,n,o){var a={};return a.r=i||0,a.g=e||0,a.b=n||0,a.a=null!=o?o:1,a.add=function(t,i){for(var e=0;e<t.length;++e)a[t.charAt(e)]+=i;return a.normalize()},a.scale=function(t,i){for(var e=0;e<t.length;++e)a[t.charAt(e)]*=i;return a.normalize()},a.toString=function(){return a.a>=1?"rgb("+[a.r,a.g,a.b].join(",")+")":"rgba("+[a.r,a.g,a.b,a.a].join(",")+")"},a.normalize=function(){function t(t,i,e){return t>i?t:i>e?e:i}return a.r=t(0,parseInt(a.r),255),a.g=t(0,parseInt(a.g),255),a.b=t(0,parseInt(a.b),255),a.a=t(0,a.a,1),a},a.clone=function(){return t.color.make(a.r,a.b,a.g,a.a)},a.normalize()},t.color.extract=function(i,e){var n;do{if(n=i.css(e).toLowerCase(),""!=n&&"transparent"!=n)break;i=i.parent()}while(!t.nodeName(i.get(0),"body"));return"rgba(0, 0, 0, 0)"==n&&(n="transparent"),t.color.parse(n)},t.color.parse=function(e){var n,o=t.color.make;if(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(e))return o(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10));if(n=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(e))return o(parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),parseFloat(n[4]));if(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(e))return o(2.55*parseFloat(n[1]),2.55*parseFloat(n[2]),2.55*parseFloat(n[3]));if(n=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(e))return o(2.55*parseFloat(n[1]),2.55*parseFloat(n[2]),2.55*parseFloat(n[3]),parseFloat(n[4]));if(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(e))return o(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16));if(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(e))return o(parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16));var a=t.trim(e).toLowerCase();return"transparent"==a?o(255,255,255,0):(n=i[a]||[0,0,0],o(n[0],n[1],n[2]))};var i={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(t){function e(e,o,a,r){function l(t,i){i=[kt].concat(i);for(var e=0;e<t.length;++e)t[e].apply(this,i)}function s(){for(var i=0;i<r.length;++i){var e=r[i];e.init(kt),e.options&&t.extend(!0,rt,e.options)}}function c(i){var e;for(t.extend(!0,rt,i),null==rt.xaxis.color&&(rt.xaxis.color=rt.grid.color),null==rt.yaxis.color&&(rt.yaxis.color=rt.grid.color),null==rt.xaxis.tickColor&&(rt.xaxis.tickColor=rt.grid.tickColor),null==rt.yaxis.tickColor&&(rt.yaxis.tickColor=rt.grid.tickColor),null==rt.grid.borderColor&&(rt.grid.borderColor=rt.grid.color),null==rt.grid.tickColor&&(rt.grid.tickColor=t.color.parse(rt.grid.color).scale("a",.22).toString()),e=0;e<Math.max(1,rt.xaxes.length);++e)rt.xaxes[e]=t.extend(!0,{},rt.xaxis,rt.xaxes[e]);for(e=0;e<Math.max(1,rt.yaxes.length);++e)rt.yaxes[e]=t.extend(!0,{},rt.yaxis,rt.yaxes[e]);for(rt.xaxis.noTicks&&null==rt.xaxis.ticks&&(rt.xaxis.ticks=rt.xaxis.noTicks),rt.yaxis.noTicks&&null==rt.yaxis.ticks&&(rt.yaxis.ticks=rt.yaxis.noTicks),rt.x2axis&&(rt.xaxes[1]=t.extend(!0,{},rt.xaxis,rt.x2axis),rt.xaxes[1].position="top"),rt.y2axis&&(rt.yaxes[1]=t.extend(!0,{},rt.yaxis,rt.y2axis),rt.yaxes[1].position="right"),rt.grid.coloredAreas&&(rt.grid.markings=rt.grid.coloredAreas),rt.grid.coloredAreasColor&&(rt.grid.markingsColor=rt.grid.coloredAreasColor),rt.lines&&t.extend(!0,rt.series.lines,rt.lines),rt.points&&t.extend(!0,rt.series.points,rt.points),rt.bars&&t.extend(!0,rt.series.bars,rt.bars),null!=rt.shadowSize&&(rt.series.shadowSize=rt.shadowSize),e=0;e<rt.xaxes.length;++e)x(ht,e+1).options=rt.xaxes[e];for(e=0;e<rt.yaxes.length;++e)x(dt,e+1).options=rt.yaxes[e];for(var n in bt)rt.hooks[n]&&rt.hooks[n].length&&(bt[n]=bt[n].concat(rt.hooks[n]));l(bt.processOptions,[rt])}function u(t){at=f(t),g(),v()}function f(i){for(var e=[],n=0;n<i.length;++n){var o=t.extend(!0,{},rt.series);null!=i[n].data?(o.data=i[n].data,delete i[n].data,t.extend(!0,o,i[n]),i[n].data=o.data):o.data=i[n],e.push(o)}return e}function h(t,i){var e=t[i+"axis"];return"object"==typeof e&&(e=e.n),"number"!=typeof e&&(e=1),e}function d(){return t.grep(ht.concat(dt),function(t){return t})}function m(t){var i,e,n={};for(i=0;i<ht.length;++i)e=ht[i],e&&e.used&&(n["x"+e.n]=e.c2p(t.left));for(i=0;i<dt.length;++i)e=dt[i],e&&e.used&&(n["y"+e.n]=e.c2p(t.top));return void 0!==n.x1&&(n.x=n.x1),void 0!==n.y1&&(n.y=n.y1),n}function p(t){var i,e,n,o={};for(i=0;i<ht.length;++i)if(e=ht[i],e&&e.used&&(n="x"+e.n,null==t[n]&&1==e.n&&(n="x"),null!=t[n])){o.left=e.p2c(t[n]);break}for(i=0;i<dt.length;++i)if(e=dt[i],e&&e.used&&(n="y"+e.n,null==t[n]&&1==e.n&&(n="y"),null!=t[n])){o.top=e.p2c(t[n]);break}return o}function x(i,e){return i[e-1]||(i[e-1]={n:e,direction:i==ht?"x":"y",options:t.extend(!0,{},i==ht?rt.xaxis:rt.yaxis)}),i[e-1]}function g(){var i,e=at.length,n=[],o=[];for(i=0;i<at.length;++i){var a=at[i].color;null!=a&&(--e,"number"==typeof a?o.push(a):n.push(t.color.parse(at[i].color)))}for(i=0;i<o.length;++i)e=Math.max(e,o[i]+1);var r=[],l=0;for(i=0;r.length<e;){var s;s=rt.colors.length==i?t.color.make(100,100,100):t.color.parse(rt.colors[i]);var c=l%2==1?-1:1;s.scale("rgb",1+c*Math.ceil(l/2)*.2),r.push(s),++i,i>=rt.colors.length&&(i=0,++l)}var u,f=0;for(i=0;i<at.length;++i){if(u=at[i],null==u.color?(u.color=r[f].toString(),++f):"number"==typeof u.color&&(u.color=r[u.color].toString()),null==u.lines.show){var d,m=!0;for(d in u)if(u[d]&&u[d].show){m=!1;break}m&&(u.lines.show=!0)}u.xaxis=x(ht,h(u,"x")),u.yaxis=x(dt,h(u,"y"))}}function v(){function i(t,i,e){i<t.datamin&&i!=-x&&(t.datamin=i),e>t.datamax&&e!=x&&(t.datamax=e)}var e,n,o,a,r,s,c,u,f,h,m=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,x=Number.MAX_VALUE;for(t.each(d(),function(t,i){i.datamin=m,i.datamax=p,i.used=!1}),e=0;e<at.length;++e)r=at[e],r.datapoints={points:[]},l(bt.processRawData,[r,r.data,r.datapoints]);for(e=0;e<at.length;++e){r=at[e];var g=r.data,v=r.datapoints.format;if(v||(v=[],v.push({x:!0,number:!0,required:!0}),v.push({y:!0,number:!0,required:!0}),(r.bars.show||r.lines.show&&r.lines.fill)&&(v.push({y:!0,number:!0,required:!1,defaultValue:0}),r.bars.horizontal&&(delete v[v.length-1].y,v[v.length-1].x=!0)),r.datapoints.format=v),null==r.datapoints.pointsize)for(r.datapoints.pointsize=v.length,c=r.datapoints.pointsize,s=r.datapoints.points,insertSteps=r.lines.show&&r.lines.steps,r.xaxis.used=r.yaxis.used=!0,n=o=0;n<g.length;++n,o+=c){h=g[n];var b=null==h;if(!b)for(a=0;c>a;++a)u=h[a],f=v[a],f&&(f.number&&null!=u&&(u=+u,isNaN(u)?u=null:u==1/0?u=x:u==-(1/0)&&(u=-x)),null==u&&(f.required&&(b=!0),null!=f.defaultValue&&(u=f.defaultValue))),s[o+a]=u;if(b)for(a=0;c>a;++a)u=s[o+a],null!=u&&(f=v[a],f.x&&i(r.xaxis,u,u),f.y&&i(r.yaxis,u,u)),s[o+a]=null;else if(insertSteps&&o>0&&null!=s[o-c]&&s[o-c]!=s[o]&&s[o-c+1]!=s[o+1]){for(a=0;c>a;++a)s[o+c+a]=s[o+a];s[o+1]=s[o-c+1],o+=c}}}for(e=0;e<at.length;++e)r=at[e],l(bt.processDatapoints,[r,r.datapoints]);for(e=0;e<at.length;++e){r=at[e],s=r.datapoints.points,c=r.datapoints.pointsize;var k=m,y=m,T=p,w=p;for(n=0;n<s.length;n+=c)if(null!=s[n])for(a=0;c>a;++a)u=s[n+a],f=v[a],f&&u!=x&&u!=-x&&(f.x&&(k>u&&(k=u),u>T&&(T=u)),f.y&&(y>u&&(y=u),u>w&&(w=u)));if(r.bars.show){var M="left"==r.bars.align?0:-r.bars.barWidth/2;r.bars.horizontal?(y+=M,w+=M+r.bars.barWidth):(k+=M,T+=M+r.bars.barWidth)}i(r.xaxis,k,T),i(r.yaxis,y,w)}t.each(d(),function(t,i){i.datamin==m&&(i.datamin=null),i.datamax==p&&(i.datamax=null)})}function b(i,n){var o=document.createElement("canvas");return o.className=n,o.width=pt,o.height=xt,i||t(o).css({position:"absolute",left:0,top:0}),t(o).appendTo(e),o.getContext||(o=window.G_vmlCanvasManager.initElement(o)),o.getContext("2d").save(),o}function k(){if(pt=e.width(),xt=e.height(),0>=pt||0>=xt)throw"Invalid dimensions for plot, width = "+pt+", height = "+xt}function y(t){t.width!=pt&&(t.width=pt),t.height!=xt&&(t.height=xt);var i=t.getContext("2d");i.restore(),i.save()}function T(){var i,n=e.children("canvas.base"),o=e.children("canvas.overlay");0==n.length||0==o?(e.html(""),e.css({padding:0}),"static"==e.css("position")&&e.css("position","relative"),k(),lt=b(!0,"base"),st=b(!1,"overlay"),i=!1):(lt=n.get(0),st=o.get(0),i=!0),ut=lt.getContext("2d"),ft=st.getContext("2d"),ct=t([st,lt]),i&&(e.data("plot").shutdown(),kt.resize(),ft.clearRect(0,0,pt,xt),ct.unbind(),e.children().not([lt,st]).remove()),e.data("plot",kt)}function w(){rt.grid.hoverable&&(ct.mousemove(G),ct.mouseleave(_)),rt.grid.clickable&&ct.click(J),l(bt.bindEvents,[ct])}function M(){Tt&&clearTimeout(Tt),ct.unbind("mousemove",G),ct.unbind("mouseleave",_),ct.unbind("click",J),l(bt.shutdown,[ct])}function C(t){function i(t){return t}var e,n,o=t.options.transform||i,a=t.options.inverseTransform;"x"==t.direction?(e=t.scale=gt/Math.abs(o(t.max)-o(t.min)),n=Math.min(o(t.max),o(t.min))):(e=t.scale=vt/Math.abs(o(t.max)-o(t.min)),e=-e,n=Math.max(o(t.max),o(t.min))),o==i?t.p2c=function(t){return(t-n)*e}:t.p2c=function(t){return(o(t)-n)*e},a?t.c2p=function(t){return a(n+t/e)}:t.c2p=function(t){return n+t/e}}function S(i){function n(n,o){return t('<div style="position:absolute;top:-10000px;'+o+'font-size:smaller"><div class="'+i.direction+"Axis "+i.direction+i.n+'Axis">'+n.join("")+"</div></div>").appendTo(e)}var o,a,r,l=i.options,s=i.ticks||[],c=[],u=l.labelWidth,f=l.labelHeight;if("x"==i.direction){if(null==u&&(u=Math.floor(pt/(s.length>0?s.length:1))),null==f){for(c=[],o=0;o<s.length;++o)a=s[o].label,a&&c.push('<div class="tickLabel" style="float:left;width:'+u+'px">'+a+"</div>");c.length>0&&(c.push('<div style="clear:left"></div>'),r=n(c,"width:10000px;"),f=r.height(),r.remove())}}else if(null==u||null==f){for(o=0;o<s.length;++o)a=s[o].label,a&&c.push('<div class="tickLabel">'+a+"</div>");c.length>0&&(r=n(c,""),null==u&&(u=r.children().width()),null==f&&(f=r.find("div.tickLabel").height()),r.remove())}null==u&&(u=0),null==f&&(f=0),i.labelWidth=u,i.labelHeight=f}function z(i){var e=i.labelWidth,n=i.labelHeight,o=i.options.position,a=i.options.tickLength,r=rt.grid.axisMargin,l=rt.grid.labelMargin,s="x"==i.direction?ht:dt,c=t.grep(s,function(t){return t&&t.options.position==o&&t.reserveSpace});t.inArray(i,c)==c.length-1&&(r=0),null==a&&(a="full");var u=t.grep(s,function(t){return t&&t.reserveSpace}),f=0==t.inArray(i,u);f||"full"!=a||(a=5),isNaN(+a)||(l+=+a),"x"==i.direction?(n+=l,"bottom"==o?(mt.bottom+=n+r,i.box={top:xt-mt.bottom,height:n}):(i.box={top:mt.top+r,height:n},mt.top+=n+r)):(e+=l,"left"==o?(i.box={left:mt.left+r,width:e},mt.left+=e+r):(mt.right+=e+r,i.box={left:pt-mt.right,width:e})),i.position=o,i.tickLength=a,i.box.padding=l,i.innermost=f}function W(t){"x"==t.direction?(t.box.left=mt.left,t.box.width=gt):(t.box.top=mt.top,t.box.height=vt)}function A(){var i,e=d();if(t.each(e,function(t,i){i.show=i.options.show,null==i.show&&(i.show=i.used),i.reserveSpace=i.show||i.options.reserveSpace,F(i)}),allocatedAxes=t.grep(e,function(t){return t.reserveSpace}),mt.left=mt.right=mt.top=mt.bottom=0,rt.grid.show){for(t.each(allocatedAxes,function(t,i){I(i),U(i),N(i,i.ticks),S(i)}),i=allocatedAxes.length-1;i>=0;--i)z(allocatedAxes[i]);var n=rt.grid.minBorderMargin;if(null==n)for(n=0,i=0;i<at.length;++i)n=Math.max(n,at[i].points.radius+at[i].points.lineWidth/2);for(var o in mt)mt[o]+=rt.grid.borderWidth,mt[o]=Math.max(n,mt[o])}gt=pt-mt.left-mt.right,vt=xt-mt.bottom-mt.top,t.each(e,function(t,i){C(i)}),rt.grid.show&&(t.each(allocatedAxes,function(t,i){W(i)}),O()),B()}function F(t){var i=t.options,e=+(null!=i.min?i.min:t.datamin),n=+(null!=i.max?i.max:t.datamax),o=n-e;if(0==o){var a=0==n?1:.01;null==i.min&&(e-=a),null!=i.max&&null==i.min||(n+=a)}else{var r=i.autoscaleMargin;null!=r&&(null==i.min&&(e-=o*r,0>e&&null!=t.datamin&&t.datamin>=0&&(e=0)),null==i.max&&(n+=o*r,n>0&&null!=t.datamax&&t.datamax<=0&&(n=0)))}t.min=e,t.max=n}function I(i){var e,o=i.options;e="number"==typeof o.ticks&&o.ticks>0?o.ticks:.3*Math.sqrt("x"==i.direction?pt:xt);var a,r,l,s,c,u,f,h=(i.max-i.min)/e;if("time"==o.mode){var d={second:1e3,minute:6e4,hour:36e5,day:864e5,month:2592e6,year:525949.2*60*1e3},m=[[1,"second"],[2,"second"],[5,"second"],[10,"second"],[30,"second"],[1,"minute"],[2,"minute"],[5,"minute"],[10,"minute"],[30,"minute"],[1,"hour"],[2,"hour"],[4,"hour"],[8,"hour"],[12,"hour"],[1,"day"],[2,"day"],[3,"day"],[.25,"month"],[.5,"month"],[1,"month"],[2,"month"],[3,"month"],[6,"month"],[1,"year"]],p=0;null!=o.minTickSize&&(p="number"==typeof o.tickSize?o.tickSize:o.minTickSize[0]*d[o.minTickSize[1]]);for(var c=0;c<m.length-1&&!(h<(m[c][0]*d[m[c][1]]+m[c+1][0]*d[m[c+1][1]])/2&&m[c][0]*d[m[c][1]]>=p);++c);a=m[c][0],l=m[c][1],"year"==l&&(u=Math.pow(10,Math.floor(Math.log(h/d.year)/Math.LN10)),f=h/d.year/u,a=1.5>f?1:3>f?2:7.5>f?5:10,a*=u),i.tickSize=o.tickSize||[a,l],r=function(t){var i=[],e=t.tickSize[0],o=t.tickSize[1],a=new Date(t.min),r=e*d[o];"second"==o&&a.setUTCSeconds(n(a.getUTCSeconds(),e)),"minute"==o&&a.setUTCMinutes(n(a.getUTCMinutes(),e)),"hour"==o&&a.setUTCHours(n(a.getUTCHours(),e)),"month"==o&&a.setUTCMonth(n(a.getUTCMonth(),e)),"year"==o&&a.setUTCFullYear(n(a.getUTCFullYear(),e)),a.setUTCMilliseconds(0),r>=d.minute&&a.setUTCSeconds(0),r>=d.hour&&a.setUTCMinutes(0),r>=d.day&&a.setUTCHours(0),r>=4*d.day&&a.setUTCDate(1),r>=d.year&&a.setUTCMonth(0);var l,s=0,c=Number.NaN;do if(l=c,c=a.getTime(),i.push(c),"month"==o)if(1>e){a.setUTCDate(1);var u=a.getTime();a.setUTCMonth(a.getUTCMonth()+1);var f=a.getTime();a.setTime(c+s*d.hour+(f-u)*e),s=a.getUTCHours(),a.setUTCHours(0)}else a.setUTCMonth(a.getUTCMonth()+e);else"year"==o?a.setUTCFullYear(a.getUTCFullYear()+e):a.setTime(c+r);while(c<t.max&&c!=l);return i},s=function(i,e){var n=new Date(i);if(null!=o.timeformat)return t.plot.formatDate(n,o.timeformat,o.monthNames);var a=e.tickSize[0]*d[e.tickSize[1]],r=e.max-e.min,l=o.twelveHourClock?" %p":"";return a<d.minute?fmt="%h:%M:%S"+l:a<d.day?r<2*d.day?fmt="%h:%M"+l:fmt="%b %d %h:%M"+l:a<d.month?fmt="%b %d":a<d.year?r<d.year?fmt="%b":fmt="%b %y":fmt="%y",t.plot.formatDate(n,fmt,o.monthNames)}}else{var x=o.tickDecimals,g=-Math.floor(Math.log(h)/Math.LN10);null!=x&&g>x&&(g=x),u=Math.pow(10,-g),f=h/u,1.5>f?a=1:3>f?(a=2,f>2.25&&(null==x||x>=g+1)&&(a=2.5,++g)):a=7.5>f?5:10,a*=u,null!=o.minTickSize&&a<o.minTickSize&&(a=o.minTickSize),i.tickDecimals=Math.max(0,null!=x?x:g),i.tickSize=o.tickSize||a,r=function(t){var i,e=[],o=n(t.min,t.tickSize),a=0,r=Number.NaN;do i=r,r=o+a*t.tickSize,e.push(r),++a;while(r<t.max&&r!=i);return e},s=function(t,i){return t.toFixed(i.tickDecimals)}}if(null!=o.alignTicksWithAxis){var v=("x"==i.direction?ht:dt)[o.alignTicksWithAxis-1];if(v&&v.used&&v!=i){var b=r(i);if(b.length>0&&(null==o.min&&(i.min=Math.min(i.min,b[0])),null==o.max&&b.length>1&&(i.max=Math.max(i.max,b[b.length-1]))),r=function(t){var i,e,n=[];for(e=0;e<v.ticks.length;++e)i=(v.ticks[e].v-v.min)/(v.max-v.min),i=t.min+i*(t.max-t.min),n.push(i);return n},"time"!=i.mode&&null==o.tickDecimals){var k=Math.max(0,-Math.floor(Math.log(h)/Math.LN10)+1),y=r(i);y.length>1&&/\..*0$/.test((y[1]-y[0]).toFixed(k))||(i.tickDecimals=k)}}}i.tickGenerator=r,t.isFunction(o.tickFormatter)?i.tickFormatter=function(t,i){return""+o.tickFormatter(t,i)}:i.tickFormatter=s}function U(i){var e=i.options.ticks,n=[];null==e||"number"==typeof e&&e>0?n=i.tickGenerator(i):e&&(n=t.isFunction(e)?e({min:i.min,max:i.max}):e);var o,a;for(i.ticks=[],o=0;o<n.length;++o){var r=null,l=n[o];"object"==typeof l?(a=+l[0],l.length>1&&(r=l[1])):a=+l,null==r&&(r=i.tickFormatter(a,i)),isNaN(a)||i.ticks.push({v:a,label:r})}}function N(t,i){t.options.autoscaleMargin&&i.length>0&&(null==t.options.min&&(t.min=Math.min(t.min,i[0].v)),null==t.options.max&&i.length>1&&(t.max=Math.max(t.max,i[i.length-1].v)))}function D(){ut.clearRect(0,0,pt,xt);var t=rt.grid;t.show&&t.backgroundColor&&P(),t.show&&!t.aboveData&&H();for(var i=0;i<at.length;++i)l(bt.drawSeries,[ut,at[i]]),Y(at[i]);l(bt.draw,[ut]),t.show&&t.aboveData&&H()}function L(t,e){var n,o,a,r,l=d();for(i=0;i<l.length;++i)if(n=l[i],n.direction==e&&(r=e+n.n+"axis",t[r]||1!=n.n||(r=e+"axis"),t[r])){o=t[r].from,a=t[r].to;break}if(t[r]||(n="x"==e?ht[0]:dt[0],o=t[e+"1"],a=t[e+"2"]),null!=o&&null!=a&&o>a){var s=o;o=a,a=s}return{from:o,to:a,axis:n}}function P(){ut.save(),ut.translate(mt.left,mt.top),ut.fillStyle=ot(rt.grid.backgroundColor,vt,0,"rgba(255, 255, 255, 0)"),ut.fillRect(0,0,gt,vt),ut.restore()}function H(){var i;ut.save(),ut.translate(mt.left,mt.top);var e=rt.grid.markings;if(e){if(t.isFunction(e)){var n=kt.getAxes();n.xmin=n.xaxis.min,n.xmax=n.xaxis.max,n.ymin=n.yaxis.min,n.ymax=n.yaxis.max,e=e(n)}for(i=0;i<e.length;++i){var o=e[i],a=L(o,"x"),r=L(o,"y");null==a.from&&(a.from=a.axis.min),null==a.to&&(a.to=a.axis.max),null==r.from&&(r.from=r.axis.min),null==r.to&&(r.to=r.axis.max),a.to<a.axis.min||a.from>a.axis.max||r.to<r.axis.min||r.from>r.axis.max||(a.from=Math.max(a.from,a.axis.min),a.to=Math.min(a.to,a.axis.max),r.from=Math.max(r.from,r.axis.min),r.to=Math.min(r.to,r.axis.max),a.from==a.to&&r.from==r.to||(a.from=a.axis.p2c(a.from),a.to=a.axis.p2c(a.to),r.from=r.axis.p2c(r.from),r.to=r.axis.p2c(r.to),a.from==a.to||r.from==r.to?(ut.beginPath(),ut.strokeStyle=o.color||rt.grid.markingsColor,ut.lineWidth=o.lineWidth||rt.grid.markingsLineWidth,ut.moveTo(a.from,r.from),ut.lineTo(a.to,r.to),ut.stroke()):(ut.fillStyle=o.color||rt.grid.markingsColor,ut.fillRect(a.from,r.to,a.to-a.from,r.from-r.to))))}}for(var n=d(),l=rt.grid.borderWidth,s=0;s<n.length;++s){var c,u,f,h,m=n[s],p=m.box,x=m.tickLength;if(m.show&&0!=m.ticks.length){for(ut.strokeStyle=m.options.tickColor||t.color.parse(m.options.color).scale("a",.22).toString(),ut.lineWidth=1,"x"==m.direction?(c=0,u="full"==x?"top"==m.position?0:vt:p.top-mt.top+("top"==m.position?p.height:0)):(u=0,c="full"==x?"left"==m.position?0:gt:p.left-mt.left+("left"==m.position?p.width:0)),m.innermost||(ut.beginPath(),f=h=0,"x"==m.direction?f=gt:h=vt,1==ut.lineWidth&&(c=Math.floor(c)+.5,u=Math.floor(u)+.5),ut.moveTo(c,u),ut.lineTo(c+f,u+h),ut.stroke()),ut.beginPath(),i=0;i<m.ticks.length;++i){var g=m.ticks[i].v;f=h=0,g<m.min||g>m.max||"full"==x&&l>0&&(g==m.min||g==m.max)||("x"==m.direction?(c=m.p2c(g),h="full"==x?-vt:x,"top"==m.position&&(h=-h)):(u=m.p2c(g),f="full"==x?-gt:x,"left"==m.position&&(f=-f)),1==ut.lineWidth&&("x"==m.direction?c=Math.floor(c)+.5:u=Math.floor(u)+.5),ut.moveTo(c,u),ut.lineTo(c+f,u+h))}ut.stroke()}}l&&(ut.lineWidth=l,ut.strokeStyle=rt.grid.borderColor,ut.strokeRect(-l/2,-l/2,gt+l,vt+l)),ut.restore()}function O(){e.find(".tickLabels").remove();for(var t=['<div class="tickLabels" style="font-size:smaller">'],i=d(),n=0;n<i.length;++n){var o=i[n],a=o.box;if(o.show){t.push('<div class="'+o.direction+"Axis "+o.direction+o.n+'Axis" style="color:'+o.options.color+'">');for(var r=0;r<o.ticks.length;++r){var l=o.ticks[r];if(!(!l.label||l.v<o.min||l.v>o.max)){var s,c={};"x"==o.direction?(s="center",c.left=Math.round(mt.left+o.p2c(l.v)-o.labelWidth/2),"bottom"==o.position?c.top=a.top+a.padding:c.bottom=xt-(a.top+a.height-a.padding)):(c.top=Math.round(mt.top+o.p2c(l.v)-o.labelHeight/2),"left"==o.position?(c.right=pt-(a.left+a.width-a.padding),s="right"):(c.left=a.left+a.padding,s="left")),c.width=o.labelWidth;var u=["position:absolute","text-align:"+s];for(var f in c)u.push(f+":"+c[f]+"px");t.push('<div class="tickLabel" style="'+u.join(";")+'">'+l.label+"</div>")}}t.push("</div>")}}t.push("</div>"),e.append(t.join(""))}function Y(t){t.lines.show&&j(t),t.bars.show&&V(t),t.points.show&&R(t)}function j(t){function i(t,i,e,n,o){var a=t.points,r=t.pointsize,l=null,s=null;ut.beginPath();for(var c=r;c<a.length;c+=r){var u=a[c-r],f=a[c-r+1],h=a[c],d=a[c+1];if(null!=u&&null!=h){if(d>=f&&f<o.min){if(d<o.min)continue;u=(o.min-f)/(d-f)*(h-u)+u,f=o.min}else if(f>=d&&d<o.min){if(f<o.min)continue;h=(o.min-f)/(d-f)*(h-u)+u,d=o.min}if(f>=d&&f>o.max){if(d>o.max)continue;u=(o.max-f)/(d-f)*(h-u)+u,f=o.max}else if(d>=f&&d>o.max){if(f>o.max)continue;h=(o.max-f)/(d-f)*(h-u)+u,d=o.max}if(h>=u&&u<n.min){if(h<n.min)continue;f=(n.min-u)/(h-u)*(d-f)+f,u=n.min}else if(u>=h&&h<n.min){if(u<n.min)continue;d=(n.min-u)/(h-u)*(d-f)+f,h=n.min}if(u>=h&&u>n.max){if(h>n.max)continue;f=(n.max-u)/(h-u)*(d-f)+f,u=n.max}else if(h>=u&&h>n.max){if(u>n.max)continue;d=(n.max-u)/(h-u)*(d-f)+f,h=n.max}u==l&&f==s||ut.moveTo(n.p2c(u)+i,o.p2c(f)+e),l=h,s=d,ut.lineTo(n.p2c(h)+i,o.p2c(d)+e)}}ut.stroke()}function e(t,i,e){for(var n=t.points,o=t.pointsize,a=Math.min(Math.max(0,e.min),e.max),r=0,l=!1,s=1,c=0,u=0;;){if(o>0&&r>n.length+o)break;r+=o;var f=n[r-o],h=n[r-o+s],d=n[r],m=n[r+s];if(l){if(o>0&&null!=f&&null==d){u=r,o=-o,s=2;continue}if(0>o&&r==c+o){ut.fill(),l=!1,o=-o,s=1,r=c=u+o;continue}}if(null!=f&&null!=d){if(d>=f&&f<i.min){if(d<i.min)continue;h=(i.min-f)/(d-f)*(m-h)+h,f=i.min}else if(f>=d&&d<i.min){if(f<i.min)continue;m=(i.min-f)/(d-f)*(m-h)+h,d=i.min}if(f>=d&&f>i.max){if(d>i.max)continue;h=(i.max-f)/(d-f)*(m-h)+h,f=i.max}else if(d>=f&&d>i.max){if(f>i.max)continue;m=(i.max-f)/(d-f)*(m-h)+h,d=i.max}if(l||(ut.beginPath(),ut.moveTo(i.p2c(f),e.p2c(a)),l=!0),h>=e.max&&m>=e.max)ut.lineTo(i.p2c(f),e.p2c(e.max)),ut.lineTo(i.p2c(d),e.p2c(e.max));else if(h<=e.min&&m<=e.min)ut.lineTo(i.p2c(f),e.p2c(e.min)),ut.lineTo(i.p2c(d),e.p2c(e.min));else{var p=f,x=d;m>=h&&h<e.min&&m>=e.min?(f=(e.min-h)/(m-h)*(d-f)+f,h=e.min):h>=m&&m<e.min&&h>=e.min&&(d=(e.min-h)/(m-h)*(d-f)+f,m=e.min),h>=m&&h>e.max&&m<=e.max?(f=(e.max-h)/(m-h)*(d-f)+f,h=e.max):m>=h&&m>e.max&&h<=e.max&&(d=(e.max-h)/(m-h)*(d-f)+f,m=e.max),f!=p&&ut.lineTo(i.p2c(p),e.p2c(h)),ut.lineTo(i.p2c(f),e.p2c(h)),ut.lineTo(i.p2c(d),e.p2c(m)),d!=x&&(ut.lineTo(i.p2c(d),e.p2c(m)),ut.lineTo(i.p2c(x),e.p2c(m)))}}}}ut.save(),ut.translate(mt.left,mt.top),ut.lineJoin="round";var n=t.lines.lineWidth,o=t.shadowSize;if(n>0&&o>0){ut.lineWidth=o,ut.strokeStyle="rgba(0,0,0,0.1)";var a=Math.PI/18;i(t.datapoints,Math.sin(a)*(n/2+o/2),Math.cos(a)*(n/2+o/2),t.xaxis,t.yaxis),ut.lineWidth=o/2,i(t.datapoints,Math.sin(a)*(n/2+o/4),Math.cos(a)*(n/2+o/4),t.xaxis,t.yaxis)}ut.lineWidth=n,ut.strokeStyle=t.color;var r=X(t.lines,t.color,0,vt);r&&(ut.fillStyle=r,e(t.datapoints,t.xaxis,t.yaxis)),n>0&&i(t.datapoints,0,0,t.xaxis,t.yaxis),ut.restore()}function R(t){function i(t,i,e,n,o,a,r,l){for(var s=t.points,c=t.pointsize,u=0;u<s.length;u+=c){var f=s[u],h=s[u+1];null==f||f<a.min||f>a.max||h<r.min||h>r.max||(ut.beginPath(),f=a.p2c(f),h=r.p2c(h)+n,"circle"==l?ut.arc(f,h,i,0,o?Math.PI:2*Math.PI,!1):l(ut,f,h,i,o),ut.closePath(),e&&(ut.fillStyle=e,ut.fill()),ut.stroke())}}ut.save(),ut.translate(mt.left,mt.top);var e=t.points.lineWidth,n=t.shadowSize,o=t.points.radius,a=t.points.symbol;if(e>0&&n>0){var r=n/2;ut.lineWidth=r,ut.strokeStyle="rgba(0,0,0,0.1)",i(t.datapoints,o,null,r+r/2,!0,t.xaxis,t.yaxis,a),ut.strokeStyle="rgba(0,0,0,0.2)",i(t.datapoints,o,null,r/2,!0,t.xaxis,t.yaxis,a)}ut.lineWidth=e,ut.strokeStyle=t.color,i(t.datapoints,o,X(t.points,t.color),0,!1,t.xaxis,t.yaxis,a),ut.restore()}function E(t,i,e,n,o,a,r,l,s,c,u,f){var h,d,m,p,x,g,v,b,k;u?(b=g=v=!0,x=!1,h=e,d=t,p=i+n,m=i+o,h>d&&(k=d,d=h,h=k,x=!0,g=!1)):(x=g=v=!0,b=!1,h=t+n,d=t+o,m=e,p=i,m>p&&(k=p,p=m,m=k,b=!0,v=!1)),d<l.min||h>l.max||p<s.min||m>s.max||(h<l.min&&(h=l.min,x=!1),d>l.max&&(d=l.max,g=!1),m<s.min&&(m=s.min,b=!1),p>s.max&&(p=s.max,v=!1),h=l.p2c(h),m=s.p2c(m),d=l.p2c(d),p=s.p2c(p),r&&(c.beginPath(),c.moveTo(h,m),c.lineTo(h,p),c.lineTo(d,p),c.lineTo(d,m),c.fillStyle=r(m,p),c.fill()),f>0&&(x||g||v||b)&&(c.beginPath(),c.moveTo(h,m+a),x?c.lineTo(h,p+a):c.moveTo(h,p+a),v?c.lineTo(d,p+a):c.moveTo(d,p+a),g?c.lineTo(d,m+a):c.moveTo(d,m+a),b?c.lineTo(h,m+a):c.moveTo(h,m+a),c.stroke()))}function V(t){function i(i,e,n,o,a,r,l){for(var s=i.points,c=i.pointsize,u=0;u<s.length;u+=c)null!=s[u]&&E(s[u],s[u+1],s[u+2],e,n,o,a,r,l,ut,t.bars.horizontal,t.bars.lineWidth)}ut.save(),ut.translate(mt.left,mt.top),ut.lineWidth=t.bars.lineWidth,ut.strokeStyle=t.color;var e="left"==t.bars.align?0:-t.bars.barWidth/2,n=t.bars.fill?function(i,e){return X(t.bars,t.color,i,e)}:null;i(t.datapoints,e,e+t.bars.barWidth,0,n,t.xaxis,t.yaxis),ut.restore()}function X(i,e,n,o){var a=i.fill;if(!a)return null;if(i.fillColor)return ot(i.fillColor,n,o,e);var r=t.color.parse(e);return r.a="number"==typeof a?a:.4,r.normalize(),r.toString()}function B(){if(e.find(".legend").remove(),rt.legend.show){for(var i,n,o=[],a=!1,r=rt.legend.labelFormatter,l=0;l<at.length;++l)i=at[l],n=i.label,n&&(l%rt.legend.noColumns==0&&(a&&o.push("</tr>"),o.push("<tr>"),a=!0),r&&(n=r(n,i)),o.push('<td class="legendColorBox"><div style="border:1px solid '+rt.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+i.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+n+"</td>"));if(a&&o.push("</tr>"),0!=o.length){var s='<table style="font-size:smaller;color:'+rt.grid.color+'">'+o.join("")+"</table>";if(null!=rt.legend.container)t(rt.legend.container).html(s);else{var c="",u=rt.legend.position,f=rt.legend.margin;null==f[0]&&(f=[f,f]),"n"==u.charAt(0)?c+="top:"+(f[1]+mt.top)+"px;":"s"==u.charAt(0)&&(c+="bottom:"+(f[1]+mt.bottom)+"px;"),"e"==u.charAt(1)?c+="right:"+(f[0]+mt.right)+"px;":"w"==u.charAt(1)&&(c+="left:"+(f[0]+mt.left)+"px;");var h=t('<div class="legend">'+s.replace('style="','style="position:absolute;'+c+";")+"</div>").appendTo(e);if(0!=rt.legend.backgroundOpacity){var d=rt.legend.backgroundColor;null==d&&(d=rt.grid.backgroundColor,d=d&&"string"==typeof d?t.color.parse(d):t.color.extract(h,"background-color"),d.a=1,d=d.toString());var m=h.children();t('<div style="position:absolute;width:'+m.width()+"px;height:"+m.height()+"px;"+c+"background-color:"+d+';"> </div>').prependTo(h).css("opacity",rt.legend.backgroundOpacity)}}}}}function q(t,i,e){var n,o,a=rt.grid.mouseActiveRadius,r=a*a+1,l=null;for(n=at.length-1;n>=0;--n)if(e(at[n])){var s=at[n],c=s.xaxis,u=s.yaxis,f=s.datapoints.points,h=s.datapoints.pointsize,d=c.c2p(t),m=u.c2p(i),p=a/c.scale,x=a/u.scale;if(c.options.inverseTransform&&(p=Number.MAX_VALUE),u.options.inverseTransform&&(x=Number.MAX_VALUE),s.lines.show||s.points.show)for(o=0;o<f.length;o+=h){var g=f[o],v=f[o+1];if(null!=g&&!(g-d>p||-p>g-d||v-m>x||-x>v-m)){var b=Math.abs(c.p2c(g)-t),k=Math.abs(u.p2c(v)-i),y=b*b+k*k;r>y&&(r=y,l=[n,o/h])}}if(s.bars.show&&!l){var T="left"==s.bars.align?0:-s.bars.barWidth/2,w=T+s.bars.barWidth;for(o=0;o<f.length;o+=h){var g=f[o],v=f[o+1],M=f[o+2];null!=g&&(at[n].bars.horizontal?d<=Math.max(M,g)&&d>=Math.min(M,g)&&m>=v+T&&v+w>=m:d>=g+T&&g+w>=d&&m>=Math.min(M,v)&&m<=Math.max(M,v))&&(l=[n,o/h])}}}return l?(n=l[0],o=l[1],h=at[n].datapoints.pointsize,{datapoint:at[n].datapoints.points.slice(o*h,(o+1)*h),dataIndex:o,series:at[n],seriesIndex:n}):null}function G(t){rt.grid.hoverable&&Q("plothover",t,function(t){return 0!=t.hoverable})}function _(t){rt.grid.hoverable&&Q("plothover",t,function(t){return!1})}function J(t){Q("plotclick",t,function(t){return 0!=t.clickable})}function Q(t,i,n){var o=ct.offset(),a=i.pageX-o.left-mt.left,r=i.pageY-o.top-mt.top,l=m({left:a,top:r});l.pageX=i.pageX,l.pageY=i.pageY;var s=q(a,r,n);if(s&&(s.pageX=parseInt(s.series.xaxis.p2c(s.datapoint[0])+o.left+mt.left),s.pageY=parseInt(s.series.yaxis.p2c(s.datapoint[1])+o.top+mt.top)),rt.grid.autoHighlight){for(var c=0;c<yt.length;++c){var u=yt[c];u.auto!=t||s&&u.series==s.series&&u.point[0]==s.datapoint[0]&&u.point[1]==s.datapoint[1]||tt(u.series,u.point)}s&&Z(s.series,s.datapoint,t)}e.trigger(t,[l,s])}function $(){Tt||(Tt=setTimeout(K,30))}function K(){Tt=null,ft.save(),ft.clearRect(0,0,pt,xt),ft.translate(mt.left,mt.top);var t,i;for(t=0;t<yt.length;++t)i=yt[t],i.series.bars.show?nt(i.series,i.point):et(i.series,i.point);ft.restore(),l(bt.drawOverlay,[ft])}function Z(t,i,e){if("number"==typeof t&&(t=at[t]),"number"==typeof i){var n=t.datapoints.pointsize;i=t.datapoints.points.slice(n*i,n*(i+1))}var o=it(t,i);-1==o?(yt.push({series:t,point:i,auto:e}),$()):e||(yt[o].auto=!1)}function tt(t,i){null==t&&null==i&&(yt=[],$()),"number"==typeof t&&(t=at[t]),"number"==typeof i&&(i=t.data[i]);var e=it(t,i);-1!=e&&(yt.splice(e,1),$())}function it(t,i){for(var e=0;e<yt.length;++e){var n=yt[e];if(n.series==t&&n.point[0]==i[0]&&n.point[1]==i[1])return e}return-1}function et(i,e){var n=e[0],o=e[1],a=i.xaxis,r=i.yaxis;if(!(n<a.min||n>a.max||o<r.min||o>r.max)){var l=i.points.radius+i.points.lineWidth/2;ft.lineWidth=l,ft.strokeStyle=t.color.parse(i.color).scale("a",.5).toString();var s=1.5*l,n=a.p2c(n),o=r.p2c(o);ft.beginPath(),"circle"==i.points.symbol?ft.arc(n,o,s,0,2*Math.PI,!1):i.points.symbol(ft,n,o,s,!1),ft.closePath(),ft.stroke()}}function nt(i,e){ft.lineWidth=i.bars.lineWidth,ft.strokeStyle=t.color.parse(i.color).scale("a",.5).toString();var n=t.color.parse(i.color).scale("a",.5).toString(),o="left"==i.bars.align?0:-i.bars.barWidth/2;E(e[0],e[1],e[2]||0,o,o+i.bars.barWidth,0,function(){return n},i.xaxis,i.yaxis,ft,i.bars.horizontal,i.bars.lineWidth)}function ot(i,e,n,o){if("string"==typeof i)return i;for(var a=ut.createLinearGradient(0,n,0,e),r=0,l=i.colors.length;l>r;++r){var s=i.colors[r];if("string"!=typeof s){var c=t.color.parse(o);null!=s.brightness&&(c=c.scale("rgb",s.brightness)),null!=s.opacity&&(c.a*=s.opacity),s=c.toString()}a.addColorStop(r/(l-1),s)}return a}var at=[],rt={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85},xaxis:{show:null,position:"bottom",mode:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null,monthNames:null,timeformat:null,twelveHourClock:!1},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1},shadowSize:3},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},hooks:{}},lt=null,st=null,ct=null,ut=null,ft=null,ht=[],dt=[],mt={left:0,right:0,top:0,bottom:0},pt=0,xt=0,gt=0,vt=0,bt={processOptions:[],processRawData:[],processDatapoints:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},kt=this;kt.setData=u,kt.setupGrid=A,kt.draw=D,kt.getPlaceholder=function(){return e},kt.getCanvas=function(){return lt},kt.getPlotOffset=function(){return mt},kt.width=function(){return gt},kt.height=function(){return vt},kt.offset=function(){var t=ct.offset();return t.left+=mt.left,t.top+=mt.top,t},kt.getData=function(){return at},kt.getAxes=function(){var i={};return t.each(ht.concat(dt),function(t,e){e&&(i[e.direction+(1!=e.n?e.n:"")+"axis"]=e)}),i},kt.getXAxes=function(){return ht},kt.getYAxes=function(){return dt},kt.c2p=m,kt.p2c=p,kt.getOptions=function(){return rt},kt.highlight=Z,kt.unhighlight=tt,kt.triggerRedrawOverlay=$,
kt.pointOffset=function(t){return{left:parseInt(ht[h(t,"x")-1].p2c(+t.x)+mt.left),top:parseInt(dt[h(t,"y")-1].p2c(+t.y)+mt.top)}},kt.shutdown=M,kt.resize=function(){k(),y(lt),y(st)},kt.hooks=bt,s(kt),c(a),T(),u(o),A(),D(),w();var yt=[],Tt=null}function n(t,i){return i*Math.floor(t/i)}t.plot=function(i,n,o){var a=new e(t(i),n,o,t.plot.plugins);return a},t.plot.version="0.7",t.plot.plugins=[],t.plot.formatDate=function(t,i,e){var n=function(t){return t=""+t,1==t.length?"0"+t:t},o=[],a=!1,r=!1,l=t.getUTCHours(),s=12>l;null==e&&(e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),-1!=i.search(/%p|%P/)&&(l>12?l-=12:0==l&&(l=12));for(var c=0;c<i.length;++c){var u=i.charAt(c);if(a){switch(u){case"h":u=""+l;break;case"H":u=n(l);break;case"M":u=n(t.getUTCMinutes());break;case"S":u=n(t.getUTCSeconds());break;case"d":u=""+t.getUTCDate();break;case"m":u=""+(t.getUTCMonth()+1);break;case"y":u=""+t.getUTCFullYear();break;case"b":u=""+e[t.getUTCMonth()];break;case"p":u=s?"am":"pm";break;case"P":u=s?"AM":"PM";break;case"0":u="",r=!0}u&&r&&(u=n(u),r=!1),o.push(u),r||(a=!1)}else"%"==u?a=!0:o.push(u)}return o.join("")}}(jQuery);
!function(t){function e(t){return Math.log(t)/Math.LN10}function o(t,o){if(void 0===o&&(o=3),0===t)return 0;if(0>=o)throw new Error("Significant figures must be greater than zero.");o=Math.floor(o+.5);var i=t>=0?"":"-";t=Math.abs(t);var r=Math.floor(e(t))+1;if(r>o)return t=t.toPrecision(o),i+t.replace("+","");if(0>r){var n=t*pow(10,abs(r)+1);return r-=1,i+n.toFixed(o-1)+"e"+r}return i+t.toFixed(o-r)}function i(t){function e(e){r.locked||-1!=r.x&&(r.x=-1,t.triggerRedrawOverlay())}function i(e){if(!r.locked){if(t.getSelection&&t.getSelection())return void(r.x=-1);var o=t.offset();r.x=Math.max(0,Math.min(e.pageX-o.left,t.width())),r.y=Math.max(0,Math.min(e.pageY-o.top,t.height())),t.triggerRedrawOverlay()}}var r={x:-1,y:-1,locked:!1};t.setCrosshair=function(e){if(e){var o=t.p2c(e);r.x=Math.max(0,Math.min(o.left,t.width())),r.y=Math.max(0,Math.min(o.top,t.height()))}else r.x=-1;t.triggerRedrawOverlay()},t.clearCrosshair=t.setCrosshair,t.lockCrosshair=function(e){e&&t.setCrosshair(e),r.locked=!0},t.unlockCrosshair=function(){r.locked=!1},t.hooks.bindEvents.push(function(t,o){t.getOptions().crosshair.mode&&(o.mouseout(e),o.mousemove(i))}),t.hooks.drawOverlay.push(function(t,e){var i=t.getOptions().crosshair;if(i.mode){var n=t.getPlotOffset();if(e.save(),e.translate(n.left,n.top),-1!=r.x){var a=t.c2p({left:r.x,top:r.y});text=o(a.x,3)+","+o(a.y,3);var s=13;e.fillStyle=i.color,e.font=s+"px Verdana";var h=e.measureText(text).width,l=0,f=0;r.y<s+3?(h+=14,f=s,r.x<=t.width()-(h+5)&&(l+=14)):f=-5,r.x>t.width()-(h+5)?(e.textAlign="right",l+=-3):(e.textAlign="left",l+=3),e.fillText(text,r.x+l,r.y+f),e.strokeStyle=i.color,e.lineWidth=i.lineWidth,e.lineJoin="round",e.beginPath(),-1!=i.mode.indexOf("x")&&(e.moveTo(r.x,0),e.lineTo(r.x,t.height())),-1!=i.mode.indexOf("y")&&(e.moveTo(0,r.y),e.lineTo(t.width(),r.y)),e.stroke()}e.restore()}}),t.hooks.shutdown.push(function(t,o){o.unbind("mouseout",e),o.unbind("mousemove",i)})}var r={crosshair:{mode:null,color:"rgba(0, 0, 0, 0.5)",lineWidth:1}};t.plot.plugins.push({init:i,options:r,name:"crosshair_GS",version:"1.0"})}(jQuery);
"undefined"!=typeof Float32Array?glMatrixArrayType=Float32Array:"undefined"!=typeof WebGLFloatArray?glMatrixArrayType=WebGLFloatArray:glMatrixArrayType=Array;var vec3={};vec3.create=function(t){var r=new glMatrixArrayType(3);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),r},vec3.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},vec3.add=function(t,r,n){return n&&t!=n?(n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n):(t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t)},vec3.subtract=function(t,r,n){return n&&t!=n?(n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n):(t[0]-=r[0],t[1]-=r[1],t[2]-=r[2],t)},vec3.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r},vec3.scale=function(t,r,n){return n&&t!=n?(n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n):(t[0]*=r,t[1]*=r,t[2]*=r,t)},vec3.normalize=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=Math.sqrt(n*n+a*a+e*e);return u?1==u?(r[0]=n,r[1]=a,r[2]=e,r):(u=1/u,r[0]=n*u,r[1]=a*u,r[2]=e*u,r):(r[0]=0,r[1]=0,r[2]=0,r)},vec3.cross=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=r[0],i=r[1],o=r[2];return n[0]=e*o-u*i,n[1]=u*c-a*o,n[2]=a*i-e*c,n},vec3.length=function(t){var r=t[0],n=t[1],a=t[2];return Math.sqrt(r*r+n*n+a*a)},vec3.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},vec3.direction=function(t,r,n){n||(n=t);var a=t[0]-r[0],e=t[1]-r[1],u=t[2]-r[2],c=Math.sqrt(a*a+e*e+u*u);return c?(c=1/c,n[0]=a*c,n[1]=e*c,n[2]=u*c,n):(n[0]=0,n[1]=0,n[2]=0,n)},vec3.lerp=function(t,r,n,a){return a||(a=t),a[0]=t[0]+n*(r[0]-t[0]),a[1]=t[1]+n*(r[1]-t[1]),a[2]=t[2]+n*(r[2]-t[2]),a},vec3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"};var mat3={};mat3.create=function(t){var r=new glMatrixArrayType(9);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8]),r},mat3.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},mat3.transpose=function(t,r){if(!r||t==r){var n=t[1],a=t[2],e=t[5];return t[1]=t[3],t[2]=t[6],t[3]=n,t[5]=t[7],t[6]=a,t[7]=e,t}return r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8],r},mat3.toMat4=function(t,r){return r||(r=mat4.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=0,r[4]=t[3],r[5]=t[4],r[6]=t[5],r[7]=0,r[8]=t[6],r[9]=t[7],r[10]=t[8],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},mat3.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"};var mat4={};mat4.create=function(t){var r=new glMatrixArrayType(16);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},mat4.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},mat4.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.transpose=function(t,r){if(!r||t==r){var n=t[1],a=t[2],e=t[3],u=t[6],c=t[7],i=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=n,t[6]=t[9],t[7]=t[13],t[8]=a,t[9]=u,t[11]=t[14],t[12]=e,t[13]=c,t[14]=i,t}return r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15],r},mat4.determinant=function(t){var r=t[0],n=t[1],a=t[2],e=t[3],u=t[4],c=t[5],i=t[6],o=t[7],f=t[8],v=t[9],m=t[10],s=t[11],M=t[12],l=t[13],h=t[14],y=t[15];return M*v*i*e-f*l*i*e-M*c*m*e+u*l*m*e+f*c*h*e-u*v*h*e-M*v*a*o+f*l*a*o+M*n*m*o-r*l*m*o-f*n*h*o+r*v*h*o+M*c*a*s-u*l*a*s-M*n*i*s+r*l*i*s+u*n*h*s-r*c*h*s-f*c*a*y+u*v*a*y+f*n*i*y-r*v*i*y-u*n*m*y+r*c*m*y},mat4.inverse=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=t[3],c=t[4],i=t[5],o=t[6],f=t[7],v=t[8],m=t[9],s=t[10],M=t[11],l=t[12],h=t[13],y=t[14],q=t[15],p=n*i-a*c,A=n*o-e*c,d=n*f-u*c,g=a*o-e*i,b=a*f-u*i,x=e*f-u*o,T=v*h-m*l,w=v*y-s*l,F=v*q-M*l,V=m*y-s*h,W=m*q-M*h,z=s*q-M*y,G=1/(p*z-A*W+d*V+g*F-b*w+x*T);return r[0]=(i*z-o*W+f*V)*G,r[1]=(-a*z+e*W-u*V)*G,r[2]=(h*x-y*b+q*g)*G,r[3]=(-m*x+s*b-M*g)*G,r[4]=(-c*z+o*F-f*w)*G,r[5]=(n*z-e*F+u*w)*G,r[6]=(-l*x+y*d-q*A)*G,r[7]=(v*x-s*d+M*A)*G,r[8]=(c*W-i*F+f*T)*G,r[9]=(-n*W+a*F-u*T)*G,r[10]=(l*b-h*d+q*p)*G,r[11]=(-v*b+m*d-M*p)*G,r[12]=(-c*V+i*w-o*T)*G,r[13]=(n*V-a*w+e*T)*G,r[14]=(-l*g+h*A-y*p)*G,r[15]=(v*g-m*A+s*p)*G,r},mat4.toRotationMat=function(t,r){return r||(r=mat4.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},mat4.toMat3=function(t,r){return r||(r=mat3.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r},mat4.toInverseMat3=function(t,r){var n=t[0],a=t[1],e=t[2],u=t[4],c=t[5],i=t[6],o=t[8],f=t[9],v=t[10],m=v*c-i*f,s=-v*u+i*o,M=f*u-c*o,l=n*m+a*s+e*M;if(!l)return null;var h=1/l;return r||(r=mat3.create()),r[0]=m*h,r[1]=(-v*a+e*f)*h,r[2]=(i*a-e*c)*h,r[3]=s*h,r[4]=(v*n-e*o)*h,r[5]=(-i*n+e*u)*h,r[6]=M*h,r[7]=(-f*n+a*o)*h,r[8]=(c*n-a*u)*h,r},mat4.multiply=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=t[3],i=t[4],o=t[5],f=t[6],v=t[7],m=t[8],s=t[9],M=t[10],l=t[11],h=t[12],y=t[13],q=t[14],p=t[15],A=r[0],d=r[1],g=r[2],b=r[3],x=r[4],T=r[5],w=r[6],F=r[7],V=r[8],W=r[9],z=r[10],G=r[11],I=r[12],L=r[13],k=r[14],P=r[15];return n[0]=A*a+d*i+g*m+b*h,n[1]=A*e+d*o+g*s+b*y,n[2]=A*u+d*f+g*M+b*q,n[3]=A*c+d*v+g*l+b*p,n[4]=x*a+T*i+w*m+F*h,n[5]=x*e+T*o+w*s+F*y,n[6]=x*u+T*f+w*M+F*q,n[7]=x*c+T*v+w*l+F*p,n[8]=V*a+W*i+z*m+G*h,n[9]=V*e+W*o+z*s+G*y,n[10]=V*u+W*f+z*M+G*q,n[11]=V*c+W*v+z*l+G*p,n[12]=I*a+L*i+k*m+P*h,n[13]=I*e+L*o+k*s+P*y,n[14]=I*u+L*f+k*M+P*q,n[15]=I*c+L*v+k*l+P*p,n},mat4.multiplyVec3=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2];return n[0]=t[0]*a+t[4]*e+t[8]*u+t[12],n[1]=t[1]*a+t[5]*e+t[9]*u+t[13],n[2]=t[2]*a+t[6]*e+t[10]*u+t[14],n},mat4.multiplyVec4=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2],c=r[3];return n[0]=t[0]*a+t[4]*e+t[8]*u+t[12]*c,n[1]=t[1]*a+t[5]*e+t[9]*u+t[13]*c,n[2]=t[2]*a+t[6]*e+t[10]*u+t[14]*c,n[3]=t[3]*a+t[7]*e+t[11]*u+t[15]*c,n},mat4.translate=function(t,r,n){var a=r[0],e=r[1],u=r[2];if(!n||t==n)return t[12]=t[0]*a+t[4]*e+t[8]*u+t[12],t[13]=t[1]*a+t[5]*e+t[9]*u+t[13],t[14]=t[2]*a+t[6]*e+t[10]*u+t[14],t[15]=t[3]*a+t[7]*e+t[11]*u+t[15],t;var c=t[0],i=t[1],o=t[2],f=t[3],v=t[4],m=t[5],s=t[6],M=t[7],l=t[8],h=t[9],y=t[10],q=t[11];return n[0]=c,n[1]=i,n[2]=o,n[3]=f,n[4]=v,n[5]=m,n[6]=s,n[7]=M,n[8]=l,n[9]=h,n[10]=y,n[11]=q,n[12]=c*a+v*e+l*u+t[12],n[13]=i*a+m*e+h*u+t[13],n[14]=o*a+s*e+y*u+t[14],n[15]=f*a+M*e+q*u+t[15],n},mat4.scale=function(t,r,n){var a=r[0],e=r[1],u=r[2];return n&&t!=n?(n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*e,n[5]=t[5]*e,n[6]=t[6]*e,n[7]=t[7]*e,n[8]=t[8]*u,n[9]=t[9]*u,n[10]=t[10]*u,n[11]=t[11]*u,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):(t[0]*=a,t[1]*=a,t[2]*=a,t[3]*=a,t[4]*=e,t[5]*=e,t[6]*=e,t[7]*=e,t[8]*=u,t[9]*=u,t[10]*=u,t[11]*=u,t)},mat4.rotate=function(t,r,n,a){var e=n[0],u=n[1],c=n[2],i=Math.sqrt(e*e+u*u+c*c);if(!i)return null;1!=i&&(i=1/i,e*=i,u*=i,c*=i);var o=Math.sin(r),f=Math.cos(r),v=1-f,m=t[0],s=t[1],M=t[2],l=t[3],h=t[4],y=t[5],q=t[6],p=t[7],A=t[8],d=t[9],g=t[10],b=t[11],x=e*e*v+f,T=u*e*v+c*o,w=c*e*v-u*o,F=e*u*v-c*o,V=u*u*v+f,W=c*u*v+e*o,z=e*c*v+u*o,G=u*c*v-e*o,I=c*c*v+f;return a?t!=a&&(a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]):a=t,a[0]=m*x+h*T+A*w,a[1]=s*x+y*T+d*w,a[2]=M*x+q*T+g*w,a[3]=l*x+p*T+b*w,a[4]=m*F+h*V+A*W,a[5]=s*F+y*V+d*W,a[6]=M*F+q*V+g*W,a[7]=l*F+p*V+b*W,a[8]=m*z+h*G+A*I,a[9]=s*z+y*G+d*I,a[10]=M*z+q*G+g*I,a[11]=l*z+p*G+b*I,a},mat4.rotateX=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[4],c=t[5],i=t[6],o=t[7],f=t[8],v=t[9],m=t[10],s=t[11];return n?t!=n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[4]=u*e+f*a,n[5]=c*e+v*a,n[6]=i*e+m*a,n[7]=o*e+s*a,n[8]=u*-a+f*e,n[9]=c*-a+v*e,n[10]=i*-a+m*e,n[11]=o*-a+s*e,n},mat4.rotateY=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[0],c=t[1],i=t[2],o=t[3],f=t[8],v=t[9],m=t[10],s=t[11];return n?t!=n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*e+f*-a,n[1]=c*e+v*-a,n[2]=i*e+m*-a,n[3]=o*e+s*-a,n[8]=u*a+f*e,n[9]=c*a+v*e,n[10]=i*a+m*e,n[11]=o*a+s*e,n},mat4.rotateZ=function(t,r,n){var a=Math.sin(r),e=Math.cos(r),u=t[0],c=t[1],i=t[2],o=t[3],f=t[4],v=t[5],m=t[6],s=t[7];return n?t!=n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*e+f*a,n[1]=c*e+v*a,n[2]=i*e+m*a,n[3]=o*e+s*a,n[4]=u*-a+f*e,n[5]=c*-a+v*e,n[6]=i*-a+m*e,n[7]=o*-a+s*e,n},mat4.frustum=function(t,r,n,a,e,u,c){c||(c=mat4.create());var i=r-t,o=a-n,f=u-e;return c[0]=2*e/i,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2*e/o,c[6]=0,c[7]=0,c[8]=(r+t)/i,c[9]=(a+n)/o,c[10]=-(u+e)/f,c[11]=-1,c[12]=0,c[13]=0,c[14]=-(u*e*2)/f,c[15]=0,c},mat4.perspective=function(t,r,n,a,e){var u=n*Math.tan(t*Math.PI/360),c=u*r;return mat4.frustum(-c,c,-u,u,n,a,e)},mat4.ortho=function(t,r,n,a,e,u,c){c||(c=mat4.create());var i=r-t,o=a-n,f=u-e;return c[0]=2/i,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=2/o,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=-2/f,c[11]=0,c[12]=-(t+r)/i,c[13]=-(a+n)/o,c[14]=-(u+e)/f,c[15]=1,c},mat4.lookAt=function(t,r,n,a){a||(a=mat4.create());var e=t[0],u=t[1],c=t[2],i=n[0],o=n[1],f=n[2],v=r[0],m=r[1],s=r[2];if(e==v&&u==m&&c==s)return mat4.identity(a);var M,l,h,y,q,p,A,d,g,b;return M=e-r[0],l=u-r[1],h=c-r[2],b=1/Math.sqrt(M*M+l*l+h*h),M*=b,l*=b,h*=b,y=o*h-f*l,q=f*M-i*h,p=i*l-o*M,b=Math.sqrt(y*y+q*q+p*p),b?(b=1/b,y*=b,q*=b,p*=b):(y=0,q=0,p=0),A=l*p-h*q,d=h*y-M*p,g=M*q-l*y,b=Math.sqrt(A*A+d*d+g*g),b?(b=1/b,A*=b,d*=b,g*=b):(A=0,d=0,g=0),a[0]=y,a[1]=A,a[2]=M,a[3]=0,a[4]=q,a[5]=d,a[6]=l,a[7]=0,a[8]=p,a[9]=g,a[10]=h,a[11]=0,a[12]=-(y*e+q*u+p*c),a[13]=-(A*e+d*u+g*c),a[14]=-(M*e+l*u+h*c),a[15]=1,a},mat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"},quat4={},quat4.create=function(t){var r=new glMatrixArrayType(4);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]),r},quat4.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},quat4.calculateW=function(t,r){var n=t[0],a=t[1],e=t[2];return r&&t!=r?(r[0]=n,r[1]=a,r[2]=e,r[3]=-Math.sqrt(Math.abs(1-n*n-a*a-e*e)),r):(t[3]=-Math.sqrt(Math.abs(1-n*n-a*a-e*e)),t)},quat4.inverse=function(t,r){return r&&t!=r?(r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},quat4.length=function(t){var r=t[0],n=t[1],a=t[2],e=t[3];return Math.sqrt(r*r+n*n+a*a+e*e)},quat4.normalize=function(t,r){r||(r=t);var n=t[0],a=t[1],e=t[2],u=t[3],c=Math.sqrt(n*n+a*a+e*e+u*u);return 0==c?(r[0]=0,r[1]=0,r[2]=0,r[3]=0,r):(c=1/c,r[0]=n*c,r[1]=a*c,r[2]=e*c,r[3]=u*c,r)},quat4.multiply=function(t,r,n){n||(n=t);var a=t[0],e=t[1],u=t[2],c=t[3],i=r[0],o=r[1],f=r[2],v=r[3];return n[0]=a*v+c*i+e*f-u*o,n[1]=e*v+c*o+u*i-a*f,n[2]=u*v+c*f+a*o-e*i,n[3]=c*v-a*i-e*o-u*f,n},quat4.multiplyVec3=function(t,r,n){n||(n=r);var a=r[0],e=r[1],u=r[2],c=t[0],i=t[1],o=t[2],f=t[3],v=f*a+i*u-o*e,m=f*e+o*a-c*u,s=f*u+c*e-i*a,M=-c*a-i*e-o*u;return n[0]=v*f+M*-c+m*-o-s*-i,n[1]=m*f+M*-i+s*-c-v*-o,n[2]=s*f+M*-o+v*-i-m*-c,n},quat4.toMat3=function(t,r){r||(r=mat3.create());var n=t[0],a=t[1],e=t[2],u=t[3],c=n+n,i=a+a,o=e+e,f=n*c,v=n*i,m=n*o,s=a*i,M=a*o,l=e*o,h=u*c,y=u*i,q=u*o;return r[0]=1-(s+l),r[1]=v-q,r[2]=m+y,r[3]=v+q,r[4]=1-(f+l),r[5]=M-h,r[6]=m-y,r[7]=M+h,r[8]=1-(f+s),r},quat4.toMat4=function(t,r){r||(r=mat4.create());var n=t[0],a=t[1],e=t[2],u=t[3],c=n+n,i=a+a,o=e+e,f=n*c,v=n*i,m=n*o,s=a*i,M=a*o,l=e*o,h=u*c,y=u*i,q=u*o;return r[0]=1-(s+l),r[1]=v-q,r[2]=m+y,r[3]=0,r[4]=v+q,r[5]=1-(f+l),r[6]=M-h,r[7]=0,r[8]=m-y,r[9]=M+h,r[10]=1-(f+s),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},quat4.slerp=function(t,r,n,a){a||(a=t);var e=t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3];if(Math.abs(e)>=1)return a!=t&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3]),a;var u=Math.acos(e),c=Math.sqrt(1-e*e);if(Math.abs(c)<.001)return a[0]=.5*t[0]+.5*r[0],a[1]=.5*t[1]+.5*r[1],a[2]=.5*t[2]+.5*r[2],a[3]=.5*t[3]+.5*r[3],a;var i=Math.sin((1-n)*u)/c,o=Math.sin(n*u)/c;return a[0]=t[0]*i+r[0]*o,a[1]=t[1]*i+r[1]*o,a[2]=t[2]*i+r[2]*o,a[3]=t[3]*i+r[3]*o,a},quat4.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};
WebGLUtils=function(){var e=function(e){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+e+"</div></div></td></tr></table>"},t='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org" target="_blank">Click here to upgrade your browser.</a>',r='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/" target="_blank">Click here for more information.</a>',n=function(n,o){function a(t){var r=n.parentNode;r&&(r.innerHTML=e(t))}if(!window.WebGLRenderingContext)return a(t),null;var u=i(n,o);return u||a(r),u},i=function(e,t){for(var r=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,i=0;i<r.length;++i){try{n=e.getContext(r[i],t)}catch(o){}if(n)break}return n};return{create3DContext:i,setupWebGL:n}}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}();
!function(){"use strict";function e(e){for(var r in e)t[r]=e[r],n[r]=e[r]}var t={version:"1.2dev"},r={declare:function(e,t){$.each(t,function(t,n){function c(){throw new Error("Property '"+t+"' is read-only.")}(null===n||void 0===n.value&&!n.get)&&(n={value:n}),n.name=t;var o=n.internal||"__"===t.substr(0,2);if(void 0===n.enumerable&&(n.enumerable=!o),void 0===n.type&&!n.get&&!o){var i=typeof n.value;"number"===i?n.type=r.check_number:"string"===i?n.type=r.check_string:n.value instanceof attributeVector?n.type=r.check_attributeVector:n.value instanceof attributeVectorPos?n.type=r.check_attributeVectorPos:n.value instanceof attributeVectorAxis?n.type=r.check_attributeVectorAxis:n.value instanceof attributeVectorSize?n.type=r.check_attributeVectorSize:n.value instanceof vec&&(n.type=r.check_vec)}if(n.readonly&&n.set||n.onchanged&&n.set||void 0!==n.value&&n.get)throw new Error("Erroneous property definition '"+t+"'.");if(n.get)Object.defineProperty(e,t,{enumerable:n.enumerable,get:n.get,set:n.set||c});else if(n.type||n.onchanged){var o="__"+t,a={enumerable:n.enumerable,get:function(){return this[o]}};n.set?a.set=n.set:n.onchanged&&n.type?a.set=function(e){var t=this[o];this[o]=n.type.call(this,e,n),n.onchanged.call(this,t)}:n.onchanged?a.set=function(e){var t=this[o];this[o]=e,n.onchanged.call(this,t)}:n.type&&(a.set=function(e){this[o]=n.type.call(this,e,n)}),Object.defineProperty(e,o,{enumerable:!1,writable:!0,value:n.value}),Object.defineProperty(e,t,a)}else Object.defineProperty(e,t,{enumerable:n.enumerable,writable:!n.readonly,value:n.value})})},nullable_attributeVector:function(e,t){return null===e?null:r.check_attributeVector.call(this,e,t)},check_attributeVector:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVector(this,e.x,e.y,e.z)},check_attributeVectorPos:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVectorPos(this,e.x,e.y,e.z)},check_attributeVectorAxis:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVectorAxis(this,e.x,e.y,e.z)},check_attributeVectorSize:function(e,t){if(!(e instanceof vec))throw new Error("Property '"+t.name+"' must be a vector.");return new attributeVectorSize(this,e.x,e.y,e.z)},check_vec:function(e,t){if(!e instanceof vec)throw new Error("Property '"+t.name+"' must be a vector.");return e},check_number:function(e,t){return e},check_string:function(e,t){return e}},n=window,c={glowscript:t,property:r,Export:e};e(c)}();
!function(){"use strict";function t(e,r,n){if(!(this instanceof t))return void 0===r&&void 0===n?new t(e.x,e.y,e.z):new t(e,r,n);if(void 0===n||void 0===r)throw new Error("vector() requires 3 arguments: x, y, and z.");this.x=e,this.y=r,this.z=n}function e(t,e,r,n){this.__parent=t,this.__x=e,this.__y=r,this.__z=n,t&&t.__change()}function r(e,r,n,i){this.__parent=e,this.__x=r,this.__y=n,this.__z=i,e&&(e.__change(),e.__make_trail&&e.__update_trail(t(r,n,i)))}function n(t,e,r,n){this.__parent=t,this.__x=e,this.__y=r,this.__z=n,t&&(t.__size.__x=Math.sqrt(e*e+r*r+n*n),t.__change())}function i(t,e,r,n){if(this.__parent=t,this.__x=e,this.__y=r,this.__z=n,t){if(0!==e){var i=t.__axis.norm().multiply(e);t.__axis.__x=i.x,t.__axis.__y=i.y,t.__axis.__z=i.z}t.__change()}}e.prototype=new t(0,0,0),e.prototype.constructor=e,r.prototype=new t(0,0,0),r.prototype.constructor=r,n.prototype=new t(1,0,0),n.prototype.constructor=n,i.prototype=new t(1,1,1),i.prototype.constructor=i,Object.defineProperty(e.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(e.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(t){this.__x=t,this.__parent.__change()}}),Object.defineProperty(e.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(e.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(t){this.__y=t,this.__parent.__change()}}),Object.defineProperty(e.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(e.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(t){this.__z=t,this.__parent.__change()}}),Object.defineProperty(r.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(r.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(e){this.__x=e,this.__parent.__change(),this.__parent.__make_trail&&this.__parent.__update_trail(t(this.__x,this.__y,this.__z))}}),Object.defineProperty(r.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(r.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(e){this.__y=e,this.__parent.__change(),this.__parent.__make_trail&&this.__parent.__update_trail(t(this.__x,this.__y,this.__z))}}),Object.defineProperty(r.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(r.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(e){this.__z=e,this.__parent.__change(),this.__parent.__make_trail&&this.__parent.__update_trail(t(this.__x,this.__y,this.__z))}}),Object.defineProperty(n.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(n.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(t){this.__x=this.__parent.__axis.__x=t,this.__parent.__size.x=this.mag(),this.__parent.__change()}}),Object.defineProperty(n.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(n.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(t){this.__y=this.__parent.__axis.__y=t,this.__parent.__size.x=this.mag(),this.__parent.__change()}}),Object.defineProperty(n.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(n.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(t){this.__z=this.__parent.__axis.__z=t,this.__parent.__size.x=this.mag(),this.__parent.__change()}}),Object.defineProperty(i.prototype,"__x",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(i.prototype,"x",{enumerable:!0,get:function(){return this.__x},set:function(t){this.__x=t;var e=this.__parent.__axis.norm().multiply(t);this.__parent.__axis.__x=e.x,this.__parent.__axis.__y=e.y,this.__parent.__axis.__z=e.z,this.__parent.__change()}}),Object.defineProperty(i.prototype,"__y",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(i.prototype,"y",{enumerable:!0,get:function(){return this.__y},set:function(t){this.__y=t,this.__parent.__change()}}),Object.defineProperty(i.prototype,"__z",{enumerable:!1,writable:!0,value:0}),Object.defineProperty(i.prototype,"z",{enumerable:!0,get:function(){return this.__z},set:function(t){this.__z=t,this.__parent.__change()}}),t.prototype.toString=function(){for(var t,e,r,n,i=[this.x,this.y,this.z],o=[],_=0;3>_;_++){var t=i[_];if(0!=t)if(t=Math.abs(t)<1e-4?t.toExponential(5):t.toPrecision(6),e=t.indexOf("."),e>=0){for(n=t.indexOf("e"),0>n&&(n=t.length),r=n;;)if(r--,"0"!=t.charAt(r)){if(r==e){o.push(t.slice(0,e).concat(t.slice(n,t.length)));break}n==t.length?o.push(t.slice(0,r+1)):o.push(t.slice(0,r+1).concat(t.slice(n,t.length)));break}}else o.push(t);else o.push("0")}return"< "+o[0]+", "+o[1]+", "+o[2]+" >"},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.multiply=function(e){return new t(this.x*e,this.y*e,this.z*e)},t.prototype.divide=function(e){return new t(this.x/e,this.y/e,this.z/e)},t.prototype.mag=function(t){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.prototype.mag2=function(t){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.norm=function(){var e=this.mag();return 0==e?new t(0,0,0):new t(this.x/e,this.y/e,this.z/e)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.equals=function(t){return null===t?!1:this.x==t.x&&this.y==t.y&&this.z==t.z},t.prototype.proj=function(t){var e=norm(t);return e.multiply(this.dot(e))},t.prototype.comp=function(t){return this.dot(norm(t))},t.prototype.cross=function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},t.prototype.diff_angle=function(t){var e=this.norm().dot(t.norm());return e>1?0:-1>e?Math.PI:Math.acos(e)},t.prototype.rotate=function(e){var r,n;if(1==arguments.length?null!==e&&void 0!==e&&("number"==typeof e?r=e:(r=e.angle,n=e.axis)):2==arguments.length&&(r=arguments[0],n=arguments[1]),void 0===r)throw new Error("To rotate a vector you must specify an angle.");void 0===n&&(n=new t(0,0,1));var i=this.diff_angle(n);if(0==i)return new t(this.x,this.y,this.z);var n=n.norm(),o=n.multiply(n.dot(this)),_=n.cross(this),s=_.mag();_=_.norm();var p=_.cross(n),a=p.multiply(s*Math.cos(r)).add(_.multiply(s*Math.sin(r)));return o.add(a)},t.random=function(){return new t(-1+2*Math.random(),-1+2*Math.random(),-1+2*Math.random())},String.prototype["+"]=function(t){return this+t},Number.prototype["+"]=function(t){return this+t},Number.prototype["-"]=function(t){return this-t},Number.prototype["*"]=function(e){return e instanceof t?e.multiply(this):e*this},Number.prototype["/"]=function(t){return this/t},Number.prototype["-u"]=function(){return-this},t.prototype["+"]=t.prototype.add,t.prototype["-"]=t.prototype.sub,t.prototype["*"]=t.prototype.multiply,t.prototype["/"]=function(t){return this.divide(t)},t.prototype["-u"]=function(){return new t(-this.x,-this.y,-this.z)};var o={vec:t,attributeVector:e,attributeVectorPos:r,attributeVectorAxis:n,attributeVectorSize:i};Export(o)}(),function(){"use strict";function t(t){return t.mag()}function e(t){return t.mag2()}function r(t){return t.norm()}function n(t,e){return t.dot(e)}function i(t,e){return t.cross(e)}function o(t,e){return t.comp(e)}function _(t,e){return t.diff_angle(e)}function s(t){var e,r,n=arguments[0];if(2==arguments.length){var t=arguments[1];null!==t&&void 0!==t&&("number"==typeof t?e=t:(e=t.angle,r=t.axis))}else 3==arguments.length&&(e=arguments[1],r=arguments[2]);if(void 0===e)throw new Error("To rotate a vector you must specify an angle.");return void 0===r&&(r=new vec(0,0,1)),n.rotate({angle:e,axis:r})}var p={mag:t,mag2:e,norm:r,dot:n,cross:i,comp:o,diff_angle:_,rotate:s};Export(p)}();
!function(){"use strict";function s(){this.pos=[],this.normal=[],this.color=[],this.opacity=[],this.shininess=[],this.emissive=[],this.texpos=[],this.bumpaxis=[],this.index=[],this.model_transparent=!1}$.extend(s.prototype,{merge:function(s,p,h){var o=null,i=null,u=null,n=null,t=null,e=null,a=this.pos.length/3;if(p instanceof vertex)0>h?this.index.push(a+h):((null===o||p.__pos.x<o)&&(o=p.__pos.x),(null===i||p.__pos.x>i)&&(i=p.__pos.x),(null===u||p.__pos.y<u)&&(u=p.__pos.y),(null===n||p.__pos.y>n)&&(n=p.__pos.y),(null===t||p.__pos.z<t)&&(t=p.__pos.z),(null===e||p.__pos.z>e)&&(e=p.__pos.z),this.pos.push(p.__pos.x,p.__pos.y,p.__pos.z),this.normal.push(p.__normal.x,p.__normal.y,p.__normal.z),this.color.push(p.__color.x,p.__color.y,p.__color.z),p.__opacity<1&&(this.model_transparent=!0),this.opacity.push(p.__opacity),this.shininess.push(p.__shininess),this.emissive.push(p.__emissive),this.texpos.push(p.__texpos.x,p.__texpos.y),this.bumpaxis.push(p.__bumpaxis.x,p.__bumpaxis.y,p.__bumpaxis.z),this.index.push(a));else{for(var r=[p.__color.x,p.__color.y,p.__color.z],l=0;l<s.pos.length;l++)l%3===0?((null===o||s.pos[l]<o)&&(o=s.pos[l]),(null===i||s.pos[l]>i)&&(i=s.pos[l])):l%3===1?((null===u||s.pos[l]<u)&&(u=s.pos[l]),(null===n||s.pos[l]>n)&&(n=s.pos[l])):l%3===2&&((null===t||s.pos[l]<t)&&(t=s.pos[l]),(null===e||s.pos[l]>e)&&(e=s.pos[l])),this.pos.push(s.pos[l]);for(var l=0;l<s.normal.length;l++)this.normal.push(s.normal[l]);for(var l=0;l<s.color.length;l++)this.color.push(r[l%3]*s.color[l]);for(var l=0;l<s.opacity.length;l++){var m=p.__opacity*s.opacity[l];1>m&&(this.model_transparent=!0),this.opacity.push(m)}for(var l=0;l<s.shininess.length;l++){var x=p.__shininess*s.shininess[l];this.shininess.push(x)}for(var l=0;l<s.emissive.length;l++){var _=p.__emissive||s.emissive[l]?1:0;this.emissive.push(_)}for(var l=0;l<s.texpos.length;l++)this.texpos.push(s.texpos[l]);for(var l=0;l<s.bumpaxis.length;l++)this.bumpaxis.push(s.bumpaxis[l]);for(var l=0;l<s.index.length;l++)this.index.push(a+s.index[l])}return{__xmin:o,__ymin:u,__zmin:t,__xmax:i,__ymax:n,__zmax:e}},transformed:function(p){var h=mat3.toMat4(mat3.transpose(mat4.toInverseMat3(p))),o=new s;o.index=this.index,o.color=this.color,o.opacity=this.opacity,o.shininess=this.shininess,o.emissive=this.emissive,o.texpos=this.texpos;for(var i=0;i<this.pos.length;i+=3){var u=[this.pos[i],this.pos[i+1],this.pos[i+2]],n=[this.normal[i],this.normal[i+1],this.normal[i+2],0],t=[this.bumpaxis[i],this.bumpaxis[i+1],this.bumpaxis[i+2]];mat4.multiplyVec3(p,u),mat4.multiplyVec4(h,n),mat4.multiplyVec3(p,t),o.pos.push(u[0],u[1],u[2]),o.normal.push(n[0],n[1],n[2]),o.bumpaxis.push(t[0],t[1],t[2])}return o}}),$.extend(s,{makeCube:function(){var p=new s,h=.5;return p.pos.push(+h,+h,+h,+h,-h,+h,+h,-h,-h,+h,+h,-h,-h,+h,-h,-h,-h,-h,-h,-h,+h,-h,+h,+h,-h,-h,+h,-h,-h,-h,+h,-h,-h,+h,-h,+h,-h,+h,-h,-h,+h,+h,+h,+h,+h,+h,+h,-h,-h,+h,+h,-h,-h,+h,+h,-h,+h,+h,+h,+h,+h,+h,-h,+h,-h,-h,-h,-h,-h,-h,+h,-h),p.normal.push(1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1),p.color.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.opacity.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.shininess.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.emissive.push(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),p.texpos.push(0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1),p.bumpaxis.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0),p.index.push(0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23),p},makeQuad:function(){var p=new s;return p.pos.push(-1,-1,0,1,-1,0,1,1,0,-1,1,0),p.normal.push(0,0,1,0,0,1,0,0,1,0,0,1),p.color.push(1,1,1,1,1,1,1,1,1,1,1,1),p.opacity.push(1,1,1,1),p.shininess.push(1,1,1,1),p.emissive.push(0,0,0,0),p.texpos.push(0,0,1,0,1,1,0,1),p.bumpaxis.push(1,0,0,1,0,0,1,0,0,1,0,0),p.index.push(0,1,2,0,2,3),p},makeCylinder:function(p){var h,o,i=50,u=2*Math.PI/i,n=Math.sin(u),t=Math.cos(u),e=0,a=-p,r=new s;r.pos.push(0,0,0,1,0,0),r.normal.push(-1,0,0,1,0,0),r.color.push(1,1,1,1,1,1),r.opacity.push(1,1),r.shininess.push(1,1),r.emissive.push(0,0),r.texpos.push(.5,.5,.5,.5),r.bumpaxis.push(0,0,-1,0,0,-1);for(var l=4*i,m=2;2+4*i>=m;m+=4)r.pos.push(0,e,a,0,e,a,1,e,a,1,e,a),r.normal.push(-1,0,0,0,e,a,0,e,a,1,0,0),r.color.push(1,1,1,1,1,1,1,1,1,1,1,1),r.opacity.push(1,1,1,1),r.shininess.push(1,1,1,1),r.emissive.push(0,0,0,0),r.texpos.push(.5*(1+a/p),.5+.5*e/p,1-(m-2)/i/4,0,.5*(1-a/p),.5+.5*e/p,1-(m-2)/i/4,1),r.bumpaxis.push(1,0,0,1,0,0,1,0,0,1,0,0),m!=2+4*i&&r.index.push(0,(m-2)%l+2,(m+4-2)%l+2,m+1,(m+2-2)%l+2,(m+6-2)%l+2,m+1,(m+6-2)%l+2,(m+5-2)%l+2,1,(m+7-2)%l+2,(m+3-2)%l+2),h=e*t+a*n,o=a*t-e*n,e=h,a=o;return r},makeRing:function(p,h){for(var o,i,u=64,n=2*Math.PI/u,t=Math.sin(n),e=Math.cos(n),a=20,r=2*Math.PI/a,l=Math.sin(r),m=Math.cos(r),x=0,_=h,c=[],v=0;a>v;v++)c.push(vec(x,0,_-h)),o=x*m+_*l,i=_*m-x*l,x=o,_=i;for(var y,i,f=new s,M=0,_=p+h,d=[],b=[],v=0;u>v;v++){for(var z=vec(0,M,_),g=0;a>g;g++)d.push(c[g]),b.push(z);y=M*e+_*t,i=_*e-M*t,M=y,_=i}for(var v=0;u>v;v++)for(var g=0;a>g;g++){var I=(g+1)%a,P=(v+1)%u,k=d[v*a+g];f.pos.push(k.x,k.y,k.z),k=b[v*a+g],f.normal.push(k.x,k.y,k.z),f.color.push(1,1,1),f.opacity.push(1),f.shininess.push(1),f.emissive.push(0),f.texpos.push(g/a,v/u),k=d[v*a+I].sub(d[v*a+g]),f.bumpaxis.push(k.x,k.y,k.z),f.index.push(a*v+g,a*P+g,a*P+I,a*v+g,a*P+I,a*v+I)}return f},makeRing_compound:function(p){for(var h,o,i=p.x/2,u=(p.y/2-i,64),n=2*Math.PI/u,t=Math.sin(n),e=Math.cos(n),a=20,r=2*Math.PI/a,l=Math.sin(r),m=Math.cos(r),x=0,_=i,c=[],v=0;a>v;v++)c.push(vec(x,0,_-i)),h=x*m+_*l,o=_*m-x*l,x=h,_=o;for(var y,o,f=0,_=.5,M=[],d=[],v=0;u>v;v++){for(var b=vec(0,f*p.y,_*p.z),z=vec(0,f,_).norm(),g=b.sub(z.multiply(i)),I=0;a>I;I++){var P=c[I].x,k=c[I].z,w=vec(P,0,0).add(z.multiply(k)).add(b);M.push(w),d.push(w.sub(g).norm())}y=f*e+_*t,o=_*e-f*t,f=y,_=o}for(var C=new s,v=0;u>v;v++)for(var I=0;a>I;I++){var S=(I+1)%a,V=(v+1)%u,q=M[v*a+I];C.pos.push(q.x,q.y,q.z),q=d[v*a+I],C.normal.push(q.x,q.y,q.z),C.color.push(1,1,1),C.opacity.push(1),C.shininess.push(1),C.emissive.push(0),C.texpos.push(I/a,v/u),q=M[v*a+S].sub(M[v*a+I]),C.bumpaxis.push(q.x,q.y,q.z),C.index.push(a*v+I,a*V+I,a*V+S,a*v+I,a*V+S,a*v+S)}return C},makeSphere:function(p,h,o){var i=h,u=h,n=u,t=Math.PI/i,e=2*Math.PI/u,a=Math.sin(t),r=Math.cos(t),l=Math.sin(e),m=Math.cos(e),n=u;o&&(i=h/2,u=4,n=u+1,t=Math.PI/i,a=-Math.sin(t),r=Math.cos(t),e=Math.PI/u,l=Math.sin(e),m=Math.cos(e));var x,_,c,v,y,f,M,d,b,z,g,I,P=new s;for(x=0,c=p,y=0,g=0;i+1>g;g++){for(_=0,v=c*r+y*a,z=f=y*r-c*a,I=0;u+1>I&&(P.pos.push(x,c,y),P.normal.push(x/p,c/p,y/p),P.color.push(1,1,1),P.opacity.push(1),P.shininess.push(1),P.emissive.push(0),P.texpos.push(I/u,1-g/i),P.bumpaxis.push(y/p,0,-x/p),M=x*m+y*l,d=y*m-x*l,x=M,y=d,!(o&&I>=u));I++)b=g*n,u>I?P.index.push(b+I,b+I+n,b+I+n+1,b+I,b+I+n+1,b+I+1):P.index.push(b+I,b+I+n,b+0+n,b+I,b+0+n,b+0);if(x=0,c=v,y=z,g==i)for(y=0,I=0;u>I;I+=1)P.pos.push(0,-p,0),P.normal.push(-1,0,0),P.color.push(1,1,1),P.opacity.push(1),P.shininess.push(1),P.emissive.push(0),P.texpos.push(I/u,0),P.bumpaxis.push(y/p,0,-x/p),M=x*m+y*l,d=y*m-x*l,x=M,y=d}return P},makeCone:function(p){var h=200,o=new s;o.pos.push(0,0,0),o.normal.push(-1,0,0),o.color.push(1,1,1),o.opacity.push(1),o.shininess.push(1),o.emissive.push(0),o.texpos.push(.5,.5),o.bumpaxis.push(0,0,1);for(var i,u,n=2*Math.PI/h,t=Math.sin(n),e=Math.cos(n),a=1/(p*Math.sqrt(5)),r=0,l=-p,m=1;1+3*h>=m;m+=3)i=r*e+l*t,u=l*e-r*t,o.pos.push(0,r,l,0,r,l,1,0,0),o.normal.push(-1,0,0,a*p,2*a*r,2*a*l,a*p,2*a*(r+i)/2,2*a*(l+u)/2),o.color.push(1,1,1,1,1,1,1,1,1),o.opacity.push(1,1,1),o.shininess.push(1,1,1),o.emissive.push(0,0,0),o.texpos.push(.5*(1+l/p),.5*(1+r/p),1-(m-1)/h/3,0,1-(m-1)/h/3,1),o.bumpaxis.push(0,0,1,0,0,1,0,-l,r),m!=1+3*h&&o.index.push(0,m,m+3,m+1,m+2,m+4),r=i,l=u;return o},makePyramid:function(){var p=new s,h=1/Math.sqrt(5);return p.pos.push(0,.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,1,0,0,0,-.5,-.5,0,.5,-.5,1,0,0,0,-.5,.5,0,-.5,-.5,1,0,0,0,.5,.5,0,-.5,.5,1,0,0),p.normal.push(-1,0,0,-1,0,0,-1,0,0,-1,0,0,h,2*h,0,h,2*h,0,h,2*h,0,h,0,-2*h,h,0,-2*h,h,0,-2*h,h,-2*h,0,h,-2*h,0,h,-2*h,0,h,0,2*h,h,0,2*h,h,0,2*h),p.color.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.opacity.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.shininess.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),p.emissive.push(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),p.texpos.push(1,1,0,1,0,0,1,0,0,0,.25,0,.125,1,1,0,.75,0,.875,1,.5,0,.75,0,.625,1,.25,0,.5,0,.375,1),p.bumpaxis.push(0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0),p.index.push(0,1,2,0,2,3,4,5,6,7,8,9,10,11,12,13,14,15),p},makeCurveSegment:function(p){for(var h,o,i=16,u=2*Math.PI/i,n=Math.sin(u),t=Math.cos(u),e=0,a=-p,r=new s,l=0;2*i>=l;l+=2)r.pos.push(0,e,a,0,0,e,a,1),r.normal.push(0,e,a,0,e,a),r.color.push(1,1,1,1,1,1),r.opacity.push(1,1),r.shininess.push(1,1),r.emissive.push(0,0),r.texpos.push(0,0,0,0),r.bumpaxis.push(0,0,0,0,0,0),l!=2*i&&r.index.push(l,l+2,l+1,l+1,l+2,l+3),h=e*t+a*n,o=a*t-e*n,e=h,a=o;for(var m=r.pos.length/4,x=s.makeSphere(p,i,!0),_=x.pos.length,l=0;_>l;l++)r.pos.push(x.pos[3*l],x.pos[3*l+1],x.pos[3*l+2],1),r.normal.push(x.normal[3*l],x.normal[3*l+1],x.normal[3*l+2]),r.color.push(1,1,1),r.opacity.push(1),r.shininess.push(1),r.emissive.push(0),r.texpos.push(x.texpos[2*l],x.texpos[2*l+1]),r.bumpaxis.push(x.bumpaxis[3*l],x.bumpaxis[3*l+1],x.bumpaxis[3*l+2]);for(var l=0;l<x.index.length;l++)r.index.push(x.index[l]+m);return r}});var p={Mesh:s};Export(p)}();
!function(){"use strict";function t(i){if(!(this instanceof t))return new t(i);i||(i={}),t.all.push(this),t.selected=this,this.__titlediv=$("<div/>"),this.__captiondiv=$("<div/>"),this.__titletext=null,this.__captiontext=null,"title"in i&&(this.__titletext=i.title,delete i.title),"caption"in i&&(this.__captiontext=i.caption,delete i.caption),this.__lastcenter=vec(0,0,0);for(var s in i)this[s]=i[s];this.events=$("<div/>"),this.wrapper=$("<div/>"),this.menu=$("<div/>"),this.__canvas_element=document.createElement("canvas"),this.__overlay_element=document.createElement("canvas"),this.elements=$([this.__canvas_element,this.__overlay_element]),this.__overlay_objects={objects:[],__changed:!1},this.__visiblePrimitives={},this.lights=[{direction:vec(.21821789,.4364357,.8728715),color:vec(.8,.8,.8)},{direction:vec(-.872872,-.218218,-.436436),color:vec(.3,.3,.3)}],this.trails=[],this.arrows=[],this.__points_objects=[],this.__opaque_objects={},this.__transparent_objects={},this.vertex_id=1;var n=100;this.__vertices={Nalloc:n,pos:new Float32Array(3*n),normal:new Float32Array(3*n),color:new Float32Array(3*n),opacity:new Float32Array(n),shininess:new Float32Array(n),emissive:new Float32Array(n),texpos:new Float32Array(2*n),bumpaxis:new Float32Array(3*n),index:new Uint16Array(n),model_transparent:!1,object_info:{},available:[]},this.__vertices.normal[2]=1,this.__sort_objects={opaque:{plain:{},textures:{},bumpmaps:{},textures_and_bumpmaps:{}},transparent:{plain:{},textures:{},bumpmaps:{},textures_and_bumpmaps:{}}},this.camera=orbital_camera(this),this.mouse=new e(this),this.__range=10,this.__autoscale=!0,this.textures={},this.textures_requested={},this.__changed={},this.__vertex_changed={},this.visible=!0,this.waitfor_textures=!1,this.__waitfor="",this.__expecting_key=!1}function e(t){this.canvas=t}var i=["","","","","","","","","backspace","tab","","","","\n","","","shift","ctrl","alt","","caps lock","","","","","","","esc","","","",""," ","pageup","pagedown","end","home","left","up","right","down","","","",",","insert","delete","/","0","1","2","3","4","5","6","7","8","9","",";","","=","","","","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","[","\\","]","","","`","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","delete"];i[187]="=",i[189]="-",i[192]="`",i[219]="[",i[220]="\\",i[221]="]",i[186]=";",i[222]="'",i[188]=",",i[190]=".",i[191]="/";var s=["","","","","","","","","backspace","tab","","","","\n","","","shift","ctrl","alt","break","caps lock","","","","","","","esc","","","","","","!",'"',"//","$","%","&",'"',"(",")","*","+","<","_",">","?",")","!","@","#","$","%","^","&","*","(",":",":","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","^","_","~","","","","","","","","","","*","+","","","","","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","","{","|","}","~","delete"];s[187]="+",s[189]="_",s[192]="~",s[219]="{",s[220]="|",s[221]="}",s[186]=":",s[222]='"',s[188]="<",s[190]=">",s[191]="?";var n=!1;property.declare(t.prototype,{__activate:function(){this.__activated=!0,this.__activate=function(){};var e=t.container;this.__titlediv.css("white-space","pre").appendTo(e),this.menu.css("white-space","pre").appendTo(e),this.wrapper.addClass("glowscript-canvas-wrapper").appendTo(e),this.__captiondiv.css("white-space","pre").appendTo(e),this.wrapper.css("position","relative");var i=this.__canvas_element;i.style.position="absolute";var s=this.__overlay_element;s.style.position="relative",s.style.backgroundColor="transparent",this.__canvas_element.setAttribute("width",this.width),this.__overlay_element.setAttribute("width",this.width),this.__canvas_element.setAttribute("height",this.height),this.__overlay_element.setAttribute("height",this.height),this.wrapper.append(i),this.wrapper.append(s),$(this.wrapper).resizable(),$(this.wrapper).on("resize",{"this":this},function(t,e){t.data["this"].width=e.size.width,t.data["this"].height=e.size.height}),this.resizable||$(this.wrapper).resizable("disable"),this.__renderer=new WebGLRenderer(this,i,s),this.camera.__activate&&this.camera.__activate(),this.__handleEvents(),this.__titletext&&this.__titlediv.text(this.__titletext),this.__captiontext&&this.__captiondiv.text(this.__captiontext)},remove:function(){for(var t in this.__visiblePrimitives)this.__visiblePrimitives[t].visible=!1;for(var t in this.__overlay_objects.objects)this.__overlay_objects.objects[t].visible=!1;this.wrapper.remove()},__change_size:function(){this.__activated&&(this.__canvas_element.style.width=Math.floor(this.width).toString()+"px",this.__overlay_element.style.width=Math.floor(this.width).toString()+"px",this.__canvas_element.style.height=Math.floor(this.height).toString()+"px",this.__overlay_element.style.height=Math.floor(this.height).toString()+"px")},__handleEvents:function(){var t=this,e=t.elements;e.bind("mouseenter mouseleave",function(e){1==e.which&&t.trigger("mouse",e)});var a={shift:16,ctrl:17,alt:18};$(document).bind("keydown keyup",function(e){for(var _ in a)if(a[_]==e.which){t.mouse[_]="keydown"==e.type;break}t.__waitfor.length>0&&t.__waitfor.search(e.type)<0||t.__expecting_key&&(e.event=e.type,20==e.which&&"keydown"==e.type&&(n=!n),e.shift=t.mouse.shift||n,e.key=i[e.which],n&&65<=e.which&&e.which<=90?e.key=s[e.which]:t.mouse.shift&&(e.key=s[e.which]),e.alt=t.mouse.alt,e.ctrl=t.mouse.ctrl,t.__waitfor?(t.__expecting_key=!1,t.__waitfor="",t.trigger(e.type,e)):t.__expecting_key&&t.trigger(e.type,e))})},__change:function(){!this.__lastcenter.equals(this.__center)&&this.mouse.pos&&(this.mouse.pos=this.mouse.pos.sub(this.__lastcenter).add(this.__center),this.mouse.ray=this.mouse.pos.sub(this.camera.pos).norm(),this.__lastcenter=this.__center)},waitfor:function(t,e){return t.search("key")>=0?(this.__waitfor=t,this.__expecting_key=!0):(this.__waitfor="",this.__expecting_key=!1),"textures"==t&&(this.waitfor_textures=!0),this.events.waitfor(t,e)},pause:function(t,e){if(arguments.length>1)void 0==this.__prompt&&(this.__prompt=label({align:"right",pixel_pos:!0,height:14,color:color.black,background:color.white,opacity:1,box:!1})),this.__prompt.pos=vec(this.__width,this.__height-12,0),this.__prompt.text=t,this.__prompt.visible=!0,this.events.pause(this.__prompt,e);else{void 0==this.__draw&&(this.__draw=draw());var i=this.width-5,s=this.height-20;this.__draw.points=[vec(i,s,0),vec(i-30,s-13,0),vec(i-30,s+15,0),vec(i,s,0)],this.__draw.opacity=1,this.__draw.color=color.black,this.__draw.fillcolor=color.white,this.__draw.visible=!0,this.events.pause(this.__draw,t)}},select:function(){window.__context.canvas_selected=this},title:{get:function(){return this.__titlediv},set:function(t){this.__titletext=t,this.__titlediv.text(t)}},caption:{get:function(){return this.__captiondiv},set:function(t){this.__captiontext=t,this.caption.text(t)}},bind:function(t,e){return t.search("key")>=0&&(this.__expecting_key=!0),this.events.bind(t,e)},unbind:function(t,e){return t.search("key")>=0&&(this.__expecting_key=!1),this.events.unbind(t,e)},one:function(t,e){return this.events.one(t,e)},trigger:function(t,e){if("mouse"==t){t=e.type;var e={type:t,pageX:e.pageX,pageY:e.pageY,which:1};this.mouse.__update(e),e.event=e.type,e.pos=this.mouse.pos,"mousedown"==e.type?(e.press="left",e.release=null):"mousemove"==e.type?(e.press=null,e.release=null):"mouseup"==e.type?(e.press=null,e.release="left"):"mouseenter"==e.type||"mouseleave"==e.type?(e.press=null,e.release=null):"click"==e.type&&(e.press=null,e.release="left")}var i=new $.Event(t,e);this.events.trigger(i)},background:new attributeVector(null,0,0,0),ambient:new attributeVector(null,.2,.2,.2),center:new attributeVector(null,0,0,0),forward:new attributeVector(null,0,0,-1),up:new attributeVector(null,0,1,0),__last_forward:null,__activated:!1,userzoom:!0,userspin:!0,fov:60*Math.PI/180,width:{value:640,onchanged:function(){this.__change_size()}},height:{value:400,onchanged:function(){this.__change_size()}},resizable:{value:!1,onchanged:function(){this.__activated&&$(this.wrapper).resizable((this.resizable?"en":"dis")+"able")}},autoscale:{get:function(){return this.__autoscale},set:function(t){this.__autoscale&&!t&&Autoscale.compute_autoscale(this),this.__autoscale=t}},range:{get:function(){return this.__autoscale&&Autoscale.compute_autoscale(this),this.__range},set:function(t){this.__autoscale=!1,this.__range=t}},pixel_to_world:{get:function(){var t=this.__width,e=this.__height,i=2*this.range;return t>=e?i/e:i/t},set:function(t){throw new Error("Cannot assign a value to pixel_to_world.")}},objects:{get:function(){var t=[];for(var e in this.__visiblePrimitives){var i=this.__visiblePrimitives[e];i.__obj?i==i.__obj.__components[0]&&i.__obj.visible&&t.push(i.__obj):t.push(i)}for(var e in this.__overlay_objects.objects){var s=this.__overlay_objects.objects[e];s instanceof label&&t.push(s)}return t}}}),property.declare(t,{selected:{get:function(){return window.__context.canvas_selected||null},set:function(t){window.__context.canvas_selected=t}},get_selected:function(){return window.__context.canvas_selected||null},all:{get:function(){var t=window.__context.canvas_all;return void 0===t&&(t=window.__context.canvas_all=[]),t}},container:{get:function(){return window.__context.glowscript_container||null},set:function(t){window.__context.glowscript_container=$(t)}}}),property.declare(e.prototype,{canvas:null,pos:null,ray:null,__pickx:null,__picky:null,pick:function(){return this.canvas.__renderer.render(1)},project:function(t){if(void 0===t.normal)throw new Error("scene.mouse.project() must specify a normal");var e,i=t.normal;void 0===t.d&&void 0===t.point?e=i.dot(this.canvas.__center):void 0!==t.d?e=t.d:void 0!==t.point&&(e=i.dot(t.point));var s=i.dot(this.canvas.camera.pos)-e,n=i.dot(this.ray);if(0==n)return null;var a=-s/n;return this.canvas.camera.pos.add(this.ray.multiply(a))},alt:!1,ctrl:!1,shift:!1,__update:function(t){var e,i=this.canvas;e=i.__width>i.__height?2*i.__range/i.__height:2*i.__range/i.__width;var s=$(i.__canvas_element).offset();this.__pickx=t.pageX-s.left,this.__picky=i.__height-(t.pageY-s.top);var n=(this.__pickx-i.__width/2)*e,a=(this.__picky-i.__height/2)*e,_=i.__forward.norm().cross(i.__up).norm(),r=_.cross(i.__forward.norm());this.pos=i.__center.add(_.multiply(n).add(r.multiply(a))),this.ray=this.pos.sub(i.camera.pos).norm()}});var a={canvas:t};Export(a)}();
!function(){"use strict";function e(n,l){return this instanceof e?(this.canvas=n,void(this.follower=null)):new e(n,l)}property.declare(e.prototype,{pos:{get:function(){var e=this.canvas;return e.center.sub(e.forward.norm().multiply(e.range/Math.tan(e.fov/2)))}},follow:function(e){this.follower=e},__activate:function(){var e,n,l,t,r,u=this.canvas,o=!1,i=[null,null],a=[null,null],s=[null,null],c=[null,null],g=0,h=0,f=!1,p=!1,m=!1,v=null,w=null,d=0,_=!1,b=[null,null],Y=function(e){var n=Math.exp(.05*-e);u.range=u.range*n},X=function(e){u.up=u.up.rotate({angle:2*e,axis:u.__forward})},M=function(e){var n=e.pageX-i[0],l=e.pageY-a[0];g+=.01*n,h+=.01*l,-1.4>h&&(h=-1.4),h>1.4&&(h=1.4),u.__forward=u.__forward.rotate({angle:-.01*n,axis:u.up});var t=u.up.diff_angle(u.__forward.multiply(-1)),r=.01*l;r>=t||r<=t-Math.PI||(u.__forward=u.__forward.rotate({angle:-r,axis:u.__forward.cross(u.__up)}))};$(document).bind("contextmenu",function(e){return!o}),u.elements.mousewheel(function(e,n){return u.userzoom&&Y(n),!1}),u.elements.mousedown(function(n){return 1==n.which&&(p=!0),3==n.which&&(m=!0),e=u.userspin&&(3==n.which||1==n.which&&u.mouse.ctrl&&!u.mouse.alt),l=u.userzoom&&(2==n.which||1==n.which&&u.mouse.alt&&!u.mouse.ctrl||p&&m),3!=n.which||e||l?(s[0]=i[0]=n.pageX,c[0]=a[0]=n.pageY,e||l?o=!0:1==n.which&&u.trigger("mouse",n),f=!0,n.preventDefault(),n.stopPropagation(),!1):void 0}),u.elements.mousemove(function(n){if(n.pageX!==i[0]||n.pageY!==a[0]){if(!f)return void u.mouse.__update(n);if(l){var t=a[0]-n.pageY;0!==t&&Y(.1*t)}else e?M(n):1==n.which&&u.trigger("mouse",n);i[0]=n.pageX,a[0]=n.pageY}}),u.elements.mouseup(function(n){if(1==n.which&&(p=!1),3==n.which&&(m=!1),f){if(3==n.which&&o&&setTimeout(function(){o=!1},0),!e&&!l)if(1==n.which)u.trigger("mouse",n),abs(n.pageX-s[0])<=5&&abs(n.pageY-c[0])<=5&&(n.type="click",u.trigger("mouse",n));else if(3==n.which)return void(o=!0);e=l=f=!1,i=[null,null],a=[null,null]}}),u.elements.bind("touchstart",function(n){e=l=_=!1,v=w=null;var o,g=n.originalEvent.targetTouches;if(!(g.length>2)&&(2!=g.length||u.userspin||u.userzoom)){d++;for(var h=0;h<g.length;h++)o=g[h],s[h]=i[h]=o.clientX,c[h]=a[h]=o.clientY,b[h]=vec(s[h],c[h],0);return v=null,r={type:"mousedown",pageX:s[0],pageY:c[0],which:1},u.userspin||u.userzoom||(u.trigger("mouse",r),r=null),t=msclock(),n.preventDefault(),n.stopPropagation(),!1}}),u.elements.bind("touchmove",function(o){if(_)return void u.mouse.__update(o);var g=msclock()-t,h=o.originalEvent.targetTouches;if(!(h.length>2)){for(var f,p=[null,null],m=[null,null],d=[0,0],y=[0,0],z=0;z<h.length;z++)f=h[z],p[z]=f.clientX,m[z]=f.clientY,d[z]=p[z]-s[z],y[z]=m[z]-c[z];if(2==h.length){if(!u.userspin&&!u.userzoom)return;var x=[null,null];if(!l){n=!1;for(var z=0;2>z;z++)x[z]=vec(p[z],m[z],0).sub(b[z]);if(!(x[0].mag()>15||x[1].mag()>15))return;r=null,l=!0;var k=b[1].sub(b[0]).norm(),E=k.cross(x[1]).sub(k.cross(x[0])).mag();E>10&&(n=u.userspin,u.userspin||(l=!1))}}if(null!==r)if(2==h.length)r=null;else{var T=d[0]<=5&&y[0]<=5;!e&&g>150&&T?(u.trigger("mouse",r),r=null):T||(e=u.userspin,r=null)}else{if(p[0]===i[0]&&m[0]===a[0]&&p[1]===i[1]&&m[1]===a[1])return;if(o.pageX=p[0],o.pageY=m[0],o.type="mousemove",e)M(o);else if(l){var P=p[1]-p[0],D=m[1]-m[0];if(n){var q=Math.atan2(D,P);if(null!==w){var I,$=vec(Math.cos(w),Math.sin(w),0),j=vec(Math.cos(q),Math.sin(q),0),A=$.cross(j),B=Math.abs(Math.asin(A.mag()));I=A.z>=0?-B:B,X(I)}w=q}else if(u.userzoom){var C=Math.sqrt(P*P+D*D);null!==v&&C!=v&&Y(.2*(C-v)),v=C}}else u.trigger("mouse",o)}i[0]=p[0],i[1]=p[1],a[0]=m[0],a[1]=m[1]}}),u.elements.bind("touchend",function(n){d--,null===r||e||l||(u.trigger("mouse",r),r=null);var t=n.originalEvent.changedTouches;n.pageX=t[0].clientX,n.pageY=t[0].clientY,e||l||(n.type="mouseup",u.trigger("mouse",n),abs(n.pageX-s[0])<=5&&abs(n.pageY-c[0])<=5&&(n.type="click",u.trigger("mouse",n))),l&&(d>0?_=!0:l=_=!1),e=!1,i=[null,null],a=[null,null],v=w=null})}});var n={orbital_camera:e};Export(n)}();
!function(){"use strict";function _(){}$.extend(_.prototype,{xmin:null,ymin:null,zmin:null,xmax:null,ymax:null,zmax:null,zx_camera:0,zy_camera:0,last_zx_camera:-1,last_zy_camera:-1,point_extent:function(_,a){this.xmin=Math.min(a.x,this.xmin),this.ymin=Math.min(a.y,this.ymin),this.zmin=Math.min(a.z,this.zmin),this.xmax=Math.max(a.x,this.xmax),this.ymax=Math.max(a.y,this.ymax),this.zmax=Math.max(a.z,this.zmax),_.__xmin=Math.min(a.x,_.__xmin),_.__ymin=Math.min(a.y,_.__ymin),_.__zmin=Math.min(a.z,_.__zmin),_.__xmax=Math.max(a.x,_.__xmax),_.__ymax=Math.max(a.y,_.__ymax),_.__zmax=Math.max(a.z,_.__zmax)}});var a={Autoscale:{compute_autoscale:function(a){var t=a.__extent;t||(t=a.__extent=new _);var e=a.center.x,m=a.center.y,n=a.center.z,i=a.__visiblePrimitives;t.zx_camera=0,t.zy_camera=0;var r=1/Math.tan(a.__fov/2);t.__cot_hfov=r,t.__centerx=a.center.x,t.__centery=a.center.y,t.__centerz=a.center.z;var x,c=!1;for(var h in i)if(x=i[h],"point"!=x.constructor.name&&"points"!=x.constructor.name){if(c=!0,a.__changed[x.__id]||null==x.__zx_camera||null==x.__zy_camera){if(x.__get_extent(t),null===x.__xmin)continue;var z=Math.max(Math.abs(x.__xmin-e),Math.abs(x.__xmax-e)),s=Math.max(Math.abs(x.__ymin-m),Math.abs(x.__ymax-m)),o=Math.max(Math.abs(x.__zmin-n),Math.abs(x.__zmax-n));x.__zx_camera=z*r+o,x.__zy_camera=s*r+o}t.zx_camera=Math.max(t.zx_camera,x.__zx_camera),t.zy_camera=Math.max(t.zy_camera,x.__zy_camera)}if(c&&(t.zx_camera>t.last_zx_camera||t.zx_camera<t.last_zx_camera/3||t.zy_camera>t.last_zy_camera||t.zy_camera<t.last_zy_camera/3)){var y=t.zx_camera*a.__height/a.__width;y>t.zy_camera?a.__width>=a.__height?a.__range=1.1*(a.__height/a.__width)*t.zx_camera/r:a.__range=1.1*t.zx_camera/r:a.__width>=a.__height?a.__range=1.1*t.zy_camera/r:a.__range=1.1*(a.__width/a.__height)*t.zy_camera/r,t.last_zx_camera=t.zx_camera,t.last_zy_camera=t.zy_camera}},find_extent:function(_,a){if("points"!=_.constructor.name){var t,e=_.__size,m=e.__x,n=e.__y,i=e.__z,r=_.__pos,x=r.__x,c=r.__y,h=r.__z,z=_.__hasPosAtCenter;t=z?Math.sqrt(m*m+n*n+i*i)/2:Math.sqrt(m*m+n*n/4+i*i/4);var s=x-a.__centerx,o=c-a.__centery,y=h-a.__centerz,l=(Math.abs(s)+t)*a.__cot_hfov+Math.abs(y)+t,u=(Math.abs(o)+t)*a.__cot_hfov+Math.abs(y)+t;if(!(l<a.zx_camera&&u<a.zy_camera)){var M=_.__axis.norm(),d=_.__up.norm();z&&(r=r.sub(M.multiply(m/2)));var p=M.multiply(m),v=M.cross(d).norm();v.dot(v)<1e-10&&(v=M.cross(vec(1,0,0)).norm(),v.dot(v)<1e-10&&(v=M.cross(vec(0,1,0)).norm()));var f=v.cross(M),b=r.add(f.multiply(-n/2).add(v.multiply(-i/2))),g=b.add(f.multiply(n)),w=b.add(v.multiply(i)),q=g.add(v.multiply(i)),A=b.add(p),P=g.add(p),C=w.add(p),E=q.add(p);a.point_extent(_,b),a.point_extent(_,g),a.point_extent(_,w),a.point_extent(_,q),a.point_extent(_,A),a.point_extent(_,P),a.point_extent(_,C),a.point_extent(_,E)}}}}};Export(a)}();
!function(){"use strict";function e(e,r,t){function E(e){xe[e]=U.createTexture(),U.activeTexture(Fe[e]),U.bindTexture(U.TEXTURE_2D,xe[e]),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texImage2D(U.TEXTURE_2D,0,U.RGBA,Ae,Ee,0,U.RGBA,U.UNSIGNED_BYTE,null),U.bindTexture(U.TEXTURE_2D,null)}function x(e,r,t){function a(e,r,t){var a=t.createShader(r);if(t.shaderSource(a,e),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS))throw alert(t.getShaderInfoLog(a)),new Error("Shader compile error");return a}var n=a(r,t.VERTEX_SHADER,t),i=a(e,t.FRAGMENT_SHADER,t),_=t.createProgram();if(t.attachShader(_,n),t.attachShader(_,i),t.linkProgram(_),!t.getProgramParameter(_,t.LINK_STATUS))throw alert(t.getProgramInfoLog(_)),new Error("Shader link error");var s=t.getProgramParameter(_,t.ACTIVE_UNIFORMS);_.uniforms={};for(var o=0;s>o;o++){var f=t.getActiveUniform(_,o),u=f.name;"[0]"==u.substring(u.length-3)&&(u=u.substring(0,u.length-3)),_.uniforms[u]=t.getUniformLocation(_,u)}var l=t.getProgramParameter(_,t.ACTIVE_ATTRIBUTES);_.attributes={};for(var o=0;l>o;o++){var f=t.getActiveAttrib(_,o);_.attributes[f.name]=t.getAttribLocation(_,f.name)}return _}function F(e){return 0===(e&e-1)}function T(e){--e;for(var r=1;32>r;r<<=1)e|=e>>r;return e+1}function B(r,t,a){var n,i,_;a?(n=t.__tex.bumpmap,_=t.__tex.bumpmap_ref,i=t.__tex.bumpmap_t0):(n=t.__tex.file,_=t.__tex.texture_ref,i=t.__tex.texture_t0);var s=msclock();if(s-=i,n in e.textures)_.reference=e.textures[n];else{if(e.textures[n]=_.reference=U.createTexture(),U.bindTexture(U.TEXTURE_2D,_.reference),U.pixelStorei(U.UNPACK_FLIP_Y_WEBGL,!0),!F(r.width)||!F(r.height)){var o=document.createElement("canvas");o.width=T(r.width),o.height=T(r.height);var f=o.getContext("2d");f.drawImage(r,0,0,o.width,o.height),r=o}U.texImage2D(U.TEXTURE_2D,0,U.RGBA,U.RGBA,U.UNSIGNED_BYTE,r),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR_MIPMAP_NEAREST),U.generateMipmap(U.TEXTURE_2D),U.bindTexture(U.TEXTURE_2D,null)}if(n in e.textures_requested)for(var u=e.textures_requested[n];u.length>0;){var l=u.pop();l[1]?l[0].__tex.bumpmap_ref.reference=_.reference:l[0].__tex.texture_ref.reference=_.reference,l[0].__change()}}function g(){var t=b>0,n=msclock(),i=0;t&&(i=n-b),b=n,e.trigger("redraw",{dt:i}),D.render(a),n=msclock(),i=0,t&&(i=n-A),A=n,t?(h=.95*h+.05*(n-b),v=.95*v+1e3/i*.05):(h=n-b,v=0);var _=v*h;$("#fps").text(v.toFixed(1)+" renders/s * "+h.toFixed(1)+" ms/render = "+_.toFixed(1)+" ms rendering/s"),e.trigger("draw_complete",{dt:i}),e.__last_forward=e.__forward,e.__last_range=e.__range,window.requestAnimFrame(g,r)}var D=this,U=WebGLUtils.setupWebGL(r);if(!U)throw new Error("Can't create canvas: WebGL not supported");e.overlay_context=t.getContext("2d");var y=8,w=new Float32Array(4*y),Y=new Float32Array(3*y),C=new Float32Array(3),M=new Float32Array(2),N=new Array(4),k=new Uint8Array(4),P=null,I=null,L=null,X=null,j=null,S=null,O=null,G=null,q=null,W=null,z=null,H=null,V=null,K=null,Q=null,J=null,Z=null,ee=null,re=null,te=null,ae=null,ne=null,ie=null,_e=null,se=null,oe=null,fe=null,ue=null,le=null,de=null,ce=null,pe=null,me=null,Re=null,ve=null,he=null,be=1,Ae=be*e.__width,Ee=be*e.__height,xe={C0:null,D0:null,C1:null,D1:null,C2:null,D2:null,C3:null,D3:null,C4:null,EXTENT_TEXTURE:null},Fe={C0:U.TEXTURE2,D0:U.TEXTURE3,C1:U.TEXTURE4,D1:U.TEXTURE5,C2:U.TEXTURE6,D2:U.TEXTURE7,C3:U.TEXTURE8,D3:U.TEXTURE9,C4:U.TEXTURE10,EXTENT_TEXTURE:U.TEXTURE11};for(var Te in xe)E(Te);var Be=U.createFramebuffer();U.bindFramebuffer(U.FRAMEBUFFER,Be);var ge=U.createRenderbuffer();U.bindRenderbuffer(U.RENDERBUFFER,ge),U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,Ae,Ee),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,ge),U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null);var De=U.getParameter(U.MAX_TEXTURE_IMAGE_UNITS)>=16,Ue=function(e,r){r?this.dynamism=U.DYNAMIC_DRAW:this.dynamism=U.STATIC_DRAW,this.elementType=U.TRIANGLES,this.mesh=e,this.model_transparent=e.model_transparent,this.pos=new Float32Array(e.pos),this.normal=new Float32Array(e.normal),this.color=new Float32Array(e.color),this.opacity=new Float32Array(e.opacity),this.shininess=new Float32Array(e.shininess),this.emissive=new Float32Array(e.emissive),this.texpos=new Float32Array(e.texpos),this.bumpaxis=new Float32Array(e.bumpaxis),this.index=new Uint16Array(e.index),this.posBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.posBuffer),U.bufferData(U.ARRAY_BUFFER,this.pos,this.dynamism),this.normalBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.normalBuffer),U.bufferData(U.ARRAY_BUFFER,this.normal,this.dynamism),this.colorBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.colorBuffer),U.bufferData(U.ARRAY_BUFFER,this.color,this.dynamism),this.opacityBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.opacityBuffer),U.bufferData(U.ARRAY_BUFFER,this.opacity,this.dynamism),this.shininessBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.shininessBuffer),U.bufferData(U.ARRAY_BUFFER,this.shininess,this.dynamism),this.emissiveBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.emissiveBuffer),U.bufferData(U.ARRAY_BUFFER,this.emissive,this.dynamism),this.texposBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.texposBuffer),U.bufferData(U.ARRAY_BUFFER,this.texpos,this.dynamism),this.bumpaxisBuffer=U.createBuffer(),U.bindBuffer(U.ARRAY_BUFFER,this.bumpaxisBuffer),U.bufferData(U.ARRAY_BUFFER,this.bumpaxis,this.dynamism),this.indexBuffer=U.createBuffer(),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,this.indexBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,this.index,this.dynamism)},ye=new Ue(Mesh.makeCube(),!1),we=new Ue(Mesh.makeCylinder(.5),!1),Ye=new Ue(Mesh.makeSphere(.5,30,!1),!1),Ce=new Ue(Mesh.makePyramid(),!1),Me=new Ue(Mesh.makeCone(.5),!1),Ne=new Ue(Mesh.makeRing(.45,.05),!1),ke={triangle:new Ue(e.__vertices,!0),quad:new Ue(Mesh.makeQuad(),!1),curve:new Ue(Mesh.makeCurveSegment(1),!1)};"vpython"==window.__GSlang?(ke.vp_box=ye,ke.vp_pyramid=Ce,ke.vp_cylinder=we,ke.vp_cone=Me,ke.vp_sphere=Ye,ke.vp_ellipsoid=Ye,ke.vp_ring=Ne):(ke.box=ye,ke.pyramid=Ce,ke.cylinder=we,ke.cone=Me,ke.sphere=Ye,ke.ring=Ne);var Pe=this.models={};for(var Ie in ke)Pe[Ie]=ke[Ie];this.add_model=function(e,r){var t=e.__mesh_id;Pe[t]=ke[t]=new Ue(e,r),Pe[t].id_object={}},this.remove_model=function(e,r){var t=e.__mesh_id;delete Pe[t],delete ke[t]},this.screenshot=function(t){e.waitfor("draw_complete",function(e){var a=new Image;a.src=r.toDataURL(),t(e,a)})},this.reset=function(){for(var e in ke)ke[e].id_object={}};var Le={target:vec3.create([0,0,0]),up:vec3.create([0,1,0]),fovy:60,angleX:0,angleY:0,distance:1};this.reset(),this.initTexture=function(r,t,a){if(a?t.__tex.bumpmap=r:t.__tex.file=r,r in e.textures)return void(a?t.__tex.bumpmap_ref.reference=e.textures[r]:t.__tex.texture_ref.reference=e.textures[r]);if(r in e.textures_requested)return void e.textures_requested[r].push([t,a]);e.textures_requested[r]=[[t,a]];var n=msclock();a?t.__tex.bumpmap_t0=n:t.__tex.texture_t0=n;var i=new Image;i.crossOrigin="anonymous",i.src=r,i.onload=function(){B(i,t,a)}};var Xe=0;this.render=function(t){function v(e,r,t){if(void 0===t.__owner||t.__owner.__vis){var a=e[r];void 0===a&&(a=e[r]=[t]),3==qe?a.push(t.v0.__id,t.v1.__id,t.v2.__id):a.push(t.v0.__id,t.v1.__id,t.v2.__id,t.v0.__id,t.v2.__id,t.v3.__id)}}function h(e,r){or=e,U.useProgram(e),U.enableVertexAttribArray(e.attributes.pos),(t==R||r>o)&&U.uniform2fv(e.uniforms.canvas_size,M),r!=R&&(t!=a&&r!=s&&r!=f&&r!=l&&r!=c&&r!=m||(U.uniform1i(e.uniforms.light_count,ye),U.uniform4fv(e.uniforms.light_pos,w),U.uniform3fv(e.uniforms.light_color,Y),U.uniform3fv(e.uniforms.light_ambient,C),U.enableVertexAttribArray(e.attributes.normal),e!=I&&(U.enableVertexAttribArray(e.attributes.color),U.enableVertexAttribArray(e.attributes.opacity),U.enableVertexAttribArray(e.attributes.shininess),U.enableVertexAttribArray(e.attributes.emissive),U.enableVertexAttribArray(e.attributes.texpos),U.enableVertexAttribArray(e.attributes.bumpaxis),U.uniform1i(e.uniforms.texmap,0),U.uniform1i(e.uniforms.bumpmap,1))),U.uniformMatrix4fv(e.uniforms.viewMatrix,!1,Ue),U.uniformMatrix4fv(e.uniforms.projMatrix,!1,ge)),r==R?(U.uniform1i(e.uniforms.C0,2),U.uniform1i(e.uniforms.C1,4),De&&(U.uniform1i(e.uniforms.C2,6),U.uniform1i(e.uniforms.C3,8),U.uniform1i(e.uniforms.C4,10))):r>o&&(U.uniform1i(e.uniforms.D0,3),r==l||r==d?U.uniform1i(e.uniforms.D1,5):r==c||r==p?U.uniform1i(e.uniforms.D2,7):r==m&&U.uniform1i(e.uniforms.D3,9))}function b(r,v,b){function A(){var _=ke.curve,f=_.id_object,u=_.elementType,l=_.index.length,d=!0;for(var c in f){if(!f[c].visible)break;if(r>o)break;d&&(r==a||r==s?(null==I&&(I=x(shaders.opaque_render_fragment,shaders.curve_render_vertex,U)),h(I,r)):r==o?(null==le&&(le=x(shaders.peel_depth_fragmentD0,shaders.curve_peel_depth_vertex,U)),h(le,r)):r==n&&(null==ce&&(ce=x(shaders.pick_fragment,shaders.curve_pick_vertex,U)),h(ce,r)),U.bindBuffer(U.ARRAY_BUFFER,_.posBuffer),U.vertexAttribPointer(or.attributes.pos,4,U.FLOAT,!1,0,0),r!=n&&o>r&&(U.bindBuffer(U.ARRAY_BUFFER,_.normalBuffer),U.vertexAttribPointer(or.attributes.normal,3,U.FLOAT,!1,0,0)),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,_.indexBuffer),t==i&&(u=U.POINTS),d=!1);var p=f[c],m=p.__points,R=m.length,v=p.__data[15];0===v&&(p.__data[15]=6*e.__range/e.__width),U.uniform4fv(or.uniforms.objectData,p.__data);for(var b=1;R>b;b++){var A=m[b];if(A.visible){var E=A.__prevsegment;if(t==n)for(var F=A.__falsecolor,T=0;4>T;T++)N[T]=E[8+T],N[T+4]=E[12+T],E[12+T]=E[8+T]=F[T];if(U.uniform4fv(or.uniforms.segmentData,E),U.drawElements(u,l,U.UNSIGNED_SHORT,0),t==n)for(var T=0;8>T;T++)E[8+T]=N[T]}}p.__data[15]=v}}function E(){var R=ke.triangle,v=R.elementType,b=e.__vertices;if(t==n)return null==pe&&(pe=x(shaders.pick_fragment,shaders.tri_pick_vertex,U)),h(pe,r),b={},b.pos=new Float32Array(rr.pos),b.color=new Float32Array(rr.color),y=new Uint16Array(rr.index),w=y.length,U.bindBuffer(U.ARRAY_BUFFER,R.posBuffer),U.bufferData(U.ARRAY_BUFFER,b.pos,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.pos,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,R.colorBuffer),U.bufferData(U.ARRAY_BUFFER,b.color,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.color,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,R.indexBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,y,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.color,4,U.FLOAT,!1,0,0),U.drawElements(v,w,U.UNSIGNED_SHORT,0),U.bindBuffer(U.ARRAY_BUFFER,R.posBuffer),U.bufferData(U.ARRAY_BUFFER,e.__vertices.pos,U.DYNAMIC_DRAW),U.bindBuffer(U.ARRAY_BUFFER,R.colorBuffer),void U.bufferData(U.ARRAY_BUFFER,e.__vertices.color,U.DYNAMIC_DRAW);var A=e.__sort_objects;for(var E in A){if(r>o){if("opaque"==E)continue}else if("transparent"==E)continue;var F=!0;for(var T in A[E])for(var B in A[E][T]){if(F){switch(F=!1,r){case a:case s:null===L&&(L=x(shaders.opaque_render_fragment,shaders.tri_render_vertex,U)),h(L,r);break;case i:null===Re&&(Re=x(shaders.pick_fragment,shaders.extent_vertex,U)),h(Re,r);break;case o:null===ae&&(ae=x(shaders.peel_depth_fragmentD0,shaders.tri_peel_depth_vertex,U)),h(ae,r);break;case u:null===ie&&(ie=x(shaders.peel_depth_fragmentD1,shaders.tri_peel_depth_vertex,U)),h(ie,r);break;case d:null===se&&(se=x(shaders.peel_depth_fragmentD2,shaders.tri_peel_depth_vertex,U)),h(se,r);break;case p:null===fe&&(fe=x(shaders.peel_depth_fragmentD3,shaders.tri_peel_depth_vertex,U)),h(fe,r);break;case f:null===ne&&(ne=x(shaders.peel_color_fragmentC1,shaders.tri_render_vertex,U)),h(ne,r);break;case l:null===_e&&(_e=x(shaders.peel_color_fragmentC2,shaders.tri_render_vertex,U)),h(_e,r);break;case c:null===oe&&(oe=x(shaders.peel_color_fragmentC3,shaders.tri_render_vertex,U)),h(oe,r);break;case m:null===ue&&(ue=x(shaders.peel_color_fragmentC4,shaders.tri_render_vertex,U)),h(ue,r)}U.bindBuffer(U.ARRAY_BUFFER,R.posBuffer),Xe&&U.bufferData(U.ARRAY_BUFFER,b.pos,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.pos,3,U.FLOAT,!1,0,0),t!=a&&r!=s&&r!=f&&r!=l&&r!=c&&r!=m||(U.bindBuffer(U.ARRAY_BUFFER,R.normalBuffer),Xe&&U.bufferData(U.ARRAY_BUFFER,b.normal,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.normal,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,R.colorBuffer),Xe&&U.bufferData(U.ARRAY_BUFFER,b.color,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.color,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,R.opacityBuffer),Xe&&U.bufferData(U.ARRAY_BUFFER,b.opacity,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.opacity,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,R.shininessBuffer),Xe&&U.bufferData(U.ARRAY_BUFFER,b.shininess,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.shininess,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,R.emissiveBuffer),Xe&&U.bufferData(U.ARRAY_BUFFER,b.emissive,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.emissive,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,R.texposBuffer),Xe&&U.bufferData(U.ARRAY_BUFFER,b.texpos,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.texpos,2,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,R.bumpaxisBuffer),Xe&&U.bufferData(U.ARRAY_BUFFER,b.bumpaxis,U.DYNAMIC_DRAW),U.vertexAttribPointer(or.attributes.bumpaxis,3,U.FLOAT,!1,0,0),Xe=0)}var g=A[E][T][B],D=g[0],y=new Uint16Array(g.slice(1)),w=y.length;U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,R.indexBuffer),U.bufferData(U.ELEMENT_ARRAY_BUFFER,y,U.DYNAMIC_DRAW),t==i&&(v=U.POINTS);var Y=0,C=0;if("textures"==T){if((t==a||t==_)&&null!==D.__tex.file){if(null===D.__tex.texture_ref.reference)continue;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,D.__tex.texture_ref.reference),Y=1}}else if("bumpmaps"==T){if((t==a||t==_)&&null!==D.__tex.bumpmap){if(null===D.__tex.bumpmap_ref.reference)continue;U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,D.__tex.bumpmap_ref.reference),C=1}}else if("textures_and_bumpmaps"==T){if((t==a||t==_)&&null!==D.__tex.file){if(null===D.__tex.texture_ref.reference)continue;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,D.__tex.texture_ref.reference),Y=1}if((t==a||t==_)&&null!==D.__tex.bumpmap){if(null===D.__tex.bumpmap_ref.reference)continue;U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,D.__tex.bumpmap_ref.reference),C=1}}U.uniform1f(or.uniforms.T,Y),U.uniform1f(or.uniforms.B,C),U.drawElements(v,w,U.UNSIGNED_SHORT,0)}}}function F(){var e=ke.quad,t=e.elementType,a=e.index.length;De?(null==ve&&(ve=x(shaders.merge_fragment,shaders.merge_vertex,U)),h(ve,r)):(null==he&&(he=x(shaders.merge_fragment2,shaders.merge_vertex,U)),h(he,r)),U.bindBuffer(U.ARRAY_BUFFER,e.posBuffer),U.vertexAttribPointer(or.attributes.pos,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,e.indexBuffer),U.drawElements(t,a,U.UNSIGNED_SHORT,0)}if(t==_&&b.length>0)for(var T=0;T<b.length;T++){var B=b[T];B!=v&&(U.activeTexture(Fe[B]),U.bindTexture(U.TEXTURE_2D,xe[B]))}null===v?U.bindFramebuffer(U.FRAMEBUFFER,null):(U.bindFramebuffer(U.FRAMEBUFFER,Be),U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,xe[v],0)),U.viewport(0,0,Ae,Ee),U.enable(U.DEPTH_TEST),t==n||r>s?U.clearColor(0,0,0,0):t==i?U.clearColor(0,0,0,1):U.clearColor(e.__background.x,e.__background.y,e.__background.z,1),t==i?(U.depthFunc(U.GREATER),U.clearDepth(0)):(U.depthFunc(U.LEQUAL),U.clearDepth(1)),U.clear(U.COLOR_BUFFER_BIT|U.DEPTH_BUFFER_BIT);for(var g in ke){if(r>=R){F();break}if("quad"!=g&&"triangle"!=g)if("curve"!=g){var D,y=ke[g],w=y.elementType,Y=y.index.length;if(r>o){if(void 0===e.__transparent_objects[g])continue;D=e.__transparent_objects[g]}else{if(void 0===e.__opaque_objects[g])continue;D=e.__opaque_objects[g]}var C=!1;for(var M in D){C=!0;break}if(C){var k="ring"==g||"vp_ring"==g;switch(r){case a:case s:k?(null===X&&(X=x(shaders.opaque_render_fragment,shaders.ring_render_vertex,U)),h(X,r)):(null===P&&(P=x(shaders.opaque_render_fragment,shaders.render_vertex,U)),h(P,r));break;case n:k?(null===me&&(me=x(shaders.pick_fragment,shaders.ring_pick_vertex,U)),h(me,r)):(null===de&&(de=x(shaders.pick_fragment,shaders.pick_vertex,U)),h(de,r));break;case i:null===Re&&(Re=x(shaders.pick_fragment,shaders.extent_vertex,U)),h(Re,r);break;case o:k?(null===V&&(V=x(shaders.peel_depth_fragmentD0,shaders.ring_peel_depth_vertex,U)),h(V,r)):(null===j&&(j=x(shaders.peel_depth_fragmentD0,shaders.peel_depth_vertex,U)),h(j,r));break;case u:k?(null===Q&&(Q=x(shaders.peel_depth_fragmentD1,shaders.ring_peel_depth_vertex,U)),h(Q,r)):(null===O&&(O=x(shaders.peel_depth_fragmentD1,shaders.peel_depth_vertex,U)),h(O,r));break;case d:k?(null===Z&&(Z=x(shaders.peel_depth_fragmentD2,shaders.ring_peel_depth_vertex,U)),h(Z,r)):(null===q&&(q=x(shaders.peel_depth_fragmentD2,shaders.peel_depth_vertex,U)),h(q,r));break;case p:k?(null===re&&(re=x(shaders.peel_depth_fragmentD3,shaders.ring_peel_depth_vertex,U)),h(re,r)):(null===z&&(z=x(shaders.peel_depth_fragmentD3,shaders.peel_depth_vertex,U)),h(z,r));break;case f:k?(null===K&&(K=x(shaders.peel_color_fragmentC1,shaders.ring_render_vertex,U)),h(K,r)):(null===S&&(S=x(shaders.peel_color_fragmentC1,shaders.render_vertex,U)),h(S,r));break;case l:k?(null===J&&(J=x(shaders.peel_color_fragmentC2,shaders.ring_render_vertex,U)),h(J,r)):(null===G&&(G=x(shaders.peel_color_fragmentC2,shaders.render_vertex,U)),h(G,r));break;case c:k?(null===ee&&(ee=x(shaders.peel_color_fragmentC3,shaders.ring_render_vertex,U)),h(ee,r)):(null===W&&(W=x(shaders.peel_color_fragmentC3,shaders.render_vertex,U)),h(W,r));break;case m:k?(null===te&&(te=x(shaders.peel_color_fragmentC4,shaders.ring_render_vertex,U)),h(te,r)):(null===H&&(H=x(shaders.peel_color_fragmentC4,shaders.render_vertex,U)),h(H,r))}U.bindBuffer(U.ARRAY_BUFFER,y.posBuffer),U.vertexAttribPointer(or.attributes.pos,3,U.FLOAT,!1,0,0),t==n||t!=a&&r!=s&&r!=f&&r!=l&&r!=c&&r!=m?k&&(U.bindBuffer(U.ARRAY_BUFFER,y.normalBuffer),U.vertexAttribPointer(or.attributes.normal,3,U.FLOAT,!1,0,0)):(U.bindBuffer(U.ARRAY_BUFFER,y.normalBuffer),U.vertexAttribPointer(or.attributes.normal,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,y.colorBuffer),U.vertexAttribPointer(or.attributes.color,3,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,y.opacityBuffer),U.vertexAttribPointer(or.attributes.opacity,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,y.shininessBuffer),U.vertexAttribPointer(or.attributes.shininess,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,y.emissiveBuffer),U.vertexAttribPointer(or.attributes.emissive,1,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,y.texposBuffer),U.vertexAttribPointer(or.attributes.texpos,2,U.FLOAT,!1,0,0),U.bindBuffer(U.ARRAY_BUFFER,y.bumpaxisBuffer),U.vertexAttribPointer(or.attributes.bumpaxis,3,U.FLOAT,!1,0,0)),U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,y.indexBuffer),t==i&&(w=U.POINTS);for(var M in D){var $=D[M],be=$.__data;if(R>r&&t!=n){if((t==a||t==_)&&null!==$.__tex.file){if(null===$.__tex.texture_ref.reference)continue;U.activeTexture(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,$.__tex.texture_ref.reference)}if((t==a||t==_)&&null!==$.__tex.bumpmap){if(null===$.__tex.bumpmap_ref.reference)continue;U.activeTexture(U.TEXTURE1),U.bindTexture(U.TEXTURE_2D,$.__tex.bumpmap_ref.reference)}}if(t==n)for(var Te=$.__falsecolor,T=0;4>T;T++)N[T]=be[16+T],be[16+T]=Te[T];if(U.uniform4fv(or.uniforms.objectData,be),U.drawElements(w,Y,U.UNSIGNED_SHORT,0),t==n)for(var T=0;4>T;T++)be[16+T]=N[T]}}}else A();else tr&&E()}t!=n&&(U.bindRenderbuffer(U.RENDERBUFFER,null),U.bindFramebuffer(U.FRAMEBUFFER,null))}if(t==a&&e.waitfor_textures){var A=e.objects;for(var E in A){var F=A[E];if(void 0!==F.__tex&&!F.ready)return}e.waitfor_textures=!1,e.trigger("textures",null)}if(!e.visible){if(t==a)return;return null}if(e.autoscale&&Autoscale.compute_autoscale(e),null!==e.camera.follower&&(e.center="function"!=typeof e.camera.follower?e.camera.follower.pos:e.camera.follower()),t==a){for(var T in e.arrows){var B=e.arrows[T];if(B.run){if(void 0!==B.obj){if(void 0===B.obj.pos)continue;B.arrow.pos=B.obj.pos}null!==B.last_pos&&g.equals(B.last_pos)||(B.arrow.visible||(B.arrow.visible=!0),"vpython"==window.__GSlang?B.arrow.axis=B.obj[B.attr].multiply(B.scale):B.arrow.axis_and_length=B.obj[B.attr].multiply(B.scale))}}for(var T in e.trails){var g,B=e.trails[T];if(B.__run){if("function"!=typeof B.__obj){if(void 0!==B.__obj){if(void 0===B.__obj.pos)continue;g=B.__obj.pos}}else g=B.__obj();if(null===B.__last_pos||!g.equals(B.__last_pos)){if(B.pps>0){var D=msclock();if(null===B.__last_time&&(B.last_time=D),D-B.__last_time>1e3/B.pps)B.__last_time=D;else if(D!=B.__last_time)continue}if(B.retain>0&&B.__elements==B.retain)if("curve"==B.type)B.__curve.shift(),B.__curve.push(g);else{var $=B.__spheres.shift();$.pos=g,B.__spheres.push($)}else{if("curve"==B.type)B.__curve.push(g);else{var be="vpython"==window.__GSlang?vp_sphere:sphere,$=be({pos:g,canvas:B.__options.canvas,color:B.__options.color,size:B.__options.size,pickable:B.__options.pickable});B.__spheres.push($)}B.__elements+=1}B.__last_pos=vec(g)}}}}Le.target=vec3.create([e.__center.x,e.__center.y,e.__center.z]),Le.up=vec3.create([e.__up.x,e.__up.y,e.__up.z]),Le.fovy=180*e.__fov/Math.PI;var Te=vec(e.__forward.x,0,e.__forward.z).norm();Le.angleX=Math.atan2(Te.x,-Te.z),Le.angleY=Math.PI/2-Math.acos(-e.__forward.norm().y),r.clientWidth>=r.clientHeight?Le.distance=e.__range/Math.tan(e.__fov/2):Le.distance=e.__range*(r.clientHeight/r.clientWidth)/Math.tan(e.__fov/2),Le.pos=mat4.multiplyVec3(mat4.rotateX(mat4.rotateY(mat4.identity(mat4.create()),-Le.angleX),-Le.angleY),vec3.create([0,0,Le.distance])),Le.pos=vec3.create([e.__center.x+Le.pos[0],e.__center.y+Le.pos[1],e.__center.z+Le.pos[2]]),Le.zNear=Le.distance/100,Le.zFar=10*Le.distance;for(var ge=mat4.perspective(Le.fovy,r.clientWidth/r.clientHeight,Le.zNear,Le.zFar),Ue=mat4.lookAt(Le.pos,Le.target,Le.up),ye=Math.min(e.lights.length,y),T=0;ye>T;T++){var we=e.lights[T];if(void 0===we.direction)var Ye=[we.pos.x,we.pos.y,we.pos.z,1];else var Ye=[we.direction.x,we.direction.y,we.direction.z,0];mat4.multiplyVec4(Ue,Ye);for(var Ce=0;4>Ce;Ce++)w[4*T+Ce]=Ye[Ce];Y[3*T]=we.color.x,Y[3*T+1]=we.color.y,Y[3*T+2]=we.color.z}if(C[0]=e.ambient.x,C[1]=e.ambient.y,C[2]=e.ambient.z,e.__points_objects.length>0)for(var Me,Ne=e.__points_objects,Pe=3*e.__range/e.__width,T=0;T<Ne.length;T++){var Ie=Ne[T];if(Ie.__pixels){if(void 0===Ie||Ie.__last_range===e.__range)continue;Ie.__last_range=e.__range,Me=0===Ie.__size?5*Pe:Pe*Ie.__size}else Me=Ie.__size;for(var $=0;$<Ie.__points.length;$++)Ie.__points[$].size=vec(Me,Me,Me)}if(t==a&&e.__overlay_objects.objects.length>0&&(e.__overlay_objects.__changed||!e.__forward.equals(e.__last_forward)||e.__range!=e.__last_range)){e.__overlay_objects.__changed=!1;var je=e.overlay_context;je.clearRect(0,0,e.__width,e.__height);for(var T=0;T<e.__overlay_objects.objects.length;T++){var F=e.__overlay_objects.objects[T];F.visible&&F.__update(je,Le)}}var Se={pos:3,normal:3,color:3,opacity:1,shininess:1,emissive:1,texpos:2,bumpaxis:3},Ce=e.__vertices;for(var Oe in e.__vertex_changed){var Ge=e.__vertex_changed[Oe],qe=Ge.__id;Xe++;for(var We in Se){var ze=Ge["__"+We];1==Se[We]?Ce[We][qe]=ze:2==Se[We]?(Ce[We][2*qe]=ze.x,Ce[We][2*qe+1]=ze.y):(Ce[We][3*qe]=ze.x,Ce[We][3*qe+1]=ze.y,Ce[We][3*qe+2]=ze.z)}}e.__vertex_changed={};for(var T=0;2>T;T++){var He=[];for(var Oe in e.__changed){var Ce=e.__changed[Oe];Ce.__obj?(He.indexOf(Ce.__obj)<0&&(Ce.__obj.__update(),He.push(Ce.__obj)),delete e.__changed[Ce.__id],Ce.__obj.visible||delete Ce.__model.id_object[Ce.__id]):(Ce.__update(),delete e.__changed[Oe])}}e.__changed={};for(var Ve in ke)e.__opaque_objects[Ve]={},e.__transparent_objects[Ve]={};var Ke=!1;for(var Ve in ke)if("triangle"!=Ve&&"quad"!=Ve&&"point"!=Ve){var Qe=ke[Ve],$e=Qe.id_object;for(var Oe in $e){var F=$e[Oe];"curve"!=Ve&&t==a&&(F.__data[19]<1||Qe.model_transparent)?(e.__transparent_objects[Ve][Oe]=F,Ke=!0):e.__opaque_objects[Ve][Oe]=F}}var Je=e.__sort_objects;for(var Ze in Je)for(var B in Je[Ze])Je[Ze][B]={};for(var qe,Qe,er=["v0","v1","v2","v3"],rr={pos:[],color:[],index:[]},tr=!1,Ve=0;2>Ve;Ve++){0===Ve?(qe=3,Qe=ke.triangle):(qe=4,Qe=ke.quad);var $e=Qe.id_object;for(var Oe in $e){tr=!0;var F=$e[Oe];if(t==n){for(var Ie,ar=F.__falsecolor,T=0;3>T;T++)Ie=F[er[T]].pos,rr.pos.push(Ie.x,Ie.y,Ie.z),rr.color.push(ar[0],ar[1],ar[2],ar[3]),rr.index.push(rr.index.length);if(4==qe)for(var nr=[0,2,3],ir=0;3>ir;ir++){var T=nr[ir];Ie=F[er[T]].pos,rr.pos.push(Ie.x,Ie.y,Ie.z),rr.color.push(ar[0],ar[1],ar[2],ar[3]),rr.index.push(rr.index.length)}}else if(t==a){for(var _r=!0,T=0;qe>T;T++)if(F[er[T]].opacity<1){_r=!1;break}var We=F.__tex.file,sr=F.__tex.bumpmap;_r?null!==We?(v(Je.opaque.textures,We,F),null!=sr&&v(Je.opaque.textures_and_bumpmaps,sr,F)):null!=sr?v(Je.opaque.bumpmaps,sr,F):v(Je.opaque.plain,"all",F):(Ke=!0,null!==We?(v(Je.transparent.textures,We,F),null!=sr&&v(Je.transparent.textures_and_bumpmaps,sr,F)):null!=sr?v(Je.transparent.bumpmaps,sr,F):v(Je.transparent.plain,"all",F))}}}Ke&&(t=_);var or;if(M[0]=Ae,M[1]=Ee,t==a?b(t,null,[]):t==n?b(t,"C0",[""]):t==i?b(t,"EXTENT_TEXTURE",[]):t==_&&(b(s,"C0",[]),b(o,"D0",[]),b(f,"C1",["D0"]),De?(b(u,"D1",["D0"]),b(l,"C2",["D0","D1"]),b(d,"D2",["D0","D1"]),b(c,"C3",["D0","D2"]),b(p,"D3",["D0","D2"]),b(m,"C4",["D0","D3"]),b(R,null,["C0","C1","C2","C3","C4"])):b(R,null,["C0","C1"])),t==i){U.readPixels(0,0,1,1,U.RGBA,U.UNSIGNED_BYTE,k);var fr=(256*k[1]+k[2])/65536,ur=k[0];ur>128&&(ur=-(ur-128),fr=-fr);var lr;return lr=0==fr&&0==ur?0:Math.exp(fr+ur),null}if(t==n){U.readPixels(e.mouse.__pickx,e.mouse.__picky,1,1,U.RGBA,U.UNSIGNED_BYTE,k);var Oe=16777216*k[0]+65536*k[1]+256*k[2]+k[3],F=e.__visiblePrimitives[Oe];if(!F)return null;if(F.__obj&&F.__obj.pickable)return F.__obj;if("point"==F.constructor.name){if(!F.__curve.pickable||!F.pickable)return null;for(var dr=F.__curve.__points,cr=dr.length,T=0;cr>T;T++)if(dr[T]===F)return F=F.__curve,F.pick=T,F.segment=T,F;return null}return F.pickable?F:null}},this.reset(),g()}function r(e,r){if(void 0===r)throw new Error("rate(iterations_per_second, wait) called without wait");x>0?(x--,msclock()>t&&(x=0),x>0?r():setTimeout(r,Math.ceil(1e3/E))):120>=e?setTimeout(r,Math.ceil(1e3/e)):(x=Math.ceil(e/E),t=msclock()+Math.ceil(1e3/E),r())}var t,a=0,n=1,i=2,_=3,s=4,o=5,f=6,u=7,l=8,d=9,c=10,p=11,m=12,R=13,v=0,h=0,b=0,A=0,E=60,x=0,F={WebGLRenderer:e,rate:r};Export(F)}();
!function(){"use strict";function t(t){return Math.log(t)/Math.LN10}function i(i,o){if(0==o.ticks.length){for(var e,r,s=o.tickSize,n=o.min,h=o.max,a=Math.floor((h-n)/s+.5)+1,_=0;a>_;_++)r=abs(n+_*s),(void 0===e||r>e&&0!=r)&&(e=r);p=Math.floor(t(e))+1;var c=Math.floor(t(s))+1;c>3?(l=!0,d=c):c>0?(l=!1,d=0):0>c?(l=!0,d=c,p>=0&&(l=!1,d=-c+1)):(l=!1,d=1)}if(0==i)return"0";if(l){var g,u,f=i*pow(10,-d+1);return g=0,u=d-1,p>d&&(f*=.1,g+=1,u+=1),f.toFixed(g)+"e"+u}return i.toFixed(d)}function o(e){if(!(this instanceof o))return new o(e);if(void 0===e&&(e={}),this.graph_options={series:{shadowSize:0},crosshair:{mode:"xy",color:"rgba(0,0,0,1)"}},this.__width=480,this.__height=300,this.__title="",this.__xmin=this.__xmax=this.__ymin=this.__ymax=null,this.wrapper=$("<div/>"),void 0!==e.width&&(this.__width=e.width,delete e.width),void 0!==e.height&&(this.__height=e.height,delete e.height),this.graph_options.xaxis={min:null,max:null,tickFormatter:i},this.graph_options.yaxis={min:null,max:null,tickFormatter:i},void 0!==e.title&&(this.__title=e.title,delete e.title),this.__foreground=color.black,this.__background=color.gray(.95),void 0!==e.foreground){var r=e.foreground;if(!(r instanceof vec))throw new Error("graph foreground must be a vector.");this.__foreground=r,delete e.foreground}if(void 0!==e.background){var r=e.background;if(!(r instanceof vec))throw new Error("graph background must be a vector.");this.__background=r,delete e.background}this.graph_options.grid={color:color.to_html(this.__foreground),backgroundColor:color.to_html(this.__background)},void 0!==e.xmin&&(this.__xmin=this.graph_options.xaxis.min=e.xmin,delete e.xmin),void 0!==e.xmax&&(this.__xmax=this.graph_options.xaxis.max=e.xmax,delete e.xmax),void 0!==e.ymin&&(this.__ymin=this.graph_options.yaxis.min=e.ymin,delete e.ymin),void 0!==e.ymax&&(this.__ymax=this.graph_options.yaxis.max=e.ymax,delete e.ymax),this.__logx=this.__logy=!1,void 0!==e.logx&&(this.__logx=this.graph_options.logx=e.logx,delete e.logx),void 0!==e.logy&&(this.__logy=this.graph_options.logy=e.logy,delete e.logy),this.__logx&&(this.graph_options.xaxis.transform=function(i){return t(i)},this.graph_options.xaxis.inverseTransform=function(t){return pow(10,t)}),this.__logy&&(this.graph_options.yaxis.transform=function(i){return t(i)},this.graph_options.yaxis.inverseTransform=function(t){return pow(10,t)});var s="",n=0;for(var h in e)n+=1,s+=h+", ";if(s.length>0)throw 1==n?new Error(s.slice(0,s.length-2)+" is not an attribute of a graph"):new Error("These are not attributes of a graph: "+s.slice(0,s.length-2));o.selected=this,this.graph_series=[],this.__activated=!1}function e(t){void 0===t?t={data:[]}:void 0===t.data&&(t.data=[]),this.__color=vec(0,0,0),this.__label=null,this.__delta=1,this.__width=1,this.__radius=3,this.__horizontal=!1,this.__dot=!1,this.__dot_color=null,this.__dot_radius=null,this.__data=[],void 0!==t.graph?(this.__graph=t.graph,delete t.graph):void 0!==t.gdisplay?(this.__graph=t.gdisplay,delete t.gdisplay):(this.__graph=o.selected,this.__graph||(this.__graph=o())),this.__type="line",void 0!==t.type&&(this.__type=t.type,delete t.type);var i=this.__ftype=c[this.__type];if(!i)throw new Error("Unknown series type: "+this.__type);if(this.options={},this.options.data=t.data,delete t.data,this.options[i]={show:!0,align:"center",horizontal:!1,barWidth:1},"scatter"==this.__type?this.options.fill=1:"bar"==this.__type?this.options.fill=.5:this.options.fill=0,void 0!==t.horizontal&&(this.__horizontal=this.options[i].horizontal=t.horizontal,delete t.horizontal),void 0!==t.delta&&(this.__delta=this.options[i].barWidth=t.delta,delete t.delta),void 0!==t.width&&(this.__width=this.options[i].lineWidth=t.width,delete t.width),void 0!==t.color){var e=t.color;if(!(e instanceof vec))throw new Error("graph color must be a vector.");this.__color=e,delete t.color}if(this.options.color=color.to_html(this.__color),"scatter"==this.__type?this.options[i].fillColor=this.options.color:this.options.fillColor=this.options.color,void 0!==t.radius&&(this.__radius=this.options[i].radius=t.radius,delete t.radius),void 0!==t.dot&&(this.__dot=t.dot,delete t.dot),void 0!==t.dot_color){var r=t.dot_color;if(!(r instanceof vec))throw new Error("graph dot_color must be a vector.");this.__dot_color=r,delete t.dot_color}void 0!==t.dot_radius&&(this.__dot_radius=t.dot_radius,delete t.dot_radius),void 0!==t.label&&(this.__label=this.options.label=t.label,delete t.label),this.options.data.length>0&&(this.__graph.changed=!0),this.__visible=!0,void 0!==t.visible&&(this.__visible=t.visible,delete t.visible);var s="",n=0;for(var h in t)n+=1,s+=h+", ";if(s.length>0)throw 1==n?new Error(s.slice(0,s.length-2)+" is not an attribute of a series"):new Error("These are not attributes of a graph object: "+s.slice(0,s.length-2));this.__graph.add_to_graph(this),this.remove=function(){this.__graph.changed=!0,this.options.data=[]};var a=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},_=function(t){var i,o;if(o=[],"array"!=a(arguments[0]))return 2==arguments.length?[[arguments[0],arguments[1]]]:null;if("array"!=a(arguments[0][0]))for(var e=0;e<arguments.length;e++){if(i=arguments[e],"array"!=a(i)||2!=i.length)return null;o.push(i)}else for(var e=0;e<arguments[0].length;e++){if(i=arguments[0][e],"array"!=a(i)||2!=i.length)return null;o.push(i)}return o},a=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},_=function(t){var i,o;if(o=[],"array"!=a(arguments[0][0]))for(var e=0;e<arguments.length;e++){if(i=arguments[e],"array"!=a(i)||2!=i.length)return null;o.push(i)}else for(var e=0;e<arguments[0].length;e++){if(i=arguments[0][e],"array"!=a(i)||2!=i.length)return null;o.push(i)}return o};this.plot=function(t){var i;if(void 0!==t.color)throw new Error("Cannot currently change color in a plot statement.");if(void 0!==t.pos)i=_(t.pos);else if("array"==a(t)&&1==arguments.length)i=_(t);else{for(var o=[],e=0;e<arguments.length;e++)o.push(arguments[e]);i=_("array"==a(o[0])?o:[o])}if(null===i)throw new Error("Must be plot(x,y) or plot(pos=[x,y]) or plot([x,y]) or plot([x,y], ...) or plot([ [x,y], ... ])");for(var e=0;e<i.length;e++)this.options.data.push(i[e]);this.__graph.changed=!0,this.__graph.__activated||this.__graph.__activate()}}function r(t){return new e(t)}function s(t){if(void 0===t)return new o;void 0!==t.x&&delete t.x,void 0!==t.y&&delete t.y;var i="",e="",r="",s="&nbsp&nbsp&nbsp&nbsp&nbsp";void 0!==t.title&&(i=t.title,delete t.title),void 0!==t.xtitle&&(e=t.xtitle,delete t.xtitle),void 0!==t.ytitle&&(r=t.ytitle,delete t.ytitle);var n="",h="";return i.length>0&&(e.length>0||r.length>0)?n=i+"<br>":i.length>0&&(n=i),r.length>0?(h=r,e.length>0&&(h+=" vs "+e)):e.length>0&&(h=e),n.length>0&&(n=s+n),h.length>0?t.title=n+s+h:n.length>0&&(t.title=n),new o(t)}function n(t){void 0===t&&(t={}),t.type="line",void 0!==t.pos&&(t.data=t.pos,delete t.pos),void 0!==t.size?(t.dot_radius=t.size/2,delete t.size):t.dot_radius=4;var i=new e(t);return i.gcurve=i,i}function h(t){void 0===t&&(t={}),t.type="scatter",void 0!==t.pos&&(t.data=t.pos,delete t.pos),void 0!==t.size?(t.radius=t.size/2,delete t.size):t.radius=2.6;var i=new e(t);return i.dots=i,i}function a(t){return void 0===t&&(t={}),t.type="bar",void 0!==t.pos&&(t.data=t.pos,delete t.pos),new e(t)}function _(t){return void 0===t&&(t={}),t.type="bar",t.horizontal=!0,void 0!==t.pos&&(t.data=t.pos,delete t.pos),new e(t)}var l=!1,d=0,p=0;property.declare(o,{selected:{get:function(){return window.__context.graph_selected||null},set:function(t){window.__context.graph_selected=t}}}),property.declare(o.prototype,{__activate:function(){this.__activated=!0,this.__activate=function(){},void 0!==this.__title&&this.__title.length>0&&$("<div>"+this.__title+"</div>").appendTo(canvas.container),this.wrapper.addClass("glowscript-graph").css("width",this.__width).css("height",this.__height).appendTo(canvas.container),this.__update()},__update:function(){var t=this;if(window.requestAnimFrame(function(){t.__update.call(t)},this.wrapper.get(0)),this.changed){for(var i=[],o=0;o<this.graph_series.length;o++){var e=this.graph_series[o];if(e.__visible&&(i.push(e.options),e.__dot&&"line"==e.__type&&e.options.data.length>0)){var r={points:{show:!0}};null!==e.__dot_radius?r.points.radius=e.__dot_radius:r.points.radius=e.__width+1,null!==e.__dot_color?r.color=color.to_html(e.__dot_color):r.color=color.to_html(e.__color),r.points.fillColor=r.color,r.data=[e.options.data[e.options.data.length-1]],i.push(r)}}if(this.changed=!1,0!=i.length){var s=$.plot(this.wrapper,i,this.graph_options);s.draw()}}},add_to_graph:function(t){this.graph_series.push(t),t.options.data.length>0&&this.__activate()},changed:!1,remove:function(){this.wrapper.remove()},width:{get:function(){return this.__width},set:function(t){this.__width=t,this.wrapper.css("width",t);var i=$.plot(this.wrapper,[],this.graph_options);i.resize(),i.setupGrid(),this.changed=!0}},height:{get:function(){return this.__height},set:function(t){this.__height=t,this.wrapper.css("height",t);var i=$.plot(this.wrapper,[],this.graph_options);i.resize(),i.setupGrid(),this.changed=!0}},title:{get:function(){return this.__title},set:function(t){this.__title=t,this.changed=!0}},xmin:{get:function(){return this.__xmin},set:function(t){this.__xmin=this.graph_options.xaxis.min=t,this.changed=!0}},xmax:{get:function(){return this.__xmax},set:function(t){this.__xmax=this.graph_options.xaxis.max=t,this.changed=!0}},ymin:{get:function(){return this.__ymin},set:function(t){this.__ymin=this.graph_options.yaxis.min=t,this.changed=!0}},ymax:{get:function(){return this.__ymax},set:function(t){this.__ymax=this.graph_options.yaxis.max=t,this.changed=!0}},logx:{get:function(){return this.__logx},set:function(i){this.__logx!=i&&(i?(this.graph_options.xaxis.transform=function(i){return t(i)},this.graph_options.xaxis.inverseTransform=function(t){return pow(10,t)}):(delete this.graph_options.xaxis.transform,delete this.graph_options.xaxis.inverseTransform),this.__logx=i,this.changed=!0)}},logy:{get:function(){return this.__logy},set:function(i){this.__logy!=i&&(i?(this.graph_options.yaxis.transform=function(i){return t(i)},this.graph_options.yaxis.inverseTransform=function(t){return pow(10,t)}):(delete this.graph_options.yaxis.transform,delete this.graph_options.yaxis.inverseTransform),this.__logy=i,this.changed=!0)}},foreground:{get:function(){return this.__foreground},set:function(t){if(!(t instanceof vec))throw new Error("graph foreground color must be a vector.");this.__foreground.equals(t)||(this.__foreground=t,this.graph_options.grid.color=color.to_html(t),this.changed=!0)}},background:{get:function(){return this.__background},set:function(t){if(!(t instanceof vec))throw new Error("graph background color must be a vector.");this.__background.equals(t)||(this.__background=t,this.graph_options.grid.backgroundColor=color.to_html(t),this.changed=!0)}}});var c={line:"lines",scatter:"points",bar:"bars",__proto__:null};property.declare(e.prototype,{graph:{get:function(){return this.__graph},set:function(t){this.__graph.changed=!0,this.__graph.graph_series.splice(this.__graph.graph_series.indexOf(this),1),this.__graph=t,this.__graph.add_to_graph(this),this.__graph.changed=!0}},type:{get:function(){return this.__type},set:function(t){var i=this.__ftype,o=c[t];if(!o)throw new Error("Unknown series type: "+t);o!=i&&(this.options[o]=this.options[i],delete this.options[i],"scatter"==t?(this.options.fill=1,this.options[o].fillColor=this.options.color):"bar"==t?(this.options.fill=.5,this.options.fillColor=this.options.color):(this.options.fill=0,this.options.fillColor=this.options.color),this.__type=t,this.__graph.changed=!0)}},color:{get:function(){return this.__color},set:function(t){if(!(t instanceof vec))throw new Error("graph color must be a vector.");this.__color.equals(t)||(this.__color=t,this.options.color=color.to_html(t),"scatter"==this.__type?this.options[this.__ftype].fillColor=this.options.color:this.options.fillColor=this.options.color,this.__graph.changed=!0)}},label:{get:function(){return void 0===this.options.label?"":this.options.label},set:function(t){this.options.label!=t&&(this.options.label=t,this.__graph.changed=!0)}},delta:{get:function(){return this.__delta},set:function(t){if(this.__delta!=t){this.__delta=t;var i=c[this.__type];this.options[i].barWidth=t,this.__graph.changed=!0}}},width:{get:function(){return this.__width},set:function(t){if(this.__width!=t){this.__width=t;var i=c[this.__type];this.options[i].lineWidth=t,this.__graph.changed=!0}}},radius:{get:function(){return this.__radius},set:function(t){if(this.__radius!=t){this.__radius=t;var i=c[this.__type];this.options[i].radius=t,this.__graph.changed=!0}}},size:{get:function(){return 2*this.__radius},set:function(t){if(2*this.__radius!=t){this.__radius=t/2;var i=c[this.__type];this.options[i].radius=t/2,this.__graph.changed=!0}}},horizontal:{get:function(){return this.__horizontal},set:function(t){if(this.__horizontal!=t){this.__horizontal=t;var i=c[this.__type];this.options[i].horizontal=t,this.__graph.changed=!0}}},dot:{get:function(){return this.__dot},set:function(t){this.__dot!=t&&(this.__dot=t,this.__graph.changed=!0)}},dot_color:{get:function(){return this.__dot_color},set:function(t){if(!(t instanceof vec))throw new Error("graph dot_color must be a vector.");this.__dot_color.equals(t)||(this.__dot_color=t,this.__graph.changed=!0)}},dot_radius:{get:function(){return this.__dot_radius},set:function(t){this.__dot_radius!=t&&(this.__dot_radius=t,this.__graph.changed=!0)}},visible:{get:function(){return this.__visible},set:function(t){this.__visible!=t&&(this.__visible=t,this.__graph.changed=!0)}},data:{get:function(){return this.options.data},set:function(t){this.options.data=[],this.plot(t)}}});var g={graph:o,series:r,gdisplay:s,vp_graph:s,gcurve:n,gdots:h,gvbars:a,ghbars:_};Export(g)}();
!function(){"use strict";var r={red:vec(1,0,0),green:vec(0,1,0),blue:vec(0,0,1),yellow:vec(1,1,0),orange:vec(1,.6,0),cyan:vec(0,1,1),magenta:vec(1,0,1),white:vec(1,1,1),black:vec(0,0,0),gray:function(r){return vec(r,r,r)},hsv_to_rgb:function(r){var e=r.x,t=r.y,c=r.z;if(0==t)return vec(c,c,c);var a=Math.floor(6*e),n=6*e-a,o=c*(1-t),v=c*(1-t*n),u=c*(1-t*(1-n)),a=a%6;switch(a){case 0:return vec(c,u,o);case 1:return vec(v,c,o);case 2:return vec(o,c,u);case 3:return vec(o,v,c);case 4:return vec(u,o,c);case 5:return vec(c,o,v)}},rgb_to_hsv:function(r){var e=r.x,t=r.y,c=r.z,a=Math.max(e,t,c),n=Math.min(e,t,c),o=a;if(n==a)return vec(0,0,o);var v,u=(a-n)/a,f=(a-e)/(a-n),h=(a-t)/(a-n),l=(a-c)/(a-n);return v=e==a?l-h:t==a?2+f-l:4+h-f,v/=6,0>v&&v++,vec(v,u,o)},to_html:function(r){var e=Math.floor(255*r.x),t=Math.floor(255*r.y),c=Math.floor(255*r.z);return"rgb("+e+","+t+","+c+")"},to_html_rgba:function(r,e){var t=Math.floor(255*r.x),c=Math.floor(255*r.y),a=Math.floor(255*r.z);return"rgba("+t+","+c+","+a+","+e+")"}},e={color:r};Export(e)}();
!function(){"use strict";function subclass(t,i){t.prototype=new i({visible:!1,canvas:null}),t.prototype.constructor=t}function id_to_falsecolor(t){var i=0,e=0,s=0;return t>=16777216&&(i=Math.floor(t/16777216),t-=16777216*i),t>=65536&&(e=Math.floor(t/65536),t-=65536*e),t>=256&&(s=Math.floor(t/256),t-=256*s),[i/255,e/255,s/255,t/255]}function init(t,i){if("vpython"==window.__GSlang&&void 0!==i.display&&(i.canvas=i.display,delete i.display),void 0!==i.canvas?(t.canvas=i.canvas,delete i.canvas):t.canvas=canvas.selected,t.canvas&&(t.canvas.__activate(),t.__model=t.__get_model()),i.__obj&&(t.__obj=i.__obj,delete i.__obj),t.constructor==curve||t.constructor==points){var e=["pos","color","radius","retain"],s={};for(var n in e){var r=e[n];void 0!==i[r]&&(s[r]=i[r],"pos"!=r&&(t[r]=i[r]),delete i[r])}s._constructor=!0,t.push(s)}if(void 0!==i.radius&&(t.radius=i.radius,delete i.radius),void 0!==i.size_units&&(t.size_units=i.size_units,delete i.size_units),void 0!==i.axis&&(t.axis=i.axis,delete i.axis),void 0!==i.size&&(t.size=i.size,delete i.size),void 0!==i.color&&(t.color=i.color,delete i.color),void 0!==i.pos&&(t.pos=i.pos,delete i.pos),t.constructor!=curve&&t.constructor!=points&&void 0!==i.make_trail){if(t.__make_trail=i.make_trail,delete i.make_trail,void 0!==i.interval?(t.__interval=i.interval,delete i.interval):t.__interval=1,void 0!==i.retain?(t.__retain=i.retain,delete i.retain):t.__retain=-1,t.__trail_color=color.white,void 0!==t.color&&(t.__trail_color=t.color),void 0!==i.trail_color&&(t.__trail_color=i.trail_color,delete i.trail_color),t.__trail_radius=0,void 0!==i.trail_radius&&(t.__trail_radius=i.trail_radius,delete i.trail_radius),t.__trail_type="curve",void 0!==i.trail_type){if("curve"!=i.trail_type&&"points"!=i.trail_type)throw new Error("trail_type = "+i.trail_type+" but must be 'curve' or 'points'.");t.__trail_type=i.trail_type,delete i.trail_type}"curve"==t.__trail_type?t.__trail_object=curve({color:t.__trail_color,radius:t.__trail_radius}):t.__trail_object=points({color:t.__trail_color,size:2*t.__trail_radius}),void 0!==t.pos&&t.__trail_object.push(t.pos),t.__ninterval=0}for(var o in i)t[o]=i[o];void 0===i.visible&&null!==t.canvas&&(t.visible=!0)}function initObject(t,i,e){if(!(t instanceof i))return new i(e);if(e=e||{},t.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:!1,right:!1,sides:!1,flipx:!1,flipy:!1,turn:0,flags:0},i!=curve&&i!=points&&void 0===e.pos&&(t.pos=t.pos),void 0===e.color&&(t.color=t.color),i!=curve&&i!=extrusion||(t.origin=t.origin),i!=points){if(i==arrow){if(void 0!==e.axis)throw new Error("arrow does not have axis; replace with axis_and_length");void 0===e.axis_and_length&&(t.axis_and_length=t.axis_and_length)}else{if(i==vp_arrow&&void 0!==e.axis_and_length)throw new Error("VPython arrow does not have axis_and_length; replace with axis");void 0===e.axis&&(t.axis=t.axis)}void 0===e.up&&(t.up=t.up),void 0===e.size&&(t.size=t.size)}void 0===e.opacity&&(t.__opacity=1),void 0===e.make_trail&&(t.__make_trail=!1),t.__opacity_change=!0,init(t,e)}function setup_texture(t,i,e){":"==t.slice(0,1)&&(t="https://s3.amazonaws.com/glowscript/textures/"+t.slice(1)),i.canvas.__renderer.initTexture(t,i,e)}function Primitive(){}function box(t){return initObject(this,box,t)}function cylinder(t){return initObject(this,cylinder,t)}function cone(t){return initObject(this,cone,t)}function pyramid(t){return initObject(this,pyramid,t)}function sphere(t){return initObject(this,sphere,t)}function vp_box(t){return initObject(this,vp_box,t)}function vp_pyramid(t){return initObject(this,vp_pyramid,t)}function vp_sphere(t){return initObject(this,vp_sphere,t)}function vp_ellipsoid(t){return initObject(this,vp_ellipsoid,t)}function vp_cylinder(t){return initObject(this,vp_cylinder,t)}function vp_cone(t){return initObject(this,vp_cone,t)}function arrow_update(t,i){var e,s=t.__pos;t.__color;e=i?t.__axis:t.__axis_and_length;var n=t.__size,r=t.__up,o=n.__x,_=e.norm(),a=t.__shaftwidth||.1*o,h=t.__headwidth||2*a,c=t.__headlength||3*a;if(.02*o>a){var l=.02*o/a;t.__shaftwidth||(a*=l),t.__headwidth||(h*=l),t.__headlength||(c*=l)}if(c>.5*o){var l=.5*o/c;t.__shaftwidth||(a*=l),t.__headwidth||(h*=l),t.__headlength||(c*=l)}var u=t.__components;u||(u=i?t.__components=[vp_box({canvas:t.canvas,__obj:t}),vp_pyramid({canvas:t.canvas,__obj:t})]:t.__components=[box({canvas:t.canvas,__obj:t}),pyramid({canvas:t.canvas,__obj:t})]);var p=u[0],v=u[1];p.pos=s.add(_.multiply(.5*(o-c))),v.pos=s.add(_.multiply(o-c)),p.axis=v.axis=e,p.up=v.up=r,p.size=vec(o-c,a,a),v.size=vec(c,h,h),p.color=v.color=t.color,p.opacity=v.opacity=t.opacity,p.pickable=v.pickable=t.pickable,t.size=vec(o,h,h),p.__update(),v.__update()}function arrow(t){return this instanceof arrow?(this.__shaftwidth=0,this.__headwidth=0,this.__headlength=0,initObject(this,arrow,t)):new arrow(t)}function vp_arrow(t){return this instanceof vp_arrow?(this.__shaftwidth=0,this.__headwidth=0,this.__headlength=0,initObject(this,vp_arrow,t)):new vp_arrow(t)}function vertex(t){if(!(this instanceof vertex))return new vertex(t);t=t||{},void 0!==t.canvas?(this.canvas=t.canvas,delete t.canvas):void 0!==t.display?(this.canvas=t.display,delete t.display):this.canvas=canvas.selected;for(var i in t)this[i]=t[i];if(void 0===t.opacity&&(this.opacity=1),0!==this.__texpos.z)throw new Error("In a vertex the z component of texpos must be zero.");if(this.canvas.vertex_id>=65536)throw new Error("Currently the number of vertices is limited to 65536.");var e={pos:3,normal:3,color:3,opacity:1,shininess:1,emissive:1,texpos:2,bumpaxis:3};if(this.__id=this.canvas.__vertices.available.pop(),void 0===this.__id){this.__id=this.canvas.vertex_id;var s=this.canvas.__vertices;if(this.canvas.vertex_id%s.Nalloc===0){var n,r=this.canvas.vertex_id+s.Nalloc;for(var o in e)n=new Float32Array(e[o]*r),n.set(s[o],0),s[o]=n}this.canvas.vertex_id++}this.canvas.__vertices.object_info[this.__id]={},this.__change()}function tri_quad_error(t,i){throw new Error("A "+t+" has no "+i+" attribute.")}function triangle(t){if(!(this instanceof triangle))return new triangle(t);t=t||{};for(var i=["v0","v1","v2"],e=0;3>e;e++)if(void 0===t[i[e]])throw new Error("A triangle must have a vertex "+i[e]+".");this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:!1,right:!1,sides:!1,flipx:!1,flipy:!1,turn:0,flags:0},init(this,t)}function quad(t){if(!(this instanceof quad))return new quad(t);t=t||{};for(var i=["v0","v1","v2","v3"],e=0;4>e;e++)if(void 0===t[i[e]])throw new Error("A quad must have a vertex "+i[e]+".");this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:!1,right:!1,sides:!1,flipx:!1,flipy:!1,turn:0,flags:0},init(this,t)}function compound(t,i){function e(t,i){for(var e in i){var s=i[e];"min"==e.slice(-3)?(null===t[e]||s<t[e])&&(t[e]=s):(null===t[e]||s>t[e])&&(t[e]=s)}}if(!(this instanceof compound))return new compound(t,i);if(i=i||{},void 0===t.length)throw new Error("compound takes a list of objects");initObject(this,compound,i);var s=!1;if(i.__cloning){s=!0;var n=i.__cloning;delete i.__cloning}var r=!0;if(void 0!==i){for(var o in i)this[o]=i[o];r=void 0===i.visible?!0:i.visible}if(!s){for(var n=new Mesh,_=0;_<t.length;_++){var a=t[_];if(a instanceof extrusion)throw new Error("Cannot currently make a compound of an extrusion object.");if(a instanceof arrow)throw new Error("Currently cannot include an arrow in a compound.");if(a instanceof curve)throw new Error("Currently cannot include a curve in a compound.");if(a instanceof helix)throw new Error("Currently cannot include a helix in a compound.");if(a instanceof label)throw new Error("Currently cannot include a label in a compound.");if(null!==a.__tex.file)throw new Error("Currently objects in a compound cannot have their own texture.");if(null!==a.__tex.bumpmap)throw new Error("Currently objects in a compound cannot have their own bumpmap.");a.visible=!1,a instanceof triangle||a instanceof quad?(e(this,n.merge(a.v0,a.v0,0)),e(this,n.merge(a.v1,a.v1,0)),e(this,n.merge(a.v2,a.v2,0)),this.canvas.__vertices.available.push(a.v0.__id),this.canvas.__vertices.available.push(a.v1.__id),this.canvas.__vertices.available.push(a.v2.__id),a instanceof quad&&(e(this,n.merge(a.v0,a.v0,-3)),e(this,n.merge(a.v2,a.v2,-1)),e(this,n.merge(a.v3,a.v3,0)),this.canvas.__vertices.available.push(a.v3.__id))):e(this,n.merge(a.getTransformedMesh(),a,0))}this.__center=vec((this.__xmin+this.__xmax)/2,(this.__ymin+this.__ymax)/2,(this.__zmin+this.__zmax)/2),this.__pseudosize=vec(this.__xmax-this.__xmin,this.__ymax-this.__ymin,this.__zmax-this.__zmin),compound_id++,n.__mesh_id="compound"+compound_id,this.canvas.__renderer.add_model(n,!1)}this.__mesh=n,this.__model=this.canvas.__renderer.models[n.__mesh_id],this.visible=r}function curve(t){if(!(this instanceof curve))return new curve(t);if(t=t||{},void 0!==t.texture)throw new Error("Textures are not available for curve objects.");if(void 0!==t.opacity)throw new Error("Opacity is not available for curve objects.");this.__points=[],this.__retain=-1,initObject(this,curve,t),void 0===this.radius&&(this.radius=0)}function point(t){if(!(this instanceof point))return new point(t);t instanceof vec&&(t={pos:t});for(var i in t)this[i]=t[i];if(void 0===this.pos)throw new Error("Must specify pos for a point on a curve")}function points(t){if(!(this instanceof points))return new points(t);if(t=t||{},void 0!==t.texture)throw new Error("Textures are not available for points objects.");if(void 0!==t.opacity)throw new Error("Opacity is not available for points objects.");this.__points=[],this.__size=0,this.__retain=-1,this.__pixels=!0,this.__visible=!0,initObject(this,points,t),this.__last_range=-1,this.canvas.__points_objects.push(this)}function helix(t){return initObject(this,helix,t)}function vp_helix(t){return initObject(this,vp_helix,t)}function make_circle(t){var i,e,s,n,r;if(i=void 0===t.pos?vec(0,0,0):t.pos,s=void 0===t.radius?3:t.radius,n=void 0===t.np?32:t.np,r=void 0===t.path?!0:t.path,void 0===t.axis)e=r?vec(0,1,0):vec(0,0,1);else{if(!r)throw new Error("Cannot specify an axis when creating a shape.");e=norm(t.axis)}var o=vec(1,0,0),_=vec(0,1,0),a=vec(0,0,1);_.diff_angle(e)>.001&&(o=norm(_.cross(e)),_=e,a=norm(o.cross(e)));for(var h,c=[],l=2*Math.PI/n,u=Math.cos(l),p=Math.sin(l),v=s,d=0,f=0;n>f;f++)r?c.push(i.add(o.multiply(v).add(a.multiply(-d)))):c.push([i.x+v,i.y+d]),h=v,v=v*u-d*p,d=d*u+h*p;return c.push(c[0]),c}function make_rectangle(t){var i,e,s,n,r;if(i=void 0===t.pos?vec(0,0,0):t.pos,s=void 0===t.width?5:t.width,n=void 0===t.height?3:t.height,r=void 0===t.path?!0:t.path,void 0===t.axis)e=r?vec(0,1,0):vec(0,0,1);else{if(!r)throw new Error("Cannot specify an axis when creating a shape.");e=norm(t.axis)}var o=vec(1,0,0),_=vec(0,1,0),a=vec(0,0,1);_.diff_angle(e)>.001&&(o=norm(_.cross(e)),_=e,a=norm(o.cross(e)));var h=[],c=s/2,l=n/2;if(r)for(var u=[[c,l],[c,-l],[-c,-l],[-c,l]],p=0;4>p;p++){var v=u[p];h.push(i.add(o.multiply(v[0]).add(a.multiply(v[1]))))}else for(var d=[[c,-l],[c,l],[-c,l],[-c,-l]],p=0;4>p;p++){var v=d[p];h.push([i.x+v[0],i.y+v[1]])}return h.push(h[0]),h}function make_extrusion(t){function i(){for(var t=vec(0,0,1),i=d.length,e=d[0].sub(d[i-2]),s=null,n=0;i-1>n;n++){var r=d[n+1].sub(d[n]),o=e.cross(t).norm(),_=r.cross(t).norm(),a=norm(r).dot(norm(e)),h=d[n];if(b>=a)0===n?s={pos:h,normal:o,smooth:!1}:p.push({pos:h,normal:o,smooth:!1}),p.push({pos:h,normal:_,smooth:!1});else{var c=norm(o.add(_));p.push({pos:h,normal:c,smooth:!0})}e=r}null!==s&&p.push(s)}function e(t,i,e,n,r,_){var h=mag(i);r&&(h=1);for(var d=0;E>d;d++){var f=p[d],g=t.add(i.multiply(f.pos.x)).add(e.multiply(h*f.pos.y)),x=f.normal,b=n.multiply(x.x).add(e.multiply(x.y));if(l&&T<u.length){var y=u[T];y.pos=g,y.normal=b,y.color=o,y.opacity=a,T++}else u.push(vertex({pos:g.add(s),normal:b,color:o,opacity:a})),T++}if(!l&&_)for(var m=u.length-2*E,d=m;m+E>d;d++)d==m+E-1?v.push(quad({v0:u[d],v1:u[d+E],v2:u[m+E],v3:u[m],__owner:c})):(v.push(quad({v0:u[d],v1:u[d+E],v2:u[d+E+1],v3:u[d+1],__owner:c})),p[d-m+1].smooth||d++)}var s,n,r,o,_,a,h,c;if(h=t.canvas,c=t.owner,s=void 0===t.origin?vec(0,0,0):t.origin,void 0===t.pos)throw new Error("An extrusion object needs a pos attribute.");if(n=t.pos,void 0===t.shape)throw new Error("An extrusion object needs a shape attribute.");r=t.shape,_=void 0===t.up?h.up:t.up,o=void 0===t.color?color.white:t.color,a=void 0===t.opacity?1:t.opacity;var l=!1,u=[];void 0!==t.vertices&&(u=t.vertices,l=!0);for(var p=[],v=[],d=[],f=0;f<r.length;f++)d.push(vec(r[f][0],r[f][1],0));var g=d[d.length-1].equals(d[0]);if(!g)throw new Error("Currently the extrusion shape must be closed.");var x=n[n.length-1].equals(n[0]);if(!x)throw new Error("Currently the extrusion path must be closed.");var b=.95;i();var y,m,w,z,j,E=p.length,q=n.length,k=norm(n[1].sub(n[0]));x&&(w=k,k=norm(n[0].sub(n[q-2])));for(var V=0,T=0;q>V;){if(!x||V!=q-1||l||A){(V>0||!x)&&(w=q-1>V?norm(n[V+1].sub(n[V])):k),V==q-1&&(k=norm(n[0].sub(n[q-2])),w=norm(n[1].sub(n[0]))),z=w.diff_angle(k)/2,j=norm(k.add(w)),m=norm(k.cross(w)),y=j.cross(m).divide(Math.cos(z));var A,M=k.dot(w)<=b;0===V&&(A=M),M?(V>0&&e(n[V],y,m,norm(k.cross(m)),!0,!0),q-1>V&&e(n[V],y,m,norm(w.cross(m)),!0,!1)):e(n[V],y,m,norm(y),!1,V>0),k=w}else for(var C=u.length-E,P=C;C+E>P;P++)P==C+E-1?v.push(quad({v0:u[P],v1:u[E-1],v2:u[0],v3:u[C],__owner:c})):(v.push(quad({v0:u[P],v1:u[P-C],v2:u[P-C+1],v3:u[P+1],__owner:c})),p[P-C+1].smooth||P++);V++}return u}function arrayequals(t,i){var e=t.length,s=i.length;if(e!==s)return!1;for(var n=0;e>n;n++)if(t[n]!==i[n])return!1;return!0}function extrusion(t){return this instanceof extrusion?(initObject(this,extrusion,t),this.__initialize=!0,void this.__update()):new extrusion(t)}function ring(t){return initObject(this,ring,t)}function vp_ring(t){return initObject(this,vp_ring,t)}function distant_light(t){if(!(this instanceof distant_light))return new distant_light(t);if(void 0===t.direction)throw new Error("Must specify the distant_light, direction:..");init(this,t),this.canvas.lights.push(this)}function local_light(t){if(!(this instanceof local_light))return new local_light(t);if(void 0===t.pos)throw new Error("Must specify the local_light position, pos:..");init(this,t),this.canvas.lights.push(this)}function draw(t){return this instanceof draw?(t=t||{},this.points=[],init(this,t),void this.canvas.__overlay_objects.objects.push(this)):new draw(t)}function label(t){return this instanceof label?(t=t||{},this.pos=this.pos,this.color=this.color,init(this,t),void this.canvas.__overlay_objects.objects.push(this)):new label(t)}function attach_trail(t,i){if(!(this instanceof attach_trail))return new attach_trail(t,i);if(void 0===i&&(i={}),"vpython"==window.__GSlang&&void 0!==i.display&&(i.canvas=i.display,delete i.display),void 0===i.canvas&&(i.canvas=canvas.selected,"function"!=typeof t&&(i.canvas=t.canvas)),void 0===i.type)this.type="curve";else switch(i.type){case"curve":this.type=i.type,delete i.type;break;case"spheres":this.type=i.type,delete i.type;break;default:throw new Error("attach_trail type must be 'curve' or 'spheres'")}this.retain=-1,void 0!==i.retain&&(this.retain=i.retain,delete i.retain),this.pps=0,void 0!==i.pps&&(this.pps=i.pps,delete i.pps);var e;this.__obj=t,"function"!=typeof t?(void 0===i.color&&(i.color=t.color),void 0===i.radius?e=.1*t.size.y:(e=i.radius,delete i.radius)):void 0===i.radius?e=.001*i.canvas.__range:(e=i.radius,delete i.radius),"curve"==this.type?i.radius=e:i.size=vec(2*e,2*e,2*e),i.pickable=!1,this.__options=i,"curve"==this.type?this.__curve=curve({canvas:i.canvas,color:i.color,radius:i.radius}):this.__spheres=[],this.__last_pos=null,this.__last_time=null,this.__run=!0,this.__elements=0,i.canvas.trails.push(this),this.start=function(){this.__run=!0,"curve"===this.type&&(this.curve=curve(this.options))},this.stop=function(){this.__run=!1},this.clear=function(){if(this.__last_pos=null,this.__last_time=null,this.__elements=0,"curve"==this.type)this.__curve.clear();else{for(var t=this.__spheres,i=0;i<t.length;i++)t[i].visible=!1;this.__spheres=[]}}}function attach_arrow(t,i,e){if(!(this instanceof attach_arrow))return new attach_arrow(t,i,e);void 0===e&&(e={}),void 0===e.canvas&&(e.canvas=t.canvas),this.obj=t,this.attr=i,this.scale=1,void 0!==e.scale&&(this.scale=e.scale,delete e.scale),void 0===e.color&&(e.color=t.color),this.options=e;var s=e.canvas;"vpython"==window.__GSlang?this.arrow=vp_arrow(this.options):this.arrow=arrow(this.options),this.arrow.visible=!1,this.arrow.pickable=!1,this.last_pos=null,this.run=!0,s.arrows.push(this),this.start=function(){this.arrow.visible=this.run=!0},this.stop=function(){this.arrow.visible=this.run=!1}}var nextVisibleId=1,textures={flower:":flower_texture.jpg",granite:":granite_texture.jpg",gravel:":gravel_texture.jpg",earth:":earth_texture.jpg",metal:":metal_texture.jpg",rock:":rock_texture.jpg",rough:":rough_texture.jpg",rug:":rug_texture.jpg",stones:":stones_texture.jpg",stucco:":stucco_texture.jpg",wood:":wood_texture.jpg",wood_old:":wood_old_texture.jpg"},bumpmaps={gravel:":gravel_bumpmap.jpg",rock:":rock_bumpmap.jpg",stones:":stones_bumpmap.jpg",stucco:":stucco_bumpmap.jpg",wood_old:":wood_old_bumpmap.jpg"};property.declare(Primitive.prototype,{__id:null,__hasPosAtCenter:!1,__zx_camera:null,__zy_camera:null,__xmin:null,__ymin:null,__zmin:null,__xmax:null,__ymax:null,__zmax:null,pos:new attributeVector(null,0,0,0),color:new attributeVector(null,1,1,1),up:new attributeVector(null,0,1,0),axis:new attributeVector(null,1,0,0),size:new attributeVector(null,1,1,1),opacity:{get:function(){return this.__opacity},set:function(t){t!=this.__opacity&&((this.__opacity<1&&1==t||1==this.__opacity&&1>t)&&(this.__opacity_change=!0),this.__opacity=t,this.__change())}},x:{get:function(){throw new Error('"object.x" is not supported; perhaps you meant "object.pos.x"')},set:function(t){throw new Error('"object.x" is not supported; perhaps you meant "object.pos.x"')}},y:{get:function(){throw new Error('"object.y" is not supported; perhaps you meant "object.pos.y"')},set:function(t){throw new Error('"object.y" is not supported; perhaps you meant "object.pos.y"')}},z:{get:function(){throw new Error('"object.z" is not supported; perhaps you meant "object.pos.z"')},set:function(t){throw new Error('"object.z" is not supported; perhaps you meant "object.pos.z"')}},__opacity_change:!1,__prev_opacity:null,shininess:{value:.6,onchanged:function(){this.__change()}},emissive:{value:!1,onchanged:function(){this.__change()}},pickable:{value:!0,onchanged:function(){this.__change()}},ready:{get:function(){return null===this.__tex.file||null!==this.__tex.texture_ref.reference&&null===this.__tex.bumpmap||null!==this.__tex.bumpmap_ref.reference}},texture:{get:function(){return{file:this.__tex.file,bumpmap:this.__tex.bumpmap,left:this.__tex.left,right:this.__tex.right,sides:this.__tex.sides,flipx:this.__tex.flipx,flipy:this.__tex.flipy,turn:this.__tex.turn}},set:function(t){if(this.__tex={file:null,bumpmap:null,texture_ref:{reference:null},bumpmap_ref:{reference:null},left:!1,right:!1,sides:!1,flipx:!1,flipy:!1,turn:0,flags:0},null===t);else if("string"==typeof t)this.__tex.left=this.__tex.right=this.__tex.sides=!0,setup_texture(t,this,!1);else{if(void 0===t.file||"string"!=typeof t.file)throw new Error("You must specify a file name for a texture.");if(setup_texture(t.file,this,!1),void 0!==t.bumpmap&&null!==t.bumpmap){if("string"!=typeof t.bumpmap)throw new Error("You must specify a file name for a bumpmap.");setup_texture(t.bumpmap,this,!0)}if(void 0!==t.flipx&&(this.__tex.flipx=t.flipx),void 0!==t.flipy&&(this.__tex.flipy=t.flipy),void 0!==t.turn&&(this.__tex.turn=Math.round(t.turn)),void 0!==t.place){"string"==typeof t.place&&(t.place=[t.place]);for(var i=0;i<t.place.length;i++)switch(t.place[i]){case"left":this.__tex.left=!0;break;case"right":this.__tex.right=!0;break;case"sides":this.__tex.sides=!0;break;case"ends":this.__tex.left=this.__tex.right=!0;break;case"all":this.__tex.left=this.__tex.right=this.__tex.sides=!0}}else this.__tex.left=this.__tex.right=this.__tex.sides=!0}this.__tex.flags=0,null!==this.__tex.file&&(this.__tex.flags+=1),null!==this.__tex.bumpmap&&(this.__tex.flags+=2),this.__tex.left&&(this.__tex.flags+=4),this.__tex.right&&(this.__tex.flags+=8),this.__tex.sides&&(this.__tex.flags+=16),this.__tex.flipx&&(this.__tex.flags+=32),this.__tex.flipy&&(this.__tex.flags+=64);var e=this.__tex.turn%4;0>e&&(e+=4),this.__tex.flags+=128*e,this.__change()}},visible:{get:function(){return this.__obj?null!=this.__obj.__id:null!=this.__id},set:function(t){if(!this.__obj&&t!=(null!=this.__id))if(this.__curve&&(this.__curve.visible=t),t){if(this.constructor==vp_arrow||this.constructor==arrow){this.__components||this.__update(),this.__id=nextVisibleId;var i;nextVisibleId++;for(var e=0;e<this.__components.length;e++){var s=this.__components[e];s.__id=nextVisibleId,0===e&&(i=id_to_falsecolor(nextVisibleId)),s.__falsecolor=i,this.canvas.__visiblePrimitives[nextVisibleId]=s,this.canvas.__changed[nextVisibleId]=s,nextVisibleId++}}else this.__id=nextVisibleId,this.__falsecolor=id_to_falsecolor(nextVisibleId),this.canvas.__visiblePrimitives[nextVisibleId]=this,this.canvas.__changed[nextVisibleId]=this,nextVisibleId++;if(this instanceof extrusion)this.__vis=t;else if(this instanceof triangle||this instanceof quad){var n=["__v0","__v1","__v2","__v3"],r=3;this instanceof quad&&(r=4);for(var e=0;r>e;e++)this.canvas.__vertices.object_info[this[n[e]].__id][this.__id]=this}}else{if(this.constructor==vp_arrow||this.constructor==arrow)for(var e=0;e<this.__components.length;e++){var s=this.__components[e];delete this.canvas.__visiblePrimitives[s.__id],delete this.canvas.__changed[s.__id],s.__model&&delete s.__model.id_object[s.__id]}else delete this.canvas.__visiblePrimitives[this.__id],delete this.canvas.__changed[this.__id],this.__model&&delete this.__model.id_object[this.__id];if(this instanceof extrusion)this.__vis=t;else if(this instanceof triangle||this instanceof quad){var n=["__v0","__v1","__v2","__v3"],r=3;this instanceof quad&&(r=4);for(var e=0;r>e;e++)delete this.canvas.__vertices.object_info[this[n[e]].__id][this.__id]}this.__id=null}}},clone:function(t){if(this instanceof triangle||this instanceof quad)throw new Error("Cannot clone a "+this.constructor.name+" object.");if(this instanceof curve)var i={origin:this.__origin,pos:this.pos,color:this.__color,radius:this.__radius,size:this.__size,axis:this.__axis,up:this.__up,shininess:this.__shininess,emissive:this.__emissive,visible:!0,pickable:this.__pickable};if(this instanceof helix)var i={pos:this.pos,color:this.__color,thickness:this.__thickness,coils:this.__coils,size:this.__size,axis:this.__axis,up:this.__up,shininess:this.__shininess,emissive:this.__emissive,visible:!0,pickable:this.__pickable};else var i={pos:this.__pos,color:this.__color,opacity:this.__opacity,size:this.__size,axis:this.__axis,up:this.__up,__tex:this.__tex,shininess:this.__shininess,emissive:this.__emissive,visible:!0,pickable:this.__pickable};for(var e in t)i[e]=t[e];return new this.constructor(i)},__change:function(){this.__id&&(this.canvas.__changed[this.__id]=this)},__get_extent:function(t){Autoscale.find_extent(this,t)},__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__update:function(){if(null!==this.__id){var t=this.__pos,i=this.__size,e=this.__color,s=this.__axis,n=this.__up,r=this.__data;r||(this.__data=r=new Float32Array(20)),this.__model.id_object[this.__id]=this,r[0]=t.__x,r[1]=t.__y,r[2]=t.__z,r[3]=this.__shininess,r[4]=s.__x,r[5]=s.__y,r[6]=s.__z,r[7]=this.__emissive?1:0,r[8]=n.__x,r[9]=n.__y,r[10]=n.__z,r[11]=this.__tex.flags,r[12]=i.__x,r[13]=i.__y,r[14]=i.__z,r[16]=e.__x,r[17]=e.__y,r[18]=e.__z,r[19]=this.__opacity}},rotate:function(t){if(void 0===t||void 0===t.angle)throw new Error("object.rotate() requires angle:...");var i,e,s=t.angle;i=void 0===t.axis?this.__axis:t.axis.norm(),e=void 0===t.origin?this.__pos:t.origin;var n=this.constructor==arrow,r=this.constructor==curve,o=n?this.__axis_and_length.norm():this.__axis.norm(),_=this.__up.norm(),a=o.cross(_);a.dot(a)<1e-10&&(_=vec(1,0,0),a=o.cross(_),a.dot(a)<1e-10&&(_=vec(0,1,0))),r?this.origin=e.add(this.__origin.sub(e).rotate({angle:s,axis:i})):this.pos=e.add(this.__pos.sub(e).rotate({angle:s,axis:i})),n?this.__axis_and_length=this.__axis_and_length.rotate({angle:s,axis:i}):this.axis=this.__axis.rotate({angle:s,axis:i}),this.up=_.rotate({angle:s,axis:i})},getTransformedMesh:function(){var t=this.__axis.norm(),i=this.__up.norm(),e=t.cross(i);e.dot(e)<1e-10&&(i=vec(1,0,0),e=t.cross(i),e.dot(e)<1e-10&&(i=vec(0,1,0)),e=t.cross(i)),e=e.norm(),i=e.cross(t).norm();var s=this.__pos;if(this instanceof ring||this instanceof vp_ring){var n=Mesh.makeRing_compound(this.__size),r=[t.x,t.y,t.z,0,i.x,i.y,i.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,1];return n.transformed(r)}t=t.multiply(this.__size.x),i=i.multiply(this.__size.y),e=e.multiply(this.__size.z);var r=[t.x,t.y,t.z,0,i.x,i.y,i.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,1];return this.__model.mesh.transformed(r)}}),subclass(box,Primitive),box.prototype.__hasPosAtCenter=!0,subclass(cylinder,Primitive),subclass(cone,cylinder),subclass(pyramid,box),subclass(sphere,Primitive),sphere.prototype.__hasPosAtCenter=!0,subclass(vp_box,box),property.declare(vp_box.prototype,{pos:new attributeVectorPos(null,0,0,0),axis:new attributeVectorAxis(null,1,0,0),size:new attributeVectorSize(null,1,1,1),display:{get:function(){return this.canvas},set:function(t){throw new Error("Cannot change display of existing object")}},length:{get:function(){return this.__size.__x},set:function(t){this.axis=this.__axis.norm().multiply(t),this.__change()}},height:{get:function(){return this.__size.__y},set:function(t){this.__size.__y=t,this.__change()}},width:{get:function(){return this.__size.__z},set:function(t){this.__size.__z=t,this.__change()}},red:{get:function(){return this.__color.__x},set:function(t){this.__color.__x=t,this.__change()}},green:{get:function(){return this.__color.__y},set:function(t){this.__color.__y=t,this.__change()}},blue:{get:function(){return this.__color.__z},set:function(t){this.__color.__z=t,this.__change()}},make_trail:{get:function(){return this.__make_trail},set:function(t){this.__make_trail=t}},interval:{get:function(){return this.__interval},set:function(t){this.__interval=t,this.__ninterval=0}},retain:{get:function(){return this.__retain},set:function(t){this.__retain=t}},trail_type:{get:function(){return"curve"==this.__trail_type?"curve":"spheres"==this.__trail_type?"points":this.__trail_type},set:function(t){if("curve"==t)this.__trail_type="curve";else{if("points"!=t)throw new Error('trail_type must be "curve" or "points".');this.__trail_type="spheres"}}},trail_object:{get:function(){return this.__trail_object}},trail_color:{get:function(){return this.__trail_object.color},set:function(t){this.__trail_object.color=t}},trail_radius:{get:function(){return this.__trail_object.radius},set:function(t){this.__trail_object.radius=t}},__update_trail:function(t){this.__ninterval++,this.__ninterval>=this.__interval&&(this.__ninterval=0,-1==this.__retain?this.__trail_object.push(t):this.__trail_object.push({pos:t,retain:this.__retain}))}}),subclass(vp_pyramid,vp_box),subclass(vp_sphere,vp_box),property.declare(vp_sphere.prototype,{axis:new attributeVector(null,1,0,0),size:new attributeVector(null,2,2,2),radius:{get:function(){return this.__size.__y/2},set:function(t){this.size=vec(2*t,2*t,2*t),this.__change()}}}),subclass(vp_ellipsoid,vp_box),property.declare(vp_ellipsoid.prototype,{radius:{get:function(){throw new Error("An ellipsoid does not have a radius attribute.")},set:function(t){throw new Error("An ellipsoid does not have a radius attribute.")}}}),subclass(vp_cylinder,vp_box),property.declare(vp_cylinder.prototype,{size:new attributeVectorSize(null,1,2,2),radius:{get:function(){return this.__size.__y/2},set:function(t){this.__size.__y=this.__size.__z=2*t,this.__change()}}}),subclass(vp_cone,vp_cylinder),subclass(arrow,box),property.declare(arrow.prototype,{__primitiveCount:2,shaftwidth:{get:function(){return this.__shaftwidth},set:function(t){this.__shaftwidth=t,this.__change()}},headwidth:{get:function(){return this.__headwidth},set:function(t){this.__headwidth=t,this.__change()}},headlength:{get:function(){return this.__headlength},set:function(t){this.__headlength=t,this.__change()}},axis_and_length:new attributeVectorAxis(null,1,0,0),axis:{get:function(){new Error("arrow has an axis_and_length attribute but no axis attribute")},set:function(t){new Error("arrow has an axis_and_length attribute but no axis attribute")}},__change:function(){this.__components&&(this.__components[0].__change(),this.__components[1].__change())},__update:function(){arrow_update(this,!1)},__get_extent:function(t){this.__components||this.__update(),Autoscale.find_extent(this.__components[0],t),Autoscale.find_extent(this.__components[1],t)}}),subclass(vp_arrow,arrow),property.declare(vp_arrow.prototype,{axis:new attributeVectorAxis(null,1,0,0),axis_and_length:{get:function(){new Error("arrow has an axis attribute but no axis_and_length attribute")},set:function(t){new Error("arrow has an axis attribute but no axis_and_length attribute")}},__update:function(){arrow_update(this,!0)}}),property.declare(vertex.prototype,{__id:null,__hasPosAtCenter:!0,pos:new attributeVector(null,0,0,0),normal:new attributeVector(null,0,0,1),color:new attributeVector(null,1,1,1),opacity:{get:function(){return this.__opacity},set:function(t){if(t!=this.__opacity){if(this.__opacity<1&&1==t||1==this.__opacity&&1>t){var i=this.canvas.__vertices.object_info[this.__id];for(var e in i)i[e].__change(),i[e].__opacity_change=!0}this.__opacity=t,this.canvas.__vertex_changed[this.__id]=this}}},display:{get:function(){return this.canvas},set:function(t){throw new Error("Cannot change display of existing object")}},texpos:new attributeVector(null,0,0,0),bumpaxis:new attributeVector(null,1,0,0),shininess:{value:.6,onchanged:function(){this.__change()}},emissive:{value:!1,onchanged:function(){this.__change()}},__change:function(){if(this.__id&&(this.canvas.__vertex_changed[this.__id]=this,this.canvas.__autoscale)){var t=this.canvas.__vertices.object_info[this.__id];for(var i in t)t[i].__change()}},rotate:function(t){if(void 0===t.angle)throw new Error("vertex.rotate() requires angle:...");var i=t.angle;if(void 0===t.axis)throw new Error("vertex.rotate() requires axis:...");var e,s=t.axis.norm();e=void 0===t.origin?vec(0,0,0):t.origin,this.pos=e.add(this.__pos.sub(e).rotate({angle:i,axis:s})),this.__change()}}),subclass(triangle,box),property.declare(triangle.prototype,{v0:{get:function(){return this.__v0},set:function(t){if(!(t instanceof vertex))throw new Error("v0 must be a vertex object.");this.__v0=t,this.__change()}},v1:{get:function(){return this.__v1},set:function(t){if(!(t instanceof vertex))throw new Error("v1 must be a vertex object.");this.__v1=t,this.__change()}},v2:{get:function(){return this.__v2},set:function(t){if(!(t instanceof vertex))throw new Error("v2 must be a vertex object.");this.__v2=t,this.__change()}},display:{get:function(){return this.canvas},set:function(t){throw new Error("Cannot change display of existing object")}},pos:{get:function(){tri_quad_error("triangle","pos")},set:function(t){tri_quad_error("triangle","pos")}},color:{get:function(){tri_quad_error("triangle","color")},set:function(t){tri_quad_error("triangle","color")}},size:{get:function(){tri_quad_error("triangle","size")},set:function(t){tri_quad_error("triangle","size")}},axis:{get:function(){tri_quad_error("triangle","axis")},set:function(t){tri_quad_error("triangle","axis")}},up:{get:function(){tri_quad_error("triangle","up")},set:function(t){tri_quad_error("triangle","up")}},opacity:{get:function(){tri_quad_error("triangle","opacity")},set:function(t){tri_quad_error("triangle","opacity")}},shininess:{get:function(){tri_quad_error("triangle","shininess")},set:function(t){
tri_quad_error("triangle","shininess")}},emissive:{get:function(){tri_quad_error("triangle","emissive")},set:function(t){tri_quad_error("triangle","emissive")}},__prev_texture:null,__prev_bumpmap:null,__update:function(){this.__model.id_object[this.__id]=this},__get_extent:function(t){for(var i=["__v0","__v1","__v2"],e=0;3>e;e++)t.point_extent(this,this[i[e]].pos)},rotate:function(t){throw new Error("A triangle has no rotate method; rotate the vertices instead.")}}),subclass(quad,box),property.declare(quad.prototype,{v0:{get:function(){return this.__v0},set:function(t){if(!(t instanceof vertex))throw new Error("v0 must be a vertex object.");this.__v0=t,this.__change()}},v1:{get:function(){return this.__v1},set:function(t){if(!(t instanceof vertex))throw new Error("v1 must be a vertex object.");this.__v1=t,this.__change()}},v2:{get:function(){return this.__v2},set:function(t){if(!(t instanceof vertex))throw new Error("v2 must be a vertex object.");this.__v2=t,this.__change()}},v3:{get:function(){return this.__v3},set:function(t){if(!(t instanceof vertex))throw new Error("v3 must be a vertex object.");this.__v3=t,this.__change()}},pos:{get:function(){tri_quad_error("quad","pos")},set:function(t){tri_quad_error("quad","pos")}},color:{get:function(){tri_quad_error("quad","color")},set:function(t){tri_quad_error("quad","color")}},size:{get:function(){tri_quad_error("quad","size")},set:function(t){tri_quad_error("quad","size")}},axis:{get:function(){tri_quad_error("quad","axis")},set:function(t){tri_quad_error("quad","axis")}},up:{get:function(){tri_quad_error("quad","up")},set:function(t){tri_quad_error("quad","up")}},opacity:{get:function(){tri_quad_error("quad","opacity")},set:function(t){tri_quad_error("quad","opacity")}},shininess:{get:function(){tri_quad_error("quad","shininess")},set:function(t){tri_quad_error("quad","shininess")}},display:{get:function(){return this.canvas},set:function(t){throw new Error("Cannot change display of existing object")}},__prev_texture:null,__prev_bumpmap:null,__update:function(){this.__model.id_object[this.__id]=this},__get_extent:function(t){for(var i=["__v0","__v1","__v2","__v3"],e=0;4>e;e++)t.point_extent(this,this[i[e]].pos)},rotate:function(t){throw new Error("A quad has no rotate method; rotate the vertices instead.")}});var compound_id=0;subclass(compound,box),property.declare(compound.prototype,{clone:function(t){var i={pos:this.__pos,color:this.__color,opacity:this.__opacity,size:this.__size,axis:this.__axis,up:this.__up,textures:this.__texture,shininess:this.__shininess,emissive:this.__emissive,visible:!0,pickable:this.__pickable,__center:this.__center,__pseudosize:this.__pseudosize};for(var e in t)i[e]=t[e];return i.__cloning=this.__mesh,new this.constructor([],i)},_world_zaxis:function(){var t,i=this.__axis,e=this.__up;return t=Math.abs(i.dot(e))/Math.sqrt(e.mag2()*i.mag2())>.98?Math.abs(i.norm().dot(vec(-1,0,0)))>.98?i.cross(vec(0,0,1)).norm():i.cross(vec(-1,0,0)).norm():i.cross(e).norm()},world_to_compound:function(t){var i=this.__axis,e=this._world_zaxis(),s=e.cross(i).norm(),n=i.norm(),t=t.sub(this.__pos);return vec(t.dot(n),t.dot(s),t.dot(e))},compound_to_world:function(t){var i=this.__axis,e=this._world_zaxis(),s=e.cross(i).norm(),n=i.norm();return this.__pos.add(n.multiply(t.x)).add(s.multiply(t.y)).add(e.multiply(t.z))},__get_model:function(){return this.__model},__get_extent:function(t){var i=this.__pos,e=this.__size,s=vec(this.__size.x*this.__center.x,this.__size.y*this.__center.y,this.__size.z*this.__center.z),n=s.add(this.__pos),r=vec(this.__size.x*this.__pseudosize.x,this.__size.y*this.__pseudosize.y,this.__size.z*this.__pseudosize.z);this.__pos=n,this.__pos.__x=n.x,this.__pos.__y=n.y,this.__pos.__z=n.z,this.__size=r,this.__size.__x=r.x,this.__size.__y=r.y,this.__size.__z=r.z,Autoscale.find_extent(this,t),this.__pos=i,this.__size=e}});var toType=function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};subclass(curve,Primitive),property.declare(curve.prototype,{origin:new attributeVectorPos(null,0,0,0),pos:{get:function(){for(var t=[],i=this.__points,e=0;e<i.length;e++)t.append(i[e].__pos);return t},set:function(t){this.__points=[],this.push(t)}},radius:0,retain:{get:function(){return this.__retain},set:function(t){this.__retain=t}},npoints:{get:function(){return this.__points.length},set:function(t){throw new Error("Cannot change curve or points npoints.")}},display:{get:function(){return this.canvas},set:function(t){throw new Error("Cannot change display of existing object")}},__no_autoscale:!1,__get_extent:function(t){if(!this.__no_autoscale){for(var i,e=null,s=null,n=null,r=null,o=null,_=null,a=this.__points.length,h=this.__points,c=0;a>c;c++)i=h[c].__pos,(null===e||i.x<e)&&(e=i.x),(null===s||i.y<s)&&(s=i.y),(null===n||i.z<n)&&(n=i.z),(null===r||i.x>r)&&(r=i.x),(null===o||i.y>o)&&(o=i.y),(null===_||i.z>_)&&(_=i.z);var l=vec((e+r)/2,(s+o)/2,(n+_)/2),u=vec(r-e,o-s,_-n),p=this.__pos,v=this.__size,d=vec(this.__size.x*l.x,this.__size.y*l.y,this.__size.z*l.z),f=d.add(this.__pos),g=vec(this.__size.x*u.x,this.__size.y*u.y,this.__size.z*u.z);this.__pos=f,this.__pos.__x=f.x,this.__pos.__y=f.y,this.__pos.__z=f.z,this.__size=g,this.__size.__x=g.x,this.__size.__y=g.y,this.__size.__z=g.z,Autoscale.find_extent(this,t),this.__pos=p,this.__size=v}},push:function(t){var i,e=[];if(void 0!==t.length)e=t;else for(var s=0;s<arguments.length;s++)e.push(arguments[s]);var n={},r=["color","radius","retain","visible"];for(var o in r){var _=r[o];_ in e&&(n[_]=e[_])}var a=toType(e),h=!1;e instanceof vec?e=[{pos:e}]:"array"==a?e[0]instanceof vec?e=[{pos:e}]:"object"==toType(e[0])&&(h=!0):"object"==a&&(e=[e]);for(var s=0;s<e.length;s++){var c=e[s];if(i=null,toType("array"==c))i=c;else if(c instanceof vec)i=[c];else if("object"!=toType(c))throw new Error("curve or points syntax error");if("pos"in c&&(i=c.pos,"array"!=toType(i)&&(i=[i])),null===i&&void 0===e._constructor)throw new Error("pos must be specified for curve or points objects");for(var l=0;l<i.length;l++){var u=i[l];u instanceof vec||(u=vec(u[0],u[1],u[2]));var p;if(h)p=c,p.pos=u;else{p={pos:u};for(var o in n)p[o]=n[o]}if(this.constructor==curve){var v=point(p),d=this.__retain;if(void 0!==p.retain&&(d=p.retain),d>-1&&this.__points.length>=d){for(var f=this.__points.length-d,g=0;f>g;g++){var x=this.__points.shift();x.visible=!1}var b=this.__points[this.__points.length-1],v=this.__points.shift();for(var o in p)v[o]=p[o];this.__points.push(v);var y=v.__prevsegment=b.__nextsegment=new Float32Array(16);y[11]=y[15]=1,b.__change(),v.__change()}else{if(v.__curve=this,v.__id=nextVisibleId++,this.canvas.__visiblePrimitives[v.__id]=v,v.__falsecolor=id_to_falsecolor(v.__id),this.__points.length){var b=this.__points[this.__points.length-1],y=v.__prevsegment=b.__nextsegment=new Float32Array(16);y[11]=y[15]=1,b.__change()}this.__points.push(v),v.__change()}}else{var d=this.__retain;if(void 0!==p.retain&&(d=p.retain),d>-1&&this.__points.length>=d){for(var f=this.__points.length-d,g=0;f>g;g++){var x=this.__points.shift();x.visible=!1}var b=this.__points[this.__points.length-1],v=this.__points.shift();for(var o in p)v[o]=p[o];this.__points.push(v),v.__change()}else{var m=this.__size,w=void 0===p.color?this.__color:p.color;-1!=this.__last_range&&this.__last_range===this.canvas.__range?m=this.__points[0].__size.x:(m=0,this.__last_range=-1),"vpython"==window.__GSlang?this.__points.push(vp_sphere({pos:p.pos,size:vec(m,m,m),color:w,pickable:!1})):this.__points.push(sphere({pos:p.pos,size:vec(m,m,m),color:w,pickable:!1}))}}}}this.__change()},append:function(t){var i=[];if(void 0!==t.length)i=t;else for(var e=0;e<arguments.length;e++)i.push(arguments[e]);this.push(i)},pop:function(){var t=this.__points.pop();return t.visible=!1,this.__change(),{pos:t.pos,color:t.color,radius:t.radius,visible:t.visible}},point:function(t){var i=this.__points.slice(t,t+1)[0];return{pos:i.pos,color:i.color,radius:i.radius,visible:i.visible}},clear:function(){this.splice(0,this.__points.length),this.__change()},shift:function(){var t=this.__points.shift();return t.visible=!1,this.__change(),{pos:t.pos,color:t.color,radius:t.radius,visible:t.visible}},unshift:function(t){var i=[];if(void 0!==t.length)i=t;else for(var e=0;e<arguments.length;e++)i.push(arguments[e]);this.splice(0,0,i),this.__change()},splice:function(t){for(var i=arguments[0],e=arguments[1],s=[],n=2;n<arguments.length;n++)s.push(arguments[n]);1==s.length&&void 0!==s[0].length&&(s=s[0]);for(var r=this.__points.slice(i+e),o=[],n=0;n<r.length;n++)o.push({pos:r[n].pos,color:r[n].color,radius:r[n].radius,visible:r[n].visible});for(var n=i;n<this.__points.length;n++)this.__points[n].visible=!1;this.__points.splice(i),this.push(s),this.push(o),this.__change()},modify:function(t,i){0>t&&(t+=this.__points.length),i instanceof vec&&(i={pos:i});for(var e in i)"x"==e&&(this.__points[t].pos.x=i[e]),"y"==e&&(this.__points[t].pos.y=i[e]),"z"==e?this.__points[t].pos.z=i[e]:this.__points[t][e]=i[e];this.__points[t].__change(),this.__change()},slice:function(t,i){0>t&&(t+=this.__points.length),0>i&&(i+=this.__points.length);for(var e=this.__points.slice(t,i),s=[],n=0;n<e.length;n++)s.push({pos:e[n].pos,color:e[n].color,radius:e[n].radius,visible:e[n].visible});return s},__update:function(){var t=this.__origin,i=this.__size,e=this.__color,s=this.__axis,n=this.__up,r=this.__data;r||(this.__data=r=new Float32Array(20)),this.__model.id_object[this.__id]=this,r[0]=t.__x,r[1]=t.__y,r[2]=t.__z,r[3]=this.__shininess,r[4]=s.__x,r[5]=s.__y,r[6]=s.__z,r[7]=this.__emissive?1:0,r[8]=n.__x,r[9]=n.__y,r[10]=n.__z,r[12]=i.__x,r[13]=i.__y,r[14]=i.__z,r[15]=this.__radius,r[16]=e.__x,r[17]=e.__y,r[18]=e.__z,r[19]=this.__opacity}}),property.declare(point.prototype,{__curve:null,pos:new attributeVector(null,0,0,0),color:new attributeVector(null,-1,-1,-1),radius:{value:-1,onchanged:function(){this.__change()}},pickable:{value:!0,onchanged:function(){this.__change()}},visible:{value:!0,onchanged:function(){this.__change()}},__change:function(){this.__id&&(this.__curve.canvas.__changed[this.__id]=this,this.__curve.canvas.__changed[this.__curve.__id]=this.__curve)},__update:function(){var t=this.__pos,i=this.radius||-1,e=this.color||vec(-1,-1,-1),s=this.__prevsegment;s&&(s[4]=t.x,s[5]=t.y,s[6]=t.z,s[7]=i,s[12]=e.x,s[13]=e.y,s[14]=e.z),s=this.__nextsegment,s&&(s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=i,s[8]=e.x,s[9]=e.y,s[10]=e.z)}}),subclass(points,curve),property.declare(points.prototype,{origin:{get:function(){throw new Error("The points object has no origin attribute.")},set:function(t){throw new Error("The points object has no origin attribute.")}},axis:{get:function(){throw new Error("The points object has no axis attribute.")},set:function(t){throw new Error("The points object has no axis attribute.")}},up:{get:function(){throw new Error("The points object has no up attribute.")},set:function(t){throw new Error("The points object has no up attribute.")}},radius:{get:function(){throw new Error("The points object does not have a radius attribute.")},set:function(t){throw new Error("The points object does not have a radius attribute.")}},size:{get:function(){return this.__size},set:function(t){this.__size=t}},size_units:{get:function(){return this.__pixels?"pixels":"world"},set:function(t){if("pixels"==t)this.__pixels=!0;else{if("world"!=t)throw new Error("The points object ");this.__pixels=!1}}},shape:{get:function(){return"round"},set:function(t){if("round"!=t)throw new Error('The points object only supports shape = "round".')}},visible:{get:function(){return this.__visible},set:function(t){for(var i in this.__points)this.__points[i].visible=t}},__update:function(){}}),subclass(helix,cylinder),property.declare(helix.prototype,{__initialize:!0,thickness:{value:0,onchanged:function(){this.__change()}},coils:{value:5,onchanged:function(){this.__initialize=!0,this.__change()}},__update:function(){var t=20;this.__initialize&&(void 0!==this.__curve?this.__curve.clear():this.__curve=curve({canvas:this.canvas,__no_autoscale:!0}));var i=this.__curve;if(i.origin=this.__pos,i.axis=this.__axis,i.up=this.__up,i.size=this.__size,i.color=this.__color,i.radius=this.__thickness?this.__thickness/2:this.__size.y/40,this.__initialize){for(var e,s=(vec(1,0,0),vec(0,1,0),vec(0,0,1),.5),n=this.__coils*t,r=1/n,o=Math.sin(2*Math.PI/t),_=Math.cos(2*Math.PI/t),a=0,h=0,c=s,l=0;n+1>l;l++)i.push(vec(a,h,c)),a+=r,e=c*_-h*o,h=h*_+c*o,c=e;this.__initialize=!1}}}),subclass(vp_helix,helix),property.declare(vp_helix.prototype,{axis:new attributeVectorAxis(null,1,0,0),size:new attributeVectorSize(null,1,2,2),display:{get:function(){return this.canvas},set:function(t){throw new Error("Cannot change display of existing object")}},radius:{get:function(){return this.__size.__y/2},set:function(t){this.__size.__y=this.__size.__z=2*t,this.__change()}},length:{get:function(){return this.__size.__x},set:function(t){this.__size.__x=t,this.__change()}},height:{get:function(){return this.__size.__y},set:function(t){this.__size.__y=t,this.__change()}},width:{get:function(){return this.__size.__z},set:function(t){this.__size.__z=t,this.__change()}}});var paths={circle:function(t){return t=t||{},t.path=!0,make_circle(t)},rectangle:function(t){return t=t||{},t.path=!0,make_rectangle(t)}},shapes={circle:function(t){return t=t||{},t.path=!1,make_circle(t)},rectangle:function(t){return t=t||{},t.path=!1,make_rectangle(t)}};subclass(extrusion,Primitive),property.declare(extrusion.prototype,{texture:{get:function(){throw new Error("Textures are not available for extrusion objects.")},set:function(t){throw new Error("Textures are not available for extrusion objects.")}},radius:{get:function(){throw new Error("An extrusion has no radius.")},set:function(t){throw new Error("An extrusion has no radius.")}},display:{get:function(){return this.canvas},set:function(t){throw new Error("Cannot change display of existing object")}},origin:new attributeVector(null,0,0,0),__initialize:!0,pos:{get:function(){for(var t=[],i=0;i<this.pos.length;i++)t.push(this.__pos[i].sub(this.__origin));return t},set:function(t){this.__pos=t,this.__change()}},shape:{get:function(){return this.__shape},set:function(t){this.__shape=t,this.__change()}},color:{get:function(){return this.__color},set:function(t){this.__color=t,this.__change()}},opacity:{get:function(){return this.__opacity},set:function(t){t!=this.__opacity&&((this.__opacity<1&&1==t||1==this.__opacity&&1>t)&&(this.__opacity_change=!0),this.__opacity=t,this.__change())}},__get_extent:function(t){this.__comp&&this.__comp.__get_extent(t)},clone:function(t){var i={canvas:this.canvas,origin:this.__origin,pos:this.__pos,shape:this.__shape,color:this.__color,__lastcolor:this.__lastcolor,opacity:this.__opacity,__lastopacity:this.__lastopacity,visible:!0};for(var e in t){if("pos"==e)throw new Error("Can clone an extrusion with new origin, not new pos");i[e]=t[e]}return new this.constructor(i)},__update:function(){if(!this.__initialize)if(arrayequals(this.__pos,this.__lastpos)&&arrayequals(this.__shape,this.__lastshape)){var t=!this.__color.equals(this.__lastcolor),i=this.__opacity!==this.__lastopacity,e=!this.__origin.equals(this.__lastorigin);if(t||i||e)for(var s=this.__origin.sub(this.__lastorigin),n=0;n<this.__vertices.length;n++){var r=this.__vertices[n];t&&(r.color=this.__color),i&&(r.opacity=this.__opacity),e&&(r.pos=r.pos.add(s))}this.__lastpos=this.__pos.slice(),this.__lastshape=this.__shape.slice(),this.__lastcolor=vec(this.__color),this.__lastopacity=this.__opacity,this.__lastorigin=vec(this.__origin),this.__initialize=!1}else this.__initialize=!0;this.__initialize&&(this.__vertices=make_extrusion({canvas:this.canvas,vertices:this.__vertices,origin:this.__origin,pos:this.__pos,shape:this.__shape,color:this.__color,opacity:this.__opacity,owner:this}),this.__lastpos=this.__pos.slice(),this.__lastshape=this.__shape.slice(),this.__lastcolor=vec(this.__color),this.__lastopacity=this.__opacity,this.__lastorigin=vec(this.__origin),this.__initialize=!1)}}),subclass(ring,box),property.declare(ring.prototype,{size:new attributeVector(null,.1,1,1)}),subclass(vp_ring,vp_box),property.declare(vp_ring.prototype,{axis:new attributeVector(null,1,0,0),size:new attributeVector(null,.2,2.2,2.2),thickness:{get:function(){return this.__size.__x/2},set:function(t){var i=this.radius;this.__thickness=t,this.__size.x=2*t,this.__size.y=this.__size.z=2*(t+i),this.__change()}},radius:{get:function(){return(this.__size.y-this.__size.x)/2},set:function(t){var i=this.thickness;this.__radius=t,this.__size.y=this.__size.z=2*(t+i),this.__change()}}}),property.declare(distant_light.prototype,{direction:new attributeVector(null,0,0,1),color:new attributeVector(null,1,1,1),__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__change:function(){}}),property.declare(local_light.prototype,{pos:new attributeVector(null,0,0,0),color:new attributeVector(null,1,1,1),__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__change:function(){}}),property.declare(draw.prototype,{color:{value:null,type:property.nullable_attributeVector},fillcolor:{value:null,type:property.nullable_attributeVector},linewidth:{value:1,onchanged:function(){this.__change()}},opacity:{value:.66,onchanged:function(){this.__change()}},visible:{value:!1,onchanged:function(){this.__change()}},__get_model:function(){return this.canvas.__renderer.models[this.constructor.name]},__update:function(t,i){var e=this.points.length;if(!(2>e)){if(null!=this.fillcolor){t.lineWidth=1,t.fillStyle=color.to_html_rgba(this.fillcolor,this.opacity),t.beginPath();for(var s=0;e>s;s++)0==s?t.moveTo(this.points[s].x,this.points[s].y):t.lineTo(this.points[s].x,this.points[s].y);t.fill()}if(null!=this.color){t.lineWidth=this.linewidth,t.strokeStyle=color.to_html_rgba(this.color,this.opacity),t.beginPath();for(var s=0;e>s;s++)0==s?t.moveTo(this.points[s].x,this.points[s].y):s==e-1&&this.points[s].equals(this.points[0])?t.closePath():t.lineTo(this.points[s].x,this.points[s].y);t.stroke()}}},__change:function(){this.canvas.__overlay_objects.__changed=!0}}),property.declare(label.prototype,{pos:new attributeVector(null,0,0,0),color:{value:null,type:property.nullable_attributeVector},line:{value:!0,onchanged:function(){this.__change()}},linecolor:{value:null,type:property.nullable_attributeVector},background:{value:null,type:property.nullable_attributeVector},opacity:{value:.66,onchanged:function(){this.__change()}},text:{value:"",onchanged:function(){this.__change()}},font:{value:"Verdana",onchanged:function(){this.__change()}},height:{value:13,onchanged:function(){this.__change()}},visible:{value:!1,onchanged:function(){this.__change()}},align:{value:"center",onchanged:function(){this.__change()}},box:{value:!0,onchanged:function(){this.__change()}},border:{value:5,onchanged:function(){this.__change()}},linewidth:{value:1,onchanged:function(){this.__change()}},xoffset:{value:0,onchanged:function(){this.__change()}},yoffset:{value:0,onchanged:function(){this.__change()}},space:{value:0,onchanged:function(){this.__change()}},pixel_pos:{value:!1,onchanged:function(){this.__change()}},__get_model:function(){return null},__update:function(t,i){function e(i,e,s,n){var _,a,h,c,u,p,v=e,d=s,f=t.measureText(n).width;if(_=Math.ceil(f),a=Math.ceil(i.__height+2*i.__border),h=Math.floor(v-i.__border)+.5,c=Math.ceil(d-.4*a)-.5,r||o){if(Math.abs(o)>Math.abs(r)?(o>0?(c-=o+a/2,d-=o+a/2,p=c+a):(c-=o-a/2,d-=o-a/2,p=c),v+=r-_/2,h=v-i.__border,u=v+_/2):(r>0?(h+=r,v+=r,u=h):(v+=r-_,h=v-i.__border,u=v+_+i.__border),d-=o,c-=o,p=c+a/2),i.__line){if(t.beginPath(),i.space>0){var g=vec(u-e,p-s,0).norm().multiply(l*i.space);g=g.add(vec(e,s,0)),t.moveTo(g.x,g.y)}else t.moveTo(e,s);t.lineTo(u,p),t.stroke()}}else switch(i.__align){case"center":v-=f/2,h-=f/2;break;case"right":v-=f,h-=f}return _+=2*i.__border,[h,c,_,a,v,d]}var s,n,r=this.__xoffset,o=this.__yoffset;if(this.__pixel_pos)s=this.__pos.x,n=this.__pos.y,o=-o;else{if(this.canvas.__width>=this.canvas.__height)var _=2*this.canvas.__range/this.canvas.__height;else var _=2*this.canvas.__range/this.canvas.__width;var a=mat4.lookAt(i.pos,i.target,i.up),h=mat4.multiplyVec3(a,vec3.create([this.pos.x,this.pos.y,this.pos.z]));if(h[2]>-i.zNear||h[2]<-i.zFar)return;var c=i.distance,l=-c/(h[2]*_);s=Math.round(l*h[0]+this.canvas.__width/2),n=Math.round(-l*h[1]+this.canvas.__height/2)}t.font=this.__height+"px "+this.__font,t.textAlign="left",t.textBaseline="middle",t.lineWidth=this.__linewidth;var u=vec(1,1,1);this.canvas.__background.equals(vec(1,1,1))&&(u=vec(0,0,0)),t.strokeStyle=color.to_html(this.__linecolor||this.__color||u);for(var p,v,d,f,g=this.__text.split("\n"),x=[],b=0,y=0;y<g.length;y++)p=e(this,s,n+1.2*y*this.__height,g[y]),x.push([p[4],p[5]]),(void 0===v||p[0]<v)&&(v=p[0]),0==y&&(d=p[1]),(void 0===f||p[2]>f)&&(f=p[2]),b+=1.2*this.__height;b+=2*this.__border-.2*this.__height;var m;m=null==this.__background?this.canvas.__background:this.__background,t.fillStyle=color.to_html_rgba(m,this.__opacity),t.fillRect(v,d,f,b),this.__box&&(t.beginPath(),t.moveTo(v,d),t.lineTo(v+f,d),t.lineTo(v+f,d+b),t.lineTo(v,d+b),t.closePath(),t.stroke()),t.fillStyle=color.to_html(this.__color||u);for(var y=0;y<g.length;y++)t.fillText(g[y],x[y][0],x[y][1])},__change:function(){void 0!==this.canvas&&(this.canvas.__overlay_objects.__changed=!0)}}),eval("0");var exports={box:box,vp_box:vp_box,cylinder:cylinder,vp_cylinder:vp_cylinder,cone:cone,vp_cone:vp_cone,pyramid:pyramid,vp_pyramid:vp_pyramid,sphere:sphere,vp_sphere:vp_sphere,vp_ellipsoid:vp_ellipsoid,arrow:arrow,vp_arrow:vp_arrow,curve:curve,points:points,extrusion:extrusion,paths:paths,shapes:shapes,helix:helix,vp_helix:vp_helix,ring:ring,vp_ring:vp_ring,compound:compound,vertex:vertex,triangle:triangle,quad:quad,draw:draw,label:label,distant_light:distant_light,local_light:local_light,attach_trail:attach_trail,attach_arrow:attach_arrow,textures:textures,bumpmaps:bumpmaps};Export(exports)}();
!function(){"use strict";function e(e,n){function r(){if(i)return void n();var a=c();if(a-o>6e3){var l=confirm("Timed out trying to access the library\n  "+e+"\nTry again?");if(!l)return void n();o=c()}t(.05,r)}if(void 0===n)throw new Error("get_display(URL, wait) called without wait");var i=!1,o=c();$.getScript(e).done(function(e,n){i=!0}).fail(function(r,t,i){alert("Could not access the library\n  "+e),n()}),r()}function n(e,n){function r(e){var n,r;return n=e.target.files[0],n?(r=new FileReader,r.onload=function(e){a=e.target.result;var r=n.lastModifiedDate?n.lastModifiedDate.toLocaleDateString():"";o={name:n.name,text:a,size:n.size,type:n.type,date:r},$("#read_local_file").remove()},r.readAsText(n)):void alert("Failed to load file")}function i(){return null!==a?void n(null,o):void t(.05,i)}var o;if(0===arguments.length)throw new Error("read_local_file(place, wait) called with no arguments");if(1==arguments.length){if(n=e,"function"!==v(n))throw new Error("Should be 'read_local_file(wait)'");e=$("body")}else if(arguments.length>2||"function"!==v(n))throw new Error("Should be 'read_local_file(place, wait)'");e.append('<input type="file" id="read_local_file"/>');var a=null;document.getElementById("read_local_file").addEventListener("change",r,!1),i()}function r(e){t(0,e)}function t(e,n){function r(){n()}e=1e3*e,e>5?setTimeout(r,e-5):setTimeout(r,0)}function i(e){if(e instanceof vec)e=e.toString();else if(null===e)e="null";else if(void 0===e)e="undefined";else if("object"==v(e)){var n="{";for(var r in e)n+=r+":"+e[r]+", ";e=n.slice(0,-2)+"}"}else"number"==v(e)?(e=e.toPrecision(6),e.match(/e/)?(e=e.replace(/0*e/,"e"),e=e.replace(/\.e/,"e")):e.match(/\./)&&(e=e.replace(/0*$/,"")),e=e.replace(/\.$/,"")):e=e.toString();return e}function o(){var e=void 0===g.width?640:g.width,n=void 0===g.height?100:g.height,r=void 0===g.readonly?!0:g.readonly;"right"==g.pos?canvas.container.css({"float":"left"}):"bottom"==g.pos&&canvas.container.css({clear:"both"}),p.css("width",e).css("height",n),r?p.attr("readonly","readonly"):p.attr("readonly",null)}function a(e){if(null===p){var n=m;n.appendTo($("body")),window.__context.print_container=n,p=$('<textarea id=print spellcheck="false"/>').appendTo(n).css("font-family","Verdana","Sans-Serif").css("font-size","100%"),o()}var r=" ",t="\n",a=arguments.length,l=arguments[a-1];if(null!=l&&void 0!==l){var c=!1;void 0!==l.sep&&(r=l.sep,c=!0),void 0!==l.end&&(t=l.end,c=!0),c&&a--}for(var u="",s=0;a>s;s++){var l=arguments[s];l="array"==v(l)?l.toString():null===l?"null":i(l),u+=0===u.length?l:r+l}u+=t,p.val(p.val()+u),p.scrollTop(p.scrollTop()+1e4)}function l(e){var n="";for(var r in e)g[r]=e[r];return null!==p&&(void 0!==e.clear&&e.clear&&p.val(""),o(),void 0!==e.contents&&e.contents&&(n=p.val()),void 0!==e["delete"]&&e["delete"]&&(p.remove(),p=null)),n}function c(){return performance.now?performance.now():(new Date).getTime()}function u(){return.001*c()}function s(e){if(0>=e){if(0===e)return 1;throw new Error("Cannot take factorial of negative number "+e)}for(var n=1,r=2;e>=r;)n*=r,r++;if(r!=e+1)throw new Error("Argument of factorial must be an integer, not "+e);return n}function f(e,n){var r=e-n,t=1;if(n>r){var i=n;n=r,r=i}for(var o=r+1,a=1;e>=o;)t*=o/a,o++,a++;if(o!=e+1)throw new Error("Illegal arguments ("+e+","+n+") for combin function");return t}function d(e){for(var n="[",r=0;r<e.length;r++){var t=e[r];n+=void 0===t?"undefined, ":null===t?"null ":t instanceof Array?d(t):t instanceof String?t:t.toString()+", "}return", "==n.slice(-2)&&(n=n.slice(0,-2)),n+"], "}function h(e){return void 0===e?"undefined":null===e?"null":d(e).slice(0,-2)}$.fn.extend({gsmenubar:function(e){return this.is("ul")?(this.addClass("gsmenubar"),void this.children("li").children("ul").each(function(){$(this).menu()})):void alert("MenuBar top level must be unordered list, i.e. <ul>.")}}),$.fn.waitfor=function(e,n){function r(i){t.unbind(e,r),n(null,i)}var t=this;this.bind(e,r)},$.fn.pause=function(e,n){function r(i){e.visible=!1,t.unbind("click",r),n(null,i)}var t=this;this.bind("click",r)};var v=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},p=null,g={width:640,height:100,readonly:!0,pos:"bottom"},m=$("<div/>");window.performance=window.performance||{},Array.prototype.toString=function(){return h(this)},String.prototype.format=function(e){function n(e,n,r,t){function i(e,n){for(var r="",t=0;t<n-e.length;t++)r+=" ";return r+e}var o={b:function(){return i(e.toString(2),r)},c:function(){return i(String.fromCharCode(e),r)},d:function(){return i(Math.floor(Math.round(e)).toString(),r)},e:function(){var n=i(e.toExponential(t||6),r),o=n.search("e"),a=n.slice(o);return n=n.slice(0,o),3==a.length&&(a=a.slice(0,2)+"0"+a.slice(-1)),n+a},E:function(){return o.e()},f:function(){return 0==t?t=6:-1==t&&(t=0),i(e.toFixed(t),r)},F:function(){return o.f()},g:function(){if(0==e)return"0";0==t&&(t=6);var n,r=Math.abs(e);if(r>=1e-4&&r<Math.pow(10,t)){if(.1>r){var i=e.toExponential(t);i=i.replace(".","");var a=i.search("e"),l=i.slice(a+2),c=i.slice(0,a),u=c.length;0>e&&(u++,t++),u>t&&(c=c.slice(0,t));var s="";for("-"==c.slice(0,1)&&(s="-",c=c.slice(1)),n=c.slice(0,t);"0"==n.slice(-1);)n=n.slice(0,-1);return 2==l?s+"0.0"+n:3==l?s+"0.00"+n:s+"0.000"+n}r>=1&&t--,n=o.e();var a=n.search("e"),l=Number(n.slice(a+1)),c=Number(n.slice(0,a));for(e=c*pow(10,l),n=o.f();"0"==n.slice(-1);)n=n.slice(0,-1);return"."==n.slice(-1)&&(n=n.slice(0,-1)),n}t--,n=o.e();var a=n.search("e"),l=n.slice(a);for(n=n.slice(0,a);"0"==n.slice(-1);)n=n.slice(0,-1);return"."==n.slice(-1)&&(n=n.slice(0,-1)),n+l},G:function(){return o.g().toUpperCase()},n:function(){return o.g()},o:function(){return i(e.toString(8),r)},s:function(){for(var n=e.slice(0,t),i=0;r-t>i;i++)n+=" ";return n},x:function(){return i(e.toString(16),r)},X:function(){return o.x().toUpperCase()},"%":function(){return e*=100,o.f()+"%"}};return o[n]()}for(var r=this,t=Array.prototype.slice.call(arguments),i=[],o=[],a=/(\{[^\}]*\})/g,l=0;;){var c=a.exec(r);if(null===c){i.push(r.slice(l));break}var u=r.slice(c.index+1,a.lastIndex-1);o.push(u.replace(/\s*/g,"")),i.push(r.slice(l,c.index)),l=a.lastIndex}for(var s="",f=0;f<i.length&&(s+=i[f],!(f>=o.length));f++){var d=o[f],h=f,v=d.search(":");if(0>v){if(d.length>0&&null!==d.slice(-1).match(/[a-z]/))throw new Error('Format error: missing ":" in "{'+d+'}"');if(null!==d.match(/\./))throw new Error('Format error: should not have "." in "{'+d+'}"');d.length>0&&(h=Number(d)),s+=t[h].toString()}else{var p=d.slice(-1);if(null===p.match(/[a-z]/))throw new Error('Format error: final character in "{'+d+'}" must be a letter.');v>0&&(h=Number(d.slice(0,v))),d=d.slice(v+1);var g,m,w=d.search(/\./);w>=0?(g=d.slice(0,w),g=""==g?0:Number(g),m=Number(d.slice(w+1,-1)),0===m&&(m=-1)):(g=d.length>=2?Number(d.slice(0,-1)):0,m=0),s+=n(t[h],p,g,m)}}return s};var w={sqrt:Math.sqrt,pi:Math.PI,abs:Math.abs,sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,atan2:Math.atan2,exp:Math.exp,log:Math.log,pow:Math.pow,ceil:Math.ceil,floor:Math.floor,max:Math.max,min:Math.min,random:Math.random,round:Math.round,factorial:s,combin:f,radians:function(e){return e*Math.PI/180},degrees:function(e){return 180*e/Math.PI},sleep:t,update:r,print:a,GSprint:a,print_options:l,print_container:m,clock:u,msclock:c,get_library:e,read_local_file:n};Export(w)}();
Export({shaders:{curve_peel_depth_vertex:'// Vertex shader for rendering curve segments, parameterized by\n// pos1, pos2, radius, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in a normal basis with x pointing along the segment and scaled by radius\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvec4 start;\nvec4 end;\n   \nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nmat3 getSegmentRotation() {\n  // Construct the segment rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(vec3(0,1,0)));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start.w or end.w inside the if statement fails\n    // if the curve radius is less than about 1e-7. After setting the value\n    // inside the if, it\'s zero upon exit from the if. !!?!\n    float sw = 0.0;\n    if (segmentPosR(0).w < 0.0) { // -1 means use the curve global radius\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w < 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n    \n    // The position and radius of "this" end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n    \n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n    \n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    \n    gl_Position = projMatrix * pos4;\n}',curve_pick_vertex:'#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in an normal basis with x pointing along the segment and scaled by radius\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nvec4 start;\nvec4 end;\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nmat3 getSegmentRotation() {\n    // Construct the object rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    vec4 start_color = segmentColor(0);\n    vec4 end_color = segmentColor(1);\n    if (start_color.r < 0.0) start_color.rgb = objectColor;\n    if (end_color.r < 0.0) end_color.rgb = objectColor.rgb;\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start or end inside the if statement fails\n    // if the curve radius is less than about 1e-7 !!??\n    float sw = 0.0;\n    if (segmentPosR(0).w < 0.0) {\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w < 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n\n    // The position and radius of "this" end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n\n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    vcolor = start_color * (1.-pos.w) + end_color * pos.w;\n    gl_Position = projMatrix * pos4;\n}\n',curve_render_vertex:'// Vertex shader for rendering curve segments, parameterized by\n// pos1, pos2, radius, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec4 pos;       // pos.w is 0 at the beginning of the segment and 1 at the end; \n                          // pos.xyz are relative to that end in a normal basis with x pointing along the segment and scaled by radius\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectRadius objectData[3].w\n#define objectColor objectData[4].rgb\n\nuniform vec4 segmentData[4];\n#define segmentPosR(i) segmentData[i]\n#define segmentColor(i) segmentData[2+i]\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nvec4 start;\nvec4 end;\n   \nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nmat3 getSegmentRotation() {\n  // Construct the segment rotation matrix.\n    vec3 v = end.xyz - start.xyz;\n    float vmax = max( max( abs(v.x), abs(v.y) ), abs(v.z) );\n    vec3 X = normalize(v/vmax);\n    vec3 Z = cross(X,normalize(vec3(0,1,0)));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    vec4 start_color = segmentColor(0);\n    vec4 end_color = segmentColor(1);\n    if (start_color.r < 0.0) start_color.rgb = objectColor;\n    if (end_color.r < 0.0) end_color.rgb = objectColor.rgb;\n    \n    // The following code looks very clumsy, but all other more sensible schemes \n    // failed due to what might be bugs in shader compiling or execution.\n    // Specifically, trying to set start.w or end.w inside the if statement fails\n    // if the curve radius is less than about 1e-7. After setting the value\n    // inside the if, it\'s zero upon exit from the if. !!?!\n    float sw = 0.0;\n    if (segmentPosR(0).w < 0.0) { // -1 means use the curve global radius\n        sw = 1.0;\n    }\n    start = vec4(segmentPosR(0).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(0).w);\n    sw = 0.0;\n    if (segmentPosR(1).w < 0.0) {\n        sw = 1.0;\n    }\n    end = vec4(segmentPosR(1).xyz, sw*objectRadius + (1.0-sw)*segmentPosR(1).w);\n    \n    mat3 rotObject = getObjectRotation();\n    start.xyz = rotObject*(objectScale*start.xyz) + objectPos;\n    end.xyz = rotObject*(objectScale*end.xyz) + objectPos;\n\n    // A rotation matrix with x pointed along the segment\n    mat3 rot = getSegmentRotation();\n\n    // The position and radius of "this" end of the segment in world space\n    vec4 ws_segmentEnd = start * (1.-pos.w) + end * pos.w;\n\n    // The position of this vertex in world space\n    vec3 ws_pos = ws_segmentEnd.xyz + rot * (ws_segmentEnd.w*pos.xyz);\n\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot * (normal/objectScale), 0.0)).xyz;\n    \n    // no texture or bump map yet for curve object:\n    parameters = vec4(objectShininess, objectEmissive, 0.0, 0.0);\n    mat_pos = vec2(0.0, 0.0);\n    bumpX = vec3(1.0, 0.0, 0.0);\n    \n    vcolor = start_color * (1.-pos.w) + end_color * pos.w;\n    gl_Position = projMatrix * pos4;\n}',extent_vertex:"// Vertex shader for rendering standard 'objects' parameterized by\n// pos, axis, up, scale, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform vec3 center;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nvec3 encode_float(float k) { // assumes k is >= 0\n    if (k <= 0.0) return vec3(0.0, 0.0, 0.0);\n    float logk = log(k);\n    if (logk < 0.0) {\n        logk = -logk + 128.0;\n    }\n    return vec3(\n        floor(logk)/255.0,\n        floor(256.0*fract(logk))/255.0,\n        floor(256.0*fract(256.0*logk))/255.0);\n}\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.  A waste to do this per vertex, but GPU >> CPU\n    vec3 X = normalize(objectAxis);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*position) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*(normal/objectScale), 0.0)).xyz;\n    //gl_Position = posp;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    float extent = abs(ws_pos.x-center.x);\n    extent = max(abs(ws_pos.y-center.y), extent);\n    extent = max(abs(ws_pos.z-center.z), extent);\n    mat_color = vec4(encode_float(extent), 1.0);\n    // Setting gl_Position.xy to (-1.0, -1.0) should store into pixel (0, 0), but doesn't work:\n    gl_Position = vec4(-1.0, -1.0, 1e-20*extent, 1.0);\n\n    parameters = vec4(objectShininess, objectEmissive, 0.0, 0.0);\n}\n",merge_fragment:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform sampler2D C0; // TEXTURE2 - opaque color map (minormode 4)\nuniform sampler2D C1; // TEXTURE4 - color map for transparency render 1 (minormode 6)\nuniform sampler2D C2; // TEXTURE6 - color map for transparency render 2 (minormode 8)\nuniform sampler2D C3; // TEXTURE8 - color map for transparency render 3 (minormode 10)\nuniform sampler2D C4; // TEXTURE10 - color map for transparency render 4 (minormode 12)\nuniform vec2 canvas_size;\n\nvoid main(void) {\n    // need to combine colors from C0, C1, C2, C3, C4\n    vec2 loc = vec2( gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    vec4 c0 = texture2D(C0, loc);\n    vec4 c1 = texture2D(C1, loc);\n    vec4 c2 = texture2D(C2, loc);\n    vec4 c3 = texture2D(C3, loc);\n    vec4 c4 = texture2D(C4, loc);\n    \n    vec3 mcolor = c1.rgb*c1.a + \n                 (1.0-c1.a)*(c2.rgb*c2.a +\n                 (1.0-c2.a)*(c3.rgb*c3.a +\n                 (1.0-c3.a)*(c4.rgb*c4.a + \n                 (1.0-c4.a)*c0.rgb)));\n    gl_FragColor = vec4 (mcolor, 1.0);\n}\n",merge_fragment2:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform sampler2D C0; // TEXTURE2 - opaque color map (minormode 4)\nuniform sampler2D C1; // TEXTURE4 - color map for transparency render 1 (minormode 6)\nuniform vec2 canvas_size;\n\nvoid main(void) {\n    // need to combine colors from C0 and C1\n    // This is used with mobile devices that have few texture image units.\n    vec2 loc = vec2( gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    vec4 c0 = texture2D(C0, loc);\n    vec4 c1 = texture2D(C1, loc);    \n    \n    vec3 mcolor = c1.rgb*c1.a + (1.0-c1.a)*c0.rgb;\n    gl_FragColor = vec4 (mcolor, 1.0);\n}\n",merge_vertex:"// Vertex shader for rendering standard 'objects' parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nvoid main(void) {\n    gl_Position = vec4(pos, 1.0);\n}\n",opaque_render_fragment:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * lcolor * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nvoid main(void) {\n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    gl_FragColor = vec4( color, 1.0 );\n}\n",peel_color_fragmentC1:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n\n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n	\n	if (zmin < z) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n    	discard;\n    }\n}\n",peel_color_fragmentC2:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D1; // TEXTURE5 - depth map (minormode 7)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D1, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin < z && z < zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n",peel_color_fragmentC3:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D2; // TEXTURE7 - depth map (minormode 9)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D2, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin < z && z < zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n",peel_color_fragmentC4:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nuniform int light_count;\nuniform vec4 light_pos[8];\nuniform vec3 light_color[8];\nuniform vec3 light_ambient;\n#define LP(i) light_pos[i]\n#define LC(i) light_color[i]\nuniform vec2 canvas_size;\n\nuniform sampler2D texmap;  // TEXTURE0 - user texture\nuniform sampler2D bumpmap; // TEXTURE1 - user bumpmap\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D3; // TEXTURE9 - depth map (minormode 11)\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n#define shininess parameters[0]\n#define emissive parameters[1]\n#define hasTexture parameters[2]\n#define hasBump parameters[3]\n\nvec3 normal;\nvec3 pos;\nvec3 diffuse_color;\nvec3 specular_color;\nvec3 color;\n\nvoid calc_color(vec4 lpos, vec3 lcolor)\n{\n    vec3 L = lpos.xyz - pos*lpos.w; // w == 0 for distant_light\n    L = normalize(L);\n    float N = max(dot(normal,L), 0.0);\n    color += (lcolor * N)*diffuse_color;\n    if (shininess > 0.0) {\n        vec3 R = reflect(L,normal);\n        color += specular_color * LC(0) * pow(max(dot(R,normalize(pos)),0.0),100.0*shininess);\n    }\n}\n\n// Return lit surface color based on the given surface properties and the lights\n//   specified by the light_* uniforms.\nvoid lightAt()\n{    \n    if (hasTexture != 0.0) {\n        diffuse_color = diffuse_color * texture2D(texmap, mat_pos).xyz;\n    }\n    if (hasBump != 0.0) {\n        vec3 Y = cross(normal, bumpX);\n        vec3 Nb = texture2D(bumpmap, mat_pos).xyz;\n        Nb = 2.0*Nb - 1.0;\n        normal = normalize(Nb.x*bumpX + Nb.y*Y + Nb.z*normal);\n    }\n    if (emissive != 0.0) {\n        // From VPython materials.emissive:\n        float d = dot(normalize(-pos), normal);\n        d = pow(d * 1.5, 0.4) * 1.1;\n        if (d > 1.0) d = 1.0;\n        color = diffuse_color * d;\n        return;\n    }\n    \n    color = light_ambient * diffuse_color;\n    \n    // It was necessary to restructure this shader completely in order to\n    // run on the Samsung Galaxy S3 smartphone. Apparently its compiler\n    // does not handle for loops correctly. An Asus Android tablet was ok.\n    if (light_count == 0) return;\n    calc_color(LP(0), LC(0));\n    if (light_count == 1) return;\n    calc_color(LP(1), LC(1));\n    if (light_count == 2) return;\n    calc_color(LP(2), LC(2));\n    if (light_count == 3) return;\n    calc_color(LP(3), LC(3));\n    if (light_count == 4) return;\n    calc_color(LP(4), LC(4));\n    if (light_count == 5) return;\n    calc_color(LP(5), LC(5));\n    if (light_count == 6) return;\n    calc_color(LP(6), LC(6));\n    if (light_count == 7) return;\n    calc_color(LP(7), LC(7));\n}\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create transparency color map - C1 (minormode 6), C2 (8), C3 (19), C4 (12)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D3, loc));\n    \n    normal = normalize(es_normal);\n    pos = es_position;\n    diffuse_color = vcolor.rgb;\n    specular_color = vec3(.8,.8,.8);\n    lightAt(); // determine color from lighting\n    \n    if (zmin < z && z < zmax) {\n        gl_FragColor = vec4( color, vcolor.a );\n    } else {\n        discard;\n    }\n}\n",
peel_depth_fragmentD0:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nvoid main(void) {\n    // create depth map D0 (5)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n}",peel_depth_fragmentD1:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D1 (6)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    if (zmin < z) {\n        gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}\n",peel_depth_fragmentD2:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D1; // TEXTURE5 - 1st transparency depth map (minormode 7)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D2 (7)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D1, loc));\n    if (zmin < z && z < zmax) {\n    	gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}",peel_depth_fragmentD3:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\n// Construct depth maps for depth peeling handling of opacity\n\nuniform vec2 canvas_size;\nuniform sampler2D D0; // TEXTURE3 - opaque depth map (minormode 5)\nuniform sampler2D D2; // TEXTURE7 - 2nd transparency depth map (minormode 9)\n\n// minormode = 0 render, 1 pick, 2 autoscale, 4 C0, 5 D0, 6 C1, 7 D1, 8 C2, 9 D2, 10 C3, 11 D3, 12 C4\n\nivec4 encode(float k) { // assumes k is >= 0\n    if (k <= 0.0) return ivec4(0, 0, 0, 0);\n    k = 3.0*128.0*k;\n    int b1 = int(k);\n    int b2 = int(256.0*fract(k));\n    return ivec4(\n    	b1,\n    	b2,\n    	0,\n    	0);\n}\n\nint decode(ivec4 d) {\n    return int(256*d[0] + d[1]);\n}\n\nint fdecode(vec4 d) {\n    return int(255.0*(256.0*d[0] + d[1]));\n}\n\nvoid main(void) {\n    // create depth map D3 (8)\n    ivec4 c = encode(1.0 - gl_FragCoord.z);\n    int z = decode(c);\n    vec2 loc = vec2(gl_FragCoord.x/canvas_size.x, gl_FragCoord.y/canvas_size.y);\n    int zmin = fdecode(texture2D(D0, loc));\n    int zmax = fdecode(texture2D(D2, loc));\n    if (zmin < z && z < zmax) {\n        gl_FragColor = vec4(float(c.r)/255.0, float(c.g)/255.0, 0, 0);\n    } else {\n        discard;\n    }\n}",peel_depth_vertex:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n}\n",pick_fragment:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nvarying vec4 vcolor;\n\nvoid main(void) {\n    gl_FragColor = vcolor;\n}\n",pick_vertex:"// Vertex shader for picking standard 'objects' parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectAxis objectData[1].xyz\n#define objectUp objectData[2].xyz\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nmat3 getObjectRotation() {\n  // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n    vcolor = objectColor;\n}\n",render_vertex:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n    mat3 rot = getObjectRotation();\n    // The position of this vertex in world space\n    vec3 ws_pos = rot*(objectScale*pos) + objectPos;\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*(normal/objectScale), 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color*objectColor.rgb, opacity*objectColor.a);\n    \n    float f = flags; // turn, flipy, flipx, sides, right, left, bumpmap, texture\n    float turn = floor(f/128.0);\n    f -= 128.0*turn;\n    float flipy = floor(f/64.0);\n    f -= 64.0*flipy;\n    float flipx = floor(f/32.0);\n    f -= 32.0*flipx;\n    float sides = floor(f/16.0);\n    f -= 16.0*sides;\n    float right = floor(f/8.0);\n    f -= 8.0*right;\n    float left = floor(f/4.0);\n    f -= 4.0*left;\n    float B = floor(f/2.0);\n    f -= 2.0*B;\n    float T = f;\n    if (T != 0.0) {\n        if (flipx != 0.0) {\n            mat_pos.x = 1.0 - mat_pos.x;\n        }\n        if (flipy != 0.0) {\n            mat_pos.y = 1.0 - mat_pos.y;\n        }\n        if (turn > 0.0 && turn <= 3.0) {\n            if (turn == 1.0) {\n                mat_pos = vec2(mat_pos.y,1.0 - mat_pos.x);\n            } else if (turn == 2.0) {\n                mat_pos = vec2(1.0 - mat_pos.x,1.0 - mat_pos.y);\n            } else {\n                mat_pos = vec2(1.0 - mat_pos.y,mat_pos.x);\n            }\n        }\n        T = 0.0;\n        bool L = (normal.x == -1.0);\n        bool R = (normal.x == 1.0);\n        bool S = !L && !R;\n        if (L && left == 1.0) T = 1.0;\n        if (R && right == 1.0) T = 1.0;\n        if (S && sides == 1.0) T = 1.0;\n        if (T == 0.0) {\n            B = 0.0;\n        } else if (left == 0.0 || right == 0.0 || sides == 0.0) {\n            // don't mix texture and object color if texture doesn't cover entire object\n            vcolor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    }\n    float emit = 0.0;\n    if (objectEmissive != 0.0) emit = 1.0;\n    if (emissive != 0.0) emit = 1.0;\n    parameters = vec4(objectShininess * shininess, emit, T, B);\n}\n",ring_peel_depth_vertex:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n	mat3 rot = getObjectRotation();\n	// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;           // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(r/objectScale);     // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n}\n",ring_pick_vertex:"// Vertex shader for picking standard 'objects' parameterized by\n// pos, axis, up, size, color\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectAxis objectData[1].xyz\n#define objectUp objectData[2].xyz\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n	mat3 rot = getObjectRotation();\n	// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;           // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(r/objectScale);     // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    gl_Position = projMatrix * pos4;\n    vcolor = objectColor;\n}\n",ring_render_vertex:"#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform vec4 objectData[5];\n#define objectPos objectData[0].xyz\n#define objectShininess objectData[0].w\n#define objectAxis objectData[1].xyz\n#define objectEmissive objectData[1].w\n#define objectUp objectData[2].xyz\n#define flags objectData[2].w\n#define objectScale objectData[3].xyz\n#define objectColor objectData[4].rgba\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump, flipx, flipy, turn\n\nmat3 getObjectRotation() {\n    // Construct the object rotation matrix.\n    float vmax = max( max( abs(objectAxis.x), abs(objectAxis.y) ), abs(objectAxis.z) );\n    vec3 X = normalize(objectAxis/vmax);\n    vec3 Z = cross(X,normalize(objectUp));\n    if ( dot(Z,Z) < 1e-10 ) {\n        Z = cross(X, vec3(1,0,0));\n        if (dot(Z,Z) < 1e-10 ) {\n            Z = cross(X, vec3(0,1,0));\n        }\n    }\n    Z = normalize(Z);\n    return mat3( X, normalize(cross(Z,X)), Z );\n}\n\nvoid main(void) {\n	mat3 rot = getObjectRotation();\n	// See mesh.js for details on mesh; default radius of cross section is 0.05 (default outer radius is 0.5)\n    vec3 r = normal*objectScale;  // from center of ring to outer edge of circular cross section\n    vec3 n = normalize(normal);   // lies in the plane of the cross section at this location, perpendicular to outer edge\n    vec3 adjpos = r + (objectScale.x/0.1)*(pos.x*vec3(1,0,0) + pos.z*n);    // vertex in world coordinates\n    vec3 N = adjpos - (r-0.5*objectScale.x*n);                              // normal in world coordinates\n    \n    vec3 ws_pos = rot*(adjpos) + objectPos;  // point in world space\n    vec4 pos4 = viewMatrix * vec4( ws_pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(rot*N, 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(rot*bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color*objectColor.rgb, opacity*objectColor.a);\n    \n    float f = flags; // turn, flipy, flipx, sides, right, left, bumpmap, texture\n    float turn = floor(f/128.0);\n    f -= 128.0*turn;\n    float flipy = floor(f/64.0);\n    f -= 64.0*flipy;\n    float flipx = floor(f/32.0);\n    f -= 32.0*flipx;\n    float sides = floor(f/16.0);\n    f -= 16.0*sides;\n    float right = floor(f/8.0);\n    f -= 8.0*right;\n    float left = floor(f/4.0);\n    f -= 4.0*left;\n    float B = floor(f/2.0);\n    f -= 2.0*B;\n    float T = f;\n    if (T != 0.0) {\n        if (flipx != 0.0) {\n            mat_pos.x = 1.0 - mat_pos.x;\n        }\n        if (flipy != 0.0) {\n            mat_pos.y = 1.0 - mat_pos.y;\n        }\n        if (turn > 0.0 && turn <= 3.0) {\n            if (turn == 1.0) {\n                mat_pos = vec2(mat_pos.y,1.0 - mat_pos.x);\n            } else if (turn == 2.0) {\n                mat_pos = vec2(1.0 - mat_pos.x,1.0 - mat_pos.y);\n            } else {\n                mat_pos = vec2(1.0 - mat_pos.y,mat_pos.x);\n            }\n        }\n        T = 0.0;\n        bool L = (normal.x == -1.0);\n        bool R = (normal.x == 1.0);\n        bool S = !L && !R;\n        if (L && left == 1.0) T = 1.0;\n        if (R && right == 1.0) T = 1.0;\n        if (S && sides == 1.0) T = 1.0;\n        if (T == 0.0) {\n            B = 0.0;\n        } else if (left == 0.0 || right == 0.0 || sides == 0.0) {\n            // don't mix texture and object color if texture doesn't cover entire object\n            vcolor = vec4(1.0, 1.0, 1.0, 1.0);\n        }\n    }\n    float emit = 0.0;\n    if (objectEmissive != 0.0) emit = 1.0;\n    if (emissive != 0.0) emit = 1.0;\n    parameters = vec4(objectShininess * shininess, emit, T, B);\n}\n",tri_peel_depth_vertex:"// Vertex shader for rendering triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvoid main(void) {\n    gl_Position = projMatrix * viewMatrix * vec4( pos, 1.0);\n}\n",tri_pick_vertex:"// Vertex shader for picking triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec4 color;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\n\nvarying vec4 vcolor;\n\nvoid main(void) {\n    gl_Position = projMatrix * viewMatrix * vec4( pos, 1.0);\n    vcolor = color;\n}\n",tri_render_vertex:"// Vertex shader for rendering triangles\n\n#ifdef GL_ES\n#  ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#  else\nprecision mediump float;\n#  endif\n#endif\n\nattribute vec3 pos;\nattribute vec3 normal;\nattribute vec3 color;\nattribute float opacity;\nattribute float shininess;\nattribute float emissive;\nattribute vec2 texpos;\nattribute vec3 bumpaxis;\n\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform float T; // 1.0 if there is a texture, else 0.0\nuniform float B; // 1.0 if there is a bumpmap, else 0.0\n\nvarying vec3 es_position;     // eye space surface position\nvarying vec3 es_normal;       // eye space surface normal\nvarying vec2 mat_pos;         // surface material position in [0,1]^2\nvarying vec4 vcolor;\nvarying vec3 bumpX;\nvarying vec4 parameters; // shininess, emissive, hasTexture, hasBump\n\nvoid main(void) {\n    vec4 pos4 = viewMatrix * vec4( pos, 1.0);\n    es_position = pos4.xyz;\n    es_normal = (viewMatrix * vec4(normal, 0.0)).xyz;\n    gl_Position = projMatrix * pos4;\n    bumpX = (viewMatrix * vec4(bumpaxis, 0.0)).xyz;\n    mat_pos = texpos;\n    vcolor = vec4(color, opacity);\n    parameters = vec4(shininess, emissive, T, B);\n}\n"}});
function srequire(e){if("streamline/lib/util/flows"==e)return Streamline.flows;if("streamline/lib/globals"==e)return Streamline.globals;if("streamline/lib/version"==e)return Streamline.version;if("streamline/lib/callbacks/runtime"==e)return Streamline.runtime;if("streamline/lib/callbacks/transform"==e)return Streamline;if("streamline/lib/callbacks/builtins"==e)return Streamline.builtins;if("streamline/lib/util/future"==e)return Streamline.future;if("streamline/lib/util/source-map"==e)return Streamline.sourceMap.exports;throw new Error("Cannot require "+e)}Object.create&&Object.defineProperty&&Object.defineProperties||alert("Example will fail because your browser does not support ECMAScript 5. Try with another browser!");var __filename=""+window.location;if(window.Streamline={globals:{}},function(){var e={options:{version:185},hostGlobal:this};Narcissus=e}(),Narcissus.definitions=function(){function e(e,n,t,r,i){Object.defineProperty(e,n,{get:t,configurable:!r,enumerable:!i})}function n(e,n,t,r,i,a){Object.defineProperty(e,n,{value:t,writable:!i,configurable:!r,enumerable:!a})}function t(e){return"function"==typeof e&&e.toString().match(/\[native code\]/)}function r(e,n){for(;e;){if({}.hasOwnProperty.call(e,n))return Object.getOwnPropertyDescriptor(e,n);e=Object.getPrototypeOf(e)}}function i(e){var n={};for(var t in Object.getOwnPropertyNames(e))n[t]=Object.getOwnPropertyDescriptor(e,t);return n}function a(e){return{getOwnPropertyDescriptor:function(n){var t=Object.getOwnPropertyDescriptor(e,n);return t.configurable=!0,t},getPropertyDescriptor:function(n){var t=r(e,n);return t.configurable=!0,t},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(e)},defineProperty:function(n,t){Object.defineProperty(e,n,t)},"delete":function(n){return delete e[n]},fix:function(){return Object.isFrozen(e)?i(e):void 0},has:function(n){return n in e},hasOwn:function(n){return{}.hasOwnProperty.call(e,n)},get:function(n,t){return e[t]},set:function(n,t,r){return e[t]=r,!0},enumerate:function(){var n=[];for(E in e)n.push(E);return n},keys:function(){return Object.keys(e)}}}function s(){}function o(){this.table=Object.create(null,{}),this.size=0}function c(e){this.elts=e||null}for(var u=["END","\n",";",",","=","?",":","CONDITIONAL","||","&&","|","^","&","==","!=","===","!==","<","<=",">=",">","<<",">>",">>>","+","-","*","/","%","!","~","UNARY_PLUS","UNARY_MINUS","++","--",".","[","]","{","}","(",")","SCRIPT","BLOCK","LABEL","FOR_IN","CALL","NEW_WITH_ARGS","INDEX","ARRAY_INIT","OBJECT_INIT","PROPERTY_INIT","GETTER","SETTER","GROUP","LIST","LET_BLOCK","ARRAY_COMP","GENERATOR","COMP_TAIL","IDENTIFIER","NUMBER","STRING","REGEXP","break","case","catch","const","continue","debugger","default","delete","do","else","false","finally","for","function","if","in","instanceof","let","new","null","return","switch","this","throw","true","try","typeof","var","void","yield","while","with"],l=["break","const","continue","debugger","do","for","if","return","switch","throw","try","var","yield","while","with"],p={"\n":"NEWLINE",";":"SEMICOLON",",":"COMMA","?":"HOOK",":":"COLON","||":"OR","&&":"AND","|":"BITWISE_OR","^":"BITWISE_XOR","&":"BITWISE_AND","===":"STRICT_EQ","==":"EQ","=":"ASSIGN","!==":"STRICT_NE","!=":"NE","<<":"LSH","<=":"LE","<":"LT",">>>":"URSH",">>":"RSH",">=":"GE",">":"GT","++":"INCREMENT","--":"DECREMENT","+":"PLUS","-":"MINUS","*":"MUL","/":"DIV","%":"MOD","!":"NOT","~":"BITWISE_NOT",".":"DOT","[":"LEFT_BRACKET","]":"RIGHT_BRACKET","{":"LEFT_CURLY","}":"RIGHT_CURLY","(":"LEFT_PAREN",")":"RIGHT_PAREN"},f={__proto__:null},d={},_="var ",h=0,m=u.length;m>h;h++){h>0&&(_+=", ");var E,y=u[h];/^[a-z]/.test(y)?(E=y.toUpperCase(),f[y]=h):E=/^\W/.test(y)?p[y]:y,_+=E+" = "+h,d[E]=h,u[y]=h}_+=";";var b={__proto__:null};for(h=0,m=l.length;m>h;h++)b[f[l[h]]]=!0;var v=["|","^","&","<<",">>",">>>","+","-","*","/","%"];for(h=0,m=v.length;m>h;h++)y=v[h],v[y]=u[y];var T={}.hasOwnProperty;return o.prototype={has:function(e){return T.call(this.table,e)},set:function(e,n){T.call(this.table,e)||this.size++,this.table[e]=n},get:function(e){return this.table[e]},getDef:function(e,n){return T.call(this.table,e)||(this.size++,this.table[e]=n()),this.table[e]},forEach:function(e){var n=this.table;for(var t in n)e.call(this,t,n[t])},toString:function(){return"[object StringMap]"}},c.prototype={push:function(e){return new c({top:e,rest:this.elts})},top:function(){if(!this.elts)throw new Error("empty stack");return this.elts.top},isEmpty:function(){return null===this.top},find:function(e){for(var n=this.elts;n;n=n.rest)if(e(n.top))return n.top;return null},has:function(e){return Boolean(this.find(function(n){return n===e}))},forEach:function(e){for(var n=this.elts;n;n=n.rest)e(n.top)}},{tokens:u,opTypeNames:p,keywords:f,isStatementStartCode:b,tokenIds:d,consts:_,assignOps:v,defineGetter:e,defineProperty:n,isNativeCode:t,makePassthruHandler:a,noPropFound:s,StringMap:o,Stack:c}}(),Narcissus.lexer=function(){function Tokenizer(e,n,t){this.cursor=0,this.source=String(e),this.tokens=[],this.tokenIndex=0,this.lookahead=0,this.scanNewlines=!1,this.unexpectedEOF=!1,this.filename=n||"",this.lineno=t||1}var definitions=Narcissus.definitions;eval(definitions.consts);var opTokens={};for(var op in definitions.opTypeNames)if("\n"!==op&&"."!==op)for(var node=opTokens,i=0;i<op.length;i++){var ch=op[i];ch in node||(node[ch]={}),node=node[ch],node.op=op}return Tokenizer.prototype={get done(){return this.peek(!0)===END},get token(){return this.tokens[this.tokenIndex]},match:function(e,n){return this.get(n)===e||this.unget()},mustMatch:function(e){if(!this.match(e))throw this.newSyntaxError("Missing "+definitions.tokens[e].toLowerCase());return this.token},forceIdentifier:function(){if(!this.match(IDENTIFIER)){if(!(this.get()>=definitions.keywords[0]||this.unget))throw this.newSyntaxError("Missing identifier");this.token.type=IDENTIFIER}return this.token},peek:function(e){var n,t;return this.lookahead?(t=this.tokens[this.tokenIndex+this.lookahead&3],n=this.scanNewlines&&t.lineno!==this.lineno?NEWLINE:t.type):(n=this.get(e),this.unget()),n},peekOnSameLine:function(e){this.scanNewlines=!0;var n=this.peek(e);return this.scanNewlines=!1,n},skip:function(){for(var e=this.source;;){var n=e[this.cursor++],t=e[this.cursor];if("\n"!==n||this.scanNewlines){if("/"===n&&"*"===t)for(this.cursor++;;){if(n=e[this.cursor++],void 0===n)throw this.newSyntaxError("Unterminated comment");if("*"===n){if(t=e[this.cursor],"/"===t){this.cursor++;break}}else"\n"===n&&this.lineno++}else if("/"===n&&"/"===t)for(this.cursor++;;){if(n=e[this.cursor++],void 0===n)return;if("\n"===n){this.lineno++;break}}else if(" "!==n&&"	"!==n)return void this.cursor--}else this.lineno++}},lexExponent:function(){var e=this.source,n=e[this.cursor];if("e"===n||"E"===n){if(this.cursor++,ch=e[this.cursor++],"+"!==ch&&"-"!==ch||(ch=e[this.cursor++]),"0">ch||ch>"9")throw this.newSyntaxError("Missing exponent");do ch=e[this.cursor++];while(ch>="0"&&"9">=ch);return this.cursor--,!0}return!1},lexZeroNumber:function(e){var n=this.token,t=this.source;if(n.type=NUMBER,e=t[this.cursor++],"."===e){do e=t[this.cursor++];while(e>="0"&&"9">=e);this.cursor--,this.lexExponent(),n.value=parseFloat(t.substring(n.start,this.cursor))}else if("x"===e||"X"===e){do e=t[this.cursor++];while(e>="0"&&"9">=e||e>="a"&&"f">=e||e>="A"&&"F">=e);this.cursor--,n.value=parseInt(t.substring(n.start,this.cursor))}else if(e>="0"&&"7">=e){do e=t[this.cursor++];while(e>="0"&&"7">=e);this.cursor--,n.value=parseInt(t.substring(n.start,this.cursor),8),n.value.isOctal=!0}else this.cursor--,this.lexExponent(),n.value=0},lexNumber:function(e){var n=this.token,t=this.source;n.type=NUMBER;var r=!1;do e=t[this.cursor++],"."!==e||r||(r=!0,e=t[this.cursor++]);while(e>="0"&&"9">=e);this.cursor--;var i=this.lexExponent();r=r||i;var a=t.substring(n.start,this.cursor);n.value=r?parseFloat(a):parseInt(a)},lexDot:function(e){var n=this.token,t=this.source,r=t[this.cursor];if(r>="0"&&"9">=r){do e=t[this.cursor++];while(e>="0"&&"9">=e);this.cursor--,this.lexExponent(),n.type=NUMBER,n.value=parseFloat(t.substring(n.start,this.cursor))}else n.type=DOT,n.assignOp=null,n.value="."},lexString:function(ch){var token=this.token,input=this.source;token.type=STRING;for(var hasEscapes=!1,delim=ch;(ch=input[this.cursor++])!==delim;){if(this.cursor==input.length)throw this.newSyntaxError("Unterminated string literal");if("\\"===ch&&(hasEscapes=!0,"\n"===input[this.cursor]&&this.lineno++,++this.cursor==input.length))throw this.newSyntaxError("Unterminated string literal")}token.value=hasEscapes?eval(input.substring(token.start,this.cursor)):input.substring(token.start+1,this.cursor-1)},lexRegExp:function(ch){var token=this.token,input=this.source;token.type=REGEXP;do if(ch=input[this.cursor++],"\\"===ch)this.cursor++;else if("["===ch){do{if(void 0===ch)throw this.newSyntaxError("Unterminated character class");"\\"===ch&&this.cursor++,ch=input[this.cursor++]}while("]"!==ch)}else if(void 0===ch)throw this.newSyntaxError("Unterminated regex");while("/"!==ch);do ch=input[this.cursor++];while(ch>="a"&&"z">=ch);this.cursor--,token.value=eval(input.substring(token.start,this.cursor))},lexOp:function(e){var n=this.token,t=this.source,r=opTokens[e],i=t[this.cursor];i in r&&(r=r[i],this.cursor++,i=t[this.cursor],i in r&&(r=r[i],this.cursor++,i=t[this.cursor]));var a=r.op;definitions.assignOps[a]&&"="===t[this.cursor]?(this.cursor++,n.type=ASSIGN,n.assignOp=definitions.tokenIds[definitions.opTypeNames[a]],a+="="):(n.type=definitions.tokenIds[definitions.opTypeNames[a]],n.assignOp=null),n.value=a},lexIdent:function(e){var n=this.token,t=this.source;do e=t[this.cursor++];while(e>="a"&&"z">=e||e>="A"&&"Z">=e||e>="0"&&"9">=e||"$"===e||"_"===e);this.cursor--;var r=t.substring(n.start,this.cursor);n.type=definitions.keywords[r]||IDENTIFIER,n.value=r},get:function(e){for(var n;this.lookahead;)if(--this.lookahead,this.tokenIndex=this.tokenIndex+1&3,n=this.tokens[this.tokenIndex],n.type!==NEWLINE||this.scanNewlines)return n.type;this.skip(),this.tokenIndex=this.tokenIndex+1&3,n=this.tokens[this.tokenIndex],n||(this.tokens[this.tokenIndex]=n={});var t=this.source;if(this.cursor===t.length)return n.type=END;n.start=this.cursor,n.lineno=this.lineno;var r=t[this.cursor++];if(r>="a"&&"z">=r||r>="A"&&"Z">=r||"$"===r||"_"===r)this.lexIdent(r);else if(e&&"/"===r)this.lexRegExp(r);else if(r in opTokens)this.lexOp(r);else if("."===r)this.lexDot(r);else if(r>="1"&&"9">=r)this.lexNumber(r);else if("0"===r)this.lexZeroNumber(r);else if('"'===r||"'"===r)this.lexString(r);else{if(!this.scanNewlines||"\n"!==r)throw this.newSyntaxError("Illegal token");n.type=NEWLINE,n.value="\n",this.lineno++}return n.end=this.cursor,n.type},unget:function(){if(4===++this.lookahead)throw"PANIC: too much lookahead!";this.tokenIndex=this.tokenIndex-1&3},newSyntaxError:function(e){var n=new SyntaxError(this.filename+":"+this.lineno+":"+e);return n.source=this.source,n.cursor=this.lookahead?this.tokens[this.tokenIndex+this.lookahead&3].start:this.cursor,n}},{Tokenizer:Tokenizer}}(),Narcissus.parser=function(){function pushDestructuringVarDecls(e,n){for(var t in e){var r=e[t];r.type===IDENTIFIER?n.varDecls.push(r):pushDestructuringVarDecls(r,n)}}function StaticContext(e,n,t,r,i){this.parentScript=e,this.parentBlock=n,this.inFunction=t,this.inForLoopInit=r,this.nesting=i,this.allLabels=new Stack,this.currentLabels=new Stack,this.labeledTargets=new Stack,this.defaultTarget=null,Narcissus.options.ecma3OnlyMode&&(this.ecma3OnlyMode=!0),Narcissus.options.parenFreeMode&&(this.parenFreeMode=!0)}function Script(e,n){var t=new Node(e,scriptInit()),r=new StaticContext(t,t,n,!1,NESTING_TOP);return Statements(e,r,t),t}function Node(e,n){var t=e.token;t?(this.type=t.type,this.value=t.value,this.lineno=t.lineno,this.start=t.start,this.end=t.end):this.lineno=e.lineno,this.tokenizer=e,this.children=[];for(var r in n)this[r]=n[r]}function tokenString(e){var n=definitions.tokens[e];return/^\W/.test(n)?definitions.opTypeNames[n]:n.toUpperCase()}function blockInit(){return{type:BLOCK,varDecls:[]}}function scriptInit(){return{type:SCRIPT,funDecls:[],varDecls:[],modDecls:[],impDecls:[],expDecls:[],loadDeps:[],hasEmptyReturn:!1,hasReturnWithValue:!1,isGenerator:!1}}function MaybeLeftParen(e,n){return n.parenFreeMode?e.match(LEFT_PAREN)?LEFT_PAREN:END:e.mustMatch(LEFT_PAREN).type}function MaybeRightParen(e,n){n===LEFT_PAREN&&e.mustMatch(RIGHT_PAREN)}function Statements(e,n,t){try{for(;!e.done&&e.peek(!0)!==RIGHT_CURLY;)t.push(Statement(e,n))}catch(r){throw e.done&&(e.unexpectedEOF=!0),r}}function Block(e,n){e.mustMatch(LEFT_CURLY);var t=new Node(e,blockInit());return Statements(e,n.update({parentBlock:t}).pushTarget(t),t),e.mustMatch(RIGHT_CURLY),t.end=e.token.end,t}function Statement(e,n){var t,r,i,a,s,o,c,u,l=e.get(!0);switch(l){case FUNCTION:return FunctionDefinition(e,n,!0,n.nesting!==NESTING_TOP?STATEMENT_FORM:DECLARED_FORM);case LEFT_CURLY:return r=new Node(e,blockInit()),Statements(e,n.update({parentBlock:r}).pushTarget(r).nest(NESTING_SHALLOW),r),e.mustMatch(RIGHT_CURLY),r.end=e.token.end,r;case IF:return r=new Node(e),r.condition=HeadExpression(e,n),c=n.pushTarget(r).nest(NESTING_DEEP),r.thenPart=Statement(e,c),r.elsePart=e.match(ELSE)?Statement(e,c):null,r;case SWITCH:for(r=new Node(e,{cases:[],defaultIndex:-1}),r.discriminant=HeadExpression(e,n),c=n.pushTarget(r).nest(NESTING_DEEP),e.mustMatch(LEFT_CURLY);(l=e.get())!==RIGHT_CURLY;){switch(l){case DEFAULT:if(r.defaultIndex>=0)throw e.newSyntaxError("More than one switch default");case CASE:i=new Node(e),l===DEFAULT?r.defaultIndex=r.cases.length:i.caseLabel=Expression(e,c,COLON);break;default:throw e.newSyntaxError("Invalid switch case")}for(e.mustMatch(COLON),i.statements=new Node(e,blockInit());(l=e.peek(!0))!==CASE&&l!==DEFAULT&&l!==RIGHT_CURLY;)i.statements.push(Statement(e,c));r.cases.push(i)}return r.end=e.token.end,r;case FOR:if(r=new Node(e,LOOP_INIT),e.match(IDENTIFIER)&&("each"===e.token.value?r.isEach=!0:e.unget()),n.parenFreeMode||e.mustMatch(LEFT_PAREN),c=n.pushTarget(r).nest(NESTING_DEEP),u=n.update({inForLoopInit:!0}),(l=e.peek())!==SEMICOLON&&(l===VAR||l===CONST?(e.get(),i=Variables(e,u)):l===LET?(e.get(),e.peek()===LEFT_PAREN?i=LetBlock(e,u,!1):(u.parentBlock=r,r.varDecls=[],i=Variables(e,u))):i=Expression(e,u)),i&&e.match(IN))if(r.type=FOR_IN,r.object=Expression(e,u),i.type===VAR||i.type===LET){if(s=i.children,1!==s.length&&1!==i.destructurings.length)throw new SyntaxError("Invalid for..in left-hand side",e.filename,i.lineno);i.destructurings.length>0?r.iterator=i.destructurings[0]:r.iterator=s[0],r.varDecl=i}else i.type!==ARRAY_INIT&&i.type!==OBJECT_INIT||(i.destructuredNames=checkDestructuring(e,u,i)),r.iterator=i;else{if(r.setup=i,e.mustMatch(SEMICOLON),r.isEach)throw e.newSyntaxError("Invalid for each..in loop");r.condition=e.peek()===SEMICOLON?null:Expression(e,u),e.mustMatch(SEMICOLON),o=e.peek(),r.update=(n.parenFreeMode?o===LEFT_CURLY||definitions.isStatementStartCode[o]:o===RIGHT_PAREN)?null:Expression(e,u)}return n.parenFreeMode||e.mustMatch(RIGHT_PAREN),r.body=Statement(e,c),r.end=e.token.end,r;case WHILE:return r=new Node(e,{isLoop:!0}),r.condition=HeadExpression(e,n),r.body=Statement(e,n.pushTarget(r).nest(NESTING_DEEP)),r.end=e.token.end,r;case DO:if(r=new Node(e,{isLoop:!0}),r.body=Statement(e,n.pushTarget(r).nest(NESTING_DEEP)),e.mustMatch(WHILE),r.condition=HeadExpression(e,n),!n.ecmaStrictMode)return e.match(SEMICOLON),r.end=e.token.end,r;break;case BREAK:case CONTINUE:if(r=new Node(e),c=n.pushTarget(r),e.peekOnSameLine()===IDENTIFIER&&(e.get(),r.label=e.token.value),r.target=r.label?c.labeledTargets.find(function(e){return e.labels.has(r.label)}):c.defaultTarget,!r.target)throw e.newSyntaxError("Invalid "+(l===BREAK?"break":"continue"));if(l===CONTINUE){for(var p=r.target;p&&!p.isLoop;p=p.target);if(!p)throw e.newSyntaxError("Invalid continue")}break;case TRY:for(r=new Node(e,{catchClauses:[]}),r.tryBlock=Block(e,n);e.match(CATCH);){switch(i=new Node(e),a=MaybeLeftParen(e,n),e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget(),i.varName=DestructuringExpression(e,n,!0);break;case IDENTIFIER:i.varName=e.token.value;break;default:throw e.newSyntaxError("missing identifier in catch")}if(e.match(IF)){if(n.ecma3OnlyMode)throw e.newSyntaxError("Illegal catch guard");if(r.catchClauses.length&&!r.catchClauses.top().guard)throw e.newSyntaxError("Guarded catch after unguarded");i.guard=Expression(e,n)}MaybeRightParen(e,a),i.block=Block(e,n),r.catchClauses.push(i)}if(e.match(FINALLY)&&(r.finallyBlock=Block(e,n)),!r.catchClauses.length&&!r.finallyBlock)throw e.newSyntaxError("Invalid try statement");return r.end=e.token.end,r;case CATCH:case FINALLY:throw e.newSyntaxError(definitions.tokens[l]+" without preceding try");case THROW:r=new Node(e),r.exception=Expression(e,n);break;case RETURN:r=ReturnOrYield(e,n);break;case WITH:return r=new Node(e),r.object=HeadExpression(e,n),r.body=Statement(e,n.pushTarget(r).nest(NESTING_DEEP)),r.end=e.token.end,r;case VAR:case CONST:r=Variables(e,n),r.eligibleForASI=!0;break;case LET:r=e.peek()===LEFT_PAREN?LetBlock(e,n,!0):Variables(e,n),r.eligibleForASI=!0;break;case DEBUGGER:r=new Node(e);break;case NEWLINE:case SEMICOLON:return r=new Node(e,{type:SEMICOLON}),r.expression=null,r;default:if(l===IDENTIFIER&&(l=e.peek(),l===COLON)){if(t=e.token.value,n.allLabels.has(t))throw e.newSyntaxError("Duplicate label");return e.get(),r=new Node(e,{type:LABEL,label:t}),r.statement=Statement(e,n.pushLabel(t).nest(NESTING_SHALLOW)),r.target=r.statement.type===LABEL?r.statement.target:r.statement,r.end=e.token.end,r}r=new Node(e,{type:SEMICOLON}),e.unget(),r.expression=Expression(e,n),r.end=r.expression.end}return MagicalSemicolon(e),r.end=e.token.end,r}function MagicalSemicolon(e){var n;if(e.lineno===e.token.lineno&&(n=e.peekOnSameLine(),n!==END&&n!==NEWLINE&&n!==SEMICOLON&&n!==RIGHT_CURLY))throw e.newSyntaxError("missing ; before statement");e.match(SEMICOLON)}function ReturnOrYield(e,n){var t,r,i=e.token.type,a=n.parentScript;if(i===RETURN);else{if(!n.inFunction)throw e.newSyntaxError("Yield not in function");a.isGenerator=!0}if(t=new Node(e,{value:void 0}),r=e.peek(!0),r!==END&&r!==NEWLINE&&r!==SEMICOLON&&r!==RIGHT_CURLY&&(i!==YIELD||r!==i&&r!==RIGHT_BRACKET&&r!==RIGHT_PAREN&&r!==COLON&&r!==COMMA)?i===RETURN?(t.value=Expression(e,n),a.hasReturnWithValue=!0):t.value=AssignExpression(e,n):i===RETURN&&(a.hasEmptyReturn=!0),a.hasReturnWithValue&&a.isGenerator)throw e.newSyntaxError("Generator returns a value");return t}function FunctionDefinition(e,n,t,r){var i,a=new Node(e,{params:[]});if(a.type!==FUNCTION&&(a.type="get"===a.value?GETTER:SETTER),e.match(IDENTIFIER))a.name=e.token.value;else if(t)throw e.newSyntaxError("missing function identifier");var s=new StaticContext(null,null,!0,!1,NESTING_TOP);if(e.mustMatch(LEFT_PAREN),!e.match(RIGHT_PAREN)){do switch(e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget(),a.params.push(DestructuringExpression(e,s));break;case IDENTIFIER:a.params.push(e.token.value);break;default:throw e.newSyntaxError("missing formal parameter")}while(e.match(COMMA));e.mustMatch(RIGHT_PAREN)}if(i=e.get(),i!==LEFT_CURLY&&e.unget(),i!==LEFT_CURLY){if(a.body=AssignExpression(e,s),a.body.isGenerator)throw e.newSyntaxError("Generator returns a value")}else a.body=Script(e,!0);return i===LEFT_CURLY&&e.mustMatch(RIGHT_CURLY),a.end=e.token.end,a.functionForm=r,r===DECLARED_FORM&&n.parentScript.funDecls.push(a),a}function Variables(e,n,t){var r,i,a,s;switch(s=e.token.type){case VAR:case CONST:a=n.parentScript;break;case LET:a=n.parentBlock;break;case LEFT_PAREN:s=LET,a=t}r=new Node(e,{type:s,destructurings:[]});do if(s=e.get(),s!==LEFT_BRACKET&&s!==LEFT_CURLY){if(s!==IDENTIFIER)throw e.newSyntaxError("missing variable name");if(i=new Node(e,{type:IDENTIFIER,name:e.token.value,readOnly:r.type===CONST}),r.push(i),a.varDecls.push(i),e.match(ASSIGN)){if(e.token.assignOp)throw e.newSyntaxError("Invalid variable initialization");i.initializer=AssignExpression(e,n)}}else{e.unget();var o=DestructuringExpression(e,n,!0);if(i=new Node(e,{type:IDENTIFIER,name:o,readOnly:r.type===CONST}),r.push(i),pushDestructuringVarDecls(i.name.destructuredNames,a),r.destructurings.push({exp:o,decl:i}),n.inForLoopInit&&e.peek()===IN)continue;if(e.mustMatch(ASSIGN),e.token.assignOp)throw e.newSyntaxError("Invalid variable initialization");i.initializer=AssignExpression(e,n)}while(e.match(COMMA));return r.end=e.token.end,r}function LetBlock(e,n,t){var r,i;return r=new Node(e,{type:LET_BLOCK,varDecls:[]}),e.mustMatch(LEFT_PAREN),r.variables=Variables(e,n,r),e.mustMatch(RIGHT_PAREN),t&&e.peek()!==LEFT_CURLY&&(i=new Node(e,{type:SEMICOLON,expression:r}),t=!1),t?r.block=Block(e,n):r.expression=AssignExpression(e,n),r}function checkDestructuring(e,n,t,r){if(t.type===ARRAY_COMP)throw e.newSyntaxError("Invalid array comprehension left-hand side");if(t.type===ARRAY_INIT||t.type===OBJECT_INIT){for(var i,a,s,o,c={},u=t.children,l=0,p=u.length;p>l;l++)if(i=u[l])if(i.type===PROPERTY_INIT?(o=i.children,s=o[1],a=o[0].value):t.type===OBJECT_INIT?(s=i,a=i.value):(s=i,a=l),s.type===ARRAY_INIT||s.type===OBJECT_INIT)c[a]=checkDestructuring(e,n,s,r);else{if(r&&s.type!==IDENTIFIER)throw e.newSyntaxError("missing name in pattern");c[a]=s}return c}}function DestructuringExpression(e,n,t){var r=PrimaryExpression(e,n);return r.destructuredNames=checkDestructuring(e,n,r,t),r}function GeneratorExpression(e,n,t){return new Node(e,{type:GENERATOR,expression:t,tail:ComprehensionTail(e,n)})}function ComprehensionTail(e,n){var t,r,i,a,s;t=new Node(e,{type:COMP_TAIL});do{switch(r=new Node(e,{type:FOR_IN,isLoop:!0}),e.match(IDENTIFIER)&&("each"===e.token.value?r.isEach=!0:e.unget()),s=MaybeLeftParen(e,n),e.get()){case LEFT_BRACKET:case LEFT_CURLY:e.unget(),r.iterator=DestructuringExpression(e,n);break;case IDENTIFIER:r.iterator=a=new Node(e,{type:IDENTIFIER}),a.name=a.value,r.varDecl=i=new Node(e,{type:VAR}),i.push(a),n.parentScript.varDecls.push(a);break;default:throw e.newSyntaxError("missing identifier")}e.mustMatch(IN),r.object=Expression(e,n),MaybeRightParen(e,s),t.push(r)}while(e.match(FOR));return e.match(IF)&&(t.guard=HeadExpression(e,n)),t}function HeadExpression(e,n){var t=MaybeLeftParen(e,n),r=ParenExpression(e,n);if(MaybeRightParen(e,t),t===END&&!r.parenthesized){var i=e.peek();if(i!==LEFT_CURLY&&!definitions.isStatementStartCode[i])throw e.newSyntaxError("Unparenthesized head followed by unbraced body")}return r}function ParenExpression(e,n){var t=Expression(e,n.update({inForLoopInit:n.inForLoopInit&&e.token.type===LEFT_PAREN}));if(e.match(FOR)){if(t.type===YIELD&&!t.parenthesized)throw e.newSyntaxError("Yield expression must be parenthesized");if(t.type===COMMA&&!t.parenthesized)throw e.newSyntaxError("Generator expression must be parenthesized");t=GeneratorExpression(e,n,t)}return t}function Expression(e,n){var t,r;if(t=AssignExpression(e,n),e.match(COMMA)){r=new Node(e,{type:COMMA}),r.push(t),t=r;do{if(r=t.children[t.children.length-1],r.type===YIELD&&!r.parenthesized)throw e.newSyntaxError("Yield expression must be parenthesized");t.push(AssignExpression(e,n))}while(e.match(COMMA))}return t}function AssignExpression(e,n){var t,r;if(e.match(YIELD,!0))return ReturnOrYield(e,n);if(t=new Node(e,{type:ASSIGN}),r=ConditionalExpression(e,n),!e.match(ASSIGN))return r;switch(r.type){case OBJECT_INIT:case ARRAY_INIT:r.destructuredNames=checkDestructuring(e,n,r);case IDENTIFIER:case DOT:case INDEX:case CALL:break;default:throw e.newSyntaxError("Bad left-hand side of assignment")}return t.assignOp=e.token.assignOp,t.push(r),t.push(AssignExpression(e,n)),t}function ConditionalExpression(e,n){var t,r;if(t=OrExpression(e,n),e.match(HOOK)){if(r=t,t=new Node(e,{type:HOOK}),t.push(r),t.push(AssignExpression(e,n.update({inForLoopInit:!1}))),!e.match(COLON))throw e.newSyntaxError("missing : after ?");t.push(AssignExpression(e,n))}return t}function OrExpression(e,n){var t,r;for(t=AndExpression(e,n);e.match(OR);)r=new Node(e),r.push(t),r.push(AndExpression(e,n)),t=r;return t}function AndExpression(e,n){var t,r;for(t=BitwiseOrExpression(e,n);e.match(AND);)r=new Node(e),r.push(t),r.push(BitwiseOrExpression(e,n)),t=r;return t}function BitwiseOrExpression(e,n){var t,r;for(t=BitwiseXorExpression(e,n);e.match(BITWISE_OR);)r=new Node(e),r.push(t),r.push(BitwiseXorExpression(e,n)),t=r;return t}function BitwiseXorExpression(e,n){var t,r;for(t=BitwiseAndExpression(e,n);e.match(BITWISE_XOR);)r=new Node(e),r.push(t),r.push(BitwiseAndExpression(e,n)),t=r;return t}function BitwiseAndExpression(e,n){var t,r;for(t=EqualityExpression(e,n);e.match(BITWISE_AND);)r=new Node(e),r.push(t),r.push(EqualityExpression(e,n)),t=r;return t}function EqualityExpression(e,n){var t,r;for(t=RelationalExpression(e,n);e.match(EQ)||e.match(NE)||e.match(STRICT_EQ)||e.match(STRICT_NE);)r=new Node(e),r.push(t),r.push(RelationalExpression(e,n)),t=r;return t}function RelationalExpression(e,n){var t,r,i=n.update({inForLoopInit:!1});for(t=ShiftExpression(e,i);e.match(LT)||e.match(LE)||e.match(GE)||e.match(GT)||!n.inForLoopInit&&e.match(IN)||e.match(INSTANCEOF);)r=new Node(e),r.push(t),r.push(ShiftExpression(e,i)),t=r;return t}function ShiftExpression(e,n){var t,r;for(t=AddExpression(e,n);e.match(LSH)||e.match(RSH)||e.match(URSH);)r=new Node(e),r.push(t),r.push(AddExpression(e,n)),t=r;return t}function AddExpression(e,n){var t,r;for(t=MultiplyExpression(e,n);e.match(PLUS)||e.match(MINUS);)r=new Node(e),r.push(t),r.push(MultiplyExpression(e,n)),t=r;return t}function MultiplyExpression(e,n){var t,r;for(t=UnaryExpression(e,n);e.match(MUL)||e.match(DIV)||e.match(MOD);)r=new Node(e),r.push(t),r.push(UnaryExpression(e,n)),t=r;return t}function UnaryExpression(e,n){var t,r,i;switch(i=e.get(!0)){case DELETE:case VOID:case TYPEOF:case NOT:case BITWISE_NOT:case PLUS:case MINUS:t=i===PLUS?new Node(e,{type:UNARY_PLUS}):i===MINUS?new Node(e,{type:UNARY_MINUS}):new Node(e),t.push(UnaryExpression(e,n));break;case INCREMENT:case DECREMENT:t=new Node(e),t.push(MemberExpression(e,n,!0));break;default:e.unget(),t=MemberExpression(e,n,!0),e.tokens[e.tokenIndex+e.lookahead-1&3].lineno===e.lineno&&(e.match(INCREMENT)||e.match(DECREMENT))&&(r=new Node(e,{postfix:!0}),r.push(t),t=r)}return t}function MemberExpression(e,n,t){var r,i,a;for(e.match(NEW)?(r=new Node(e),r.push(MemberExpression(e,n,!1)),e.match(LEFT_PAREN)&&(r.type=NEW_WITH_ARGS,r.push(ArgumentList(e,n)))):r=PrimaryExpression(e,n);(a=e.get())!==END;){switch(a){case DOT:i=new Node(e),i.push(r),e.forceIdentifier(),i.push(new Node(e));break;case LEFT_BRACKET:i=new Node(e,{type:INDEX}),i.push(r),i.push(Expression(e,n)),e.mustMatch(RIGHT_BRACKET),i.end=e.token.end;break;case LEFT_PAREN:if(t){i=new Node(e,{type:CALL}),i.push(r),i.push(ArgumentList(e,n));break}default:return e.unget(),r}r=i}return r}function ArgumentList(e,n){var t,r;if(t=new Node(e,{type:LIST}),e.match(RIGHT_PAREN,!0))return t.end=e.token.end,t;do{if(r=AssignExpression(e,n),r.type===YIELD&&!r.parenthesized&&e.peek()===COMMA)throw e.newSyntaxError("Yield expression must be parenthesized");if(e.match(FOR)&&(r=GeneratorExpression(e,n,r),t.children.length>1||e.peek(!0)===COMMA))throw e.newSyntaxError("Generator expression must be parenthesized");t.push(r)}while(e.match(COMMA));return e.mustMatch(RIGHT_PAREN),t.end=e.token.end,t}function PrimaryExpression(e,n){var t,r,i=e.get(!0);switch(i){case FUNCTION:t=FunctionDefinition(e,n,!1,EXPRESSED_FORM);break;case LEFT_BRACKET:for(t=new Node(e,{type:ARRAY_INIT});(i=e.peek(!0))!==RIGHT_BRACKET;)if(i!==COMMA){if(t.push(AssignExpression(e,n)),i!==COMMA&&!e.match(COMMA))break}else e.get(),t.push(null);1===t.children.length&&e.match(FOR)&&(r=new Node(e,{type:ARRAY_COMP,expression:t.children[0],tail:ComprehensionTail(e,n)}),t=r),e.mustMatch(RIGHT_BRACKET),t.end=e.token.end;break;case LEFT_CURLY:var a;t=new Node(e,{type:OBJECT_INIT});e:if(!e.match(RIGHT_CURLY)){do if(i=e.get(),"get"!==e.token.value&&"set"!==e.token.value||e.peek()!==IDENTIFIER){switch(i){case IDENTIFIER:case NUMBER:case STRING:a=new Node(e,{type:IDENTIFIER});break;case RIGHT_CURLY:if(n.ecma3OnlyMode)throw e.newSyntaxError("Illegal trailing ,");break e;default:if(e.token.value in definitions.keywords){a=new Node(e,{type:IDENTIFIER});break}throw e.newSyntaxError("Invalid property name")}if(e.match(COLON))r=new Node(e,{type:PROPERTY_INIT}),r.push(a),r.push(AssignExpression(e,n)),t.push(r);else{if(e.peek()!==COMMA&&e.peek()!==RIGHT_CURLY)throw e.newSyntaxError("missing : after property");t.push(a)}}else{if(n.ecma3OnlyMode)throw e.newSyntaxError("Illegal property accessor");t.push(FunctionDefinition(e,n,!0,EXPRESSED_FORM))}while(e.match(COMMA));e.mustMatch(RIGHT_CURLY)}t.end=e.token.end;break;case LEFT_PAREN:var s=e.token.start;t=ParenExpression(e,n),e.mustMatch(RIGHT_PAREN),t.start=s,t.end=e.token.end,t.parenthesized=!0;break;case LET:t=LetBlock(e,n,!1);break;case NULL:case THIS:case TRUE:case FALSE:case IDENTIFIER:case NUMBER:case STRING:case REGEXP:t=new Node(e);break;default:throw e.newSyntaxError("missing operand")}return t}function parse(e,n,t){var r=new lexer.Tokenizer(e,n,t),i=Script(r,!1);if(!r.done)throw r.newSyntaxError("Syntax error");return i}function parseStdin(e,n){for(;;)try{var t=new lexer.Tokenizer(e,"stdin",n.value),r=Script(t,!1);return n.value=t.lineno,r}catch(i){if(!t.unexpectedEOF)throw i;var a=readline();if(!a)throw i;e+="\n"+a}}var lexer=Narcissus.lexer,definitions=Narcissus.definitions;const StringMap=definitions.StringMap,Stack=definitions.Stack;eval(definitions.consts);const NESTING_TOP=0,NESTING_SHALLOW=1,NESTING_DEEP=2;StaticContext.prototype={ecma3OnlyMode:!1,parenFreeMode:!1,update:function(e){var n={};for(var t in e)n[t]={value:e[t],writable:!0,enumerable:!0,configurable:!0};return Object.create(this,n)},pushLabel:function(e){return this.update({currentLabels:this.currentLabels.push(e),allLabels:this.allLabels.push(e)})},pushTarget:function(e){var n=e.isLoop||e.type===SWITCH;return n&&(e.target=this.defaultTarget),this.currentLabels.isEmpty()?n?this.update({defaultTarget:e}):this:(e.labels=new StringMap,this.currentLabels.forEach(function(n){e.labels.set(n,!0)}),this.update({currentLabels:new Stack,labeledTargets:this.labeledTargets.push(e),defaultTarget:n?e:this.defaultTarget}))},nest:function(e){var n=Math.max(this.nesting,e);return n!==this.nesting?this.update({nesting:n}):this}},definitions.defineProperty(Array.prototype,"top",function(){return this.length&&this[this.length-1]},!1,!1,!0);var Np=Node.prototype={};Np.constructor=Node,Np.toSource=Object.prototype.toSource,Np.push=function(e){return null!==e&&(e.start<this.start&&(this.start=e.start),this.end<e.end&&(this.end=e.end)),this.children.push(e)},Node.indentLevel=0,Np.toString=function(){var e=[];for(var n in this)this.hasOwnProperty(n)&&"type"!==n&&"target"!==n&&e.push({id:n,value:this[n]});e.sort(function(e,n){return e.id<n.id?-1:1});const t="    ";var r=++Node.indentLevel,i="{\n"+t.repeat(r)+"type: "+tokenString(this.type);for(n=0;n<e.length;n++)i+=", "+e[n].id+": "+e[n].value;return r=--Node.indentLevel,i+="\n"+t.repeat(r)+"}"},Np.getSource=function(){return this.tokenizer.source.slice(this.start,this.end)};const LOOP_INIT={isLoop:!0};definitions.defineGetter(Np,"filename",function(){return this.tokenizer.filename}),definitions.defineGetter(Np,"length",function(){throw new Error("Node.prototype.length is gone; use n.children.length instead")}),definitions.defineProperty(String.prototype,"repeat",function(e){for(var n="",t=this+n;--e>=0;)n+=t;return n},!1,!1,!0);const DECLARED_FORM=0,EXPRESSED_FORM=1,STATEMENT_FORM=2;return{parse:parse,parseStdin:parseStdin,Node:Node,DECLARED_FORM:DECLARED_FORM,EXPRESSED_FORM:EXPRESSED_FORM,STATEMENT_FORM:STATEMENT_FORM,Tokenizer:lexer.Tokenizer,FunctionDefinition:FunctionDefinition}}(),Narcissus.decompiler=function(){function indent(e,n){for(var t="",r=!0,i=0,a=n.length;a>i;i++){if(r)for(var s=0;e>s;s++)t+=" ";t+=n[i],r="\n"===n[i]}return t}function isBlock(e){return e&&e.type===BLOCK}function isNonEmptyBlock(e){
return isBlock(e)&&e.children.length>0}function nodeStr(e){return'"'+e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}function pp(e,n,t){var r=!1;if(!e)return"";if(!(e instanceof Object))return e;n||(r=!0,n=1);var i="";switch(e.parenthesized&&(i+="("),e.type){case FUNCTION:case GETTER:case SETTER:i+=e.type===FUNCTION?"function":e.type===GETTER?"get":"set",i+=(e.name?" "+e.name:"")+"(";for(var a=0,s=e.params.length;s>a;a++)i+=(a>0?", ":"")+pp(e.params[a],n);i+=") "+pp(e.body,n);break;case SCRIPT:case BLOCK:var o=e.children;if(r){for(var a=0,s=o.length;s>a;a++){a>0&&(i+="\n"),i+=pp(o[a],n);var c=i[i.length-1];";"!=c&&(i+=";")}break}i+="{",void 0!==e.id&&(i+=" /* "+e.id+" */"),i+="\n";for(var a=0,s=o.length;s>a;a++){a>0&&(i+="\n"),i+=indent(4,pp(o[a],n));var c=i[i.length-1];";"!=c&&(i+=";")}i+="\n}";break;case LET_BLOCK:i+="let ("+pp(e.variables,n,!0)+") ",i+=e.expression?pp(e.expression,n):pp(e.block,n);break;case IF:i+="if ("+pp(e.condition,n)+") ";var u=e.thenPart,l=e.elsePart,p=isBlock(u)||isBlock(l);p||(i+="{\n"),i+=(p?pp(u,n):indent(4,pp(u,n)))+"\n",l&&(i+=p?" else ":"} else {\n",i+=(p?pp(l,n):indent(4,pp(l,n)))+"\n"),p||(i+="}");break;case SWITCH:i+="switch ("+pp(e.discriminant,n)+") {\n";for(var a=0,s=e.cases.length;s>a;a++){var f=e.cases[a];i+=f.type===CASE?"  case "+pp(f.caseLabel,n)+":\n":"  default:\n",ps=pp(f.statements,n),i+=ps.slice(2,ps.length-2)+"\n"}i+="}";break;case FOR:i+="for ("+pp(e.setup,n)+"; "+pp(e.condition,n)+"; "+pp(e.update,n)+") ";var d=pp(e.body,n);isBlock(e.body)?e.body&&(i+=d):i+="{\n"+indent(4,d)+";\n}";break;case WHILE:i+="while ("+pp(e.condition,n)+") ";var d=pp(e.body,n);i+=isBlock(e.body)?d:"{\n"+indent(4,d)+";\n}";break;case FOR_IN:var _=e.varDecl;i+=e.isEach?"for each (":"for (",i+=(_?pp(_,n):pp(e.iterator,n))+" in "+pp(e.object,n)+") ";var d=pp(e.body,n);isBlock(e.body)?e.body&&(i+=d):i+="{\n"+indent(4,d)+";\n}";break;case DO:i+="do "+pp(e.body,n),i+=" while ("+pp(e.condition,n)+");";break;case BREAK:i+="break"+(e.label?" "+e.label:"")+";";break;case CONTINUE:i+="continue"+(e.label?" "+e.label:"")+";";break;case TRY:i+="try ",i+=pp(e.tryBlock,n);for(var a=0,s=e.catchClauses.length;s>a;a++){var h=e.catchClauses[a];i+=" catch ("+pp(h.varName,n)+(h.guard?" if "+pp(h.guard,n):"")+") ",i+=pp(h.block,n)}e.finallyBlock&&(i+=" finally ",i+=pp(e.finallyBlock,n));break;case THROW:i+="throw "+pp(e.exception,n);break;case RETURN:i+="return",e.value&&(i+=" "+pp(e.value,n));break;case YIELD:i+="yield",e.value.type&&(i+=" "+pp(e.value,n));break;case GENERATOR:i+=pp(e.expression,n)+" "+pp(e.tail,n);break;case WITH:i+="with ("+pp(e.object,n)+") ",i+=pp(e.body,n);break;case LET:case VAR:case CONST:var o=e.children;t||(i+=tokens[e.type]+" ");for(var a=0,s=o.length;s>a;a++){a>0&&(i+=", ");var _=o[a];i+=pp(_.name,n),_.initializer&&(i+=" = "+pp(_.initializer,n))}break;case DEBUGGER:i+="debugger\n";break;case SEMICOLON:e.expression&&(i+=pp(e.expression,n)+";");break;case LABEL:i+=e.label+":\n"+pp(e.statement,n);break;case COMMA:case LIST:for(var o=e.children,a=0,s=o.length;s>a;a++)a>0&&(i+=", "),i+=pp(o[a],n);break;case ASSIGN:var o=e.children,h=e.assignOp;i+=pp(o[0],n)+" "+(h?tokens[h]:"")+"= "+pp(o[1],n);break;case HOOK:var o=e.children;i+="("+pp(o[0],n)+" ? "+pp(o[1],n)+" : "+pp(o[2],n),i+=")";break;case OR:case AND:var o=e.children;i+="("+pp(o[0],n)+" "+tokens[e.type]+" "+pp(o[1],n),i+=")";break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var o=e.children;i+="("+pp(o[0],n)+" "+tokens[e.type]+" "+pp(o[1],n)+")";break;case DELETE:case VOID:case TYPEOF:i+=tokens[e.type]+" "+pp(e.children[0],n);break;case NOT:case BITWISE_NOT:i+=tokens[e.type]+pp(e.children[0],n);break;case UNARY_PLUS:i+="+"+pp(e.children[0],n);break;case UNARY_MINUS:i+="-"+pp(e.children[0],n);break;case INCREMENT:case DECREMENT:i+=e.postfix?pp(e.children[0],n)+tokens[e.type]:tokens[e.type]+pp(e.children[0],n);break;case DOT:var o=e.children;i+=pp(o[0],n)+"."+pp(o[1],n);break;case INDEX:var o=e.children;i+=pp(o[0],n)+"["+pp(o[1],n)+"]";break;case CALL:var o=e.children;i+=pp(o[0],n)+"("+pp(o[1],n)+")";break;case NEW:case NEW_WITH_ARGS:var o=e.children;i+="new "+pp(o[0],n),o[1]&&(i+="("+pp(o[1],n)+")");break;case ARRAY_INIT:i+="[";for(var o=e.children,a=0,s=o.length;s>a;a++)o[a]&&(i+=pp(o[a],n)),i+=",";i+="]";break;case ARRAY_COMP:i+="["+pp(e.expression,n)+" ",i+=pp(e.tail,n),i+="]";break;case COMP_TAIL:for(var o=e.children,a=0,s=o.length;s>a;a++)a>0&&(i+=" "),i+=pp(o[a],n);e.guard&&(i+=" if ("+pp(e.guard,n)+")");break;case OBJECT_INIT:var o=e.children;i+=o[0]&&o[0].type===PROPERTY_INIT?"{\n":"{";for(var a=0,s=o.length;s>a;a++){a>0&&(i+=",\n");var h=o[a];if(h.type===PROPERTY_INIT){var m,E=h.children;m="string"!=typeof E[0].value||/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(E[0].value)?pp(E[0],n):nodeStr(E[0]),i+=indent(4,m)+": "+indent(4,pp(E[1],n)).substring(4)}else i+=indent(4,pp(h,n))}i+="\n}";break;case NULL:i+="null";break;case THIS:i+="this";break;case TRUE:i+="true";break;case FALSE:i+="false";break;case IDENTIFIER:case NUMBER:case REGEXP:i+=e.value.isOctal?"0"+e.value.toString(8):e.value;break;case STRING:i+=nodeStr(e);break;case GROUP:i+="("+pp(e.children[0],n)+")";break;default:throw"PANIC: unknown operation "+tokens[e.type]+" "+e.toSource()}return e.parenthesized&&(i+=")"),i}const parser=Narcissus.parser,definitions=Narcissus.definitions,tokens=definitions.tokens;return eval(definitions.consts),{pp:pp}}(),function(e){e.version="0.10.8"}("undefined"!=typeof exports?exports:Streamline.version=Streamline.version||{}),function(){var e;if("undefined"!=typeof exports){var n=srequire;try{e=n("source-map")}catch(t){}}e||(e={SourceNode:function(e,n,t,r){this.children=r?[r]:[]}},e.SourceNode.prototype.add=function(e){return Array.isArray(e)?this.children=this.children.concat(e):this.children.push(e),this},e.SourceNode.prototype.prepend=function(e){return Array.isArray(e)?this.children=e.concat(this.children.concat):this.children.unshift(e),this},e.SourceNode.prototype.toString=function(){var e="";return this.walk(function(n){e+=n}),e},e.SourceNode.prototype.walk=function(n){return this.children.forEach(function(t){t instanceof e.SourceNode?t.walk(n):n(t)}),this}),function(n){function t(){e.SourceNode.apply(this,arguments)}t.prototype=Object.create(e.SourceNode.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0},length:{get:function(){var e=0;return this.walk(function(n){e+=n.length}),e}}}),t.prototype.stripPrefix=function(e){for(var n;this.children.length>0&&e>0&&(n=this.children[0].length)<=e;)this.children.shift(),e-=n;return 0==this.children.length||0==e?this:("string"==typeof this.children[0]?this.children[0]=this.children[0].substring(e):this.children[0].stripPrefix(e),this)},t.prototype.stripSuffix=function(e){for(var n,t;(t=this.children.length)>0&&e>0&&(n=this.children[t-1].length)<=e;)this.children.pop(),e-=n;return 0==t||0==e?this:("string"==typeof this.children[t-1]?this.children[t-1]=this.children[0].slice(0,-e):this.children[t-1].stripSuffix(e),this)},t.prototype.map=function(n){return this.children=this.children.map(function(t){return t instanceof e.SourceNode?t.map(n):n(t)}),this},t.prototype.lastChar=function(){for(var e=this.children.length;e--;){var n;if(n="string"==typeof this.children[e]?this.children[e].slice(-1):this.children[e].lastChar())return n}return""},n.exports=Object.create(e,{SourceNode:{value:t}})}("undefined"!=typeof exports?module:Streamline.sourceMap=Streamline.sourceMap||{})}(),"undefined"!=typeof exports)var Narcissus=srequire("streamline/deps/narcissus");var sourceMap=srequire("streamline/lib/util/source-map");if(function(exports){function _pp(e){function n(e){return o+=1,e}function t(e,n){var t=new Array(e+1).join(" ");return n.map(function(e){return e.replace(/\n/g,"\n"+t)}),n.prepend(new sourceMap.SourceNode(null,null,null,t)),n}function r(e){return e&&e.type===BLOCK}function i(e,n){var t,r,i=e.tokenizer&&e.tokenizer.filename;i=i||void 0;var a=e.start,s=e.end,o=e.tokenizer&&e.tokenizer.source;if(!(i&&a&&s&&o))return new sourceMap.SourceNode(void 0,void 0,void 0,n);if(i&&!l){l=[],l[-1]=0;for(var t=1,c=o.indexOf("\n");c>=0;c=o.indexOf("\n",c+1))l[c]=t,t++}for(;s>a&&" \n	;{}".indexOf(o[a])>=0;)a++;if(s>a){var u=(o.substring(a,s),o.lastIndexOf("\n",a));t=l[u]+1,r=a-(u+1)}else i=void 0;return new sourceMap.SourceNode(t,r,i,n)}function a(e){return i(e,'"'+e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"')}function s(e,u,l){var p=!1;if(!e)return"";if(!(e instanceof Object))return""+e;u||(p=!0,u=1),c[o]||(c[o]=[]),c[o].push(e);var f=i(e);switch(e.parenthesized&&f.add("("),e.type){case FUNCTION:case GETTER:case SETTER:e.type===FUNCTION?f.add("function"):e.type===GETTER?f.add("get"):f.add("set"),e.name&&f.add([" ",i(e,e.name)]),f.add("(");for(var d=0,_=e.params.length;_>d;d++)f.add([d>0?", ":"",s(e.params[d],u)]);f.add([") ",s(e.body,u)]);break;case SCRIPT:case BLOCK:var h=e.children;if(p){for(var d=0,_=h.length;_>d;d++)d>0&&f.add(n("\n")),f.add(s(h[d],u)),";"!=f.lastChar()&&f.add(";");break}f.add("{"),void 0!==e.id&&f.add(" /* "+e.id+" */"),f.add(n("\n"));for(var d=0,_=h.length;_>d;d++)d>0&&f.add(n("\n")),f.add(t(2,s(h[d],u))),";"!=f.lastChar()&&f.add(";");f.add(n("\n}"));break;case LET_BLOCK:f.add(["let (",s(e.variables,u,!0),") "]),e.expression?f.add(s(e.expression,u)):f.add(s(e.block,u));break;case IF:f.add(["if (",s(e.condition,u),") "]);var m=e.thenPart,E=e.elsePart,y=r(m)||r(E);y||f.add(n("{\n")),f.add(y?s(m,u):t(2,s(m,u))),E&&";}".indexOf(f.lastChar())<0&&f.add(";"),f.add(n("\n")),E&&(y?f.add(" else "):f.add(n("} else {\n")),f.add([y?s(E,u):t(2,s(E,u)),n("\n")])),y||f.add("}");break;case SWITCH:f.add(["switch (",s(e.discriminant,u),n(") {\n")]);for(var d=0,_=e.cases.length;_>d;d++){var b=e.cases[d];b.type===CASE?f.add(["case ",s(b.caseLabel,u),n(":\n")]):f.add(n("  default:\n")),f.add([s(b.statements,u).stripPrefix(2).stripSuffix(2),n("\n")]),o-=2}f.add("}");break;case FOR:f.add(["for (",s(e.setup,u),"; ",s(e.condition,u),"; ",s(e.update,u),") "]);var v=s(e.body,u);r(e.body)?e.body&&f.add(v):f.add([n("{\n"),t(2,v),n(";\n}")]);break;case WHILE:f.add(["while (",s(e.condition,u),") "]);var v=s(e.body,u);r(e.body)?f.add(v):f.add([n("{\n"),t(2,v),n(";\n}")]);break;case FOR_IN:var T=e.varDecl;f.add([e.isEach?"for each (":"for (",T?s(T,u):s(e.iterator,u)," in ",s(e.object,u),") "]);var v=s(e.body,u);r(e.body)?e.body&&f.add(v):f.add([n("{\n"),t(2,v),n(";\n}")]);break;case DO:f.add(["do ",s(e.body,u)," while (",s(e.condition,u),");"]);break;case BREAK:f.add(["break",e.label?" "+e.label:"",";"]);break;case CONTINUE:f.add(["continue",e.label?" "+e.label:"",";"]);break;case TRY:f.add(["try ",s(e.tryBlock,u)]);for(var d=0,_=e.catchClauses.length;_>d;d++){var I=e.catchClauses[d];f.add([" catch (",s(I.varName,u),I.guard?" if "+s(I.guard,u):"",") ",s(I.block,u)])}e.finallyBlock&&f.add([" finally ",s(e.finallyBlock,u)]);break;case THROW:f.add(["throw ",s(e.exception,u)]);break;case RETURN:f.add("return"),e.value&&f.add([" ",s(e.value,u)]);break;case YIELD:f.add("yield"),e.value.type&&f.add([" ",s(e.value,u)]);break;case GENERATOR:f.add([s(e.expression,u)," ",s(e.tail,u)]);break;case WITH:f.add(["with (",s(e.object,u),") ",s(e.body,u)]);break;case LET:case VAR:case CONST:var h=e.children;l||f.add([tokens[e.type]," "]);for(var d=0,_=h.length;_>d;d++){d>0&&f.add(", ");var T=h[d];f.add(s(T.name,u)),T.initializer&&f.add([" = ",s(T.initializer,u)])}break;case DEBUGGER:f.add(n("debugger\n"));break;case SEMICOLON:e.expression&&f.add([s(e.expression,u),";"]);break;case LABEL:f.add([e.label,n(":\n"),s(e.statement,u)]);break;case COMMA:case LIST:for(var h=e.children,d=0,_=h.length;_>d;d++)d>0&&f.add(", "),f.add(s(h[d],u));break;case ASSIGN:var h=e.children,I=e.assignOp;f.add([s(h[0],u)," ",I?tokens[I]:"","="," ",s(h[1],u)]);break;case HOOK:var h=e.children;f.add(["(",s(h[0],u)," ? ",s(h[1],u)," : ",s(h[2],u),")"]);break;case OR:case AND:var h=e.children;f.add(["(",s(h[0],u)," ",tokens[e.type]," ",s(h[1],u),")"]);break;case BITWISE_OR:case BITWISE_XOR:case BITWISE_AND:case EQ:case NE:case STRICT_EQ:case STRICT_NE:case LT:case LE:case GE:case GT:case IN:case INSTANCEOF:case LSH:case RSH:case URSH:case PLUS:case MINUS:case MUL:case DIV:case MOD:var h=e.children;f.add(["(",s(h[0],u)," ",tokens[e.type]," ",s(h[1],u),")"]);break;case DELETE:case VOID:case TYPEOF:f.add([tokens[e.type]," ",s(e.children[0],u)]);break;case NOT:case BITWISE_NOT:f.add([tokens[e.type],s(e.children[0],u)]);break;case UNARY_PLUS:f.add(["+",s(e.children[0],u)]);break;case UNARY_MINUS:f.add(["-",s(e.children[0],u)]);break;case INCREMENT:case DECREMENT:e.postfix?f.add([s(e.children[0],u),tokens[e.type]]):f.add([tokens[e.type],s(e.children[0],u)]);break;case DOT:var h=e.children;f.add([s(h[0],u),".",s(h[1],u)]);break;case INDEX:var h=e.children;f.add([s(h[0],u),"[",s(h[1],u),"]"]);break;case CALL:var h=e.children;f.add([s(h[0],u),"(",s(h[1],u),")"]);break;case NEW:case NEW_WITH_ARGS:var h=e.children;f.add("new "),f.add(s(h[0],u)),h[1]&&f.add(["(",s(h[1],u),")"]);break;case ARRAY_INIT:f.add("[");for(var h=e.children,d=0,_=h.length;_>d;d++)h[d]&&f.add(s(h[d],u)),f.add(",");f.add("]");break;case ARRAY_COMP:f.add(["[",s(e.expression,u)," ",s(e.tail,u),"]"]);break;case COMP_TAIL:for(var h=e.children,d=0,_=h.length;_>d;d++)d>0&&f.add(" "),f.add(s(h[d],u));e.guard&&f.add([" if (",s(e.guard,u),")"]);break;case OBJECT_INIT:var h=e.children;h[0]&&h[0].type===PROPERTY_INIT?f.add(n("{\n")):f.add("{");for(var d=0,_=h.length;_>d;d++){d>0&&f.add(n(",\n"));var I=h[d];if(I.type===PROPERTY_INIT){var N,g=I.children;"string"!=typeof g[0].value||/^[A-Za-z_$][A-Za-z0-9_$]*$/.test(g[0].value)?(N=s(g[0],u),f.add(t(2,N))):(N=a(g[0]),f.add(N)),f.add([": ",t(2,s(g[1],u)).stripPrefix(2)])}else f.add(t(2,s(I,u)))}f.add(n("\n}"));break;case NULL:f.add("null");break;case THIS:f.add("this");break;case TRUE:f.add("true");break;case FALSE:f.add("false");break;case IDENTIFIER:case NUMBER:case REGEXP:e.value.isOctal?f.add("0"+e.value.toString(8)):f.add(""+e.value);break;case STRING:f.add(a(e));break;case GROUP:f.add(["(",s(e.children[0],u),")"]);break;default:throw"PANIC: unknown operation "+tokens[e.type]+" "+e.toSource()}return e.parenthesized&&f.add(")"),f}var o=0,c={},u=s(e);return{source:u,lineMap:c};var l}eval(Narcissus.definitions.consts);var tokens=Narcissus.definitions.tokens;exports.format=function(e,n){var t="",r=_pp(e);if("sourcemap"==n)return r.source;if(r.source=r.source.toString(),"ignore"==n)return r.source;var i=r.lineMap,a=r.source.split("\n");if("preserve"==n){for(var s=1,o=!0,c=0;c<a.length;c++){var u=(i[c]||[]).filter(function(e){return e._isSourceNode});if(u.length>0)for(var l=u[0].lineno;l>s;)t+="\n",s+=1,o=!0;t+=o?a[c]:a[c].replace(/^\s+/," "),o=!1}t+="\n"}else{if("mark"!=n)throw new Error("bad --lines option: "+n);for(var c=0;c<a.length;c++){var p=a[c],u=(i[c]||[]).filter(function(e){return e._isSourceNode}),f="            ";if(u.length>0){var l=""+u[0].lineno;f="/* ";for(var d=l.length;5>d;d++)f+=" ";f+=l+" */ "}t+=f+p+"\n"}}return t}}("undefined"!=typeof exports?exports:window.Streamline=window.Streamline||{}),"undefined"!=typeof exports)var Narcissus=srequire("../../deps/narcissus"),format=srequire("./format").format;else var format=Streamline.format;!function(exports){function _assert(e){if(!e)throw new Error("Assertion failed!")}function _tag(e){if(!e||!e.type)return"*NOT_A_NODE*";var n=definitions.tokens[e.type];return/^\W/.test(n)?definitions.opTypeNames[n]:n.toUpperCase()}function originalLine(e,n,t){if(!e.prevMap)return n;null==t&&(t=1e3);var r=e.prevMap.originalPositionFor({line:n,column:t}).line;return null==r?n:r}function originalCol(e,n,t){return e.prevMap?e.prevMap.originalPositionFor({line:n,column:t}).column||0:t}function _node(e,n,t){return{_scope:e&&e._scope,_async:e&&e._async,type:n,children:t}}function _identifier(e,n){return{_scope:n&&n._scope,type:IDENTIFIER,name:e,value:e,initializer:n}}function _number(e){return{type:NUMBER,value:e}}function _string(e){return{type:STRING,value:e}}function _return(e){return{type:RETURN,_scope:e._scope,value:e}}function _semicolon(e){var n=_node(e,SEMICOLON);return n.expression=e,n}function _safeName(e,n){if("__"===n.substring(0,2))for(;e[n];)n+="A";return n}function _flatten(e){if(e.type==BLOCK||e.type==SCRIPT)do{var n=!1,t=[];e.children.forEach(function(r){r._isFunctionReference||r.type==SEMICOLON&&(null==r.expression||r.expression._isFunction)||(e._async|=r._async,r.type==BLOCK||r.type==SCRIPT?(t=t.concat(r.children),n=!0):t.push(r))}),e.children=t}while(n);return e}function _propagate(e,n,t,r){var i=r?r:e;for(var a in e)if(e.hasOwnProperty(a)&&a.indexOf("Decls")<0&&(t||"target"!=a)&&"_"!=a[0]){var s=e[a];if(null!=s)if(Array.isArray(s)){r&&(i[a]=s=[].concat(s));for(var o=!1,c=0;c<s.length;c++)(t||s[c]&&s[c].type)&&(s[c]=n(s[c],e),o|="undefined"==typeof s[c]);o&&(i[a]=s.filter(function(e){return"undefined"!=typeof e}))}else(t||s&&s.type)&&(i[a]=n(s,e))}return i}function _clone(e){function n(e){if(!e||!e.type)return e;var i=e._cloneId;i||(i=e._cloneId=++t);var a=r[i];return a?a:(r[i]=a={_cloneId:i},_propagate(e,n,!0,a))}var t=0,r={};return _propagate(e,n,!0,{})}function Template(e,n,t,r){var i=parse("function _t(){"+n+"}").children[0].body;i=1==i.children.length?i.children[0]:_node(i.children[0],BLOCK,i.children),this.generate=function(n,a){function s(n){if(n.type!=SCRIPT&&n.type!=BLOCK&&(n._pass=e),n.type==FUNCTION&&r&&(_assert(null==u),u=n),!n||!n.type)return"_"==n?c.options.callback:"string"==typeof n?"$"===n[0]?a[n]:_safeName(c.options.precious,n):n;n._scope=c;var t=n.type==SEMICOLON?n.expression:n;if(t&&t.type==IDENTIFIER&&"$"===t.value[0]){var i=a[t.value];return t.initializer&&(i.initializer=s(t.initializer),i.initializer._async&&(i._async=!0)),i}return n=_propagate(n,function(e){return e=s(e),e&&(e._async||e===c.options.callback&&r)&&n.type!==FUNCTION&&(n._async=!0),e},!0),n=_flatten(n)}function o(e,n){return e.type==FUNCTION?e:(e._scope=c,_propagate(e,o))}var c=n._scope;_assert(null!=c),a=a||{};var u=null,l=s(_clone(i));if(u){u.parenthesized=!0;var c=new Scope(u.body,u._scope.options);c.name=u._scope.name,c.line=u._scope.line,c.last=u._scope.last,_assert(u.params[0]===u._scope.options.callback),c.cbIndex=0,_propagate(u,o)}return t?l.value:l},this.root=t?i.value:i}function Scope(e,n){this.script=e,this.line=0,this.last=0,this.vars=[],this.functions=[],this.options=n,this.cbIndex=-1,this.isAsync=function(){return this.cbIndex>=0}}function _genId(e){return _safeName(e._scope.options.precious,"__"+ ++e._scope.last)}function _removeFast(e,n){function t(e){return e.type===IDENTIFIER&&e.value===n.callback}function r(e){return e.type===CALL&&t(e.children[0])&&2===e.children[1].children.length}return e.type===BITWISE_NOT&&t(e.children[0])?(n.needsTransform=!0,e.children[0]):e.type===ARRAY_INIT&&1===e.children.length&&t(e.children[0])?(n.needsTransform=!0,e.children[0]._returnArray=!0,e.children[0]):e.type===RSH&&t(e.children[0])?(n.needsTransform=!0,e.children[1]):e.type===LSH&&t(e.children[0])?(n.needsTransform=!0,e.children[1]):e.type===NOT&&t(e.children[0])?(n.needsTransform=!0,e.type=FALSE,e.children=[],e):r(e)?(e._isStar=!0,n.needsTransform=!0,e.children[0].value=_safeName(n.precious,"__rt")+".streamlinify",e):e}function _markSource(e,n){function t(e){"string"==typeof e.value&&(n.precious[e.value]=!0),e.params&&e.params.forEach(function(e){n.precious[e]=!0}),e._isSourceNode=!0,_propagate(e,function(e){return e=_removeFast(e,n),t(e),e})}t(e)}function _isScriptAsync(e,n){function t(e,i){switch(e.type){case FUNCTION:return e;case IDENTIFIER:return e.value==n.callback?r=!0:_propagate(e,t),e;case CALL:var a,s=e.children[0],o=e.children[1];if(s.type===DOT&&"call"===(a=s.children[1]).value&&(s=s.children[0]).type===FUNCTION&&0===s.params.length&&!s.name&&1===o.children.length&&o.children[0].type===THIS)return _propagate(s.body,t),e;default:return r||_propagate(e,t),e}}var r=!1;return _propagate(e,t),r&&n.verbose&&console.log("WARNING: async calls found at top level in "+e.filename),r}function _canonTopLevelScript(e,n){return e._scope=new Scope(e,n),_isScriptAsync(e,n)?_rootTemplate.generate(e,{$script:e}):e}function _guessName(e,n){function t(e){return e=e.replace(/[^A-Z0-9_$]/gi,"_o_"),e&&!/^\d/.test(e)?e:"_o_"+e}var r,i,a=_genId(e);if(n.type===IDENTIFIER)return t(n.value)+a;if(n.type===ASSIGN){r=n.children[0];for(var s="";r.type===DOT&&(i=r.children[1]).type===IDENTIFIER||r.type===INDEX&&(i=r.children[1]).type===STRING;)s=s?i.value+"_"+s:i.value,r=r.children[0];if(r.type===IDENTIFIER&&(s=s?r.value+"_"+s:r.value),s)return t(s)+a}else if(n.type==PROPERTY_INIT&&(r=n.children[0],r.type===IDENTIFIER||r.type===STRING))return t(r.value)+a;return a}function _canonScopes(e,n){function t(e,r){var i=r._scope;e._scope=i;var a=i.isAsync();if(!a&&e.type!==FUNCTION){if(e.type===IDENTIFIER&&e.value===n.callback&&!r._isStar)throw new Error(e.filename+": Function contains async calls but does not have _ parameter: "+e.name+" at line "+e.lineno);return _propagate(e,t)}switch(e.type===TRY&&(e._async=!0),e.type){case FUNCTION:var s=e,o=e.params.reduce(function(e,t,r){if(t!=n.callback)return e;if(0>e)return r;throw new Error("duplicate _ parameter")},-1);if(o>=0){if(_isFatArrow(e))return e;n.needsTransform=!0,e.name||(e.name=_guessName(e,r))}!a||r.type!==SCRIPT&&r.type!==BLOCK||(i.functions.push(e),s=void 0);var c=new Scope(e.body,n);return e.body._scope=c,c.name=e.name,c.cbIndex=o,c.line=e.lineno,e.body=_propagate(e.body,t),o>=0&&c.functions.push(_string("BEGIN_BODY")),e.body.children=c.functions.concat(e.body.children),c.hasThis&&!e._inhibitThis&&c.vars.push(_identifier(_safeName(n.precious,"__this"),_node(e,THIS))),c.hasArguments&&!e._inhibitArguments&&c.vars.push(_identifier(_safeName(n.precious,"__arguments"),_identifier("arguments"))),c.vars.length>0&&e.body.children.splice(0,0,_node(e,VAR,c.vars)),s;case VAR:var u=e.children.map(function(e){return i.vars.some(function(n){return n.value==e.value})||i.vars.push(_identifier(e.value)),e.initializer?(e=_assignTemplate.generate(r,{$lhs:_identifier(e.value),$rhs:e.initializer}),r.type===FOR&&(e=e.expression),e):null}).filter(function(e){return null!=e});if(0==u.length)return;var l=r.type==BLOCK||r.type===SCRIPT?BLOCK:COMMA,s=_node(r,l,u);return s=_propagate(s,t),r._async|=s._async,s;case THIS:return i.hasThis=!0,_identifier(_safeName(n.precious,"__this"));case IDENTIFIER:if("arguments"===e.value)return i.hasArguments=!0,_identifier(_safeName(n.precious,"__arguments"));if(e=_propagate(e,t),e._async|=e.value===n.callback,e._async&&!r.isArgsList&&(r.type!==PROPERTY_INIT||e!==r.children[0])&&(r.type!==DOT||e!==r.children[1]))throw new Error("invalid usage of '_'");return r._async|=e._async,e;case NEW_WITH_ARGS:var o=e.children[1].children.reduce(function(e,t,r){if(t.type!==IDENTIFIER||t.value!==n.callback)return e;if(0>e)return r;throw new Error("duplicate _ argument")},-1);if(o>=0){var p=_node(e,CALL,[_identifier(_safeName(n.precious,"__construct")),_node(e,LIST,[e.children[0],_number(o)])]);e=_node(e,CALL,[p,e.children[1]])}return e.children[1].isArgsList=!0,e=_propagate(e,t),r._async|=e._async,e;case CALL:e.children[1].isArgsList=!0,_convertCoffeeScriptCalls(e,n),_convertApply(e,n),e.children[1].isArgsList=!0;default:return e=_propagate(e,t),_setBreaks(e),r._async|=e._async,e}}return _propagate(e,t)}function _convertCoffeeScriptCalls(e,n){var t=e.children[0],r=e.children[1];if(t.type!==FUNCTION||0!==t.params.length||t.name||0!=r.children.length){if(t.type===DOT){var i=t.children[1];t=t.children[0],t.type!==FUNCTION||0!==t.params.length||t.name||i.type!==IDENTIFIER||("call"===i.value&&1===r.children.length&&r.children[0].type===THIS?(e.children[0]=t,t._noFuture=!0,t.name="___closure",t.params=[n.callback],r.children=[_identifier(n.callback)],e._scope.hasThis=!0,t._inhibitThis=!0):"apply"===i.value&&2===r.children.length&&r.children[0].type===THIS&&r.children[1].type===IDENTIFIER&&"arguments"===r.children[1].value&&(e.children[0]=t,t._noFuture=!0,t.name="___closure",t.params=[n.callback],r.children=[_identifier(n.callback)],e._scope.hasThis=!0,e._scope.hasArguments=!0,t._inhibitThis=!0,t._inhibitArguments=!0))}}else t._noFuture=!0,t.name="___closure",t.params=[n.callback],r.children=[_identifier(n.callback)]}function _isFatArrow(e){if(1!==e.body.children.length)return!1;var n=e.body.children[0];if(n.type!==RETURN||!n.value)return!1;if(n=n.value,n.type!==CALL)return!1;var t=n.children[1].children,r=n.children[0];return 2!==t.length||"_this"!==t[0].value||"arguments"!==t[1].value?!1:r.type!==DOT||"apply"!==r.children[1].value?!1:(r=r.children[0],r.type!==DOT||r.children[1].type!==IDENTIFIER?!1:(r=r.children[0],r.type!==DOT||"prototype"!==r.children[1].value?!1:(r=r.children[0],r.type!==IDENTIFIER?!1:(e.params=[],!0))))}function _convertApply(e,n){var t=e.children[0],r=e.children[1];if(t.type===DOT){var i=t.children[1];if(i.type===IDENTIFIER&&"apply"===i.value&&2===r.children.length&&r.children[0].type===THIS&&r.children[1].type===IDENTIFIER&&"arguments"===r.children[1].value){var a=t.children[0];e.children[0]=_identifier("__apply"),r.children=[_identifier(n.callback),a,_identifier("__this"),_identifier("__arguments"),_number(e._scope.cbIndex)],e._scope.hasThis=!0,e._scope.hasArguments=!0}}}function _setBreaks(e){switch(e.type){case IF:e._breaks=e.thenPart._breaks&&e.elsePart&&e.elsePart._breaks;break;case SWITCH:for(var n=0;n<e.cases.length;n++){var t=e.cases[n].statements;if(e._async&&t.children.length>0&&!t._breaks)if(n==e.cases.length-2&&e.cases[n+1].type===DEFAULT&&1===e.cases[n+1].statements.children.length&&e.cases[n+1].statements.children[0].type===SEMICOLON&&null==e.cases[n+1].statements.children[0].expression)t.children.push(_node(e,BREAK)),t._breaks=!0;else if(n===e.cases.length-1)t.children.push(_node(e,BREAK)),t._breaks=!0;else{var r=_identifier(_genId(e));e.cases[n].statements=_switchVarTemplate.generate(e.cases[n],{$v:r});var i=_switchIfTemplate.generate(e.cases[n],{$v:r,$block:t});e.cases[n+1].statements.children.splice(0,0,i)}}break;case TRY:e._breaks=e.tryBlock._breaks&&e.catchClauses[0]&&e.catchClauses[0].block._breaks;break;case BLOCK:case SCRIPT:e.children.forEach(function(n){e._breaks|=n._breaks});break;case RETURN:case THROW:case BREAK:e._breaks=!0}}function _statementify(e){function n(e){e.type===COMMA?e.children.forEach(n):t.children.push(e.type==SEMICOLON?e:_semicolon(e))}if(!e)return e;var t=_node(e,BLOCK,[]);return n(e),t}function _blockify(e){if(!e||e.type==BLOCK)return e;if(e.type==COMMA)return _statementify(e);var n=_node(e,BLOCK,[e]);return n._async=e._async,n}function _canonFlows(e,n){function t(e,n,r){function i(e){e.condition&&e.condition._async&&e.condition.type!==CALL&&(e.condition=_flowsTemplates.CONDITION.generate(e,{$name:"__$"+e._scope.name,$condition:t(e.condition,e,!0)})),e.update&&e.update._async&&(e.update=_flowsTemplates.UPDATE.generate(e,{$name:"__$"+e._scope.name,$update:_statementify(e.update)}))}var a=e._scope;if(e.type==FOR&&"flows"===e._pass&&i(e),!a||!a.isAsync()||!r&&"flows"===e._pass)return _propagate(e,t);switch(e.type){case IF:e.thenPart=_blockify(e.thenPart),e.elsePart=_blockify(e.elsePart);break;case SWITCH:if(e._async){var s=e.cases.filter(function(e){return e.type==DEFAULT})[0];s||(s=_node(e,DEFAULT),s.statements=_node(e,BLOCK,[]),e.cases.push(s)),s._breaks||s.statements.children.push(_node(e,BREAK))}break;case WHILE:e.body=_blockify(e.body),e._async&&(e=_flowsTemplates.WHILE.generate(e,{$condition:e.condition,$body:e.body}));break;case DO:e.body=_blockify(e.body),e._async&&(e=_flowsTemplates.DO.generate(e,{$firstTime:_identifier(_genId(e)),$condition:e.condition,$body:e.body}));break;case FOR:e.condition=e.condition||_number(1),e.body=_blockify(e.body),e._async&&(e.setup?e=_flowsTemplates.FOR.generate(e,{$setup:_statementify(e.setup),$condition:e.condition,$update:e.update,$body:e.body}):"flows"!==e._pass&&(e._pass="flows",i(e)));break;case FOR_IN:if(e.body=_blockify(e.body),e._async){if(e.iterator.type!=IDENTIFIER)throw new Error("unsupported 'for ... in' syntax: type="+_tag(e.iterator));e=_flowsTemplates.FOR_IN.generate(e,{$array:_identifier(_genId(e)),$i:_identifier(_genId(e)),$object:e.object,$iter:e.iterator,$body:e.body})}break;case TRY:e.tryBlock&&e.catchClauses[0]&&e.finallyBlock&&(e=_flowsTemplates.TRY.generate(e,{$try:e.tryBlock,$catch:e.catchClauses[0].block,$ex:e.catchClauses[0].varName,$finally:e.finallyBlock}));break;case AND:case OR:e._async&&(e=_flowsTemplates[_tag(e)].generate(e,{$name:"__$"+e._scope.name,$v:_identifier(_genId(e)),$op1:e.children[0],$op2:e.children[1]}));break;case HOOK:e._async&&(e=_flowsTemplates.HOOK.generate(e,{$name:"__$"+e._scope.name,$v:_identifier(_genId(e)),$condition:e.children[0],$true:e.children[1],$false:e.children[2]}));break;case COMMA:e._async&&(e=_flowsTemplates.COMMA.generate(e,{$name:"__$"+e._scope.name,$body:_node(e,BLOCK,e.children.slice(0,e.children.length-1).map(_semicolon)),$result:e.children[e.children.length-1]}))}return _propagate(e,t)}return _propagate(e,t)}function _split(e,n){var t=e[n];if(!t||!t._async)return e;var r=_genId(e),i=_identifier(r,t);return e[n]=_identifier(r),_node(e,BLOCK,[_node(e,VAR,[i]),e])}function _disassemble(e,n){function t(e,i,a){if(!e._async)return _propagate(e,r);if(e=_propagate(e,t),e.type===CALL){if(e.children[0].type===IDENTIFIER&&0==e.children[0].value.indexOf("__wrap"))return e._isWrapper=!0,e;var s=e.children[1];if(s.children.some(function(e){return e.type===IDENTIFIER&&e.value===n.callback||e._isWrapper})){if(a)return void e._scope.disassembly.push(_statementify(e));if(i.type==IDENTIFIER&&0===i.value.indexOf("__"))return e._skipDisassembly=!0,e;var o=_genId(e),c=_identifier(o,e);return e=_node(e,VAR,[c]),e._scope.disassembly.push(e),_identifier(o)}}return e}function r(e,n){var i=e._scope;if(!i||!i.isAsync()||!e._async)return _propagate(e,r);switch(e.type){case IF:e=_split(e,"condition");break;case SWITCH:e=_split(e,"discriminant");break;case FOR:break;case RETURN:e=_split(e,"value");break;case THROW:e=_split(e,"exception");break;case VAR:_assert(1===e.children.length);var a=e.children[0];return i.disassembly=[],a.initializer=t(a.initializer,a),e._async=a.initializer._skipDisassembly,i.disassembly.push(e),_node(n,BLOCK,i.disassembly);case SEMICOLON:return i.disassembly=[],e.expression=t(e.expression,e,!0),e.expression&&(e._async=!1,i.disassembly.push(e)),_node(n,BLOCK,i.disassembly)}return _propagate(e,r)}return _propagate(e,r)}function _callbackify(e,n){function t(e,r){if(e=_flatten(e),!e._scope||!e._scope.isAsync()||"cb"===e._pass)return _propagate(e,t);switch(e.type){case SCRIPT:if("cb"!==r._pass){for(var a,s=0;s<e.children.length;s++){var o=e.children[s];if(o.type===STRING&&"BEGIN_BODY"===o.value){a=e.children.splice(0,s),e.children.splice(0,1);break}}var c=r._noFuture||"flows"===r._pass?_cbTemplates.FUNCTION_INTERNAL:_cbTemplates.FUNCTION;e=c.generate(e,{$fn:r.name,$name:"__$"+e._scope.name,$fname:_string(r.name),$line:_number(originalLine(n,e._scope.line)),$index:_number(e._scope.cbIndex),$decls:_node(e,BLOCK,a||[]),$body:e})}e.type=SCRIPT;case BLOCK:for(var u=0;u<e.children.length;u++)e.children[u]=i(e,u);return e}return _propagate(e,t)}function r(e,n){return _node(e,BLOCK,e.children.splice(n+1,e.children.length-n-1))}function i(e,i){function s(e,r,i){function a(e){return e.children.reduce(function(e,t,r){return t.type==IDENTIFIER&&t.value===n.callback||t._isWrapper?r:e},-1)}var s=e.children[1],o=a(s);_assert(o>=0);var c=s.children[o]._returnArray;s.children[o]._isWrapper&&(s=s.children[o].children[1],o=a(s));for(var u=e.children[0];u.type==DOT;)u=u.children[1];var l=n.source.lastIndexOf("\n",u.start)+1,p=u.start-l;s.children[o]=(i?0===i.indexOf("__")?_cbTemplates.CALL_TMP:_cbTemplates.CALL_RESULT:_cbTemplates.CALL_VOID).generate(e,{
$v:_genId(e),$frameName:_string(e._scope.name),$offset:_number(originalLine(n,u.lineno,p)-originalLine(n,e._scope.line)),$col:_number(originalCol(n,u.lineno,p)),$name:"__$"+e._scope.name,$returnArray:c,$result:i,$tail:r}),e=_propagate(e,t);var f=_node(e,RETURN,[]);return f.value=e,f._pass="cb",f}var o=e.children[i];if("cb"===o._pass)return _propagate(o,t);switch(o.type){case RETURN:r(e,i);var c=o.value?_cbTemplates.RETURN:_cbTemplates.RETURN_UNDEFINED;o=c.generate(o,{$value:o.value});break;case THROW:r(e,i),o=_cbTemplates.THROW.generate(o,{$exception:o.exception});break;case BREAK:if(o.target&&!o.target._async)break;r(e,i),o=o.label?_cbTemplates.LABELLED_BREAK.generate(o,{$break:_safeName(n.precious,"__break__"+o.label)}):_cbTemplates.BREAK.generate(o,{});break;case CONTINUE:if(o.target&&!o.target._async)break;r(e,i),o=o.label?_cbTemplates.LABELLED_CONTINUE.generate(o,{$loop:_safeName(n.precious,"__loop__"+o.label),$more:_safeName(n.precious,"__more__"+o.label)}):_cbTemplates.CONTINUE.generate(o,{});break;case TRY:var u=r(e,i);o=o.catchClauses[0]?_cbTemplates.CATCH.generate(o,{$name:"__$"+o._scope.name,$try:o.tryBlock,$catch:o.catchClauses[0].block,$ex:o.catchClauses[0].varName,$tail:u}):_cbTemplates.FINALLY.generate(o,{$name:"__$"+o._scope.name,$try:o.tryBlock,$finally:o.finallyBlock,$tail:u});break;default:if(o._async){var u=r(e,i);switch(o.type){case IF:o=_cbTemplates.IF.generate(o,{$name:"__$"+o._scope.name,$condition:o.condition,$then:o.thenPart,$else:o.elsePart||_node(o,BLOCK,[]),$tail:u});break;case SWITCH:o._pass="cb",o=_cbTemplates.SWITCH.generate(o,{$name:"__$"+o._scope.name,$statement:o,$tail:u});break;case LABEL:var l=a;return a=o.label,o=_cbTemplates.LABEL.generate(o,{$name:"__$"+o._scope.name,$statement:o.statement,$tail:u}),o=t(o,e),a=l,o;case FOR:var p=_identifier(_genId(o)),f=_cbTemplates.LOOP1.generate(o,{$v:p,$body:o.body}),d=o.update,_=d&&_identifier(_genId(o)),h=(d?_cbTemplates.LOOP2_UPDATE:_cbTemplates.LOOP2).generate(o,{$v:p,$condition:o.condition,$beenHere:_,$update:_statementify(d),$loop1:f});o=(d?a?_cbTemplates.LABELLED_FOR_UPDATE:_cbTemplates.FOR_UPDATE:a?_cbTemplates.LABELLED_FOR:_cbTemplates.FOR).generate(o,{$name:"__$"+o._scope.name,$loop:_identifier(_safeName(n.precious,"__loop__"+a)),$break:_identifier(_safeName(n.precious,"__break__"+a)),$more:_identifier(_safeName(n.precious,"__more__"+a)),$beenHere:_,$loop2:h,$tail:u});break;case VAR:_assert(1==o.children.length);var m=o.children[0];_assert(m.type===IDENTIFIER);var E=m.initializer;return delete m.initializer,_assert(E&&E.type===CALL),s(E,u,m.value);case SEMICOLON:var E=o.expression;return _assert(E.type===CALL),s(E,u);default:throw new Error("internal error: bad node type: "+_tag(o)+": "+pp(o))}}}return t(o,e)}var a;return _propagate(e,t)}function _checkUsed(e,n){"string"==typeof e&&"__"===e.substring(0,2)&&(n[e]=!0)}function _simplify(e,n,t){function r(e,n,t,i){var a=["parenthesized","lineno","start","end","tokenizer","hasReturnWithValue"];if(0==e.indexOf("_")||a.indexOf(e)>=0)return!0;if(n==t)return!0;if(null==n||null==t)return!("children"!=e||!n||0!==n.length);if(Array.isArray(n)){if(n.length!=t.length)return!1;for(var s=0;s<n.length;s++)if(!r(e,n[s],t[s],i))return!1;return!0}if(n.type===IDENTIFIER&&"$"===n.value[0]&&t.type===NUMBER)return i[n.value]=t.value,!0;if("string"==typeof n&&"$"==n[0]&&"string"==typeof t)return i[n]=t,!0;if(n.type){var o;if(n.type==SCRIPT&&n.children[0]&&(o=n.children[0].expression)&&"string"==typeof o.value&&"$"==o.value[0])return i[o.value]=t,!0;if(n.type!=t.type)return!1;if(n.type==IDENTIFIER&&"$"==n.value)return i[n.value]=t.value,!0;for(var e in n)if(n.hasOwnProperty(e)&&e.indexOf("Decls")<0&&"target"!=e&&!r(e,n[e],t[e],i))return!1;return!0}return!1}if(e._simplified)return e;e._simplified=!0,_propagate(e,function(e){return _simplify(e,n,t)}),_checkUsed(e.value,t);var i={};return r("",_optims.function__0$fn,e,i)?_identifier(i.$fn):!r("",_optims.function$return,e,i)||"___"!==i.$fn1&&0!==i.$fn1.indexOf("__$")||"__break"!==i.$fn2?r("",_optims.function__0$arg1return_null$arg2,e,i)&&i.$arg1==i.$arg2?_identifier("_"):n.optimize&&r("",_optims.__cb__,e,i)?_identifier("_"):n.optimize&&r("",_optims.__cbt__,e,i)?_identifier("_"):!r("",_optims.function$fn,e,i)||"___"!==i.$fn1&&0!==i.$fn1.indexOf("__$")||"__then"!==i.$fn2&&"__loop"!==i.$fn2?(r("",_optims.closure,e,i)&&(e.children[1]=_identifier("_")),!r("",_optims.safeParam,e,i)||"__then"!==i.$param&&"__break"!==i.$param||(e.children[1]=_identifier("_")),_flatten(e),e):_identifier(i.$fn2):_identifier(i.$fn2)}function _extend(e,n){for(var t in n)e[t]=n[t];return e}function _cl(e){return _extend({},e)}function _trim(e){return e.toString().replace(/\s+/g," ")}function include(e,n){var t=n+"['"+e+"']=(mod={exports:{}});";t+="(function(module, exports){";var r=srequire;return t+=r("fs").readFileSync(__dirname+"/../"+e+".js","utf8").replace(/(\/\/[^"\n]*\n|\/\*[\s\S]*?\*\/|\n)[ \t]*/g,""),t+="})(mod, mod.exports);"}function requireRuntime(e){if(!e.standalone)return"srequire('streamline/lib/callbacks/runtime').runtime(__filename, "+!!e.oldStyleFutures+")";var n=_safeName(e.precious,"__modules"),t="(function(){var "+n+"={},mod;";return t+="function srequire(p){var m="+n+"[p.substring(15)]; return m && m.exports};",t+=include("globals",n),t+=include("util/future",n),t+=include("callbacks/runtime",n),["funnel","forEach_","map_","filter_","every_","some_","reduce_","reduceRight_","sort_","apply_"].some(function(n){return e.precious[n]})&&(t+=include("callbacks/builtins",n)),t+="return "+n+"['callbacks/runtime'].exports.runtime('"+e.sourceName+"', "+!!e.oldStyleFutures+");",t+="})()"}exports.version=srequire("streamline/lib/version").version+" (callbacks)";var parse=Narcissus.parser.parse,pp=Narcissus.decompiler.pp,definitions=Narcissus.definitions;eval(definitions.consts.replace(/const /g,"var "));var _rootTemplate=new Template("root","(function main(_){ $script }).call(this, __trap);"),_assignTemplate=new Template("canon","$lhs = $rhs;"),_switchVarTemplate=new Template("canon","{ var $v = true; }"),_switchIfTemplate=new Template("canon","if ($v) { $block; }"),_flowsTemplates={WHILE:new Template("flows","{	for (; $condition;) {		$body;	}}"),DO:new Template("flows","{	var $firstTime = true;	for (; $firstTime || $condition;) {		$firstTime = false;		$body;	}}"),FOR:new Template("flows","{	$setup;	for (; $condition; $update) {		$body;	}}"),FOR_IN:new Template("flows","{	var $array = __forIn($object);	var $i = 0;	for (; $i < $array.length;) {		$iter = $array[$i++];		$body;	}}"),TRY:new Template("flows","try {	try { $try; }	catch ($ex) { $catch; }}finally { $finally; }"),AND:new Template("flows","return (function $name(_){	var $v = $op1;	if (!$v) {		return $v;	}	return $op2;})(_)",!0,!0),OR:new Template("flows","return (function $name(_){	var $v = $op1;	if ($v) {		return $v;	}	return $op2;})(_)",!0,!0),HOOK:new Template("flows","return (function $name(_){	var $v = $condition;	if ($v) {		return $true;	}	return $false;})(_);",!0,!0),COMMA:new Template("flows","return (function $name(_){	$body;	return $result;})(_);",!0,!0),CONDITION:new Template("flows","return (function $name(_){	return $condition;})(_);",!0,!0),UPDATE:new Template("flows","return (function $name(_){	$update;})(_);",!0,!0)},_cbTemplates={FUNCTION:new Template("cb","{	$decls;	var __frame = { name: $fname, line: $line };	return __func(_, this, arguments, $fn, $index, __frame, function $name(){		$body;		_();	});}"),FUNCTION_INTERNAL:new Template("cb","{ $decls; $body; _(); }"),RETURN:new Template("cb","return _(null, $value);"),RETURN_UNDEFINED:new Template("cb","return _(null);"),THROW:new Template("cb","return _($exception);"),IF:new Template("cb","return (function $name(__then){	if ($condition) { $then; __then(); }	else { $else; __then(); }})(function $name(){ $tail; });"),SWITCH:new Template("cb","return (function $name(__break){	$statement;})(function $name(){ $tail; });"),LABEL:new Template("cb","$statement;$tail;"),BREAK:new Template("cb","return __break();"),LABELLED_BREAK:new Template("cb","return $break();"),CONTINUE:new Template("cb","while (__more) { __loop(); } __more = true;return;"),LABELLED_CONTINUE:new Template("cb","while ($more.get()) { $loop(); } $more.set(true);return;"),LOOP1:new Template("cb","if ($v) {	$body;	while (__more) { __loop(); } __more = true;}else { __break(); }"),LOOP2:new Template("temp","var $v = $condition; $loop1;"),LOOP2_UPDATE:new Template("temp","if ($beenHere) { $update; } else { $beenHere = true; }var $v = $condition; $loop1;"),FOR:new Template("cb","return (function ___(__break){	var __more;	var __loop = __cb(_, __frame, 0, 0, function $name(){		__more = false;		$loop2	});	do { __loop(); } while (__more); __more = true;})(function $name(){ $tail;});"),LABELLED_FOR:new Template("cb","return (function ___(__break){	var __more, $more = { get: function() { return __more; }, set: function(v) { __more = v; }};	var __loop = __cb(_, __frame, 0, 0, function $name(){		var $break = __break, $loop = __loop;		__more = false;		$loop2	});	do { __loop(); } while (__more); __more = true;})(function $name(){ $tail;});"),FOR_UPDATE:new Template("cb","var $beenHere = false;return (function ___(__break){	var __more;	var __loop = __cb(_, __frame, 0, 0, function $name(){		__more = false;		$loop2	});	do { __loop(); } while (__more); __more = true;})(function $name(){ $tail; });"),LABELLED_FOR_UPDATE:new Template("cb","var $beenHere = false;return (function ___(__break){	var __more, $more = { get: function() { return __more; }, set: function(v) { __more = v; }};	var __loop = __cb(_, __frame, 0, 0, function $name(){		var $break = __break, $loop = __loop;		__more = false;		$loop2	});	do { __loop(); } while (__more); __more = true;})(function $name(){ $tail; });"),CATCH:new Template("cb","return (function ___(__then){	(function ___(_){		__tryCatch(_, function $name(){ $try; __then(); });	})(function ___($ex, __result){		__catch(function $name(){			if ($ex) { $catch; __then(); }			else { _(null, __result); }		});	});})(function ___(){	__tryCatch(_, function $name(){ $tail; });});"),FINALLY:new Template("cb","return (function ___(__then){	(function ___(_){		__tryCatch(_, function $name(){ $try; _(null, null, true); });	})(function ___(__e, __r, __cont){		(function ___(__then){			__tryCatch(_, function $name(){ $finally; __then(); });		})(function ___(){			__tryCatch(_, function ___(){				if (__cont) __then(); else _(__e, __r);			});		})	});})(function ___(){	__tryCatch(_, function $name(){ $tail; });});"),CALL_VOID:new Template("cb","return __cb(_, __frame, $offset, $col, function $name(){ $tail; }, true, $returnArray)",!0),CALL_TMP:new Template("cb","return __cb(_, __frame, $offset, $col, function ___(__0, $result){ $tail }, true, $returnArray)",!0),CALL_RESULT:new Template("cb","return __cb(_, __frame, $offset, $col, function $name(__0, $v){	var $result = $v;	$tail}, true, $returnArray)",!0)},_optims={function__0$fn:new Template("simplify","return function ___(__0) { $fn(); }",!0).root,function$return:new Template("simplify","return function $fn1() { return $fn2(); }",!0).root,function__0$arg1return_null$arg2:new Template("simplify","return function ___(__0, $arg1) { return _(null, $arg2); }",!0).root,__cb__:new Template("simplify","return __cb(_, $frameVar, $line, $col, _)",!0).root,__cbt__:new Template("simplify","return __cb(_, $frameVar, $line, $col, _, true)",!0).root,function$fn:new Template("simplify","return function $fn1() { $fn2(); }",!0).root,closure:new Template("simplify","return (function ___closure(_){ $body; })(__cb(_,$frameVar,$line,$col,function $fnName(){_();},true))",!0).root,safeParam:new Template("simplify","return (function $fnName($param){ $body; })(function $fnName(){_();})",!0).root};exports.transform=function(e,n){try{e=e.replace(/\r\n/g,"\n"),n=n?_extend({},n):{};var t=/streamline\.options\s*=\s*(\{.*\})/.exec(e);t&&_extend(n,JSON.parse(t[1])),n.source=e,n.callback=n.callback||"_",n.lines=n.lines||"preserve",n.precious={};var r=parse(e+"\n",n.sourceName),i=r.children[0]&&r.children[0].expression&&"use strict"==r.children[0].expression.value;if(i&&r.children.splice(0,1),_markSource(r,n),r=_canonTopLevelScript(r,n),r=_canonScopes(r,n),!n.needsTransform)return e;r=_canonFlows(r,n),r=_disassemble(r,n),r=_callbackify(r,n);var a={};r=_simplify(r,n,a);var s=format(r,n.lines);if(!n.noHelpers){var o=exports.helpersSource(n,a,i);"sourcemap"==n.lines?s.prepend(o):s=o+s}return s}catch(c){var u="error streamlining "+(n.sourceName||"source")+": "+c.message;if(c.source&&c.cursor){for(var l=1,p=0;p<c.cursor;p++)"\n"===c.source[p]&&(l+=1);u+=" on line "+l}else c.stack&&(u+="\nSTACK:\n"+c.stack);throw new Error(u)}},exports.transform.version=exports.version,exports.helpersSource=function(e,n,t){var r=""+e.sourceName,i=r.indexOf("node_modules/");-1==i&&"object"==typeof process&&"function"==typeof process.cwd&&(i=process.cwd().length),r=i>=0?r.substring(i+13):r;var a="preserve"==e.lines?" ":"\n";t=t?'"use strict";'+a:"";var s=a+t,o=["__g","__func","__cb","__future","__propagate","__trap","__catch","__tryCatch","__forIn","__apply","__construct","__setEF"],c=_safeName(e.precious,"__rt");return s+="var "+c+"="+requireRuntime(e),o.forEach(function(t){var r=_safeName(e.precious,t);n[r]&&(s+=","+r+"="+c+"."+t)}),s+=";"+a}}("undefined"!=typeof exports?exports:window.Streamline=window.Streamline||{}),function(e){e.future=function(e,n,t){var r,i,a,s=[],o=this;return n=Array.prototype.slice.call(n),n[t]=function(e,n){r=e,i=n,a=!0,s&&s.forEach(function(t){t.call(o,e,n)}),s=null},e.apply(this,n),function c(e){if("function"!=typeof e){if(e!==!1&&!srequire("streamline/lib/globals").oldStyleFutures)throw new Error("no callback given (argument #0). If you're a Streamline user, more info: https://github.com/Sage/streamlinejs/blob/master/FAQ.md#no-callback-given-error");return c}a?e.call(o,r,i):s.push(e)}},e.streamlinify=function(n,t){return function(){return arguments[t]?n.apply(this,arguments):e.future.call(this,n,arguments,t)}}}("undefined"!=typeof exports?exports:Streamline.future=Streamline.future||{}),function(e){function n(e,n,r,i,a,s,o){n.offset=r,n.col=i;var c=l.context;return function p(r,i){o&&(i=Array.prototype.slice.call(arguments,1)),o=!1;var f=l.frame;l.frame=n,l.context=c,0===l.depth&&l.emitter&&l.emitter.emit("resume"),l.depth++;try{if(!(s&&n.active&&l.trampoline))return p.dispatched=!0,r?(u(r,n),e(r)):(n.active=!0,a(null,i));l.trampoline.queue(function(){return p(r,i)})}catch(d){return t(e,d)}finally{n.active=!1,l.frame=f,0===--l.depth&&l.trampoline&&l.trampoline.flush(),0===l.depth&&l.emitter&&l.emitter.emit("yield")}}}function t(e,n){try{e(n)}catch(t){r(t)}}function r(e){e&&(l.context&&l.context.errorHandler?l.context.errorHandler(e):process.nextTick(function(){throw e}))}function i(e,n){try{n()}catch(t){try{e(t)}catch(i){r(i)}}}function a(e){var n=l.frame,t=l.context;l.trampoline.queue(function(){var r=l.frame,i=l.context;l.frame=n,l.context=t;try{e()}finally{l.frame=r,l.context=i}})}function s(e){var n=[];for(var t in e)n.push(t);return n}function o(e,n,t,r,i){return null==e?p.future(o,arguments,0):(r=Array.prototype.slice.call(r,0),r[null!=i?i:r.length]=e,n.apply(t,r))}function c(e,n){var t="__async"+n;return e[t]||(e[t]=function(){function t(){var t=this,i=r[n];return r[n]=function(e,n){i(e,t)},e.apply(t,r)}var r=arguments;return t.prototype=e.prototype,new t})}function u(n,t){function r(e,n){var t="object"==typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1;t&&(n="Error: "+e.message+"\n"+n);var r,i,a=n;if(a){var s=a.split("\n");a=s[0]+"\n    <<< async stack >>>\n"+s.slice(1).map(function(e){var n="object"==typeof navigator&&"function"==typeof srequire&&srequire.async?11:0,t=/([^@]*)\@(.*?)\:(\d+)(?:\:(\d+))?$/.exec(e);e=t?"    at "+t[1]+" ("+t[2]+":"+(parseInt(t[3])-n)+":"+(t[4]||"0")+")":e;var r=e.indexOf("__$");return r>=0&&!i?(i=!0,e.substring(0,r)+e.substring(r+3)):i?"":e}).filter(function(e){return e}).join("\n");for(var r=e.__frame;r;r=r.prev)r.offset>=0&&(a+="\n    at "+r.name+" ("+r.file+":"+(r.line+r.offset)+":"+(r.col+1)+")")}var o=n.indexOf("\n");return a+="\n    <<< raw stack >>>"+(o>=0?n.substring(o):n)}if(n.__frame=n.__frame||t,e.stackTraceEnabled&&n.__lookupGetter__&&null==n.__lookupGetter__("rawStack")){var i=n.__lookupGetter__("stack");if(!i){var a=n.stack||"raw stack unavailable";i=function(){return a}}n.__defineGetter__("rawStack",i),n.__defineGetter__("stack",function(){return r(n,i())})}}var l=srequire("streamline/lib/globals");l.runtime="callbacks";var p=srequire("streamline/lib/util/future");l.context=l.context||{},l.depth=l.depth||0,l.trampoline=function(){var e=[];return{queue:function(n){e.push(n)},flush:function(){l.depth++;try{for(var n;n=e.shift();)n()}finally{l.depth--}}}}(),e.runtime=function(e,f){function d(n,r,i,a,s,o,c){if("function"!=typeof n){if(n!==!1&&!l.oldStyleFutures)throw new Error("no callback given (argument #"+s+"). If you're a Streamline user, more info: https://github.com/Sage/streamlinejs/blob/master/FAQ.md#no-callback-given-error");return p.future.call(r,a,i,s)}o.file=e,o.prev=l.frame,l.frame=o,0===l.depth&&l.emitter&&l.emitter.emit("resume"),l.depth++;try{o.active=!0,c()}catch(u){t(n,u)}finally{o.active=!1,l.frame=o.prev,0===--l.depth&&l.trampoline&&l.trampoline.flush(),0===l.depth&&l.emitter&&l.emitter.emit("yield")}}return l.oldStyleFutures=f,{__g:l,__func:d,__cb:n,__future:p.future,__propagate:t,__trap:r,__tryCatch:i,__catch:a,__forIn:s,__apply:o,__construct:c,__setEF:u,streamlinify:p.streamlinify}},e.stackTraceEnabled=!0}("undefined"!=typeof exports?exports:Streamline.runtime=Streamline.runtime||{}),srequire&&srequire("streamline/lib/callbacks/builtins");var __rt=srequire("streamline/lib/callbacks/runtime").runtime(__filename,!1),__func=__rt.__func,__cb=__rt.__cb;!function(e){"use strict";function n(e){return"number"==typeof e?e:"number"==typeof e.parallel?e.parallel:e.parallel?-1:1}var t=3,r=function(e,n,t){var r,i,a,s=[],o=this;return n=Array.prototype.slice.call(n),n[t]=function(e,n){r=e,i=n,a=!0,s&&s.forEach(function(t){t.call(o,e,n)}),s=null},e.apply(this,n),function c(e){return e?void(a?e.call(o,r,i):s.push(e)):c}};e.funnel=function(e){if(e=null==e?-1:e,0===e&&(e=i.defaultSize),"number"!=typeof e)throw new Error("bad max number: "+e);var n=[],t=0,a=!1,s=function(i,o){function c(){var r=n.splice(0,1)[0];return r.cb?(t++,void r.fn(function(i,s){if(t--,!a)for(r.cb(i,s);e>t&&n.length>0;)c()})):r.fn()}if(null==i)return r(s,arguments,0);if(0>e||e==1/0)return o(i);for(n.push({fn:o,cb:i});e>t&&n.length>0;)c()},o=__rt.streamlinify(s,0);return o.close=function(){n=[],a=!0},o};var i=e.funnel;if(i.defaultSize=4,!(Array.prototype.forEach_&&Array.prototype.forEach_.version_>=t)){try{Object.defineProperty({},"x",{})}catch(a){return}var s=Object.prototype.hasOwnProperty;delete Array.prototype.forEach_,Object.defineProperty(Array.prototype,"forEach_",{configurable:!0,writable:!0,enumerable:!1,value:function o(e,t,r,i){var a,c,u,l=this,p={name:"value__1",line:124};return __func(e,this,arguments,o,0,p,function(){return"function"==typeof t&&(i=r,r=t,t=1),a=n(t),i=void 0!==i?i:l,c=l.length,function(n){if(1===a||1>=c){u=0;var t=!1;return function(n){var a,o=__cb(e,p,0,0,function(){a=!1,t?u++:t=!0;var f=c>u;return f?function(n){return s.call(l,u)?r.call(i,__cb(e,p,7,31,n,!0),l[u],u):void n()}(function(){for(;a;)o();a=!0}):void n()});do o();while(a);a=!0}(n)}return l.map_(__cb(e,p,10,9,n,!0),a,r,i)}(function(){return e(null,l)})})}}),Array.prototype.forEach_.version_=t,delete Array.prototype.map_,Object.defineProperty(Array.prototype,"map_",{configurable:!0,writable:!0,enumerable:!1,value:function c(e,t,r,a){var o,u,l,p,f,d=this,_={name:"value__2",line:147};return __func(e,this,arguments,c,0,_,function(){return"function"==typeof t&&(a=r,r=t,t=1),o=n(t),a=void 0!==a?a:d,u=d.length,function(n){if(1===o||1>=u){l=new Array(u),p=0;var t=!1;return function(n){var i,o=__cb(e,_,0,0,function(){i=!1,t?p++:t=!0;var c=u>p;return c?function(n){return s.call(d,p)?r.call(a,__cb(e,_,9,43,function(e,t){l[p]=t,n()},!0),d[p],p):void n()}(function(){for(;i;)o();i=!0}):void n()});do o();while(i);i=!0}(n)}f=i(o),l=d.map(function(e,n){return f(!1,function t(i){var s={name:"__1",line:161};return __func(i,this,arguments,t,0,s,function(){return r.call(a,__cb(i,s,1,16,i,!0),e,n)})})}),p=0;var c=!1;return function(n){var t,r=__cb(e,_,0,0,function(){t=!1,c?p++:c=!0;var i=u>p;return i?function(n){return s.call(d,p)?l[p](__cb(e,_,19,40,function(e,t){l[p]=t,n()},!0)):void n()}(function(){for(;t;)r();t=!0}):void n()});do r();while(t);t=!0}(n)}(function(){return e(null,l)})})}}),delete Array.prototype.filter_,Object.defineProperty(Array.prototype,"filter_",{configurable:!0,writable:!0,enumerable:!1,value:function u(e,t,r,i){var a,o,c,l,p,f=this,d={name:"value__3",line:179};return __func(e,this,arguments,u,0,d,function(){return"function"==typeof t&&(i=r,r=t,t=1),a=n(t),i=void 0!==i?i:f,o=[],c=f.length,function(n){if(1===a||1>=c){l=0;var t=!1;return function(n){var a,u=__cb(e,d,0,0,function(){a=!1,t?l++:t=!0;var _=c>l;return _?function(n){return s.call(f,l)?(p=f[l],r.call(i,__cb(e,d,10,13,function(e,t){return function(e){t?(o.push(p),e()):e()}(n)},!0),p)):void n()}(function(){for(;a;)u();a=!0}):void n()});do u();while(a);a=!0}(n)}return f.map_(__cb(e,d,14,9,n,!0),a,function u(e,n){var t={name:"__1",line:193};return __func(e,this,arguments,u,0,t,function(){return r.call(i,__cb(e,t,1,12,function(t,r){return function(e){r?(o.push(n),e()):e()}(e)},!0),n)})},i)}(function(){return e(null,o)})})}}),delete Array.prototype.every_,Object.defineProperty(Array.prototype,"every_",{configurable:!0,writable:!0,enumerable:!1,value:function l(e,t,r,a){var o,c,u,p,f,d=this,_={name:"value__4",line:207};return __func(e,this,arguments,l,0,_,function(){return"function"==typeof t&&(a=r,r=t,t=1),o=n(t),a=void 0!==a?a:d,c=d.length,function(n){if(1===o||1>=c){u=0;var t=!1;return function(n){var i,o=__cb(e,_,0,0,function(){i=!1,t?u++:t=!0;var l=c>u;return l?function(e){var n=s.call(d,u);return n?r.call(a,__cb(e,_,8,34,function(n,t){var r=!t;return e(null,r)},!0),d[u]):e(null,n)}(__cb(e,_,-206,17,function(n,t){return function(n){return t?e(null,!1):void n()}(function(){for(;i;)o();i=!0})},!0)):void n()});do o();while(i);i=!0}(n)}p=i(o),f=d.map(function(e){return p(!1,function n(t){var i={name:"__1",line:220};return __func(t,this,arguments,n,0,i,function(){return r.call(a,__cb(t,i,1,16,t,!0),e)})})}),u=0;var l=!1;return function(n){var t,r=__cb(e,_,0,0,function(){t=!1,l?u++:l=!0;var i=c>u;return i?function(e){var n=s.call(d,u);return n?f[u](__cb(e,_,18,31,function(n,t){var r=!t;return e(null,r)},!0)):e(null,n)}(__cb(e,_,-206,17,function(n,i){return function(n){return i?(p.close(),e(null,!1)):void n()}(function(){for(;t;)r();t=!0})},!0)):void n()});do r();while(t);t=!0}(n)}(function(){return e(null,!0)})})}}),delete Array.prototype.some_,Object.defineProperty(Array.prototype,"some_",{configurable:!0,writable:!0,enumerable:!1,value:function p(e,t,r,a){var o,c,u,l,f,d=this,_={name:"value__5",line:241};return __func(e,this,arguments,p,0,_,function(){return"function"==typeof t&&(a=r,r=t,t=1),o=n(t),a=void 0!==a?a:d,c=d.length,function(n){if(1===o||1>=c){u=0;var t=!1;return function(n){var i,o=__cb(e,_,0,0,function(){i=!1,t?u++:t=!0;var l=c>u;return l?function(e){var n=s.call(d,u);return n?r.call(a,__cb(e,_,7,33,e,!0),d[u]):e(null,n)}(__cb(e,_,-240,17,function(n,t){return function(n){return t?e(null,!0):void n()}(function(){for(;i;)o();i=!0})},!0)):void n()});do o();while(i);i=!0}(n)}l=i(o),f=d.map(function(e){return l(!1,function n(t){var i={name:"__1",line:253};return __func(t,this,arguments,n,0,i,function(){return r.call(a,__cb(t,i,1,16,t,!0),e)})})}),u=0;var p=!1;return function(n){var t,r=__cb(e,_,0,0,function(){t=!1,p?u++:p=!0;var i=c>u;return i?function(e){var n=s.call(d,u);return n?f[u](__cb(e,_,17,30,e,!0)):e(null,n)}(__cb(e,_,-240,17,function(n,i){return function(n){return i?(l.close(),e(null,!0)):void n()}(function(){for(;t;)r();t=!0})},!0)):void n()});do r();while(t);t=!0}(n)}(function(){return e(null,!1)})})}}),delete Array.prototype.reduce_,Object.defineProperty(Array.prototype,"reduce_",{configurable:!0,writable:!0,enumerable:!1,value:function f(e,n,t,r){var i,a,o=this,c={name:"value__6",line:274};return __func(e,this,arguments,f,0,c,function(){r=void 0!==r?r:o,i=o.length,a=0;var u=!1;return function(l){var p,f=__cb(e,c,0,0,function(){p=!1,u?a++:u=!0;var d=i>a;return d?function(i){return s.call(o,a)?n.call(r,__cb(e,c,4,34,function(e,n){t=n,i()},!0),t,o[a],a,o):void i()}(function(){for(;p;)f();p=!0}):void l()});do f();while(p);p=!0}(function(){return e(null,t)})})}}),delete Array.prototype.reduceRight_,Object.defineProperty(Array.prototype,"reduceRight_",{configurable:!0,writable:!0,enumerable:!1,value:function d(e,n,t,r){var i,a,o=this,c={name:"value__7",line:290};return __func(e,this,arguments,d,0,c,function(){r=void 0!==r?r:o,i=o.length,a=i-1;var u=!1;return function(i){var l,p=__cb(e,c,0,0,function(){l=!1,u?a--:u=!0;var f=a>=0;return f?function(i){return s.call(o,a)?n.call(r,__cb(e,c,4,34,function(e,n){t=n,i()},!0),t,o[a],a,o):void i()}(function(){for(;l;)p();l=!0}):void i()});do p();while(l);l=!0}(function(){return e(null,t)})})}}),delete Array.prototype.sort_,Object.defineProperty(Array.prototype,"sort_",{configurable:!0,writable:!0,enumerable:!1,value:function _(e,n,t,r){function i(e,t,r){var s,o,c,u,l,p={name:"_qsort",line:313};return __func(e,this,arguments,i,0,p,function(){return t>=r?e(null):function(i){return r==t+1?n(__cb(e,p,4,9,function(n,i){var o=i>0;return function(e){o?(s=a[t],a[t]=a[r],a[r]=s,e()):e()}(function(){return e(null)})},!0),a[t],a[r]):void i()}(function(){return o=Math.floor((t+r)/2),c=a[o],u=t,l=r,function(i){var o,f=__cb(e,p,0,0,function(){o=!1;var d=l>=u;return d?function(t){var i,s=__cb(e,p,0,0,function(){return i=!1,function(e){return function(e){var t=r>u;return t?n(__cb(e,p,18,26,function(n,t){var r=0>t;return e(null,r)},!0),a[u],c):e(null,t)}(__cb(e,p,-312,17,e,!0))}(__cb(e,p,-312,17,function(e,n){if(n){for(u++;i;)s();i=!0}else t()},!0))});do s();while(i);i=!0}(function(){return function(r){var i,s=__cb(e,p,0,0,function(){return i=!1,function(e){return function(e){var r=l>t;return r?n(__cb(e,p,19,26,function(n,t){var r=0>t;return e(null,r)},!0),c,a[l]):e(null,r)}(__cb(e,p,-312,17,e,!0))}(__cb(e,p,-312,17,function(e,n){if(n){for(l--;i;)s();i=!0}else r()},!0))});do s();while(i);i=!0}(function(){for(l>=u&&(s=a[u],a[u]=a[l],a[l]=s,u++,l--);o;)f();o=!0})}):void i()});do f();while(o);o=!0}(function(){return function(n){return r>u?i(__cb(e,p,30,20,n,!0),u,r):void n()}(function(){return function(n){return l>t?i(__cb(e,p,31,20,n,!0),t,l):void n()}(e)})})})})}var a,s=this,o={name:"value__8",line:308};return __func(e,this,arguments,_,0,o,function(){return a=s,t=t||0,r=null==r?a.length-1:r,i(__cb(e,o,38,3,function(){return e(null,a)},!0),t,r)})}}),delete Function.prototype.apply_,Object.defineProperty(Function.prototype,"apply_",{configurable:!0,writable:!0,enumerable:!1,value:function(e,n,t,r){return t=Array.prototype.slice.call(t,0),t.splice(null!=r&&r>=0?r:t.length,0,e),this.apply(n,t)}})}}("undefined"!=typeof exports?exports:Streamline.builtins=Streamline.builtins||{});